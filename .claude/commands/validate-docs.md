# /validate-docs - 验证文档完整性

请验证项目文档的质量和完整性，生成验证报告。

## 你的任务

1. **扫描项目结构**
   - 使用Grep搜索所有System类（模式：`class.*ServerSystem|ClientSystem`）
   - 统计Systems总数

2. **检查文档覆盖率**
   - 对于每个System，检查是否存在对应文档（路径：`markdown/systems/{SystemName}.md`）
   - 分类统计：
     - 已覆盖（有文档）
     - 未覆盖（无文档）
     - 低质量（质量分数<50分）

3. **评估文档质量**（0-100分评分标准）
   - 存在性：20分
   - 字数：25分（>=1500字得满分，>=800字15分，>=300字10分，<300字5分）
   - 章节完整度：25分（检查是否包含"概述"、"架构"、"数据流"、"API"等章节）
   - 代码示例：15分（检查是否包含```代码块）
   - 更新时间：15分（使用git log -1 --format=%ct检查，<30天15分，<90天10分，<180天5分）

4. **生成验证报告**（格式如下）

---

## 执行流程示例

### 步骤1：扫描项目结构

1. 扫描所有Systems（使用Grep搜索 `class.*ServerSystem|ClientSystem`）
2. 扫描markdown/目录中的所有文档

### 步骤2：检查文档覆盖率

对于每个System，检查是否存在对应文档：

```python
文档覆盖情况 = {
    "已覆盖": [],  # 有文档的Systems
    "未覆盖": [],  # 没有文档的Systems
    "低质量": [],  # 文档质量<50分的Systems
}

for system in 所有Systems:
    文档路径 = "markdown/systems/{}.md".format(system.name)

    if 文档存在(文档路径):
        质量分数 = 评估文档质量(文档路径)
        if 质量分数 >= 50:
            文档覆盖情况["已覆盖"].append(system)
        else:
            文档覆盖情况["低质量"].append(system)
    else:
        文档覆盖情况["未覆盖"].append(system)
```

### 步骤3：评估文档质量

对已存在的文档进行质量评分（0-100分）：

```python
def 评估文档质量(文档路径):
    """
    评分标准:
    - 存在性: 20分
    - 字数: 25分（>=1500字得满分）
    - 章节完整度: 25分（包含概述、架构、数据流等）
    - 代码示例: 15分
    - 更新时间: 15分（<30天得满分）
    """

    分数 = 20  # 基础分

    # 读取文档
    content = Read(file_path=文档路径)

    # 字数评分
    字数 = len(content)
    if 字数 >= 1500:
        分数 += 25
    elif 字数 >= 800:
        分数 += 15
    elif 字数 >= 300:
        分数 += 10
    else:
        分数 += 5

    # 章节完整度
    必需章节 = ["概述", "架构", "数据流", "API"]
    现有章节 = 提取章节标题(content)
    匹配度 = 匹配数量 / len(必需章节)
    分数 += int(匹配度 * 25)

    # 代码示例
    if "```" in content:
        分数 += 15

    # 更新时间
    最后修改时间 = 获取文件修改时间(文档路径)
    天数 = 当前时间 - 最后修改时间
    if 天数 < 30:
        分数 += 15
    elif 天数 < 90:
        分数 += 10
    elif 天数 < 180:
        分数 += 5

    return min(分数, 100)
```

### 步骤4：生成验证报告

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 文档完整性验证报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 📈 文档覆盖率

- 总Systems数量: X
- 已覆盖: Y (Z%)
- 未覆盖: A (B%)
- 低质量: C (D%)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 📚 文档质量分布

| 质量等级 | 数量 | 比例 |
|---------|------|------|
| 优秀 (80-100分) | X | Y% |
| 良好 (60-79分) | X | Y% |
| 一般 (40-59分) | X | Y% |
| 较差 (<40分) | X | Y% |

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## ❌ 缺失文档（未覆盖的Systems）

1. CombatSystem
2. WeaponSystem
...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## ⚠️  低质量文档（需要改进）

| System | 当前分数 | 主要问题 |
|--------|---------|---------|
| AttributeSystem | 35分 | 缺少数据流、无代码示例 |
| SkillSystem | 42分 | 字数不足、缺少章节 |
...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 💡 改进建议

1. ✅ 使用 /enhance-docs 批量补充缺失文档
2. ✅ 为低质量文档补充以下内容：
   - 完整的数据流图
   - 具体的代码示例
   - 常见问题和解决方案
3. ✅ 在开发过程中持续更新文档（通过 /cc 命令的自学习机制）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 输出报告格式

```markdown
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 文档完整性验证报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 📈 文档覆盖率

- 总Systems数量: X
- 已覆盖: Y (Z%)
- 未覆盖: A (B%)
- 低质量: C (D%)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 📚 文档质量分布

| 质量等级 | 数量 | 比例 |
|---------|------|------|
| 优秀 (80-100分) | X | Y% |
| 良好 (60-79分) | X | Y% |
| 一般 (40-59分) | X | Y% |
| 较差 (<40分) | X | Y% |

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## ❌ 缺失文档（未覆盖的Systems）

1. SystemName1
2. SystemName2

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## ⚠️ 低质量文档（需要改进）

| System | 当前分数 | 主要问题 |
|--------|---------|---------|
| SystemName | 分数 | 问题描述 |

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

## 💡 改进建议

1. 使用 /enhance-docs 批量补充缺失文档
2. 为低质量文档补充：完整数据流图、代码示例、常见问题
3. 在开发中通过任务自学习机制持续更新文档

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**注意**：将报告保存到 `markdown/文档验证报告.md`
