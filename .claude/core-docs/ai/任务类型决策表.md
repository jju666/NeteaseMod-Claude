# 任务类型决策表

> **AI工作流补充文档**
>
> 用于帮助AI快速识别任务类型并选择合适的执行策略

---

## 🎯 核心决策流程

```
用户任务描述
    ↓
分析修改范围 → 单文件<30行? → 🟢 微任务
    ↓ 否
分析文件数量 → 3-8个文件? → 🟡 标准任务
    ↓ 否
复杂任务判断 → >8文件或架构变更? → 🔴 复杂任务
```

---

## 📊 三级任务分类详解

### 🟢 微任务

**判断标准**：
1. ✅ 单文件修改
2. ✅ 修改范围 < 30行
3. ✅ 无需探索其他代码
4. ✅ 用户明确指定修改内容

**示例任务**：
- 配置修改：修改配置文件参数
- 文案修改：修改提示文字颜色
- 简单BUG修复：修正拼写错误
- 文档更新：补充注释说明

**执行策略**：
```
理解任务 → 直接Edit修改 → Git commit
```

**Token成本**：< 2k

---

### 🟡 标准任务

**判断标准**：
1. ✅ 2-3个文件
2. ✅ 需要理解模块交互
3. ✅ 涉及业务逻辑
4. ❌ 不涉及架构变更

**示例任务**：
- 事件监听：添加玩家伤害事件监听
- 组件使用：使用背包组件实现物品管理
- 实体交互：创建自定义NPC并实现对话
- UI调整：调整UI显示逻辑
- 数据处理：实现玩家数据存储和读取

**执行策略**：
```
理解任务 → 查阅文档 → 可选创建tasks/（5章模板）
    ↓
探索代码（父代理直接Read/Grep）
    ↓
设计方案 → 实施修改 → 验证 → Git commit
```

**Token成本**：20-35k

---

### 🔴 复杂任务

**判断标准**：
1. ✅ 多模块重构（5+文件）
2. ✅ 架构变更
3. ✅ 涉及多个系统交互
4. ✅ 需要完整的设计文档

**示例任务**：
- 新功能/系统：添加计分板系统
- 全局重构：重构数据存储架构
- 多系统集成：集成多个System交互
- 性能优化：全局tick优化
- 框架开发：开发通用工具库

**执行策略**：
```
理解任务 → 查阅文档 → 必须创建tasks/（9章模板）
    ↓
可选并行探索（仅用户要求）
    ↓
分阶段实施 → 单元测试 → 集成测试 → 文档更新 → Git commit
```

**Token成本**：40-60k

---

## 🔍 关键词快速识别

| 关键词 | 任务级别 | 典型示例 |
|--------|---------|---------|
| 配置/价格/参数 | 🟢 微任务 | "调整配置文件中的数值" |
| 文案/颜色/UI文字 | 🟢 微任务 | "修改提示文字为红色" |
| 修复拼写/注释 | 🟢 微任务 | "修正函数名拼写错误" |
| 事件/监听 | 🟡 标准任务 | "添加玩家伤害事件监听" |
| 组件/API使用 | 🟡 标准任务 | "使用背包组件管理物品" |
| 实体/交互 | 🟡 标准任务 | "创建自定义NPC实现对话" |
| 数据处理 | 🟡 标准任务 | "实现玩家数据存储逻辑" |
| 新系统/功能 | 🔴 复杂任务 | "添加全局计分板系统" |
| 重构/迁移 | 🔴 复杂任务 | "重构数据存储架构" |
| 性能优化 | 🔴 复杂任务 | "优化全局tick性能" |

---

## ⚠️ 边界案例处理

### 案例1：日志中显示错误

**用户任务**：日志显示 `AttributeError: 'NoneType' object has no attribute 'xxx'`

**决策流程**：
1. 先理解问题现象（阅读日志、查看代码）
2. 判断修改范围：
   - 如果是单行空指针检查 → 🟢 微任务
   - 如果是生命周期问题，需修改 `__init__` 和 `Create` → 🟡 标准任务
   - 如果是架构问题，需重构多个模块 → 🔴 复杂任务

### 案例2："优化XXX性能"

**用户任务**：优化实体生成性能

**决策流程**：
1. 判断优化范围：
   - 仅优化单个函数（如缓存实体查询）→ 🟢 微任务
   - 优化多个System的实体管理逻辑 → 🟡 标准任务
   - 重构整个实体管理架构 → 🔴 复杂任务

### 案例3："添加XXX功能"

**用户任务**：为玩家添加经验系统

**决策流程**：
1. 判断实现复杂度：
   - 仅添加 `player_exp` 字段到配置 → 🟢 微任务
   - 需创建 `ExpServerSystem` 并实现经验计算 → 🟡 标准任务
   - 需添加完整经验系统（等级、升级奖励、UI显示等）→ 🔴 复杂任务

---

## 📝 决策模板

当遇到难以分类的任务时，使用以下模板：

```
## 任务分析

**用户任务**：[任务描述]

**涉及文件**（预估）：
- [ ] 文件1：[文件路径] - [修改内容]
- [ ] 文件2：[文件路径] - [修改内容]
- ...

**修改行数**（预估）：[行数]

**是否需要理解其他模块**：[是/否]

**是否涉及架构变更**：[是/否]

---

**决策结论**：[🟢 微任务 / 🟡 标准任务 / 🔴 复杂任务]

**理由**：[简述判断依据]
```

---

## 🎯 最佳实践

### 1. 当无法确定时

**原则**：宁可高估，不要低估

- 不确定是微任务还是标准任务 → 选择标准任务
- 不确定是标准任务还是复杂任务 → 选择复杂任务

### 2. 用户明确要求

**优先级**：用户意图 > 自动判断

- 如果用户说"快速修复" → 倾向微任务
- 如果用户说"完整重构" → 倾向复杂任务

### 3. 历史上下文

**检查历史**：
```bash
dir {{PROJECT_PATH}}\tasks /b
```

- 如果发现相关任务目录 → 继续之前的任务等级
- 如果是全新任务 → 按正常流程判断

---

## 📊 统计参考

根据历史任务统计：
- 85% 的任务属于 🟢 微任务
- 12% 的任务属于 🟡 标准任务
- 3% 的任务属于 🔴 复杂任务

**结论**：大部分任务都可以用微任务快速通道完成。

---

_最后更新: 2025-11-09 | 文档版本: 2.0 (MODSDK纯化)_
