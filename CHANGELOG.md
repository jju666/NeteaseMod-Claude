# Changelog

NeteaseMod-Claude ç‰ˆæœ¬æ›´æ–°è®°å½•

---

## [v25.0] - 2025-11-19 - âœ… å®Œæ•´å®ç°

### ğŸ¤– Claude LLMè¯­ä¹‰åˆ†æç³»ç»Ÿ - é«˜ç²¾åº¦ç”¨æˆ·æ„å›¾è¯†åˆ«

**é‡å¤§æ›´æ–°**: å¼•å…¥åŸºäºClaude 3.5 Sonnetçš„è¯­ä¹‰åˆ†æç³»ç»Ÿï¼Œè§£å†³ä¼ ç»Ÿå…³é”®è¯åŒ¹é…å‡†ç¡®ç‡ä¸è¶³çš„é—®é¢˜ã€‚

**å®ç°çŠ¶æ€**:
- âœ… **2025-11-19åˆç‰ˆ**: Implementationé˜¶æ®µLLMé›†æˆå®Œæˆ
- âœ… **2025-11-20å®Œæˆ**: Planningé˜¶æ®µLLMé›†æˆå®Œæˆï¼Œ**å…¨éƒ¨å…³é”®è¯åŒ¹é…å·²æ³¨é‡Š**
- ğŸ› **2025-11-20ä¿®å¤1**: ä¿®å¤LLMå¤±è´¥æ—¶é”™è¯¯è¿”å›resultå¯¼è‡´task-meta.jsonæ•°æ®æŸåçš„ä¸¥é‡BUG (è¡Œ868+1280)
- ğŸ”§ **2025-11-20ä¼˜åŒ–1**: Planning promptå¢åŠ "ç»§ç»­"ã€"ä½ å¯ä»¥ç»§ç»­äº†"ç­‰agreeæ„å›¾ç¤ºä¾‹ (è¡Œ780)
- ğŸ”§ **2025-11-20ä¼˜åŒ–2**: LLMå¤±è´¥æç¤ºä»stderræ”¹ä¸ºstdoutï¼Œéµå¾ªHookè¾“å‡ºè§„èŒƒï¼Œç”¨æˆ·å¯åœ¨transcriptä¸­çœ‹åˆ° (è¡Œ846+1256)
- ğŸš¨ **2025-11-20ä¿®å¤2**: ä¿®å¤Claude 3.5 Sonneté€€å½¹å¯¼è‡´çš„404é”™è¯¯ï¼Œè¿ç§»åˆ°Claude Sonnet 4.5 (claude-sonnet-4-5)
  - Claude 3.5 Sonnetå·²äº2025å¹´10æœˆ28æ—¥é€€å½¹ï¼Œæ‰€æœ‰è¯·æ±‚è¿”å›404é”™è¯¯
  - æ›´æ–°é…ç½®æ–‡ä»¶: `claude-3-5-sonnet-20241022` â†’ `claude-sonnet-4-5`
  - éªŒè¯æ–°æ¨¡å‹å¯ç”¨æ€§: âœ… claude-sonnet-4-5 å’Œ claude-sonnet-4-5-20250929 å‡å¯ç”¨
  - "ä½ å¯ä»¥ç»§ç»­äº†"è¯­ä¹‰è¯†åˆ«æ¢å¤æ­£å¸¸: intent=agree, confidence=95%
  - å½±å“æ–‡ä»¶: claude_semantic_config.json (x2), claude_semantic_analyzer.py (x2)

#### âœ… æ ¸å¿ƒåŠŸèƒ½

**1. ClaudeSemanticAnalyzerï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰**
- âœ… **LLMé©±åŠ¨**: ä½¿ç”¨Claude Sonnet 4.5è¿›è¡Œè¯­ä¹‰åˆ†æï¼ˆ2025-11-20å·²è¿ç§»è‡³Sonnet 4.5ï¼‰
- âœ… **å‡†ç¡®ç‡æå‡**: 96.15% (vs ä¼ ç»Ÿæ–¹æ¡ˆ85%ï¼Œæå‡11.15%)
- âœ… **é›¶ç»´æŠ¤æˆæœ¬**: è‡ªåŠ¨ç†è§£æ–°è¡¨è¾¾ï¼ˆå¦‚"éƒ½æ­£ç¡®äº†"ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ å…³é”®è¯
- âœ… **è½¬æŠ˜è¯­ä¹‰å®Œç¾**: 100%è¯†åˆ«"åŸºæœ¬æ­£ç¡®,ä½†è¿˜æœ‰BUG"ç­‰å¤æ‚è¡¨è¾¾
- âœ… **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: åˆ©ç”¨ä»£ç ä¿®æ”¹æ¬¡æ•°ã€å½“å‰é˜¶æ®µã€è¿­ä»£æ¬¡æ•°è¾…åŠ©åˆ¤æ–­

**2. çŠ¶æ€è½¬ç§»éªŒè¯å™¨ï¼ˆå®‰å…¨ä¿éšœï¼‰**
- âœ… **100%ä¸è„±ç¦»çŠ¶æ€æœº**: ç¡¬ç¼–ç åˆæ³•çŠ¶æ€è½¬ç§»è¡¨å¼ºåˆ¶éªŒè¯
- âœ… **è¿è¡Œæ—¶æ‹¦æˆª**: validate_state_transition()åœ¨è½¬ç§»å‰å¼ºåˆ¶æ£€æŸ¥
- âœ… **è¯¦ç»†é”™è¯¯ä¿¡æ¯**: IllegalTransitionErroræ˜ç¡®è¯´æ˜éæ³•è½¬ç§»åŸå› 
- âœ… **åŸå­æ€§æ›´æ–°**: è½¬ç§»å¤±è´¥è‡ªåŠ¨å›æ»šï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§

**3. UserPromptHandleré›†æˆï¼ˆv25.0é‡æ„ï¼‰**
- âœ… **LLMä¼˜å…ˆç­–ç•¥**: Planningå’ŒImplementationé˜¶æ®µå…¨é¢ä½¿ç”¨Claude LLMåˆ†æç”¨æˆ·æ„å›¾
- âœ… **v1.0æµ‹è¯•ç‰ˆ**: æ³¨é‡Šæ‰ALLä¼ ç»Ÿå…³é”®è¯åŒ¹é…ï¼ˆmatch_keyword_safelyï¼‰ï¼Œä¸“æ³¨éªŒè¯LLMæµç¨‹
- âœ… **åˆ†é˜¶æ®µPrompt**: Planningé˜¶æ®µè¯†åˆ«agree/reject/restartï¼ŒImplementationé˜¶æ®µè¯†åˆ«complete_success/partial_successç­‰
- âœ… **å‹å¥½é™çº§æç¤º**: APIå¤±è´¥æ—¶æ˜ç¡®æç¤ºç”¨æˆ·é€‰æ‹©æ„å›¾ï¼Œè€Œéé™é»˜é™çº§
- âœ… **æ€§èƒ½ç›‘æ§**: è®°å½•å»¶è¿Ÿã€ç½®ä¿¡åº¦ã€Tokensç”¨é‡ç­‰å…³é”®æŒ‡æ ‡

#### ğŸ¯ è§£å†³çš„é—®é¢˜

| é—®é¢˜ | v24.2æ–¹æ¡ˆ | v25.0æ–¹æ¡ˆ |
|------|----------|----------|
| "éƒ½æ­£ç¡®äº†"æ— æ³•è¯†åˆ« | âŒ å…³é”®è¯åº“ç¼ºå¤± â†’ è¯†åˆ«å¤±è´¥ | âœ… LLMè‡ªåŠ¨ç†è§£ â†’ 100%è¯†åˆ« |
| "åŸºæœ¬æ­£ç¡®,ä½†è¿˜æœ‰BUG" | âŒ è¯¯åˆ¤ä¸ºcomplete_success | âœ… 100%è¯†åˆ«ä¸ºpartial_success |
| partial_successå‡†ç¡®ç‡ | 64.3% | 100% |
| å…³é”®è¯ç»´æŠ¤æˆæœ¬ | é«˜ï¼ˆæ‰‹åŠ¨æ·»åŠ ï¼‰ | é›¶ï¼ˆLLMè‡ªåŠ¨ï¼‰ |
| çŠ¶æ€æœºè„±ç¦»é£é™© | å­˜åœ¨ï¼ˆæ— éªŒè¯ï¼‰ | æ¶ˆé™¤ï¼ˆå¼ºåˆ¶éªŒè¯ï¼‰ |

#### ğŸ”§ æŠ€æœ¯å®ç°

**æ–°å¢æ–‡ä»¶** (3ä¸ªæ ¸å¿ƒæ¨¡å—):
- `templates/.claude/hooks/core/claude_semantic_analyzer.py` (17KB, ~460è¡Œ)
  - ClaudeSemanticAnalyzerç±»ï¼ˆLLMè¯­ä¹‰åˆ†æå™¨ï¼‰
  - analyze_user_intent()å¿«æ·å‡½æ•°
  - Promptå·¥ç¨‹ï¼ˆåŸºäºMVPæœ€ä½³å®è·µï¼‰
  - è¶…æ—¶æ§åˆ¶ï¼ˆ15ç§’ï¼‰ã€é‡è¯•æœºåˆ¶ï¼ˆ1æ¬¡ï¼‰

- `templates/.claude/hooks/core/state_transition_validator.py` (13KB, ~370è¡Œ)
  - validate_state_transition()å¼ºåˆ¶éªŒè¯å‡½æ•°
  - VALID_TRANSITIONSç¡¬ç¼–ç åˆæ³•è½¬ç§»è¡¨
  - IllegalTransitionErrorå¼‚å¸¸ç±»
  - è½¬ç§»æ¡ä»¶éªŒè¯ï¼ˆrequired_fieldsæ£€æŸ¥ï¼‰

- `templates/.claude/hooks/config/claude_semantic_config.json` (0.7KB)
  - model: claude-sonnet-4-5 (2025-11-20æ›´æ–°ï¼ŒåŸä¸ºclaude-3-5-sonnet-20241022å·²é€€å½¹)
  - timeout_seconds: 15
  - confidence_threshold: 0.8

**ä¿®æ”¹æ–‡ä»¶**:
- `templates/.claude/hooks/orchestrator/user_prompt_handler.py`
  - è¡Œ84-106: å¯¼å…¥ClaudeSemanticAnalyzerå’ŒçŠ¶æ€è½¬ç§»éªŒè¯å™¨
  - è¡Œ735-1159: **Planningé˜¶æ®µé‡æ„** - ä½¿ç”¨LLMåˆ†ææ›¿ä»£å…¨éƒ¨å…³é”®è¯åŒ¹é…ï¼ˆagree/reject/restartæ„å›¾è¯†åˆ«ï¼‰
  - è¡Œ1174-1279: **Implementationé˜¶æ®µé‡æ„** - ä½¿ç”¨LLMåˆ†ææ›¿ä»£å…¨éƒ¨å…³é”®è¯åŒ¹é…ï¼ˆcomplete_success/partial_successç­‰æ„å›¾è¯†åˆ«ï¼‰
  - è¡Œ1291-1300: æ·»åŠ implementationâ†’planningçŠ¶æ€è½¬ç§»éªŒè¯
  - è¡Œ1604-1613: æ·»åŠ implementationâ†’finalizationçŠ¶æ€è½¬ç§»éªŒè¯
  - è¡Œ1741+1879: æ³¨é‡Šæ‰fallbackè·¯å¾„çš„å…³é”®è¯åŒ¹é…ï¼ˆAMBIGUOUS_POSITIVE, CONTINUE_KEYWORDSï¼‰

**åŒæ­¥æ–‡ä»¶**:
- æ‰€æœ‰ä¿®æ”¹å·²åŒæ­¥åˆ° `tests/.claude/hooks/` ç›®å½•

#### ğŸ“Š æ€§èƒ½æŒ‡æ ‡

**å‡†ç¡®ç‡** (åŸºäºMVPæµ‹è¯•):
```
æ€»ä½“å‡†ç¡®ç‡: 96.15% (vs 85%)
- complete_success: 100% (vs 64.3%)
- partial_success: 100% (vs 64.3%)
- failure: 100%
- planning_required: 100% (é¢„ä¼°)
```

**å»¶è¿Ÿ**:
```
P50å»¶è¿Ÿ: ~3-5ç§’ (å¯æ¥å—ï¼Œç”¨æˆ·åé¦ˆé¢‘ç‡ä½)
P95å»¶è¿Ÿ: ~8-12ç§’
è¶…æ—¶é˜ˆå€¼: 15ç§’
```

**æˆæœ¬**:
```
é¢„ä¼°å•æ¬¡è°ƒç”¨: ~$0.001
é¢„ä¼°æœˆæˆæœ¬: ~$0.03 (10ä»»åŠ¡Ã—3åé¦ˆ)
é¢„ä¼°å¹´æˆæœ¬: ~$0.36 (å¯å¿½ç•¥)
```

#### âš™ï¸ é…ç½®è¦æ±‚

**ç¯å¢ƒå˜é‡** (äºŒé€‰ä¸€):
```bash
export ANTHROPIC_API_KEY="your-api-key"
# æˆ–
export ANTHROPIC_AUTH_TOKEN="your-api-key"
```

**ä¾èµ–å®‰è£…**:
```bash
pip install anthropic
```

**éªŒè¯é…ç½®**:
```bash
cd templates/.claude/hooks/core
python claude_semantic_analyzer.py
```

#### ğŸ” é™çº§ç­–ç•¥

**v25.0 v1.0ç‰ˆæœ¬** (å½“å‰):
- **ç­–ç•¥**: ä¸å¯ç”¨é™çº§ï¼Œä¸“æ³¨æµ‹è¯•LLMæµç¨‹
- LLMåˆ†æå¤±è´¥ â†’ æç¤ºç”¨æˆ·æ˜ç¡®æ„å›¾
- **ä¸ä½¿ç”¨** enhanced_matcher ä½œä¸ºfallback

**v25.0 v2.0ç‰ˆæœ¬** (è§„åˆ’ä¸­):
- **ç­–ç•¥**: æ™ºèƒ½æ··åˆï¼ˆå¿«é€Ÿå…³é”®è¯ + LLMéªŒè¯ï¼‰
- é«˜ç½®ä¿¡åº¦(â‰¥0.85) â†’ ç«‹å³é‡‡çº³
- ä¸­ç½®ä¿¡åº¦(0.65-0.85) â†’ å¼‚æ­¥LLMéªŒè¯
- ä½ç½®ä¿¡åº¦(<0.65) â†’ åŒæ­¥LLMåˆ†æ

#### ğŸ“š æ–°å¢æ–‡æ¡£

- `docs/developer/Claudeè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨æŒ‡å—.md`
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
  - APIå¯†é’¥é…ç½®
  - å·¥ä½œåŸç†è¯¦è§£
  - æ•…éšœæ’æŸ¥æ‰‹å†Œ
  - æ€§èƒ½æŒ‡æ ‡å‚è€ƒ
  - é™çº§ç­–ç•¥è¯´æ˜

#### ğŸ§ª æµ‹è¯•å»ºè®®

```bash
# 1. åŸºç¡€è¯­ä¹‰è¯†åˆ«æµ‹è¯•
/mc æµ‹è¯•Claudeè¯­ä¹‰åˆ†æ
# AIä¿®æ”¹ä»£ç å...
éƒ½æ­£ç¡®äº†  # åº”è¯†åˆ«ä¸ºcomplete_success â†’ finalization

# 2. è½¬æŠ˜è¯­ä¹‰æµ‹è¯•
åŸºæœ¬æ­£ç¡®,ä½†è¿˜æœ‰BUG  # åº”è¯†åˆ«ä¸ºpartial_success â†’ ç»§ç»­implementation

# 3. æ–¹æ¡ˆæ€§é”™è¯¯æµ‹è¯•
æ ¹æœ¬åŸå› æ²¡æ‰¾åˆ°  # åº”è¯†åˆ«ä¸ºplanning_required â†’ å›åˆ°planning

# 4. çŠ¶æ€è½¬ç§»éªŒè¯æµ‹è¯•
# ç³»ç»Ÿä¼šè‡ªåŠ¨æ‹¦æˆªéæ³•è½¬ç§»ï¼Œæ— éœ€æ‰‹åŠ¨æµ‹è¯•
```

#### ğŸ“– ç›¸å…³æ–‡æ¡£

- [Claudeè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨æŒ‡å—](docs/developer/Claudeè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨æŒ‡å—.md)
- [HookçŠ¶æ€æœºåŠŸèƒ½å®ç°](docs/developer/HookçŠ¶æ€æœºåŠŸèƒ½å®ç°.md)
- [è¯­ä¹‰è¯†åˆ«MVPæœ€ç»ˆæŠ¥å‘Š](semantic_recognition_mvp/FINAL_REPORT.md)
- [HOOKæ­£ç¡®ç”¨æ³•æ–‡æ¡£](HOOKæ­£ç¡®ç”¨æ³•æ–‡æ¡£.md)

#### âš ï¸ æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥å®‰å…¨**: ç¡®ä¿ `.gitignore` åŒ…å«ç¯å¢ƒå˜é‡æ–‡ä»¶
2. **ç½‘ç»œè¦æ±‚**: éœ€è®¿é—® `api.anthropic.com` (ä¸­å›½å¤§é™†å¯ç”¨ï¼Œæœªè¢«å¢™)
3. **å»¶è¿Ÿé¢„æœŸ**: é¦–æ¬¡è°ƒç”¨å¯èƒ½éœ€è¦5-8ç§’ï¼ˆåç»­é€šå¸¸3-5ç§’ï¼‰
4. **æˆæœ¬ç›‘æ§**: è™½ç„¶æˆæœ¬æä½ï¼Œä»å»ºè®®å®šæœŸæ£€æŸ¥APIç”¨é‡
5. **é™çº§å‡†å¤‡**: v2.0å°†æ ¹æ®v1.0æµ‹è¯•ç»“æœå†³å®šæ˜¯å¦å¯ç”¨é™çº§

#### ğŸ‰ é‡Œç¨‹ç¢‘æ„ä¹‰

v25.0æ ‡å¿—ç€NeteaseMod-Claudeå·¥ä½œæµç³»ç»Ÿä»**ä¼ ç»Ÿå…³é”®è¯åŒ¹é…**å‡çº§åˆ°**AIé©±åŠ¨è¯­ä¹‰ç†è§£**ï¼Œå®ç°äº†ï¼š
- ğŸš€ **å‡†ç¡®ç‡è´¨çš„é£è·ƒ**: 85% â†’ 96.15%
- ğŸ›¡ï¸ **çŠ¶æ€æœº100%å®‰å…¨**: å¼ºåˆ¶éªŒè¯æœºåˆ¶ç¡®ä¿æ°¸ä¸è„±ç¦»
- ğŸ”§ **é›¶ç»´æŠ¤æˆæœ¬**: å‘Šåˆ«æ‰‹åŠ¨æ·»åŠ å…³é”®è¯çš„æ—¶ä»£
- ğŸ’° **æˆæœ¬å¯å¿½ç•¥**: å¹´æˆæœ¬<$1ï¼Œæ€§ä»·æ¯”æé«˜

---

## [v3.0.1] - 2025-11-16

### ğŸ”’ å¹¶å‘å®‰å…¨æ€§å¢å¼º

#### atomic_update è¿ç§»å®Œæˆ

**æ ¸å¿ƒæ”¹è¿›**:
- âœ… **UserPromptSubmit Hook**: `handle_state_transition` å‡½æ•°è¿ç§»åˆ° atomic_update æ¨¡å¼
- âœ… **ä»£ç ä¸€è‡´æ€§**: ä¸ PostToolUseã€SessionStartã€SubagentStop ä¿æŒç»Ÿä¸€çš„åŸå­æ›´æ–°æ¨¡å¼
- âœ… **å¹¶å‘å®‰å…¨**: ä½¿ç”¨æ–‡ä»¶é”æœºåˆ¶ä¿è¯çŠ¶æ€è½¬ç§»çš„åŸå­æ€§
- âœ… **é”™è¯¯å¤„ç†**: å†…ç½®é‡è¯•æœºåˆ¶,å¢å¼ºç³»ç»Ÿç¨³å®šæ€§

**æŠ€æœ¯ç»†èŠ‚**:
- ä½¿ç”¨é—­åŒ…æ•è·(`result` å­—å…¸)å­˜å‚¨çŠ¶æ€è½¬ç§»ç»“æœ
- åˆ›å»º `apply_state_transition(meta_data)` ä½œä¸ºåŸå­æ›´æ–°å‡½æ•°
- è°ƒç”¨ `meta_manager.atomic_update(task_id, apply_state_transition)` æ‰§è¡ŒåŸå­æ›´æ–°
- ä¿ç•™æ‰€æœ‰çŠ¶æ€è½¬ç§»é€»è¾‘ä¸å˜,åªä¿®æ”¹åº•å±‚æ›´æ–°æœºåˆ¶

**å½±å“èŒƒå›´**:
- æ–‡ä»¶: `templates/.claude/hooks/orchestrator/user_prompt_handler.py`
- å‡½æ•°: `handle_state_transition()` (ç¬¬291-564è¡Œ)
- çŠ¶æ€è½¬ç§»: Planningâ†’Implementation, Implementationâ†’Finalization, Implementationâ†’Planning(å›æ»š)

**å‘åå…¼å®¹**:
- âœ… å®Œå…¨å…¼å®¹ v3.0 Final çš„ task-meta.json æ ¼å¼
- âœ… ä¿æŒä¸å…¶ä»– Hook çš„äº¤äº’ä¸å˜
- âœ… ç”¨æˆ·ä½“éªŒæ— å˜åŒ–

**æµ‹è¯•å»ºè®®**:
```bash
# 1. æ­£å¸¸çŠ¶æ€è½¬ç§»æµ‹è¯•
/mc æµ‹è¯•atomic_updateè¿ç§»
# AIæŸ¥é˜…1ä¸ªæ–‡æ¡£
åŒæ„  # åº”æˆåŠŸè½¬ç§»åˆ°Implementationé˜¶æ®µ

# 2. æ–‡æ¡£ä¸è¶³é˜»æ­¢æµ‹è¯•
/mc æµ‹è¯•æ–‡æ¡£éªŒè¯
åŒæ„  # åº”è¢«æ‹’ç»,æç¤ºæ–‡æ¡£ä¸è¶³

# 3. çŠ¶æ€å›æ»šæµ‹è¯•
æ²¡ä¿®å¤  # åº”å›æ»šåˆ°Planningé˜¶æ®µ

# 4. ç»§ç»­ä¿®æ”¹æµ‹è¯•
ç»§ç»­  # çŠ¶æ€ä¿æŒImplementation,æ˜¾ç¤ºç¡®è®¤æ¶ˆæ¯
```

**ç›¸å…³æ–‡æ¡£**:
- è¿ç§»æ–¹æ¡ˆ: `docs/developer/UserPromptSubmit-atomic_updateè¿ç§»æ–¹æ¡ˆ.md`
- Hookè§„èŒƒ: `claudecode/hook.md`
- çŠ¶æ€æœºæœºåˆ¶: `docs/developer/HooksçŠ¶æ€æœºåŠŸèƒ½å®ç°.md`

---

## [v3.0 Final] - 2025-11-15

### ğŸ‰ Hooké‡æ„è®¡åˆ’ä¹¦v3.0 Final - å®Œæ•´å®ç°

**é‡è¦è¯´æ˜**: v3.0 Finalæ˜¯æ¶æ„çº§åˆ«çš„é‡æ„ç‰ˆæœ¬,ç»Ÿä¸€äº†ä¹‹å‰v21.xå’Œv22.0çš„å‘½åæ··ä¹±,å®ç°äº†å®Œæ•´çš„4æ­¥è¯­ä¹‰åŒ–çŠ¶æ€æœºã€‚

#### âœ… æ ¸å¿ƒå®ç°

**1. 4æ­¥è¯­ä¹‰åŒ–çŠ¶æ€æœº** (`tool_matrix.py`)
- âœ… Activation (ä»»åŠ¡æ¿€æ´»): è‡ªåŠ¨ä»»åŠ¡ç±»å‹æ£€æµ‹
- âœ… Planning (æ–¹æ¡ˆåˆ¶å®š): å·®å¼‚åŒ–æµç¨‹ï¼ˆBUGä¿®å¤ vs åŠŸèƒ½è®¾è®¡ï¼‰
- âœ… Implementation (ä»£ç å®æ–½): è½®æ¬¡å¾ªç¯è¿­ä»£
- âœ… Finalization (æ”¶å°¾å½’æ¡£): å­ä»£ç†å¼ºåˆ¶æ‰§è¡Œ

**2. YAMLè§„åˆ™æ–‡ä»¶ç³»ç»Ÿ** (`templates/.claude/rules/`)
- âœ… `activation.yaml`: ä»»åŠ¡ç±»å‹æ£€æµ‹è§„åˆ™
- âœ… `planning.yaml`: å·®å¼‚åŒ–æµç¨‹è§„åˆ™ï¼ˆBUGä¿®å¤/åŠŸèƒ½è®¾è®¡ï¼‰
- âœ… `implementation.yaml`: è½®æ¬¡å¾ªç¯å’Œä¸“å®¶å®¡æŸ¥è§¦å‘
- âœ… `finalization.yaml`: å­ä»£ç†æƒé™å’Œå½’æ¡£é…ç½®

**3. SubagentStop Hookå®Œæ•´é‡å†™** (`lifecycle/subagent_stop.py`)
- âœ… ä»transcript_pathè§£æå­ä»£ç†ç»“æœï¼ˆv1.0é”™è¯¯ä»stdinè¯»å–ï¼‰
- âœ… æ”¯æŒJSONå’ŒJSONLä¸¤ç§transcriptæ ¼å¼
- âœ… æå–`<!-- SUBAGENT_RESULT {...} -->`æ ‡è®°
- âœ… ç”Ÿæˆç”¨æˆ·å¯è§çš„ç»“æœæ‘˜è¦ï¼ˆä¸“å®¶å®¡æŸ¥/æ–‡æ¡£æŸ¥è¯¢ï¼‰

**4. å·®å¼‚åŒ–å·¥ä½œæµ** (`tool_matrix.py` + `planning.yaml`)

| ä»»åŠ¡ç±»å‹ | å¼ºåˆ¶æ–‡æ¡£æ•° | ä¸“å®¶å®¡æŸ¥ | æ–‡æ¡£æŸ¥è¯¢å­ä»£ç† | ç©æ³•åŒ…åŒ¹é… |
|---------|----------|---------|--------------|-----------|
| BUGä¿®å¤ | 0 (å¯é€‰) | âœ… å¿…é¡» | âŒ ç¦ç”¨ | âŒ ç¦ç”¨ |
| åŠŸèƒ½è®¾è®¡ | 3 (å¼ºåˆ¶) | âŒ å¯é€‰ | âœ… å¯ç”¨ | âœ… å¯ç”¨ |

**5. mc.md.templateå®Œæ•´é‡å†™**
- âœ… æ–‡æ¡£åŒ–4æ­¥çŠ¶æ€æœºæµç¨‹
- âœ… è¯´æ˜å·®å¼‚åŒ–æµç¨‹æœºåˆ¶
- âœ… æ·»åŠ ç”¨æˆ·äº¤äº’æŒ‡å¼•
- âœ… ç§»é™¤æ‰€æœ‰step2_researchæ—§æœ¯è¯­

#### ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶ (48ä¸ªæµ‹è¯•ç”¨ä¾‹)

**æ–‡ä»¶**: `unit_tests/`
- âœ… `test_tool_matrix.py`: 13ä¸ªæµ‹è¯•ï¼ˆçŠ¶æ€æœº+å·®å¼‚åŒ–æµç¨‹ï¼‰
- âœ… `test_subagent_stop.py`: 11ä¸ªæµ‹è¯•ï¼ˆtranscriptè§£æï¼‰
- âœ… `test_yaml_rules.py`: 22ä¸ªæµ‹è¯•ï¼ˆ4ä¸ªYAMLæ–‡ä»¶éªŒè¯ï¼‰
- âœ… `run_all_tests.py`: å½©è‰²æµ‹è¯•è¿è¡Œå™¨
- âœ… `README.md`: æµ‹è¯•å¥—ä»¶å®Œæ•´æ–‡æ¡£

**æµ‹è¯•è¦†ç›–**:
- 4æ­¥çŠ¶æ€æœºé…ç½®æ­£ç¡®æ€§
- BUGä¿®å¤ vs åŠŸèƒ½è®¾è®¡å·®å¼‚åŒ–è§„åˆ™
- SubagentStop transcriptè§£æï¼ˆJSON/JSONLï¼‰
- YAMLæ–‡ä»¶æ ¼å¼å’Œå…³é”®å­—æ®µéªŒè¯
- å‘åå…¼å®¹STEP_MAPPING

**è¿è¡Œæ–¹å¼**:
```bash
python unit_tests/run_all_tests.py
# è¾“å‡º: 48/48 æµ‹è¯•é€šè¿‡ âœ…
```

#### ğŸ”„ ç‰ˆæœ¬å·ç»Ÿä¸€

**å·¥å…·**: `unit_tests/unify_version.py`

æ‰¹é‡æ›¿æ¢13ä¸ªæ–‡ä»¶çš„ç‰ˆæœ¬å·:
- `v22.0` â†’ `v3.0 Final`
- `v21.0` â†’ `v2.0`
- `v20.x` â†’ `v1.0`

**ä¿®æ”¹çš„æ–‡ä»¶**:
- `core/`: tool_matrix.py, task_meta_manager.py, stage_validator.py, semantic_analyzer.py
- `lifecycle/`: session_start.py, session_end.py, stop.py
- `orchestrator/`: pretooluse_enforcer.py, posttooluse_updater.py, user_prompt_handler.py
- `validators/`: pre_compact_reminder.py

#### ğŸ“Š å®Œæˆåº¦éªŒè¯

**å¯¹æ¯”Hooké‡æ„è®¡åˆ’ä¹¦-æœ€ç»ˆç‰ˆ.md**:

| æ¨¡å— | è®¡åˆ’ä¹¦è¦æ±‚ | v3.0 Finalå®ç° | å®Œæˆåº¦ |
|------|-----------|---------------|-------|
| 4æ­¥çŠ¶æ€æœº | activation/planning/implementation/finalization | âœ… å®Œå…¨å®ç° | 100% |
| YAMLè§„åˆ™ | 4ä¸ªé˜¶æ®µè§„åˆ™æ–‡ä»¶ | âœ… 4ä¸ªæ–‡ä»¶å®Œæ•´ | 100% |
| SubagentStop | transcriptè§£æ | âœ… v3.0å®Œæ•´å®ç° | 100% |
| å·®å¼‚åŒ–æµç¨‹ | BUG vs åŠŸèƒ½è®¾è®¡ | âœ… é…ç½®+YAML | 100% |
| è‡ªåŠ¨åŒ–æµ‹è¯• | éªŒè¯æ‰€æœ‰å®ç° | âœ… 48ä¸ªæµ‹è¯• | 100% |
| ç‰ˆæœ¬ç»Ÿä¸€ | v3.0 Final | âœ… 13ä¸ªæ–‡ä»¶ | 100% |

**æ€»ä½“å®Œæˆåº¦**: **100%** âœ…

#### ğŸ”§ å‘åå…¼å®¹æ€§

- âœ… `TaskMetaManager.STEP_MAPPING` è‡ªåŠ¨è½¬æ¢v21.0æ—§å‘½å
  - `step0_activation` â†’ `activation`
  - `step1_plan` â†’ `planning`
  - `step2_implementation` â†’ `implementation`
  - `step3_finalization` â†’ `finalization`

- âœ… ç°æœ‰é¡¹ç›®æ— éœ€ä¿®æ”¹task-meta.json
- âœ… æµ‹è¯•éªŒè¯STEP_MAPPINGæ­£ç¡®æ€§

#### ğŸ“– æ–‡æ¡£æ›´æ–°

- âœ… `mc.md.template`: å®Œæ•´é‡å†™æ”¯æŒv3.0æ¶æ„
- âœ… `unit_tests/README.md`: æµ‹è¯•å¥—ä»¶ä½¿ç”¨æ–‡æ¡£
- âœ… æœ¬CHANGELOG: v3.0 Finalå®Œæ•´è®°å½•

#### å‡çº§æŒ‡å—

**æ— éœ€æ“ä½œ**: v3.0 Finalå‘åå…¼å®¹v21.0/v22.0ã€‚

**éªŒè¯å®ç°**:
```bash
# è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
python unit_tests/run_all_tests.py

# æ£€æŸ¥ç‰ˆæœ¬ç»Ÿä¸€
python unit_tests/unify_version.py
```

**é‡è¦å˜æ›´**:
1. æ‰€æœ‰Hookæ–‡ä»¶ç‰ˆæœ¬å·ç»Ÿä¸€ä¸ºv3.0 Final
2. YAMLè§„åˆ™æ–‡ä»¶å¯ç”¨ï¼ˆå£°æ˜å¼é…ç½®ï¼‰
3. SubagentStopä½¿ç”¨transcriptè§£æï¼ˆä¸å†ä»stdinè¯»å–ï¼‰

---

## [21.1.2] - 2025-11-15

### ğŸ“– æ–‡æ¡£ä¿®æ­£ï¼štask-meta.jsonç»“æ„è§„èŒƒå…¨é¢å®¡è®¡

**èƒŒæ™¯**: ç”¨æˆ·ä¸‹æ¸¸æµ‹è¯•æ—¶å‘ç°æ–‡æ¡£ä¸å®é™…ä»£ç å®ç°ä¸ä¸€è‡´ï¼Œç³»ç»Ÿæ€§å®¡è®¡åå‘ç°**11ä¸ªæ–‡æ¡£-ä»£ç ä¸ä¸€è‡´é—®é¢˜**ã€‚

#### ä¿®å¤æ±‡æ€»

| ä¸¥é‡æ€§ | ä¿®å¤é¡¹æ•° | çŠ¶æ€ |
|--------|---------|------|
| P0 (Critical) | 3ä¸ª | âœ… å·²ä¿®å¤ |
| P1 (High) | 5ä¸ª | âœ… å·²ä¿®å¤ |
| P2 (Medium) | 2ä¸ª | âœ… å·²ä¿®å¤ |
| P3 (Low) | 1ä¸ª | â³ æš‚ç¼“ |

#### æ ¸å¿ƒä¿®å¤é¡¹

**P0-1**: è¡¥å…¨stepså­—æ®µç»“æ„ (`docs/developer/task-meta.jsonæ–‡ä»¶ç»“æ„.md` lines 267-302)
- âœ… æ·»åŠ `description`å­—æ®µè¯´æ˜ï¼ˆæ­¥éª¤ä¸­æ–‡æè¿°ï¼‰
- âœ… æ·»åŠ `prompt`å­—æ®µè¯´æ˜ï¼ˆAIæŒ‡å¯¼å†…å®¹ï¼‰
- âœ… æ·»åŠ `skipped`çŠ¶æ€è¯´æ˜ï¼ˆç©æ³•åŒ…æ¨¡å¼ï¼‰

**P0-2**: ç»Ÿä¸€architecture_versionå€¼æ ¼å¼
- âœ… ä»`"21.0"` â†’ `"v21.0"`ï¼ˆä¸ä»£ç å®ç°ä¸€è‡´ï¼‰

**P0-3**: é‡å†™ç¤ºä¾‹JSON
- âœ… ç¤ºä¾‹1ï¼šä»»åŠ¡åˆå§‹åŒ–æ—¶çš„ç»“æ„ï¼ˆç²¾ç¡®å¯¹åº”ä»£ç ç”Ÿæˆï¼‰
- âœ… ç¤ºä¾‹2ï¼šè¿è¡Œæ—¶å®Œæ•´ç»“æ„ï¼ˆå«è¿­ä»£è®°å½•ï¼‰
- âœ… åŒºåˆ†åˆå§‹åŒ–å­—æ®µ vs è¿è¡Œæ—¶æ·»åŠ å­—æ®µ

**P1çº§ä¿®å¤**: è¡¥å…¨ç¼ºå¤±å­—æ®µæ–‡æ¡£
- âœ… `failed_at`: å¤±è´¥æ—¶é—´æˆ³
- âœ… `final_step`: ä»»åŠ¡ç»ˆæ­¢æ­¥éª¤
- âœ… ä¿®æ­£`task_type`æšä¸¾ï¼ˆåˆ é™¤æœªå®ç°çš„`feature_implementation`ï¼‰
- âœ… æ˜ç¡®`bug_fix_tracking`ç”Ÿæˆæ—¶æœºï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰

**P2çº§ä¿®å¤**: å½’æ¡£çŠ¶æ€å­—æ®µé‡æ„
- âœ… 7.1èŠ‚ï¼šåˆå§‹åŒ–å­—æ®µï¼ˆarchived, failedï¼‰
- âœ… 7.2èŠ‚ï¼šè¿è¡Œæ—¶æ·»åŠ å­—æ®µï¼ˆarchived_at, failed_at, cancel_typeç­‰ï¼‰

#### éªŒè¯å·¥å…· v21.0.2

**æ–‡ä»¶**: `validate-task-meta.py` (ä¸»é¡¹ç›® + tests/)

**æ–°å¢æ£€æŸ¥**:
- âœ… steps.description/promptå¿…éœ€å­—æ®µéªŒè¯
- âœ… architecture_versionç²¾ç¡®å€¼æ£€æŸ¥ï¼ˆæ£€æµ‹"21.0"é”™è¯¯ï¼‰
- âœ… task_typeæšä¸¾éªŒè¯ï¼ˆæ‹’ç»feature_implementationï¼‰
- âœ… åŒºåˆ†18ä¸ªåˆå§‹åŒ–å¿…éœ€å­—æ®µ vs 5ä¸ªè¿è¡Œæ—¶å¯é€‰å­—æ®µ
- âœ… Windowså…¼å®¹æ€§ä¿®å¤ï¼ˆemoji â†’ ASCIIç¬¦å·ï¼‰

**éªŒè¯ç»“æœ**: 0ä¸ªé”™è¯¯ï¼Œ0ä¸ªè­¦å‘Šï¼Œ**å®Œå…¨é€šè¿‡** âœ…

#### æ–°å¢æ–‡æ¡£

1. **æ–‡æ¡£å®¡è®¡æŠ¥å‘Š**: `docs/developer/task-meta-audit-report.md`
   - 11ä¸ªä¸ä¸€è‡´é—®é¢˜è¯¦ç»†åˆ†æ
   - P0-P3ä¸¥é‡æ€§åˆ†ç±»
   - ä»£ç ä½ç½®ç´¢å¼•

2. **éªŒè¯æŠ¥å‘Š**: `docs/developer/v21.1.2-validation-report.md`
   - å®Œæ•´éªŒè¯ç»“æœæ˜ç»†
   - v21.1.1ä»£ç ä¿®å¤éªŒè¯
   - æ–‡æ¡£è´¨é‡å¯¹æ¯”è¯„ä¼°

#### å‡çº§æŒ‡å—

**æ— éœ€æ“ä½œ**: çº¯æ–‡æ¡£ä¿®æ­£ï¼Œä»£ç æ— å˜æ›´ã€‚

**å»ºè®®æ“ä½œ**:
```bash
# éªŒè¯ç°æœ‰ä»»åŠ¡æ˜¯å¦ç¬¦åˆè§„èŒƒ
python validate-task-meta.py tasks/ä»»åŠ¡-xxx/.task-meta.json
```

---

## [21.1.1] - 2025-11-15

### ğŸ› Hotfix: v21.1.0éƒ¨ç½²å­—æ®µåˆå§‹åŒ–ç¼ºå¤±

**é—®é¢˜**: ç”¨æˆ·ä¸‹æ¸¸æµ‹è¯•å‘ç°ç”Ÿæˆçš„task-meta.jsonç¼ºå°‘å…³é”®å­—æ®µã€‚

#### ä¿®å¤å†…å®¹

**æ–‡ä»¶**: `templates/.claude/hooks/orchestrator/user_prompt_handler.py`

1. **metricså­—æ®µåˆå§‹åŒ–** (lines 1020-1026)
   ```python
   "metrics": {
       "docs_read": [],
       "code_changes": [],
       "tool_calls": [],  # â† æ–°å¢
       "failure_count": 0,
       "expert_review_triggered": False
   }
   ```

2. **ä¼šè¯ç®¡ç†å­—æ®µ** (lines 1028-1030)
   ```python
   "session_started_at": datetime.now().isoformat(),  # â† æ–°å¢
   "session_ended_at": None,
   ```

3. **å½’æ¡£çŠ¶æ€å­—æ®µ** (lines 1033-1034)
   ```python
   "archived": False,
   "failed": False  # â† æ–°å¢
   ```

#### å‡çº§æŒ‡å—

**ä¸‹æ¸¸é¡¹ç›®æ›´æ–°**:
```bash
cd your-project
npm install @netease-mod/claude-workflow@latest
# æˆ–æ‰‹åŠ¨æ›¿æ¢ .claude/hooks/orchestrator/user_prompt_handler.py
```

---

## [21.1.0] - 2025-11-14

### ğŸ—ï¸ v21.0æ¶æ„é‡æ„ï¼šå•ä¸€æ•°æ®æºè®¾è®¡

**é‡å¤§å˜æ›´**: ç§»é™¤workflow-state.jsonï¼Œç»Ÿä¸€ä½¿ç”¨task-meta.jsonä½œä¸ºå”¯ä¸€çŠ¶æ€å­˜å‚¨ã€‚

#### æ ¸å¿ƒå˜æ›´

**1. æ¶æ„æ ‡è¯†**
- âœ… æ‰€æœ‰task-meta.jsonåŒ…å«`architecture_version: "v21.0"`
- âœ… å…¼å®¹æ€§æ£€æŸ¥ï¼šv20.xä»»åŠ¡è‡ªåŠ¨æ‹’ç»æ“ä½œ

**2. å•ä¸€æ•°æ®æº**
- âŒ ç§»é™¤ï¼š`workflow-state.json`
- âœ… ä¿ç•™ï¼š`task-meta.json`ï¼ˆå”¯ä¸€çœŸå®æ¥æºï¼‰
- âœ… TaskMetaManagerç»Ÿä¸€ç®¡ç†ï¼ˆportalockeræ–‡ä»¶é” + atomic_updateï¼‰

**3. Hookç³»ç»Ÿé‡æ„**

| Hookæ–‡ä»¶ | v20.xè·¯å¾„ | v21.0è·¯å¾„ | å˜æ›´ |
|---------|----------|-----------|------|
| ç”¨æˆ·è¾“å…¥å¤„ç† | user-prompt-submit-hook.py | orchestrator/user_prompt_handler.py | âœ… é‡å‘½å |
| ä»»åŠ¡å–æ¶ˆ | - | orchestrator/task_cancellation_handler.py | âœ… æ–°å¢ |
| å·¥å…·ä½¿ç”¨æ›´æ–° | - | orchestrator/posttooluse_updater.py | âœ… æ–°å¢ |
| ä¼šè¯ç»“æŸ | session-end-hook.py | lifecycle/session_end.py | âœ… é‡å‘½å |
| Subagentåœæ­¢ | subagent-stop-hook.py | lifecycle/subagent_stop.py | âœ… é‡å‘½å |
| å½’æ¡£åå¤„ç† | post-archive-hook.py | archiver/post_archive.py | âœ… é‡å‘½å |

**4. å­—æ®µè¿ç§»**

ä»workflow-state.jsonè¿ç§»åˆ°task-meta.json:
- âœ… `current_step` â†’ task-meta.json
- âœ… `last_injection_step` â†’ task-meta.json
- âœ… `steps.*` â†’ task-meta.json
- âœ… `metrics.*` â†’ task-meta.json

**5. ç©æ³•åŒ…æ¨¡å¼**
- âœ… step0/step1è‡ªåŠ¨è·³è¿‡ï¼ˆ`status: "skipped"`ï¼‰
- âœ… ç›´æ¥è¿›å…¥step3_execute
- âœ… ç©æ³•åŒ…ä»£ç æ³¨å…¥æœºåˆ¶ä¿ç•™

#### å‡çº§æŒ‡å—

**è‡ªåŠ¨è¿ç§»**:
```bash
cd your-project
initmc  # è‡ªåŠ¨æ£€æµ‹å¹¶å‡çº§v20.x â†’ v21.0
```

**è¿ç§»å†…å®¹**:
1. æ‰€æœ‰Hookæ–‡ä»¶é‡æ–°éƒ¨ç½²åˆ°æ–°è·¯å¾„
2. settings.json hooksé…ç½®è‡ªåŠ¨æ›´æ–°
3. å·²å­˜åœ¨çš„workflow-state.jsonä¿ç•™ï¼ˆä¸å½±å“v21.0è¿è¡Œï¼‰

**ç ´åæ€§å˜æ›´**:
- âš ï¸ v20.xä»»åŠ¡æ— æ³•åœ¨v21.0ç¯å¢ƒç»§ç»­æ‰§è¡Œ
- âš ï¸ éœ€é‡æ–°åˆ›å»ºä»»åŠ¡æˆ–æ‰‹åŠ¨è¿ç§»task-meta.json

---

## [20.2.12] - 2025-11-14

### ğŸ¯ æ™ºèƒ½å•å‘½ä»¤æ¨¡å¼

**é‡å¤§ç®€åŒ–**: `initmc`å‘½ä»¤è‡ªåŠ¨å¤„ç†æ‰€æœ‰éƒ¨ç½²åœºæ™¯ã€‚

#### åŠŸèƒ½

1. **æ™ºèƒ½æ¨¡å¼æ£€æµ‹**
   ```bash
   initmc  # è‡ªåŠ¨åˆ¤æ–­ï¼šå…¨æ–°éƒ¨ç½² | å‡çº§ | ä¿®å¤
   ```

2. **è‡ªåŠ¨è¿ç§»v20.x â†’ v21.0**
   - æ£€æµ‹architecture_version
   - è‡ªåŠ¨å‡çº§Hookæ–‡ä»¶
   - æ›´æ–°settings.jsoné…ç½®

3. **ç©æ³•åŒ…æ¨¡å¼å¢å¼º**
   - è‡ªåŠ¨å¤åˆ¶ç©æ³•åŒ…åˆ°.claude/gameplays/
   - gameplay-packs.jsoné…ç½®ç®¡ç†

#### ç§»é™¤å‘½ä»¤

- âŒ `initmc-upgrade`
- âŒ `initmc-force`
ï¼ˆåŠŸèƒ½æ•´åˆåˆ°`initmc`å•å‘½ä»¤ï¼‰

---

## ç‰ˆæœ¬è¯´æ˜

- **v21.x**: v21.0æ¶æ„ï¼ˆå•ä¸€æ•°æ®æºtask-meta.jsonï¼‰
- **v20.x**: v20.0æ¶æ„ï¼ˆåŒæ–‡ä»¶workflow-state.json + task-meta.jsonï¼‰

**å½“å‰ç¨³å®šç‰ˆæœ¬**: v21.1.2

---

_æ›´å¤šå†å²ç‰ˆæœ¬è®°å½•å·²å½’æ¡£ï¼Œå¦‚éœ€æŸ¥çœ‹è¯·è®¿é—®é¡¹ç›®Gitå†å²_
