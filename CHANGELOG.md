# Changelog

NeteaseMod-Claude ç‰ˆæœ¬æ›´æ–°è®°å½•

---

## [21.1.2] - 2025-11-15

### ğŸ“– æ–‡æ¡£ä¿®æ­£ï¼štask-meta.jsonç»“æ„è§„èŒƒå…¨é¢å®¡è®¡

**èƒŒæ™¯**: ç”¨æˆ·ä¸‹æ¸¸æµ‹è¯•æ—¶å‘ç°æ–‡æ¡£ä¸å®é™…ä»£ç å®ç°ä¸ä¸€è‡´ï¼Œç³»ç»Ÿæ€§å®¡è®¡åå‘ç°**11ä¸ªæ–‡æ¡£-ä»£ç ä¸ä¸€è‡´é—®é¢˜**ã€‚

#### ä¿®å¤æ±‡æ€»

| ä¸¥é‡æ€§ | ä¿®å¤é¡¹æ•° | çŠ¶æ€ |
|--------|---------|------|
| P0 (Critical) | 3ä¸ª | âœ… å·²ä¿®å¤ |
| P1 (High) | 5ä¸ª | âœ… å·²ä¿®å¤ |
| P2 (Medium) | 2ä¸ª | âœ… å·²ä¿®å¤ |
| P3 (Low) | 1ä¸ª | â³ æš‚ç¼“ |

#### æ ¸å¿ƒä¿®å¤é¡¹

**P0-1**: è¡¥å…¨stepså­—æ®µç»“æ„ (`docs/developer/task-meta.jsonæ–‡ä»¶ç»“æ„.md` lines 267-302)
- âœ… æ·»åŠ `description`å­—æ®µè¯´æ˜ï¼ˆæ­¥éª¤ä¸­æ–‡æè¿°ï¼‰
- âœ… æ·»åŠ `prompt`å­—æ®µè¯´æ˜ï¼ˆAIæŒ‡å¯¼å†…å®¹ï¼‰
- âœ… æ·»åŠ `skipped`çŠ¶æ€è¯´æ˜ï¼ˆç©æ³•åŒ…æ¨¡å¼ï¼‰

**P0-2**: ç»Ÿä¸€architecture_versionå€¼æ ¼å¼
- âœ… ä»`"21.0"` â†’ `"v21.0"`ï¼ˆä¸ä»£ç å®ç°ä¸€è‡´ï¼‰

**P0-3**: é‡å†™ç¤ºä¾‹JSON
- âœ… ç¤ºä¾‹1ï¼šä»»åŠ¡åˆå§‹åŒ–æ—¶çš„ç»“æ„ï¼ˆç²¾ç¡®å¯¹åº”ä»£ç ç”Ÿæˆï¼‰
- âœ… ç¤ºä¾‹2ï¼šè¿è¡Œæ—¶å®Œæ•´ç»“æ„ï¼ˆå«è¿­ä»£è®°å½•ï¼‰
- âœ… åŒºåˆ†åˆå§‹åŒ–å­—æ®µ vs è¿è¡Œæ—¶æ·»åŠ å­—æ®µ

**P1çº§ä¿®å¤**: è¡¥å…¨ç¼ºå¤±å­—æ®µæ–‡æ¡£
- âœ… `failed_at`: å¤±è´¥æ—¶é—´æˆ³
- âœ… `final_step`: ä»»åŠ¡ç»ˆæ­¢æ­¥éª¤
- âœ… ä¿®æ­£`task_type`æšä¸¾ï¼ˆåˆ é™¤æœªå®ç°çš„`feature_implementation`ï¼‰
- âœ… æ˜ç¡®`bug_fix_tracking`ç”Ÿæˆæ—¶æœºï¼ˆåˆå§‹åŒ–é˜¶æ®µï¼‰

**P2çº§ä¿®å¤**: å½’æ¡£çŠ¶æ€å­—æ®µé‡æ„
- âœ… 7.1èŠ‚ï¼šåˆå§‹åŒ–å­—æ®µï¼ˆarchived, failedï¼‰
- âœ… 7.2èŠ‚ï¼šè¿è¡Œæ—¶æ·»åŠ å­—æ®µï¼ˆarchived_at, failed_at, cancel_typeç­‰ï¼‰

#### éªŒè¯å·¥å…· v21.0.2

**æ–‡ä»¶**: `validate-task-meta.py` (ä¸»é¡¹ç›® + tests/)

**æ–°å¢æ£€æŸ¥**:
- âœ… steps.description/promptå¿…éœ€å­—æ®µéªŒè¯
- âœ… architecture_versionç²¾ç¡®å€¼æ£€æŸ¥ï¼ˆæ£€æµ‹"21.0"é”™è¯¯ï¼‰
- âœ… task_typeæšä¸¾éªŒè¯ï¼ˆæ‹’ç»feature_implementationï¼‰
- âœ… åŒºåˆ†18ä¸ªåˆå§‹åŒ–å¿…éœ€å­—æ®µ vs 5ä¸ªè¿è¡Œæ—¶å¯é€‰å­—æ®µ
- âœ… Windowså…¼å®¹æ€§ä¿®å¤ï¼ˆemoji â†’ ASCIIç¬¦å·ï¼‰

**éªŒè¯ç»“æœ**: 0ä¸ªé”™è¯¯ï¼Œ0ä¸ªè­¦å‘Šï¼Œ**å®Œå…¨é€šè¿‡** âœ…

#### æ–°å¢æ–‡æ¡£

1. **æ–‡æ¡£å®¡è®¡æŠ¥å‘Š**: `docs/developer/task-meta-audit-report.md`
   - 11ä¸ªä¸ä¸€è‡´é—®é¢˜è¯¦ç»†åˆ†æ
   - P0-P3ä¸¥é‡æ€§åˆ†ç±»
   - ä»£ç ä½ç½®ç´¢å¼•

2. **éªŒè¯æŠ¥å‘Š**: `docs/developer/v21.1.2-validation-report.md`
   - å®Œæ•´éªŒè¯ç»“æœæ˜ç»†
   - v21.1.1ä»£ç ä¿®å¤éªŒè¯
   - æ–‡æ¡£è´¨é‡å¯¹æ¯”è¯„ä¼°

#### å‡çº§æŒ‡å—

**æ— éœ€æ“ä½œ**: çº¯æ–‡æ¡£ä¿®æ­£ï¼Œä»£ç æ— å˜æ›´ã€‚

**å»ºè®®æ“ä½œ**:
```bash
# éªŒè¯ç°æœ‰ä»»åŠ¡æ˜¯å¦ç¬¦åˆè§„èŒƒ
python validate-task-meta.py tasks/ä»»åŠ¡-xxx/.task-meta.json
```

---

## [21.1.1] - 2025-11-15

### ğŸ› Hotfix: v21.1.0éƒ¨ç½²å­—æ®µåˆå§‹åŒ–ç¼ºå¤±

**é—®é¢˜**: ç”¨æˆ·ä¸‹æ¸¸æµ‹è¯•å‘ç°ç”Ÿæˆçš„task-meta.jsonç¼ºå°‘å…³é”®å­—æ®µã€‚

#### ä¿®å¤å†…å®¹

**æ–‡ä»¶**: `templates/.claude/hooks/orchestrator/user_prompt_handler.py`

1. **metricså­—æ®µåˆå§‹åŒ–** (lines 1020-1026)
   ```python
   "metrics": {
       "docs_read": [],
       "code_changes": [],
       "tool_calls": [],  # â† æ–°å¢
       "failure_count": 0,
       "expert_review_triggered": False
   }
   ```

2. **ä¼šè¯ç®¡ç†å­—æ®µ** (lines 1028-1030)
   ```python
   "session_started_at": datetime.now().isoformat(),  # â† æ–°å¢
   "session_ended_at": None,
   ```

3. **å½’æ¡£çŠ¶æ€å­—æ®µ** (lines 1033-1034)
   ```python
   "archived": False,
   "failed": False  # â† æ–°å¢
   ```

#### å‡çº§æŒ‡å—

**ä¸‹æ¸¸é¡¹ç›®æ›´æ–°**:
```bash
cd your-project
npm install @netease-mod/claude-workflow@latest
# æˆ–æ‰‹åŠ¨æ›¿æ¢ .claude/hooks/orchestrator/user_prompt_handler.py
```

---

## [21.1.0] - 2025-11-14

### ğŸ—ï¸ v21.0æ¶æ„é‡æ„ï¼šå•ä¸€æ•°æ®æºè®¾è®¡

**é‡å¤§å˜æ›´**: ç§»é™¤workflow-state.jsonï¼Œç»Ÿä¸€ä½¿ç”¨task-meta.jsonä½œä¸ºå”¯ä¸€çŠ¶æ€å­˜å‚¨ã€‚

#### æ ¸å¿ƒå˜æ›´

**1. æ¶æ„æ ‡è¯†**
- âœ… æ‰€æœ‰task-meta.jsonåŒ…å«`architecture_version: "v21.0"`
- âœ… å…¼å®¹æ€§æ£€æŸ¥ï¼šv20.xä»»åŠ¡è‡ªåŠ¨æ‹’ç»æ“ä½œ

**2. å•ä¸€æ•°æ®æº**
- âŒ ç§»é™¤ï¼š`workflow-state.json`
- âœ… ä¿ç•™ï¼š`task-meta.json`ï¼ˆå”¯ä¸€çœŸå®æ¥æºï¼‰
- âœ… TaskMetaManagerç»Ÿä¸€ç®¡ç†ï¼ˆportalockeræ–‡ä»¶é” + atomic_updateï¼‰

**3. Hookç³»ç»Ÿé‡æ„**

| Hookæ–‡ä»¶ | v20.xè·¯å¾„ | v21.0è·¯å¾„ | å˜æ›´ |
|---------|----------|-----------|------|
| ç”¨æˆ·è¾“å…¥å¤„ç† | user-prompt-submit-hook.py | orchestrator/user_prompt_handler.py | âœ… é‡å‘½å |
| ä»»åŠ¡å–æ¶ˆ | - | orchestrator/task_cancellation_handler.py | âœ… æ–°å¢ |
| å·¥å…·ä½¿ç”¨æ›´æ–° | - | orchestrator/posttooluse_updater.py | âœ… æ–°å¢ |
| ä¼šè¯ç»“æŸ | session-end-hook.py | lifecycle/session_end.py | âœ… é‡å‘½å |
| Subagentåœæ­¢ | subagent-stop-hook.py | lifecycle/subagent_stop.py | âœ… é‡å‘½å |
| å½’æ¡£åå¤„ç† | post-archive-hook.py | archiver/post_archive.py | âœ… é‡å‘½å |

**4. å­—æ®µè¿ç§»**

ä»workflow-state.jsonè¿ç§»åˆ°task-meta.json:
- âœ… `current_step` â†’ task-meta.json
- âœ… `last_injection_step` â†’ task-meta.json
- âœ… `steps.*` â†’ task-meta.json
- âœ… `metrics.*` â†’ task-meta.json

**5. ç©æ³•åŒ…æ¨¡å¼**
- âœ… step0/step1è‡ªåŠ¨è·³è¿‡ï¼ˆ`status: "skipped"`ï¼‰
- âœ… ç›´æ¥è¿›å…¥step3_execute
- âœ… ç©æ³•åŒ…ä»£ç æ³¨å…¥æœºåˆ¶ä¿ç•™

#### å‡çº§æŒ‡å—

**è‡ªåŠ¨è¿ç§»**:
```bash
cd your-project
initmc  # è‡ªåŠ¨æ£€æµ‹å¹¶å‡çº§v20.x â†’ v21.0
```

**è¿ç§»å†…å®¹**:
1. æ‰€æœ‰Hookæ–‡ä»¶é‡æ–°éƒ¨ç½²åˆ°æ–°è·¯å¾„
2. settings.json hooksé…ç½®è‡ªåŠ¨æ›´æ–°
3. å·²å­˜åœ¨çš„workflow-state.jsonä¿ç•™ï¼ˆä¸å½±å“v21.0è¿è¡Œï¼‰

**ç ´åæ€§å˜æ›´**:
- âš ï¸ v20.xä»»åŠ¡æ— æ³•åœ¨v21.0ç¯å¢ƒç»§ç»­æ‰§è¡Œ
- âš ï¸ éœ€é‡æ–°åˆ›å»ºä»»åŠ¡æˆ–æ‰‹åŠ¨è¿ç§»task-meta.json

---

## [20.2.12] - 2025-11-14

### ğŸ¯ æ™ºèƒ½å•å‘½ä»¤æ¨¡å¼

**é‡å¤§ç®€åŒ–**: `initmc`å‘½ä»¤è‡ªåŠ¨å¤„ç†æ‰€æœ‰éƒ¨ç½²åœºæ™¯ã€‚

#### åŠŸèƒ½

1. **æ™ºèƒ½æ¨¡å¼æ£€æµ‹**
   ```bash
   initmc  # è‡ªåŠ¨åˆ¤æ–­ï¼šå…¨æ–°éƒ¨ç½² | å‡çº§ | ä¿®å¤
   ```

2. **è‡ªåŠ¨è¿ç§»v20.x â†’ v21.0**
   - æ£€æµ‹architecture_version
   - è‡ªåŠ¨å‡çº§Hookæ–‡ä»¶
   - æ›´æ–°settings.jsoné…ç½®

3. **ç©æ³•åŒ…æ¨¡å¼å¢å¼º**
   - è‡ªåŠ¨å¤åˆ¶ç©æ³•åŒ…åˆ°.claude/gameplays/
   - gameplay-packs.jsoné…ç½®ç®¡ç†

#### ç§»é™¤å‘½ä»¤

- âŒ `initmc-upgrade`
- âŒ `initmc-force`
ï¼ˆåŠŸèƒ½æ•´åˆåˆ°`initmc`å•å‘½ä»¤ï¼‰

---

## ç‰ˆæœ¬è¯´æ˜

- **v21.x**: v21.0æ¶æ„ï¼ˆå•ä¸€æ•°æ®æºtask-meta.jsonï¼‰
- **v20.x**: v20.0æ¶æ„ï¼ˆåŒæ–‡ä»¶workflow-state.json + task-meta.jsonï¼‰

**å½“å‰ç¨³å®šç‰ˆæœ¬**: v21.1.2

---

_æ›´å¤šå†å²ç‰ˆæœ¬è®°å½•å·²å½’æ¡£ï¼Œå¦‚éœ€æŸ¥çœ‹è¯·è®¿é—®é¡¹ç›®Gitå†å²_
