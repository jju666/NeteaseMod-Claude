# CLAUDE.md - NeteaseMod-Claude å·¥ä½œæµç”Ÿæˆå™¨å¼€å‘æŒ‡å—

> ğŸ¤– **å·¥ä½œæµæ¶æ„å¸ˆå’ŒNode.jså¼€å‘ä¸“å®¶å¿…è¯»æ–‡æ¡£**
>
> æœ¬æ–‡æ¡£æŒ‡å¯¼ Claude Code åœ¨æœ¬ä»“åº“ä¸­è¿›è¡Œå·¥ä½œæµçš„å¼€å‘å’Œç»´æŠ¤å·¥ä½œã€‚
>
> **å½“å‰ç‰ˆæœ¬**: v18.0.0
> **æœ€åæ›´æ–°**: 2025-11-12
> **æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæ•´æŠ€æœ¯æ–‡æ¡£

---

## ğŸ“‘ æ–‡æ¡£å¯¼èˆª

### ğŸ¯ æ ¸å¿ƒç« èŠ‚ï¼ˆå¿…è¯»ï¼‰
- [ç¬¬ä¸€ç« ï¼šé¡¹ç›®æ¦‚è§ˆ](#-ç¬¬ä¸€ç« é¡¹ç›®æ¦‚è§ˆ) - é¡¹ç›®å®šä½ã€ç‰ˆæœ¬ä¿¡æ¯ã€æŠ€æœ¯æ ˆ
- [ğŸ” å¿«é€ŸæŸ¥é˜…ç´¢å¼•](#-å¿«é€ŸæŸ¥é˜…ç´¢å¼•aiå¸¸ç”¨) - AIå¸¸ç”¨æ“ä½œé€ŸæŸ¥
- [ç¬¬äºŒç« ï¼šæ¶æ„è®¾è®¡å…¨æ™¯](#ï¸-ç¬¬äºŒç« æ¶æ„è®¾è®¡å…¨æ™¯) - å®Œæ•´æ¶æ„å›¾è§£
- [ç¬¬ä¸‰ç« ï¼šå¼€å‘è§„èŒƒ](#-ç¬¬ä¸‰ç« å¼€å‘è§„èŒƒ) - âš ï¸ æå…¶é‡è¦ï¼Œä¼˜å…ˆé˜…è¯»

### ğŸ”§ æ ¸å¿ƒæœºåˆ¶ï¼ˆæ·±åº¦ç†è§£ï¼‰
- ç¬¬å››ç« ï¼šæ ¸å¿ƒæœºåˆ¶è¯¦è§£ - åŒå±‚æ–‡æ¡£ã€ç”Ÿæˆå™¨ã€æ¨¡æ¿ç³»ç»Ÿ
- ç¬¬äº”ç« ï¼šé…ç½®ç³»ç»Ÿè¯¦è§£ - å ä½ç¬¦ã€è·¯å¾„æ˜ å°„
- ç¬¬å…­ç« ï¼šæ–‡æ¡£ç”Ÿæˆå™¨æ·±åº¦è§£æ - Layer 1/2/3æ¶æ„
- ç¬¬ä¸ƒç« ï¼šè½¯è¿æ¥ç®¡ç†å™¨å®ç° - è·¨å¹³å°æ”¯æŒ

### ğŸ“š é«˜çº§å†…å®¹ï¼ˆå®Œæ•´ç†è§£ï¼‰
- ç¬¬å…«ç« ï¼šé¡¹ç›®åˆ†æå™¨å®ç° - å¤æ‚åº¦è¯„åˆ†ç®—æ³•
- ç¬¬ä¹ç« ï¼šç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ - å‡çº§æµç¨‹ã€è¿ç§»è„šæœ¬
- ç¬¬åç« ï¼šå®Œæ•´å·¥ä½œæµç¨‹ - æ‰§è¡Œæµç¨‹å›¾
- ç¬¬åä¸€ç« ï¼šClaudeå‘½ä»¤ç³»ç»Ÿ - 6ä¸ªæ ¸å¿ƒå‘½ä»¤è¯¦è§£

### ğŸ“– å‚è€ƒèµ„æ–™
- ç¬¬åäºŒç« ï¼šå…³é”®ç‰¹æ€§ä¸æŠ€æœ¯äº®ç‚¹ - æŠ€æœ¯è¯„åˆ†
- ç¬¬åä¸‰ç« ï¼šé—®é¢˜æ’æŸ¥æŒ‡å— - æ•…éšœè¯Šæ–­
- ç¬¬åå››ç« ï¼šæŠ€æœ¯å‚è€ƒ - ç®—æ³•å…¬å¼ã€æ€§èƒ½æŒ‡æ ‡
- [é™„å½•](#-é™„å½•) - ç‰ˆæœ¬å†å²ã€æœ¯è¯­è¡¨ã€FAQ

---

## ğŸ¯ ç¬¬ä¸€ç« ï¼šé¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®å®šä½ä¸æ ¸å¿ƒèŒè´£

#### é¡¹ç›®èº«ä»½

**NeteaseMod-Claude** æ˜¯ä¸€ä¸ª**å·¥ä½œæµç”Ÿæˆå™¨**ï¼ˆWorkflow Generatorï¼‰ï¼Œè€ŒéMODSDKæ¸¸æˆé¡¹ç›®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NeteaseMod-Claude (æœ¬é¡¹ç›®)                          â”‚
â”‚  â”œâ”€ èº«ä»½: å·¥ä½œæµç”Ÿæˆå™¨                               â”‚
â”‚  â”œâ”€ å¼€å‘è€…: å·¥ä½œæµæ¶æ„å¸ˆ                             â”‚
â”‚  â”œâ”€ ç”¨æˆ·: MODSDKæ¸¸æˆå¼€å‘è€…                          â”‚
â”‚  â””â”€ è¾“å‡ºç‰©: ä¸‹æ¸¸é¡¹ç›®çš„å·¥ä½œæµæ–‡ä»¶                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ initmc éƒ¨ç½²
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸‹æ¸¸MODSDKé¡¹ç›® (ç”¨æˆ·é¡¹ç›®)                            â”‚
â”‚  â”œâ”€ èº«ä»½: MODSDKæ¸¸æˆé¡¹ç›®                             â”‚
â”‚  â”œâ”€ å¼€å‘è€…: æ¸¸æˆå¼€å‘è€…                               â”‚
â”‚  â”œâ”€ AIåŠ©æ‰‹: Claude Code (ä½¿ç”¨å·¥ä½œæµ)                â”‚
â”‚  â””â”€ è¾“å‡ºç‰©: ç½‘æ˜“æˆ‘çš„ä¸–ç•ŒMOD                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### AIåŠ©æ‰‹èº«ä»½å®šä½

ä½ æ˜¯ä¸€ä¸ª**å·¥ä½œæµæ¶æ„å¸ˆå’ŒNode.jså¼€å‘ä¸“å®¶**ï¼Œè´Ÿè´£ç»´æŠ¤å’Œæ”¹è¿› **NeteaseMod-Claude** å·¥ä½œæµç³»ç»Ÿã€‚

**æ ¸å¿ƒèŒè´£**:
- ğŸ—ï¸ å¼€å‘å’Œç»´æŠ¤å·¥ä½œæµç”Ÿæˆå™¨ï¼ˆ[lib/](lib/), [bin/](bin/)ï¼‰
- ğŸ“š ç®¡ç†å·¥ä½œæµçŸ¥è¯†åº“ï¼ˆ[markdown/](markdown/)ï¼‰
- ğŸ”§ ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼ˆå®‰è£…æµç¨‹ã€é”™è¯¯æç¤ºã€æ–‡æ¡£è´¨é‡ï¼‰
- ğŸ› ä¿®å¤Bugå’Œå¤„ç†Issue

**é‡è¦æé†’**:
- âš ï¸ æœ¬é¡¹ç›®æ˜¯**å·¥ä½œæµç”Ÿæˆå™¨**ï¼Œä¸æ˜¯MODSDKé¡¹ç›®
- âš ï¸ ä½ çš„ç”¨æˆ·æ˜¯**å·¥ä½œæµä½¿ç”¨è€…**ï¼ˆMODSDKæ¸¸æˆå¼€å‘è€…ï¼‰ï¼Œä¸æ˜¯å·¥ä½œæµå¼€å‘è€…
- âš ï¸ ä¸‹æ¸¸é¡¹ç›®ï¼ˆç”¨æˆ·çš„MODSDKé¡¹ç›®ï¼‰ä¼šä½¿ç”¨ [templates/CLAUDE.md.template](templates/CLAUDE.md.template) ä½œä¸ºAIæŒ‡å¯¼æ–‡æ¡£

---

### 1.2 ç‰ˆæœ¬ä¿¡æ¯

| é¡¹ç›® | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| **å½“å‰ç‰ˆæœ¬** | v18.0.0 | ä¸‹æ¸¸CLAUDE.mdå®Œå…¨è§£è€¦ + æ™ºèƒ½æ–‡æ¡£è·¯ç”± |
| **æœ€åæ›´æ–°** | 2025-11-12 | æœ¬æ–‡æ¡£ç¼–å†™æ—¥æœŸ |
| **Node.jsè¦æ±‚** | >=12.0.0 | è§ [package.json:42](package.json#L42) |
| **æ ¸å¿ƒä¾èµ–** | fs-extra, glob | è§ [package.json:44-47](package.json#L44-L47) |

**ç‰ˆæœ¬å·å®šä¹‰ä½ç½®**:
- [lib/config.js:29](lib/config.js#L29) - `const VERSION = '18.0.0';`
- [package.json:3](package.json#L3) - `"version": "18.0.0"`
- æœ¬æ–‡æ¡£é¡¶éƒ¨ç‰ˆæœ¬å£°æ˜

**é‡è¦æé†’**: ä¿®æ”¹ç‰ˆæœ¬å·æ—¶å¿…é¡»åŒæ­¥æ›´æ–°è¿™3ä¸ªä½ç½®ï¼è¯¦è§ [3.4 ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•](#34-ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•)ã€‚

---

### 1.3 æŠ€æœ¯æ ˆä¸ä¾èµ–

#### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Node.js** | >=12.0.0 | è¿è¡Œæ—¶ç¯å¢ƒ |
| **JavaScript (ES6+)** | - | ç¼–ç¨‹è¯­è¨€ |
| **fs-extra** | ^10.1.0 | å¢å¼ºçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ |
| **glob** | ^7.2.0 | æ–‡ä»¶æ¨¡å¼åŒ¹é… |
| **Git Submodule** | - | å®˜æ–¹æ–‡æ¡£é›†æˆ |

#### è®¾è®¡æ¨¡å¼åº”ç”¨

| è®¾è®¡æ¨¡å¼ | åº”ç”¨ä½ç½® | è¯´æ˜ |
|---------|---------|------|
| **ç”Ÿæˆå™¨æ¨¡å¼** | [lib/generator.js](lib/generator.js) | åˆ†å±‚ç”Ÿæˆæ–‡æ¡£ï¼ˆLayer 1/2/3ï¼‰ |
| **ç­–ç•¥æ¨¡å¼** | [lib/symlink-manager.js](lib/symlink-manager.js) | è½¯è¿æ¥é™çº§ç­–ç•¥ |
| **å•ä¾‹æ¨¡å¼** | [lib/config.js](lib/config.js) | å…¨å±€é…ç½®ç®¡ç† |
| **æ¨¡æ¿æ–¹æ³•æ¨¡å¼** | [lib/generator.js](lib/generator.js) | æ–‡æ¡£ç”Ÿæˆæµç¨‹ |

#### è·¨å¹³å°æ”¯æŒ

| å¹³å° | æ”¯æŒçŠ¶æ€ | è½¯è¿æ¥æ–¹å¼ | è¯´æ˜ |
|-----|---------|-----------|------|
| **Windows** | âœ… å·²æµ‹è¯• | Junction/Symlink â†’ åªè¯»å‰¯æœ¬ | è§ [lib/symlink-manager.js](lib/symlink-manager.js) |
| **Linux** | âœ… å·²æµ‹è¯• | Symlink | åŸç”Ÿæ”¯æŒ |
| **macOS** | âœ… ç†è®ºæ”¯æŒ | Symlink | åŸç”Ÿæ”¯æŒ |

---

### 1.4 ä¸ä¸‹æ¸¸é¡¹ç›®çš„å…³ç³»

#### å·¥ä½œæµéƒ¨ç½²å…³ç³»å›¾

```
ä¸Šæ¸¸é¡¹ç›®ï¼ˆNeteaseMod-Claudeï¼‰
â”œâ”€ å¼€å‘ï¼šå·¥ä½œæµæ¶æ„å¸ˆ
â”œâ”€ ç»´æŠ¤ï¼šlib/, bin/, markdown/, templates/
â””â”€ å‘å¸ƒï¼šnpm run install-global
      â”‚
      â”‚ å…¨å±€å®‰è£…åˆ° ~/.claude-modsdk-workflow/
      â†“
ä¸‹æ¸¸é¡¹ç›®ï¼ˆç”¨æˆ·çš„MODSDKé¡¹ç›®ï¼‰
â”œâ”€ ä½¿ç”¨è€…ï¼šæ¸¸æˆå¼€å‘è€…
â”œâ”€ åˆå§‹åŒ–ï¼šinitmc
â”œâ”€ ç”Ÿæˆç‰©ï¼šCLAUDE.md, .claude/, markdown/
â””â”€ AIåŠ©æ‰‹ï¼šClaude Code (è¯»å–å·¥ä½œæµæ–‡ä»¶)
```

#### æ–‡ä»¶æµå‘å›¾

```mermaid
graph LR
    A[ä¸Šæ¸¸ä»“åº“<br/>markdown/] -->|è½¯è¿æ¥| B[ä¸‹æ¸¸é¡¹ç›®<br/>.claude/core-docs/]
    C[ä¸Šæ¸¸ä»“åº“<br/>templates/] -->|ç”Ÿæˆ| D[ä¸‹æ¸¸é¡¹ç›®<br/>CLAUDE.md]
    E[ä¸Šæ¸¸ä»“åº“<br/>docs/] -->|è½¯è¿æ¥| F[ä¸‹æ¸¸é¡¹ç›®<br/>.claude/docs/]

    B --> G[AIè¯»å–æ–‡æ¡£]
    D --> G
    F --> G

    style A fill:#4caf50
    style C fill:#2196f3
    style E fill:#ff9800
    style G fill:#9c27b0,color:#fff
```

#### èŒè´£è¾¹ç•Œè¡¨ï¼ˆv18.0æ›´æ–°ï¼‰

| ç›®å½•/æ–‡ä»¶ | ä¸Šæ¸¸èŒè´£ | ä¸‹æ¸¸èŒè´£ | éƒ¨ç½²æ–¹å¼ |
|----------|---------|---------|---------|
| **markdown/** | âœ… ç»´æŠ¤æ ¸å¿ƒæ–‡æ¡£ | âŒ åªè¯»å¼•ç”¨ | è½¯è¿æ¥åˆ° `.claude/core-docs/` |
| **templates/** | âœ… ç»´æŠ¤å‘½ä»¤æ¨¡æ¿ | âŒ ä¸å¯è§ | é€šè¿‡ `initmc` ç”Ÿæˆ |
| **lib/, bin/** | âœ… ç»´æŠ¤ä»£ç  | âŒ ä¸å¯è§ | å…¨å±€å®‰è£… |
| **CLAUDE.md** | âœ… ç»´æŠ¤æœ€å°åŒ–æ¨¡æ¿ | âœ… **å®Œå…¨ç”±ç”¨æˆ·ç®¡ç†** â­ v18.0 | ä»…é¦–æ¬¡ç”Ÿæˆæœ€å°æ¨¡æ¿ |
| **markdown/core/** | âŒ ä¸ç»´æŠ¤ | âœ… é¡¹ç›®å®šåˆ¶æ–‡æ¡£ | ä¸‹æ¸¸åˆ›å»º |
| **markdown/systems/** | âŒ ä¸ç»´æŠ¤ | âœ… é¡¹ç›®Systemæ–‡æ¡£ | ä¸‹æ¸¸ç”Ÿæˆ |

---

## ğŸ” å¿«é€ŸæŸ¥é˜…ç´¢å¼•ï¼ˆAIå¸¸ç”¨ï¼‰

> ğŸ’¡ **ä½¿ç”¨è¯´æ˜**: å½“ä½ éœ€è¦æ‰§è¡Œç‰¹å®šæ“ä½œæ—¶ï¼Œå¿«é€Ÿå®šä½åˆ°ç›¸å…³ç« èŠ‚ã€‚

### ğŸ“ å½“ä½ éœ€è¦ä¿®æ”¹æ ¸å¿ƒæ–‡æ¡£...

| æ“ä½œ | æ–‡ä»¶ä½ç½® | æ³¨æ„äº‹é¡¹ |
|-----|---------|---------|
| ä¿®æ”¹å¼€å‘è§„èŒƒ | [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md) | âœ… ç›´æ¥ç¼–è¾‘ï¼ˆå•ä¸€çœŸå®æºï¼‰ |
| ä¿®æ”¹é—®é¢˜æ’æŸ¥ | [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md) | âœ… ç›´æ¥ç¼–è¾‘ |
| ä¿®æ”¹APIé€ŸæŸ¥ | [markdown/æ¦‚å¿µå‚è€ƒ/APIé€ŸæŸ¥.md](markdown/æ¦‚å¿µå‚è€ƒ/APIé€ŸæŸ¥.md) | âœ… ç›´æ¥ç¼–è¾‘ |
| âŒ ç¦æ­¢æ“ä½œ | ~~templates/markdown/å¼€å‘è§„èŒƒ.md.template~~ | âŒ å·²åˆ é™¤ï¼ˆv16.3é‡æ„ï¼‰ |

**å…³é”®è§„èŒƒ**: å‚è§ [3.1 èŒè´£è¾¹ç•Œè§„èŒƒ](#31-èŒè´£è¾¹ç•Œè§„èŒƒv163é‡æ„å)

---

### ğŸ”§ å½“ä½ éœ€è¦ä¿®æ”¹ç”Ÿæˆå™¨é€»è¾‘...

| æ“ä½œ | æ–‡ä»¶ä½ç½® | å…³é”®æ–¹æ³• |
|-----|---------|---------|
| æ·»åŠ æ–°å ä½ç¬¦ | [lib/config.js:66-81](lib/config.js#L66-L81) | `PLACEHOLDERS` å®šä¹‰ |
| | [lib/generator.js](lib/generator.js) | `_buildReplacements()` è®¡ç®—å€¼ |
| ä¿®æ”¹è½¯è¿æ¥è§„åˆ™ | [lib/symlink-manager.js](lib/symlink-manager.js) | `_getCoreFiles()` åŒ…å«/æ’é™¤æ¨¡å¼ |
| è°ƒæ•´å¤æ‚åº¦è¯„åˆ† | [lib/project-analyzer.js](lib/project-analyzer.js) | `_calculateComplexity()` ç®—æ³• |
| ä¿®æ”¹Layerç”Ÿæˆé€»è¾‘ | [lib/generator.js](lib/generator.js) | `_generateLayer1/2/3()` |

**è¯¦ç»†è¯´æ˜**:
- å ä½ç¬¦ç³»ç»Ÿ â†’ [3.2 æ¨¡æ¿å˜é‡ç³»ç»Ÿè§„èŒƒ](#32-æ¨¡æ¿å˜é‡ç³»ç»Ÿè§„èŒƒ)
- è½¯è¿æ¥ç®¡ç† â†’ [3.3 è½¯è¿æ¥ç®¡ç†è§„èŒƒ](#33-è½¯è¿æ¥ç®¡ç†è§„èŒƒ)

---

### ğŸš€ å½“ä½ éœ€è¦å‘å¸ƒæ–°ç‰ˆæœ¬...

**å®Œæ•´æ£€æŸ¥æ¸…å•**: è§ [3.4 ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•](#34-ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•)ï¼ˆ15é¡¹ï¼‰

**å¿«é€Ÿæ ¸å¿ƒæ­¥éª¤**:
1. æ›´æ–° [lib/config.js:29](lib/config.js#L29) çš„ `VERSION`
2. æ›´æ–° [package.json:3](package.json#L3) çš„ `version`
3. æ›´æ–°æœ¬æ–‡æ¡£é¡¶éƒ¨ç‰ˆæœ¬å·
4. æ›´æ–° [templates/CLAUDE.md.template](templates/CLAUDE.md.template) ç‰ˆæœ¬å·
5. è¿è¡Œ `npm run install-global` æµ‹è¯•å…¨å±€å®‰è£…
6. æµ‹è¯•å‡çº§è·¯å¾„ï¼ˆv15.x â†’ å½“å‰ï¼Œv16.x â†’ å½“å‰ï¼‰

**âš ï¸ å¹³æ»‘å‡çº§åŸåˆ™**: è§ [3.2 å¹³æ»‘å‡çº§åŸåˆ™ï¼ˆæå…¶é‡è¦ï¼‰](#32-å¹³æ»‘å‡çº§åŸåˆ™æå…¶é‡è¦)

---

### ğŸ› å½“ä½ é‡åˆ°é—®é¢˜...

| é—®é¢˜ç±»å‹ | å¿«é€Ÿå®šä½ |
|---------|---------|
| è½¯è¿æ¥åˆ›å»ºå¤±è´¥ | [é—®é¢˜1: è½¯è¿æ¥åˆ›å»ºå¤±è´¥](#é—®é¢˜1-è½¯è¿æ¥åˆ›å»ºå¤±è´¥) |
| å…¨å±€å®‰è£…åå‘½ä»¤ä¸å¯ç”¨ | [é—®é¢˜2: å…¨å±€å®‰è£…åå‘½ä»¤ä¸å¯ç”¨](#é—®é¢˜2-å…¨å±€å®‰è£…å-initmc-å‘½ä»¤ä¸å¯ç”¨) |
| æ¨¡æ¿æ–‡ä»¶æœªæ‰¾åˆ° | [é—®é¢˜3: æ¨¡æ¿æ–‡ä»¶æœªæ‰¾åˆ°](#é—®é¢˜3-æ¨¡æ¿æ–‡ä»¶æœªæ‰¾åˆ°) |
| æ–‡æ¡£å†—ä½™é—®é¢˜ | [é—®é¢˜4: æ–‡æ¡£å†—ä½™](#é—®é¢˜4-æ–‡æ¡£å†—ä½™v163å·²ä¿®å¤) |

**å®Œæ•´é—®é¢˜æ’æŸ¥**: è§ [ç¬¬åä¸‰ç« ï¼šé—®é¢˜æ’æŸ¥æŒ‡å—](#-ç¬¬åä¸‰ç« é—®é¢˜æ’æŸ¥æŒ‡å—)

---

### ğŸ“š å…³é”®è§„èŒƒé€ŸæŸ¥

#### âœ… æ­£ç¡®åšæ³•

- âœ… åœ¨ [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/) ç»´æŠ¤æ ¸å¿ƒæ–‡æ¡£
- âœ… åœ¨ [templates/](templates/) ç»´æŠ¤é¡¹ç›®ç‰¹å®šæ¨¡æ¿ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
- âœ… é€šè¿‡è½¯è¿æ¥éƒ¨ç½²æ ¸å¿ƒæ–‡æ¡£åˆ°ä¸‹æ¸¸ `.claude/core-docs/`
- âœ… å¿…é¡»ä¿æŒå‘åå…¼å®¹ï¼Œè‡³å°‘æ”¯æŒæœ€è¿‘2ä¸ªå¤§ç‰ˆæœ¬çš„å‡çº§è·¯å¾„
- âœ… å¿…é¡»æä¾›è‡ªåŠ¨è¿ç§»è„šæœ¬ï¼ˆæ”¾åœ¨ `lib/migration-vX.X.js`ï¼‰

#### âŒ ç¦æ­¢è¡Œä¸º

- âŒ åœ¨ [templates/markdown/](templates/markdown/) ç»´æŠ¤æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£å‰¯æœ¬
- âŒ é€šè¿‡ `_generateFromTemplate()` ç”Ÿæˆæ ¸å¿ƒæ–‡æ¡£ï¼ˆåº”ä½¿ç”¨è½¯è¿æ¥ï¼‰
- âŒ å¼•å…¥ç ´åæ€§å˜æ›´ï¼ˆé™¤éæä¾›è‡ªåŠ¨è¿ç§»è„šæœ¬ï¼‰
- âŒ ç›´æ¥åˆ é™¤å·²æœ‰åŠŸèƒ½ï¼ˆå¿…é¡»å…ˆæ ‡è®°ä¸º deprecatedï¼‰
- âŒ è·³è¿‡ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•çš„ä»»ä½•ä¸€é¡¹

---

## ğŸ—ï¸ ç¬¬äºŒç« ï¼šæ¶æ„è®¾è®¡å…¨æ™¯

### 2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™

NeteaseMod-Claude é‡‡ç”¨ **ç”Ÿæˆå™¨æ¨¡å¼ + åŒå±‚æ–‡æ¡£æ¶æ„**ï¼Œå®ç°äº†å·¥ä½œæµçš„æ¨¡å—åŒ–å’Œå¯å‡çº§æ€§ã€‚

#### å››å¤§æ ¸å¿ƒè®¾è®¡åŸåˆ™

```
1. å•ä¸€çœŸå®æºï¼ˆSingle Source of Truthï¼‰
   â””â”€ markdown/ æ˜¯å”¯ä¸€çš„æ ¸å¿ƒæ–‡æ¡£æº
   â””â”€ templates/ åªåŒ…å«é¡¹ç›®ç‰¹å®šæ¨¡æ¿ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰

2. è½¯è¿æ¥å¤ç”¨ï¼ˆSymlink Reuseï¼‰
   â””â”€ é€šè¿‡è½¯è¿æ¥é¿å…æ–‡æ¡£å†—ä½™
   â””â”€ é™çº§ç­–ç•¥ï¼šè½¯è¿æ¥ â†’ åªè¯»å‰¯æœ¬

3. åˆ†å±‚ç”Ÿæˆï¼ˆLayered Generationï¼‰
   â””â”€ Layer 1: é€šç”¨å±‚ï¼ˆæ ¸å¿ƒå·¥ä½œæµï¼‰
   â””â”€ Layer 2: æ¶æ„å±‚ï¼ˆSystemsæ–‡æ¡£ï¼‰
   â””â”€ Layer 3: ä¸šåŠ¡å±‚ï¼ˆæ¡†æ¶ï¼‰

4. å¹³æ»‘å‡çº§ï¼ˆSmooth Upgradeï¼‰
   â””â”€ ä¿æŠ¤ç”¨æˆ·å®šåˆ¶ï¼ˆé¡¹ç›®æ‰©å±•åŒºï¼‰
   â””â”€ æ”¯æŒè‡ªåŠ¨è¿ç§»ï¼ˆv15.x â†’ v16.x â†’ v17.xï¼‰
```

---

### 2.2 æ¶æ„æµç¨‹å›¾

#### å·¥ä½œæµéƒ¨ç½²å…¨æ™¯å›¾

```mermaid
graph TB
    subgraph "ä¸Šæ¸¸å·¥ä½œæµé¡¹ç›®"
        A1[bin/] --> A2[lib/]
        A3[markdown/] --> A4[templates/]
        A5[docs/] --> A6[Git Submodule]
    end

    A1 -->|initmc éƒ¨ç½²| B1
    A2 -->|initmc éƒ¨ç½²| B1
    A3 -->|è½¯è¿æ¥| B2
    A4 -->|ç”Ÿæˆ| B3
    A5 -->|è½¯è¿æ¥| B4

    A1 -->|npm run install-global| C1[å…¨å±€å®‰è£…ç›®å½•<br/>~/.claude-modsdk-workflow/]
    C1 -->|initmc å‘½ä»¤| B1

    subgraph "ä¸‹æ¸¸MODSDKé¡¹ç›®"
        B1[CLAUDE.md<br/>.claude/commands/]
        B2[.claude/core-docs/<br/>è½¯è¿æ¥åˆ°ä¸Šæ¸¸]
        B3[markdown/README.md<br/>markdown/core/]
        B4[.claude/docs/<br/>è½¯è¿æ¥åˆ°ä¸Šæ¸¸]
    end

    B1 --> D1[AIè¯»å–å·¥ä½œæµ]
    B2 --> D1
    B3 --> D1
    B4 --> D1

    D1 --> E1[æ‰§è¡Œå¼€å‘ä»»åŠ¡]

    style A1 fill:#4caf50
    style A3 fill:#2196f3
    style A5 fill:#ff9800
    style C1 fill:#9c27b0,color:#fff
    style D1 fill:#f44336,color:#fff
```

---

### 2.3 å®Œæ•´ç›®å½•ç»“æ„

#### ä¸Šæ¸¸é¡¹ç›®ï¼ˆNeteaseMod-Claudeï¼‰

```
D:\EcWork\åŸºäºClaudeçš„MODSDKå¼€å‘å·¥ä½œæµ\
â”œâ”€ ğŸ“¦ bin/                      CLIå·¥å…·å…¥å£ï¼ˆ7ä¸ªè„šæœ¬ï¼‰
â”‚   â”œâ”€ initmc.js                 åˆå§‹åŒ–ä¸‹æ¸¸é¡¹ç›®å·¥ä½œæµ
â”‚   â”œâ”€ install-global.js         å…¨å±€å®‰è£…åˆ° ~/.claude-modsdk-workflow/
â”‚   â”œâ”€ uninstallmc.js            æ¸…ç†ä¸‹æ¸¸é¡¹ç›®å·¥ä½œæµ
â”‚   â”œâ”€ quick-deploy.js           å¿«é€Ÿéƒ¨ç½²ï¼ˆåˆ«åï¼‰
â”‚   â”œâ”€ merge-conflicts.js        åˆå¹¶è¦†ç›–å±‚å†²çªï¼ˆå¯é€‰å·¥å…·ï¼‰
â”‚   â”œâ”€ detect-obsolete.js        æ£€æµ‹åºŸå¼ƒæ–‡ä»¶ï¼ˆå¯é€‰å·¥å…·ï¼‰
â”‚   â””â”€ uninstall-global.js       å¸è½½å…¨å±€å®‰è£…
â”‚
â”œâ”€ ğŸ”§ lib/                      æ ¸å¿ƒç”Ÿæˆå™¨ï¼ˆ22ä¸ªæ¨¡å—ï¼‰
â”‚   â”œâ”€ generator.js              æ–‡æ¡£ç”Ÿæˆå™¨ï¼ˆLayer 1/2/3ï¼‰
â”‚   â”œâ”€ symlink-manager.js        è½¯è¿æ¥ç®¡ç†ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰
â”‚   â”œâ”€ project-analyzer.js       ä»£ç ç»“æ„åˆ†æ
â”‚   â”œâ”€ config.js                 ç‰ˆæœ¬å·+è·¯å¾„é…ç½®
â”‚   â”œâ”€ version-checker.js        ç‰ˆæœ¬è¿½è¸ª
â”‚   â”œâ”€ utils.js                  å·¥å…·å‡½æ•°
â”‚   â””â”€ ... (å…¶ä»–16ä¸ªæ¨¡å—)
â”‚
â”œâ”€ ğŸ“š markdown/                 å·¥ä½œæµçŸ¥è¯†åº“ï¼ˆå•ä¸€çœŸå®æºï¼Œ80+æ–‡ä»¶ï¼‰
â”‚   â”œâ”€ æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/           å¼€å‘è§„èŒƒã€é—®é¢˜æ’æŸ¥ã€å¿«é€Ÿå¼€å§‹
â”‚   â”œâ”€ æ¦‚å¿µå‚è€ƒ/                 MODSDKæ ¸å¿ƒæ¦‚å¿µã€APIé€ŸæŸ¥
â”‚   â”œâ”€ æ·±åº¦æŒ‡å—/                 æ€§èƒ½ä¼˜åŒ–ã€äº‹ä»¶ç³»ç»Ÿã€ECSæ¶æ„
â”‚   â”œâ”€ ai/                       ä»»åŠ¡æ¨¡å¼ç­–ç•¥è¡¨ã€å¿«é€Ÿé€šé“æµç¨‹
â”‚   â”œâ”€ systems/                  Systemæ–‡æ¡£æ¨¡æ¿ï¼ˆä¸éƒ¨ç½²åˆ°ä¸‹æ¸¸ï¼‰
â”‚   â””â”€ å¯é€‰å·¥å…·è¯´æ˜.md
â”‚
â”œâ”€ ğŸ“„ templates/                ä¸‹æ¸¸é¡¹ç›®æ¨¡æ¿
â”‚   â”œâ”€ CLAUDE.md.template        ä¸‹æ¸¸AIæŒ‡å¯¼æ–‡æ¡£
â”‚   â”œâ”€ README.md.template        é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€ .claude/commands/         6ä¸ªClaudeå‘½ä»¤æ¨¡æ¿ï¼ˆv17.1ï¼‰
â”‚   â”‚   â”œâ”€ mc.md.template         /mc ä¸»å‘½ä»¤
â”‚   â”‚   â”œâ”€ mc-review.md.template  /mc-review æ–¹æ¡ˆå®¡æŸ¥
â”‚   â”‚   â”œâ”€ mc-perf.md.template    /mc-perf æ€§èƒ½åˆ†æ
â”‚   â”‚   â”œâ”€ mc-docs.md.template    /mc-docs æ–‡æ¡£å®¡è®¡
â”‚   â”‚   â”œâ”€ mc-why.md.template     /mc-why åŸç†è§£é‡Š
â”‚   â”‚   â””â”€ mc-discover.md.template /mc-discover ç»“æ„å‘ç°
â”‚   â””â”€ markdown/                  é¡¹ç›®ç‰¹å®šæ–‡æ¡£æ¨¡æ¿ï¼ˆä»…4ä¸ªï¼‰
â”‚       â”œâ”€ README.md.template     æ–‡æ¡£å¯¼èˆª
â”‚       â”œâ”€ ç´¢å¼•.md.template       å¿«é€Ÿç´¢å¼•
â”‚       â”œâ”€ é¡¹ç›®çŠ¶æ€.md.template   é¡¹ç›®çŠ¶æ€
â”‚       â””â”€ æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md.template å¾…åŠæ¸…å•
â”‚
â”œâ”€ ğŸ“– docs/                     å®˜æ–¹æ–‡æ¡£ï¼ˆGit Submoduleï¼‰
â”‚   â”œâ”€ modsdk-wiki/              ç½‘æ˜“MODSDKå®˜æ–¹æ–‡æ¡£
â”‚   â””â”€ bedrock-wiki/             MinecraftåŸºå²©ç‰ˆWiki
â”‚
â”œâ”€ ğŸ“ CLAUDE.md                 æœ¬æ–‡æ¡£ï¼ˆAIå·¥ä½œæµæŒ‡å—ï¼‰
â”œâ”€ ğŸ“ README.md                 ç”¨æˆ·è¯´æ˜ï¼ˆç®€æ´ç‰ˆï¼‰
â”œâ”€ ğŸ“¦ package.json              é¡¹ç›®é…ç½®
â””â”€ ğŸ“œ .gitmodules               Git Submoduleé…ç½®
```

**å…³é”®æ–‡ä»¶ç»Ÿè®¡**:
- CLIå·¥å…·: 7ä¸ª ([bin/](bin/))
- æ ¸å¿ƒåº“: 22ä¸ªæ¨¡å— ([lib/](lib/))
- æ ¸å¿ƒæ–‡æ¡£: 80+ Markdownæ–‡ä»¶ ([markdown/](markdown/))
- æ¨¡æ¿æ–‡ä»¶: 12ä¸ªï¼ˆ1ä¸ªCLAUDE + 6ä¸ªå‘½ä»¤ + 5ä¸ªé¡¹ç›®æ–‡æ¡£ï¼‰
- å®˜æ–¹æ–‡æ¡£: 2ä¸ªGit Submoduleï¼ˆ[docs/](docs/)ï¼‰

---

#### ä¸‹æ¸¸é¡¹ç›®ï¼ˆç”¨æˆ·çš„MODSDKé¡¹ç›®ï¼‰

```
D:\YourProject\                 ç”¨æˆ·çš„MODSDKé¡¹ç›®
â”œâ”€ ğŸ“„ CLAUDE.md                 ä»æ¨¡æ¿ç”Ÿæˆï¼ŒæŒ‡å¯¼AIå¼€å‘
â”œâ”€ ğŸ“„ README.md                 ä»æ¨¡æ¿ç”Ÿæˆï¼Œé¡¹ç›®è¯´æ˜
â”‚
â”œâ”€ ğŸ“ .claude/                  Claude Codeé…ç½®ç›®å½•
â”‚   â”œâ”€ commands/                6ä¸ªClaudeå‘½ä»¤ï¼ˆv17.1ï¼‰
â”‚   â”‚   â”œâ”€ mc.md                 /mc ä¸»å‘½ä»¤
â”‚   â”‚   â”œâ”€ mc-review.md          /mc-review æ–¹æ¡ˆå®¡æŸ¥
â”‚   â”‚   â”œâ”€ mc-perf.md            /mc-perf æ€§èƒ½åˆ†æ
â”‚   â”‚   â”œâ”€ mc-docs.md            /mc-docs æ–‡æ¡£å®¡è®¡
â”‚   â”‚   â”œâ”€ mc-why.md             /mc-why åŸç†è§£é‡Š
â”‚   â”‚   â””â”€ mc-discover.md        /mc-discover ç»“æ„å‘ç°
â”‚   â”‚
â”‚   â”œâ”€ core-docs/               ä¸Šæ¸¸æ–‡æ¡£è½¯è¿æ¥ï¼ˆåªè¯»ï¼‰
â”‚   â”‚   â”œâ”€ æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/ â†’ [è½¯è¿æ¥åˆ°ä¸Šæ¸¸ markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/]
â”‚   â”‚   â”œâ”€ æ¦‚å¿µå‚è€ƒ/ â†’ [è½¯è¿æ¥åˆ°ä¸Šæ¸¸ markdown/æ¦‚å¿µå‚è€ƒ/]
â”‚   â”‚   â”œâ”€ æ·±åº¦æŒ‡å—/ â†’ [è½¯è¿æ¥åˆ°ä¸Šæ¸¸ markdown/æ·±åº¦æŒ‡å—/]
â”‚   â”‚   â””â”€ AIç­–ç•¥æ–‡æ¡£/ â†’ [è½¯è¿æ¥åˆ°ä¸Šæ¸¸ markdown/AIç­–ç•¥æ–‡æ¡£/]
â”‚   â”‚
â”‚   â”œâ”€ docs/                    å®˜æ–¹æ–‡æ¡£è½¯è¿æ¥ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â”œâ”€ modsdk-wiki/ â†’ [è½¯è¿æ¥åˆ°ä¸Šæ¸¸ docs/modsdk-wiki/]
â”‚   â”‚   â””â”€ bedrock-wiki/ â†’ [è½¯è¿æ¥åˆ°ä¸Šæ¸¸ docs/bedrock-wiki/]
â”‚   â”‚
â”‚   â””â”€ workflow-manifest.json   ç‰ˆæœ¬è¿½è¸ªæ–‡ä»¶ï¼ˆv17.0+ï¼‰
â”‚
â”œâ”€ ğŸ“ markdown/                 é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€ README.md                æ–‡æ¡£å¯¼èˆªï¼ˆä»æ¨¡æ¿ç”Ÿæˆï¼‰
â”‚   â”œâ”€ ç´¢å¼•.md                  å¿«é€Ÿç´¢å¼•ï¼ˆAIè‡ªåŠ¨ç»´æŠ¤ï¼‰
â”‚   â”œâ”€ é¡¹ç›®çŠ¶æ€.md              é¡¹ç›®çŠ¶æ€ï¼ˆAIè‡ªåŠ¨ç»´æŠ¤ï¼‰
â”‚   â”œâ”€ æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md        å¾…åŠæ¸…å•ï¼ˆAIè‡ªåŠ¨ç»´æŠ¤ï¼‰
â”‚   â”‚
â”‚   â”œâ”€ core/                    é¡¹ç›®è¦†ç›–å±‚ï¼ˆç”¨æˆ·å¯å®šåˆ¶ï¼‰
â”‚   â”‚   â””â”€ å¼€å‘è§„èŒƒ.md           é¡¹ç›®å®šåˆ¶ç‰ˆï¼ˆå¦‚å­˜åœ¨ï¼Œä¼˜å…ˆäºä¸Šæ¸¸åŸºçº¿ï¼‰
â”‚   â”‚
â”‚   â”œâ”€ systems/                 é¡¹ç›®Systemæ–‡æ¡£ï¼ˆAIç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€ ShopServerSystem.md   å•†åº—ç³»ç»Ÿå®ç°æ–‡æ¡£
â”‚   â”‚   â”œâ”€ PlayerDataSystem.md   ç©å®¶æ•°æ®ç³»ç»Ÿæ–‡æ¡£
â”‚   â”‚   â””â”€ ... (å…¶ä»–Systemæ–‡æ¡£)
â”‚   â”‚
â”‚   â””â”€ NEWRPG/                  ä¸šåŠ¡å±‚æ¡†æ¶ï¼ˆå¦‚æœæ˜¯RPGé¡¹ç›®ï¼‰
â”‚
â”œâ”€ ğŸ“ tasks/                    AIä»»åŠ¡ä¸Šä¸‹æ–‡ï¼ˆAIç®¡ç†ï¼‰
â”‚   â”œâ”€ task-001-ä¿®å¤å•†åº—BUG/
â”‚   â”‚   â”œâ”€ context.md            ä»»åŠ¡ä¸Šä¸‹æ–‡
â”‚   â”‚   â””â”€ solution.md           è§£å†³æ–¹æ¡ˆ
â”‚   â””â”€ task-002-å®ç°æ–°ç³»ç»Ÿ/
â”‚
â”œâ”€ ğŸ“ behavior_packs/           MODSDKä»£ç ï¼ˆç”¨æˆ·å¼€å‘ï¼‰
â”‚   â””â”€ YourModPack/
â”‚       â”œâ”€ modMain.py            Modå…¥å£
â”‚       â”œâ”€ systems/              Systemç›®å½•
â”‚       â””â”€ components/           Componentç›®å½•
â”‚
â””â”€ ğŸ“ logs/                     æ—¥å¿—ç›®å½•ï¼ˆå¯é€‰ï¼‰
```

**æ–‡ä»¶æ¥æºè¯´æ˜**:
- âœ… ä»æ¨¡æ¿ç”Ÿæˆ: `CLAUDE.md`, `.claude/commands/`, `markdown/README.md` ç­‰
- ğŸ”— è½¯è¿æ¥å¼•ç”¨: `.claude/core-docs/`, `.claude/docs/`
- ğŸ¤– AIè‡ªåŠ¨ç”Ÿæˆ: `markdown/systems/`, `tasks/`
- ğŸ‘¤ ç”¨æˆ·åˆ›å»º: `markdown/core/`, `behavior_packs/`

---

### 2.4 å…³é”®è·¯å¾„è¯´æ˜

#### é…ç½®è·¯å¾„ï¼ˆlib/config.jsï¼‰

```javascript
// lib/config.js:10-22
const GLOBAL_WORKFLOW_HOME = path.join(os.homedir(), '.claude-modsdk-workflow');
const LOCAL_WORKFLOW_HOME = path.resolve(__dirname, '..');

// æ™ºèƒ½é€‰æ‹©ï¼šä¼˜å…ˆä½¿ç”¨å…¨å±€ç›®å½•
const WORKFLOW_HOME = fs.existsSync(GLOBAL_WORKFLOW_HOME)
  ? GLOBAL_WORKFLOW_HOME
  : LOCAL_WORKFLOW_HOME;

const TEMPLATES_DIR = path.join(WORKFLOW_HOME, 'templates');
const RULES_LIBRARY_DIR = path.join(WORKFLOW_HOME, 'rules-library');
const DOC_TEMPLATES_DIR = path.join(WORKFLOW_HOME, 'doc-templates');
```

**è·¯å¾„ä¼˜å…ˆçº§**:
1. å…¨å±€ç›®å½•: `C:\Users\YourName\.claude-modsdk-workflow\` (Windows)
2. å…¨å±€ç›®å½•: `~/.claude-modsdk-workflow/` (Linux/Mac)
3. æœ¬åœ°å¼€å‘ç›®å½•: `D:\EcWork\åŸºäºClaudeçš„MODSDKå¼€å‘å·¥ä½œæµ\` (å¼€å‘æ—¶)

---

## ğŸ”¨ ç¬¬ä¸‰ç« ï¼šå¼€å‘è§„èŒƒ

> âš ï¸ **æå…¶é‡è¦**: æœ¬ç« èŠ‚åŒ…å«æ‰€æœ‰å¼€å‘æ—¶å¿…é¡»éµå®ˆçš„è§„èŒƒï¼Œè¿åè¿™äº›è§„èŒƒå¯èƒ½å¯¼è‡´ä¸¥é‡é—®é¢˜ã€‚è¯·ä¼˜å…ˆé˜…è¯»ï¼

### 3.1 èŒè´£è¾¹ç•Œè§„èŒƒï¼ˆv16.3é‡æ„åï¼‰

#### æ ¸å¿ƒåŸåˆ™

**`markdown/` æ˜¯å•ä¸€çœŸå®æºï¼Œ`templates/` åªåŒ…å«é¡¹ç›®ç‰¹å®šæ¨¡æ¿ã€‚**

| ç›®å½• | èŒè´£ | æ˜¯å¦éƒ¨ç½² | ç»´æŠ¤æ–¹å¼ | æ–‡ä»¶æ•°é‡ |
|------|------|---------|---------|---------|
| **markdown/** | å·¥ä½œæµçŸ¥è¯†åº“ï¼ˆå•ä¸€çœŸå®æºï¼‰ | âœ… é€šè¿‡è½¯è¿æ¥ | ç›´æ¥ç¼–è¾‘ | 80+ æ–‡ä»¶ |
| **templates/** | ä¸‹æ¸¸é¡¹ç›®æ¨¡æ¿ | âœ… ç”Ÿæˆåˆ°ä¸‹æ¸¸ | é€šè¿‡å ä½ç¬¦ | 12 æ–‡ä»¶ |

#### âœ… æ­£ç¡®åšæ³• vs âŒ é”™è¯¯åšæ³•

| âœ… æ­£ç¡® | âŒ é”™è¯¯ |
|--------|--------|
| åœ¨ [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/) ç»´æŠ¤å¼€å‘è§„èŒƒ | ~~åœ¨ templates/markdown/ ç»´æŠ¤å¼€å‘è§„èŒƒå‰¯æœ¬~~ |
| åœ¨ [templates/markdown/](templates/markdown/) ç»´æŠ¤é¡¹ç›®ç‰¹å®šæ¨¡æ¿ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰ | ~~åœ¨ templates/markdown/ ç»´æŠ¤æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£~~ |
| é€šè¿‡è½¯è¿æ¥éƒ¨ç½²æ ¸å¿ƒæ–‡æ¡£åˆ° `.claude/core-docs/` | ~~é€šè¿‡ `_generateFromTemplate()` ç”Ÿæˆæ ¸å¿ƒæ–‡æ¡£~~ |

#### v16.3é‡æ„å‰åå¯¹æ¯”

**é‡æ„å‰é—®é¢˜ï¼ˆv16.2åŠä¹‹å‰ï¼‰**:

```
templates/markdown/
â”œâ”€ å¼€å‘è§„èŒƒ.md.template (1157è¡Œ, v3.0)  â† âŒ ä¸ä¸Šæ¸¸é‡å¤ï¼Œç‰ˆæœ¬è¿‡æ—¶
â”œâ”€ é—®é¢˜æ’æŸ¥.md.template (39KB)          â† âŒ ä¸ä¸Šæ¸¸é‡å¤
â”œâ”€ å¿«é€Ÿå¼€å§‹.md.template (4.6KB)         â† âŒ ä¸ä¸Šæ¸¸é‡å¤
â””â”€ ai/                                  â† âŒ ä¸ä¸Šæ¸¸é‡å¤ï¼Œç¼ºå°‘æ–‡ä»¶

markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/
â”œâ”€ å¼€å‘è§„èŒƒ.md (1858è¡Œ, v3.1)           â† âœ… æœ€æ–°ç‰ˆæœ¬
â”œâ”€ é—®é¢˜æ’æŸ¥.md                          â† âœ… æœ€æ–°ç‰ˆæœ¬
â””â”€ å¿«é€Ÿå¼€å§‹.md                          â† âœ… æœ€æ–°ç‰ˆæœ¬
```

**é‡æ„åï¼ˆv16.3ï¼‰**:

```
templates/markdown/
â”œâ”€ README.md.template                   â† âœ… é¡¹ç›®ç‰¹å®šï¼ˆæ–‡æ¡£å¯¼èˆªï¼‰
â”œâ”€ ç´¢å¼•.md.template                     â† âœ… é¡¹ç›®ç‰¹å®šï¼ˆå¿«é€Ÿç´¢å¼•ï¼‰
â”œâ”€ é¡¹ç›®çŠ¶æ€.md.template                 â† âœ… é¡¹ç›®ç‰¹å®šï¼ˆé¡¹ç›®çŠ¶æ€ï¼‰
â””â”€ æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md.template           â† âœ… é¡¹ç›®ç‰¹å®šï¼ˆå¾…åŠæ¸…å•ï¼‰

markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/                 â† âœ… å•ä¸€çœŸå®æº
    â†’ é€šè¿‡è½¯è¿æ¥éƒ¨ç½²åˆ°ä¸‹æ¸¸ .claude/core-docs/
```

**é‡æ„æ”¶ç›Š**:
- âœ… æ¶ˆé™¤æ–‡æ¡£å†—ä½™ï¼ˆå‡å°‘75KB+é‡å¤æ–‡ä»¶ï¼‰
- âœ… ç‰ˆæœ¬ä¸€è‡´æ€§æå‡ï¼ˆåªç»´æŠ¤ä¸€ä»½æ–‡æ¡£ï¼‰
- âœ… é™ä½ç»´æŠ¤æˆæœ¬ï¼ˆä¸éœ€è¦åŒä»½æ–‡æ¡£åŒæ­¥ï¼‰
- âœ… æ˜ç¡®èŒè´£è¾¹ç•Œï¼ˆä¸€ç›®äº†ç„¶ï¼‰

---

### 3.2 å¹³æ»‘å‡çº§åŸåˆ™ï¼ˆæå…¶é‡è¦ï¼‰

> âš ï¸ **æ ¸å¿ƒåŸåˆ™**: ä»»ä½•éœ€æ±‚å¯¼è‡´çš„å¼€å‘å˜æ›´éƒ½å¿…é¡»ä¿è¯è€ç”¨æˆ·å¯ä»¥å¹³æ»‘å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å…ç ´åç°æœ‰å·¥ä½œæµã€‚

#### 3.2.1 å¼ºåˆ¶è¦æ±‚

##### 1. å‘åå…¼å®¹æ€§

- âœ… **å¿…é¡»**ç»´æŠ¤å‘åå…¼å®¹æ€§ï¼Œè‡³å°‘æ”¯æŒæœ€è¿‘2ä¸ªå¤§ç‰ˆæœ¬çš„å‡çº§è·¯å¾„
- âœ… **å¿…é¡»**é…ç½®æ–‡ä»¶æ ¼å¼å˜æ›´æ—¶æä¾›è‡ªåŠ¨è½¬æ¢é€»è¾‘
- âŒ **ç¦æ­¢**ç›´æ¥åˆ é™¤å·²æœ‰åŠŸèƒ½ï¼Œå¿…é¡»å…ˆæ ‡è®°ä¸º `deprecated`

**ç¤ºä¾‹**:

```javascript
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šä¿æŒå‘åå…¼å®¹
function loadConfig(projectPath) {
  const newConfigPath = path.join(projectPath, '.claude/workflow-manifest.json');
  const oldConfigPath = path.join(projectPath, '.claude/workflow-version.json');

  // ä¼˜å…ˆè¯»å–æ–°æ ¼å¼
  if (fs.existsSync(newConfigPath)) {
    return JSON.parse(fs.readFileSync(newConfigPath, 'utf8'));
  }

  // é™çº§è¯»å–æ—§æ ¼å¼å¹¶è‡ªåŠ¨è½¬æ¢
  if (fs.existsSync(oldConfigPath)) {
    const oldConfig = JSON.parse(fs.readFileSync(oldConfigPath, 'utf8'));
    console.log('âš ï¸ æ£€æµ‹åˆ°æ—§ç‰ˆé…ç½®æ–‡ä»¶ï¼Œæ­£åœ¨è‡ªåŠ¨è½¬æ¢...');
    const newConfig = migrateConfigV15toV16(oldConfig);

    // ä¿å­˜æ–°æ ¼å¼
    fs.writeFileSync(newConfigPath, JSON.stringify(newConfig, null, 2));
    console.log('âœ… é…ç½®æ–‡ä»¶å·²å‡çº§åˆ° v16 æ ¼å¼');

    return newConfig;
  }

  // å…¨æ–°é¡¹ç›®
  return createDefaultConfig();
}
```

```javascript
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šç›´æ¥åˆ é™¤æ—§åŠŸèƒ½
function loadConfig(projectPath) {
  const configPath = path.join(projectPath, '.claude/workflow-manifest.json');

  if (!fs.existsSync(configPath)) {
    throw new Error('é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼è¯·é‡æ–°è¿è¡Œ initmc');
    // âŒ è¿™ä¼šå¯¼è‡´è€ç”¨æˆ·å‡çº§åæ— æ³•ä½¿ç”¨
  }

  return JSON.parse(fs.readFileSync(configPath, 'utf8'));
}
```

---

##### 2. è‡ªåŠ¨è¿ç§»æœºåˆ¶

- âœ… **å¿…é¡»**ä¸å¾—å¼•å…¥ç ´åæ€§å˜æ›´ï¼Œé™¤éæä¾›è‡ªåŠ¨è¿ç§»è„šæœ¬
- âœ… **å¿…é¡»**è¿ç§»è„šæœ¬æ”¾åœ¨ `lib/migration-vX.X.js` ä¸­
- âœ… **å¿…é¡»**è¿ç§»è„šæœ¬æ”¯æŒ `--dry-run` å‚æ•°ï¼ˆé¢„è§ˆå˜æ›´ï¼‰
- âœ… **å¿…é¡»**è¿ç§»è¿‡ç¨‹å¯å›æ»šï¼Œä¿ç•™ç”¨æˆ·æ•°æ®å’Œé…ç½®

**è¿ç§»è„šæœ¬æ¨¡æ¿**:

```javascript
// lib/migration-v17.0.js æ¨¡æ¿
/**
 * ä» v16.x è¿ç§»åˆ° v17.0
 * @param {string} projectPath - é¡¹ç›®æ ¹ç›®å½•
 * @param {object} options - { dryRun: boolean }
 * @returns {object} { success: boolean, changes: [], errors: [] }
 */
async function migrateFromV16_to_V17(projectPath, options = {}) {
  const changes = [];
  const errors = [];

  // 1. æ£€æµ‹æ—§ç‰ˆæœ¬ç‰¹å¾
  const oldConfigPath = path.join(projectPath, '.claude/old-config.json');
  if (!fs.existsSync(oldConfigPath)) {
    return { success: true, changes: [], errors: [] }; // ä¸éœ€è¦è¿ç§»
  }

  console.log('ğŸ”„ æ£€æµ‹åˆ° v16.x ç‰ˆæœ¬ï¼Œå¼€å§‹è¿ç§»åˆ° v17.0...');

  // 2. å¤‡ä»½å…³é”®æ–‡ä»¶
  if (!options.dryRun) {
    await backupFiles(projectPath, ['CLAUDE.md', '.claude/']);
    changes.push('âœ… å·²å¤‡ä»½å…³é”®æ–‡ä»¶');
  } else {
    changes.push('ä¼šå¤‡ä»½å…³é”®æ–‡ä»¶: CLAUDE.md, .claude/');
  }

  // 3. æ‰§è¡Œè¿ç§»é€»è¾‘
  try {
    // ç¤ºä¾‹: è½¬æ¢é…ç½®æ–‡ä»¶æ ¼å¼
    const oldConfig = JSON.parse(fs.readFileSync(oldConfigPath, 'utf8'));
    const newConfig = {
      version: 'v17.0',
      workflowVersion: oldConfig.workflow_version,
      deployedAt: oldConfig.created_at,
      // ... è½¬æ¢é€»è¾‘
    };

    if (options.dryRun) {
      changes.push('ä¼šè½¬æ¢é…ç½®æ–‡ä»¶æ ¼å¼: old-config.json â†’ workflow-manifest.json');
      changes.push(`  - version: ${oldConfig.workflow_version} â†’ v17.0`);
    } else {
      fs.writeFileSync(
        path.join(projectPath, '.claude/workflow-manifest.json'),
        JSON.stringify(newConfig, null, 2)
      );
      changes.push('âœ… å·²è½¬æ¢é…ç½®æ–‡ä»¶æ ¼å¼');
    }

    // 4. è¿ç§»ç”¨æˆ·å®šåˆ¶æ–‡ä»¶
    const userCustomFiles = ['markdown/core/å¼€å‘è§„èŒƒ.md'];
    for (const file of userCustomFiles) {
      const filePath = path.join(projectPath, file);
      if (fs.existsSync(filePath)) {
        if (options.dryRun) {
          changes.push(`ä¼šä¿ç•™ç”¨æˆ·å®šåˆ¶æ–‡ä»¶: ${file}`);
        } else {
          changes.push(`âœ… å·²ä¿ç•™ç”¨æˆ·å®šåˆ¶æ–‡ä»¶: ${file}`);
        }
      }
    }

  } catch (error) {
    errors.push(`è¿ç§»å¤±è´¥: ${error.message}`);
    return { success: false, changes, errors };
  }

  // 5. è¾“å‡ºè¿ç§»æŠ¥å‘Š
  console.log('ğŸ“Š è¿ç§»å®Œæˆï¼Œå˜æ›´æ¸…å•:');
  changes.forEach(c => console.log(`  - ${c}`));

  if (errors.length > 0) {
    console.log('âš ï¸ è¿ç§»è­¦å‘Š:');
    errors.forEach(e => console.log(`  - ${e}`));
  }

  return { success: true, changes, errors };
}

module.exports = { migrateFromV16_to_V17 };
```

**è°ƒç”¨è¿ç§»è„šæœ¬**:

```javascript
// bin/initmc.js ä¸­è°ƒç”¨
const { migrateFromV16_to_V17 } = require('../lib/migration-v17.0');

async function checkAndMigrate(projectPath) {
  const currentVersion = detectProjectVersion(projectPath);

  if (currentVersion === 'v16.x') {
    console.log('ğŸ”„ æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬ï¼Œå¼€å§‹è¿ç§»...');

    // é¢„è§ˆå˜æ›´
    const dryRunResult = await migrateFromV16_to_V17(projectPath, { dryRun: true });
    console.log('ğŸ“‹ é¢„è®¡å˜æ›´:');
    dryRunResult.changes.forEach(c => console.log(`  - ${c}`));

    // æ‰§è¡Œè¿ç§»
    const result = await migrateFromV16_to_V17(projectPath, { dryRun: false });

    if (result.success) {
      console.log('âœ… è¿ç§»æˆåŠŸï¼');
    } else {
      console.log('âŒ è¿ç§»å¤±è´¥ï¼Œè¯·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯');
      process.exit(1);
    }
  }
}
```

---

##### 3. åºŸå¼ƒåŠŸèƒ½å¤„ç†

- âœ… **å¿…é¡»**åºŸå¼ƒåŠŸèƒ½å…ˆæ ‡è®°ä¸º `deprecated`ï¼Œä¿ç•™è‡³å°‘1ä¸ªå¤§ç‰ˆæœ¬å‘¨æœŸ
- âœ… **å¿…é¡»**åœ¨æ§åˆ¶å°è¾“å‡ºæ¸…æ™°çš„åºŸå¼ƒè­¦å‘Šï¼Œæä¾›æ›¿ä»£æ–¹æ¡ˆ
- âœ… **å¿…é¡»**åœ¨ CHANGELOG.md ä¸­æ˜ç¡®æ ‡æ³¨åºŸå¼ƒè®¡åˆ’

**ç¤ºä¾‹**:

```javascript
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šåºŸå¼ƒåŠŸèƒ½å¤„ç†
function oldFunction() {
  console.log('âš ï¸ è­¦å‘Š: oldFunction() å·²åºŸå¼ƒï¼Œå°†åœ¨ v18.0 ä¸­ç§»é™¤');
  console.log('ğŸ’¡ è¯·æ”¹ç”¨ newFunction()ï¼Œè¯¦è§æ–‡æ¡£: https://...');

  // ä»ç„¶ä¿æŒåŠŸèƒ½å¯ç”¨
  return legacyImplementation();
}

// æ¨èä½¿ç”¨çš„æ–°å‡½æ•°
function newFunction() {
  return newImplementation();
}
```

**CHANGELOG.md è®°å½•**:

```markdown
## v17.0.0 (2025-11-12)

### âš ï¸ DEPRECATEDï¼ˆåºŸå¼ƒåŠŸèƒ½ï¼‰

- `oldFunction()` å·²æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå°†åœ¨ v18.0 ä¸­ç§»é™¤
  - **æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨ `newFunction()`
  - **è¿ç§»æŒ‡å—**: [è¯¦è§æ–‡æ¡£](https://...)
  - **ä¿ç•™å‘¨æœŸ**: è‡³ v18.0ï¼ˆé¢„è®¡2026å¹´Q1ï¼‰
```

---

##### 4. ç ´åæ€§å˜æ›´ç®¡ç†

- âœ… **å¿…é¡»**æ‰€æœ‰ç ´åæ€§å˜æ›´åœ¨ CHANGELOG.md ä¸­ä½¿ç”¨ `âš ï¸ BREAKING CHANGE` æ ‡æ³¨
- âœ… **å¿…é¡»**æä¾›è¯¦ç»†çš„è¿ç§»æŒ‡å—ï¼ˆåŒ…å«ä»£ç ç¤ºä¾‹ï¼‰
- âœ… **å¿…é¡»**åœ¨ä¸‹ä¸€ä¸ªå¤§ç‰ˆæœ¬å‘å¸ƒå‰è‡³å°‘1ä¸ªæœˆå‘å¸ƒ RC ç‰ˆæœ¬

**CHANGELOG.md æ ¼å¼**:

```markdown
## v17.0.0 (2025-11-12)

### âš ï¸ BREAKING CHANGESï¼ˆç ´åæ€§å˜æ›´ï¼‰

#### 1. é…ç½®æ–‡ä»¶æ ¼å¼å˜æ›´

**å˜æ›´å†…å®¹**:
- é…ç½®æ–‡ä»¶ä» `.claude/workflow-version.json` è¿ç§»åˆ° `.claude/workflow-manifest.json`
- å­—æ®µåç§°ä» `workflow_version` æ”¹ä¸º `workflowVersion`ï¼ˆé©¼å³°å‘½åï¼‰

**å½±å“èŒƒå›´**:
- æ‰€æœ‰ä½¿ç”¨ v16.x çš„é¡¹ç›®
- éœ€è¦è‡ªåŠ¨è¿ç§»é…ç½®æ–‡ä»¶

**è¿ç§»æ–¹æ¡ˆ**:
1. è‡ªåŠ¨è¿ç§»: è¿è¡Œ `initmc` ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è½¬æ¢
2. æ‰‹åŠ¨è¿ç§»: å‚è€ƒè¿ç§»è„šæœ¬ [lib/migration-v17.0.js](lib/migration-v17.0.js)

**ä»£ç ç¤ºä¾‹**:

\`\`\`json
// æ—§æ ¼å¼ (.claude/workflow-version.json)
{
  "workflow_version": "v16.3.0",
  "created_at": "2025-11-10"
}

// æ–°æ ¼å¼ (.claude/workflow-manifest.json)
{
  "version": "v17.0.0",
  "workflowVersion": "v17.0.0",
  "deployedAt": "2025-11-12"
}
\`\`\`

---

#### 2. å‘½ä»¤ç³»ç»Ÿé‡æ„

**å˜æ›´å†…å®¹**:
- åŸæœ‰12ä¸ªç‹¬ç«‹å‘½ä»¤æ•´åˆä¸º6ä¸ªç»Ÿä¸€å‘½ä»¤ï¼ˆ/mc å‰ç¼€ï¼‰
- åºŸå¼ƒçš„å‘½ä»¤ä»å¯ç”¨ï¼Œä½†ä¼šè¾“å‡ºè­¦å‘Š

**å½±å“èŒƒå›´**:
- ä½¿ç”¨æ—§å‘½ä»¤çš„ç”¨æˆ·ï¼ˆå¦‚ /cc, /perfï¼‰

**è¿ç§»æ–¹æ¡ˆ**:
- æ—§å‘½ä»¤åœ¨ v17.x ä»å¯ç”¨ï¼ˆè¾“å‡ºè­¦å‘Šï¼‰
- æ¨èè¿ç§»åˆ°æ–°å‘½ä»¤ï¼ˆ/mc, /mc-perf ç­‰ï¼‰
- æ—§å‘½ä»¤å°†åœ¨ v18.0 ä¸­ç§»é™¤

**å‘½ä»¤æ˜ å°„è¡¨**:

| æ—§å‘½ä»¤ | æ–°å‘½ä»¤ | çŠ¶æ€ |
|-------|-------|------|
| /cc | /mc | âš ï¸ åºŸå¼ƒ |
| /perf | /mc-perf | âš ï¸ åºŸå¼ƒ |
| /doc | /mc-docs | âš ï¸ åºŸå¼ƒ |
```

---

#### 3.2.2 æµ‹è¯•è¦æ±‚

åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬å‰ï¼Œ**å¿…é¡»**æµ‹è¯•ä»¥ä¸‹å‡çº§è·¯å¾„ï¼š

| æµ‹è¯•åœºæ™¯ | æµ‹è¯•ç›®æ ‡ | éªŒæ”¶æ ‡å‡† |
|---------|---------|---------|
| **å…¨æ–°å®‰è£…** | åœ¨ç©ºé¡¹ç›®æ‰§è¡Œ `initmc` | âœ… æˆåŠŸç”Ÿæˆæ‰€æœ‰æ–‡ä»¶ |
| **v15.x â†’ å½“å‰ç‰ˆæœ¬** | æ¨¡æ‹Ÿè€ç”¨æˆ·å‡çº§ | âœ… è‡ªåŠ¨è¿ç§»é…ç½®ï¼Œä¿ç•™ç”¨æˆ·å®šåˆ¶ |
| **v16.x â†’ å½“å‰ç‰ˆæœ¬** | æ¨¡æ‹Ÿæœ€è¿‘ç‰ˆæœ¬å‡çº§ | âœ… è‡ªåŠ¨è¿ç§»é…ç½®ï¼Œä¿ç•™ç”¨æˆ·å®šåˆ¶ |
| **å·²æœ‰å®šåˆ¶é¡¹ç›®å‡çº§** | éªŒè¯ç”¨æˆ·å®šåˆ¶æ–‡ä»¶ä¸è¢«è¦†ç›– | âœ… `markdown/core/` æ–‡ä»¶å®Œæ•´ä¿ç•™ |
| **è¿ç§»è„šæœ¬ --dry-run** | é¢„è§ˆå˜æ›´ä¸ä¿®æ”¹æ–‡ä»¶ | âœ… è¾“å‡ºå˜æ›´æ¸…å•ï¼Œæ–‡ä»¶æœªä¿®æ”¹ |
| **è¿ç§»å¤±è´¥å›æ»š** | æ¨¡æ‹Ÿè¿ç§»å¤±è´¥åœºæ™¯ | âœ… å¤‡ä»½æ–‡ä»¶å¯æ¢å¤ |

**æµ‹è¯•å‘½ä»¤**:

```bash
# 1. æµ‹è¯•å…¨æ–°å®‰è£…
cd /path/to/new-project
initmc

# 2. æµ‹è¯•v16.xå‡çº§
cd /path/to/v16-project
initmc --sync  # æˆ– initmcï¼ˆè‡ªåŠ¨æ£€æµ‹å‡çº§ï¼‰

# 3. æµ‹è¯•è¿ç§»é¢„è§ˆ
cd /path/to/old-project
node bin/migration-test.js --dry-run

# 4. æµ‹è¯•è¿ç§»å›æ»š
cd /path/to/test-project
# ä¿®æ”¹ .claude/workflow-manifest.json ä¸ºæ—§ç‰ˆæœ¬
# è¿è¡Œ initmcï¼Œåº”è‡ªåŠ¨è¿ç§»
# åˆ é™¤ .claude/workflow-manifest.json
# ä»å¤‡ä»½æ¢å¤ï¼Œåº”å›åˆ°æ—§ç‰ˆæœ¬
```

---

#### 3.2.3 CHANGELOG.md è§„èŒƒ

æ¯ä¸ªç‰ˆæœ¬å‘å¸ƒ**å¿…é¡»**åœ¨ CHANGELOG.md ä¸­è®°å½•ï¼š

**æ ‡å‡†æ ¼å¼**:

```markdown
## vX.X.X (YYYY-MM-DD)

### âœ¨ æ–°åŠŸèƒ½ï¼ˆNew Featuresï¼‰
- åŠŸèƒ½1æè¿°
- åŠŸèƒ½2æè¿°

### âš ï¸ BREAKING CHANGESï¼ˆç ´åæ€§å˜æ›´ï¼‰
ï¼ˆå¦‚æœæ²¡æœ‰ç ´åæ€§å˜æ›´ï¼Œæ ‡æ³¨"æ— ç ´åæ€§å˜æ›´"ï¼‰

- **å˜æ›´1**: è¯¦ç»†æè¿°
  - **å½±å“èŒƒå›´**: ...
  - **è¿ç§»æ–¹æ¡ˆ**: ...
  - **ä»£ç ç¤ºä¾‹**: ...

### ğŸ”§ æ”¹è¿›ï¼ˆImprovementsï¼‰
- æ”¹è¿›1æè¿°
- æ”¹è¿›2æè¿°

### ğŸ› ä¿®å¤ï¼ˆBug Fixesï¼‰
- ä¿®å¤1æè¿°
- ä¿®å¤2æè¿°

### âš ï¸ DEPRECATEDï¼ˆåºŸå¼ƒåŠŸèƒ½ï¼‰
ï¼ˆå¦‚æœæ²¡æœ‰åºŸå¼ƒåŠŸèƒ½ï¼Œçœç•¥æ­¤èŠ‚ï¼‰

- `oldFunction()` å·²æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå°†åœ¨ vX.X ä¸­ç§»é™¤
  - **æ›¿ä»£æ–¹æ¡ˆ**: ...
  - **ä¿ç•™å‘¨æœŸ**: è‡³ vX.X

### ğŸ“¦ è¿ç§»æŒ‡å—ï¼ˆMigration Guideï¼‰
- ä» vOLD.X å‡çº§: æ‰§è¡Œæ­¥éª¤...
- ä» vPREVIOUS.X å‡çº§: æ‰§è¡Œæ­¥éª¤...
- å»ºè®®å‡çº§è·¯å¾„: ...

### ğŸ“ å…¶ä»–å˜æ›´ï¼ˆOther Changesï¼‰
- æ–‡æ¡£æ›´æ–°
- ä¾èµ–å‡çº§
```

**å®Œæ•´ç¤ºä¾‹ï¼ˆv17.1.0ï¼‰**:

```markdown
## v17.1.0 (2025-11-12)

### âœ¨ æ–°åŠŸèƒ½
- æ–°å¢æ–¹æ¡ˆè‡ªæ£€ä¸ä¸“å®¶å®¡æ ¸æµç¨‹
- 6ä¸ªç»Ÿä¸€Claudeå‘½ä»¤ä½“ç³»ï¼ˆ/mc å‰ç¼€ï¼‰
- å¼ºåŒ–æ­¥éª¤2å¼ºåˆ¶æ–‡æ¡£æŸ¥é˜…æœºåˆ¶

### âš ï¸ BREAKING CHANGES
ï¼ˆæ— ç ´åæ€§å˜æ›´ï¼‰

### ğŸ”§ æ”¹è¿›
- ä¼˜åŒ–è½¯è¿æ¥é™çº§ç­–ç•¥
- æå‡æ–‡æ¡£è´¨é‡è¯„ä¼°å‡†ç¡®æ€§ï¼ˆ0-5åˆ†åˆ¶ï¼‰
- å®Œå–„Windowsè·¨å¹³å°æ”¯æŒ

### ğŸ› ä¿®å¤
- ä¿®å¤Windowsä¸‹æƒé™é—®é¢˜å¯¼è‡´çš„è½¯è¿æ¥åˆ›å»ºå¤±è´¥
- ä¿®å¤initmcæ—¶aiæ–‡æ¡£éƒ¨ç½²å¤±è´¥çš„BUG

### ğŸ“¦ è¿ç§»æŒ‡å—
- **ä» v17.0 å‡çº§**: æ‰§è¡Œ `initmc --sync` è‡ªåŠ¨å‡çº§
- **ä» v16.x å‡çº§**: æ‰§è¡Œ `initmc --sync`ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œè¿ç§»è„šæœ¬
- **ä» v15.x å‡çº§**: å»ºè®®å…ˆå‡çº§åˆ° v16.3ï¼Œå†å‡çº§åˆ° v17.1

### ğŸ“ å…¶ä»–å˜æ›´
- æ›´æ–° CLAUDE.md å·¥ä½œæµå¼€å‘æŒ‡å—
- æ¸…ç† templates/ å†—ä½™æ–‡æ¡£ï¼ˆv16.3é‡æ„ï¼‰
```

---

### 3.3 æ¨¡æ¿å˜é‡ç³»ç»Ÿè§„èŒƒ

#### æ·»åŠ æ–°å ä½ç¬¦çš„å®Œæ•´æ­¥éª¤

**æ­¥éª¤1**: åœ¨ [lib/config.js:66-81](lib/config.js#L66-L81) çš„ `PLACEHOLDERS` ä¸­å®šä¹‰å ä½ç¬¦ã€‚

```javascript
// lib/config.js
const PLACEHOLDERS = {
  PROJECT_PATH: '{{PROJECT_PATH}}',
  PROJECT_NAME: '{{PROJECT_NAME}}',
  NEW_VAR: '{{NEW_VAR}}',  // â† æ·»åŠ æ–°å ä½ç¬¦
  // ... å…¶ä»–å ä½ç¬¦
};
```

**æ­¥éª¤2**: åœ¨ [lib/generator.js](lib/generator.js) çš„ `_buildReplacements()` æ–¹æ³•ä¸­è®¡ç®—å ä½ç¬¦çš„å€¼ã€‚

```javascript
// lib/generator.js
_buildReplacements(targetPath) {
  const projectName = path.basename(targetPath);

  return {
    '{{PROJECT_PATH}}': targetPath,
    '{{PROJECT_NAME}}': projectName,
    '{{NEW_VAR}}': this._computeNewVar(targetPath),  // â† è®¡ç®—æ–°å˜é‡
    // ... å…¶ä»–å˜é‡
  };
}

_computeNewVar(targetPath) {
  // å®ç°è®¡ç®—é€»è¾‘
  return 'computed value';
}
```

**æ­¥éª¤3**: åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­ä½¿ç”¨å ä½ç¬¦ã€‚

```markdown
<!-- templates/CLAUDE.md.template -->
# {{PROJECT_NAME}}

é¡¹ç›®è·¯å¾„: {{PROJECT_PATH}}
æ–°å˜é‡: {{NEW_VAR}}
```

**æ­¥éª¤4**: éªŒè¯å ä½ç¬¦æ›¿æ¢ã€‚

```bash
# æµ‹è¯•åˆå§‹åŒ–
cd /path/to/test-project
initmc

# æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
cat CLAUDE.md | grep "æ–°å˜é‡"
```

#### å ä½ç¬¦å‘½åè§„èŒƒ

| è§„èŒƒ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| **å…¨å¤§å†™** | `{{PROJECT_PATH}}` | âœ… æ¨è |
| **ä¸‹åˆ’çº¿åˆ†éš”** | `{{PROJECT_NAME}}` | âœ… æ¨è |
| **è¯­ä¹‰åŒ–** | `{{CURRENT_DATE}}` | âœ… åç§°åº”æ¸…æ™°è¡¨è¾¾å«ä¹‰ |
| âŒ é©¼å³°å‘½å | `{{projectPath}}` | âŒ ä¸æ¨è |
| âŒ çŸ­åç§° | `{{PATH}}` | âŒ è¿‡äºæ¨¡ç³Š |

---

### 3.4 è½¯è¿æ¥ç®¡ç†è§„èŒƒ

#### æ·»åŠ æ–°çš„æ ¸å¿ƒæ–‡æ¡£ç›®å½•

ç¼–è¾‘ [lib/symlink-manager.js](lib/symlink-manager.js) çš„ `_getCoreFiles()` æ–¹æ³•ã€‚

**æ·»åŠ åŒ…å«æ¨¡å¼**:

```javascript
// lib/symlink-manager.js
_getCoreFiles() {
  const includePatterns = [
    'æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/**/*.md',
    'æ¦‚å¿µå‚è€ƒ/**/*.md',
    'æ·±åº¦æŒ‡å—/**/*.md',
    'ai/**/*.md',
    'æ–°ç›®å½•/**/*.md',  // â† æ·»åŠ æ–°æ¨¡å¼
    'å¯é€‰å·¥å…·è¯´æ˜.md'
  ];

  // ...
}
```

**æ’é™¤ç‰¹å®šæ–‡æ¡£**:

```javascript
// lib/symlink-manager.js
_getCoreFiles() {
  // ...

  const excludePatterns = [
    '**/ç´¢å¼•.md',
    '**/é¡¹ç›®çŠ¶æ€.md',
    'æ–°ç›®å½•/ç‰¹å®šæ–‡ä»¶.md',  // â† æ·»åŠ æ’é™¤æ¨¡å¼
    'systems/**',
    'core/**',
    'README.md'
  ];

  // ...
}
```

**éªŒè¯è½¯è¿æ¥**:

```bash
# æµ‹è¯•è½¯è¿æ¥åˆ›å»º
cd /path/to/test-project
initmc

# æ£€æŸ¥è½¯è¿æ¥æ˜¯å¦å­˜åœ¨
ls -la .claude/core-docs/æ–°ç›®å½•/

# Windows æ£€æŸ¥
dir /AL .claude\core-docs\æ–°ç›®å½•\
```

---

### 3.5 ç‰ˆæœ¬å‘å¸ƒæ£€æŸ¥æ¸…å•

åœ¨å‘å¸ƒæ–°ç‰ˆæœ¬å‰ï¼Œ**å¿…é¡»**å®Œæˆä»¥ä¸‹æ‰€æœ‰æ£€æŸ¥é¡¹ï¼š

#### ä»£ç å’Œé…ç½®æ›´æ–°

- [ ] æ›´æ–° [lib/config.js:29](lib/config.js#L29) çš„ `VERSION`
- [ ] æ›´æ–° [package.json:3](package.json#L3) çš„ `version`
- [ ] æ›´æ–°æœ¬æ–‡æ¡£ï¼ˆCLAUDE.mdï¼‰çš„ç‰ˆæœ¬å·å’Œæ›´æ–°è¯´æ˜
- [ ] æ›´æ–° [templates/CLAUDE.md.template](templates/CLAUDE.md.template) çš„ç‰ˆæœ¬å·

#### CHANGELOG å’Œæ–‡æ¡£

- [ ] ç¼–å†™ CHANGELOG.md çš„ç‰ˆæœ¬è®°å½•ï¼ˆä½¿ç”¨æ ‡å‡†æ ¼å¼ï¼‰
- [ ] å¦‚æœ‰ç ´åæ€§å˜æ›´ï¼Œæ ‡æ³¨ `âš ï¸ BREAKING CHANGE` å¹¶æä¾›è¿ç§»æŒ‡å—
- [ ] å¦‚æœ‰åºŸå¼ƒåŠŸèƒ½ï¼Œæ ‡æ³¨ `âš ï¸ DEPRECATED` å¹¶æä¾›æ›¿ä»£æ–¹æ¡ˆ

#### æµ‹è¯•

- [ ] æµ‹è¯•å…¨æ–°å®‰è£…æµç¨‹ï¼ˆç©ºé¡¹ç›®æ‰§è¡Œ `initmc`ï¼‰
- [ ] æµ‹è¯• v15.x â†’ å½“å‰ç‰ˆæœ¬å‡çº§ï¼ˆè‡ªåŠ¨è¿ç§»é…ç½®ï¼‰
- [ ] æµ‹è¯• v16.x â†’ å½“å‰ç‰ˆæœ¬å‡çº§ï¼ˆè‡ªåŠ¨è¿ç§»é…ç½®ï¼‰
- [ ] æµ‹è¯•å·²æœ‰å®šåˆ¶é¡¹ç›®å‡çº§ï¼ˆ`markdown/core/` æ–‡ä»¶ä¸è¢«è¦†ç›–ï¼‰
- [ ] è¿è¡Œ `npm run install-global` æµ‹è¯•å…¨å±€å®‰è£…
- [ ] æ£€æŸ¥è½¯è¿æ¥æ˜¯å¦æ­£ç¡®åˆ›å»ºï¼ˆWindows/Linuxï¼‰
- [ ] æ£€æŸ¥æ–‡æ¡£å¼•ç”¨è·¯å¾„æ˜¯å¦æ­£ç¡®
- [ ] æ£€æŸ¥æ‰€æœ‰è¿ç§»è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ˆ--dry-run æ¨¡å¼ï¼‰

#### Git å’Œå‘å¸ƒ

- [ ] æäº¤ Git commitï¼ˆæ ¼å¼: `feat(vX.X): ç‰ˆæœ¬æè¿°`ï¼‰
- [ ] æ‰“ tagï¼ˆæ ¼å¼: `vX.X.X`ï¼‰
- [ ] æ¨é€åˆ° GitHubï¼ˆ`git push && git push --tags`ï¼‰

---

### 3.6 ä»£ç è´¨é‡è§„èŒƒ

#### é”™è¯¯å¤„ç†è§„èŒƒ

**å¿…é¡»æ•è·çš„é”™è¯¯**:

```javascript
// âœ… æ­£ç¡®ç¤ºä¾‹ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†
async function createSymlink(source, target) {
  try {
    await fs.symlink(source, target, 'junction');
    console.log(`âœ… è½¯è¿æ¥åˆ›å»ºæˆåŠŸ: ${target}`);
    return { success: true, method: 'symlink' };
  } catch (err) {
    if (err.code === 'EPERM') {
      console.log(`âš ï¸ æƒé™ä¸è¶³ï¼Œé™çº§ä¸ºåªè¯»å‰¯æœ¬: ${target}`);
      return await createReadonlyCopy(source, target);
    } else if (err.code === 'EEXIST') {
      console.log(`â„¹ï¸ ç›®æ ‡å·²å­˜åœ¨ï¼Œè·³è¿‡: ${target}`);
      return { success: true, method: 'existing' };
    } else {
      console.error(`âŒ åˆ›å»ºå¤±è´¥: ${target}`, err.message);
      return { success: false, error: err.message };
    }
  }
}
```

**ç¦æ­¢çš„é”™è¯¯å¤„ç†**:

```javascript
// âŒ é”™è¯¯ç¤ºä¾‹ï¼šåæ²¡é”™è¯¯
async function createSymlink(source, target) {
  try {
    await fs.symlink(source, target, 'junction');
  } catch (err) {
    // âŒ ä¸è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œç”¨æˆ·æ— æ³•æ’æŸ¥é—®é¢˜
  }
}

// âŒ é”™è¯¯ç¤ºä¾‹ï¼šç›´æ¥æŠ›å‡ºé”™è¯¯
async function createSymlink(source, target) {
  await fs.symlink(source, target, 'junction');
  // âŒ æœªæ•è·é”™è¯¯ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ
}
```

#### æ—¥å¿—è¾“å‡ºè§„èŒƒ

**æ—¥å¿—çº§åˆ«**:

| çº§åˆ« | emoji | ä½¿ç”¨åœºæ™¯ | ç¤ºä¾‹ |
|-----|-------|---------|------|
| âœ… æˆåŠŸ | `âœ…` | æ“ä½œæˆåŠŸ | `console.log('âœ… è½¯è¿æ¥åˆ›å»ºæˆåŠŸ')` |
| âš ï¸ è­¦å‘Š | `âš ï¸` | é™çº§æ“ä½œã€åºŸå¼ƒè­¦å‘Š | `console.log('âš ï¸ æƒé™ä¸è¶³ï¼Œé™çº§ä¸ºåªè¯»å‰¯æœ¬')` |
| âŒ é”™è¯¯ | `âŒ` | æ“ä½œå¤±è´¥ | `console.error('âŒ åˆ›å»ºå¤±è´¥:', err)` |
| â„¹ï¸ ä¿¡æ¯ | `â„¹ï¸` | æ™®é€šä¿¡æ¯ | `console.log('â„¹ï¸ æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬é…ç½®')` |
| ğŸ”„ è¿›åº¦ | `ğŸ”„` | é•¿æ—¶é—´æ“ä½œ | `console.log('ğŸ”„ æ­£åœ¨ä¸‹è½½å®˜æ–¹æ–‡æ¡£...')` |

**æ—¥å¿—æ ¼å¼è§„èŒƒ**:

```javascript
// âœ… æ¨èæ ¼å¼
console.log(`âœ… [ç”Ÿæˆå™¨] æˆåŠŸç”Ÿæˆæ–‡ä»¶: ${filePath}`);
console.log(`âš ï¸ [è¿ç§»å™¨] æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬é…ç½®ï¼Œå°†è‡ªåŠ¨è½¬æ¢`);
console.error(`âŒ [è½¯è¿æ¥] åˆ›å»ºå¤±è´¥: ${target} - ${err.message}`);

// âŒ ä¸æ¨èæ ¼å¼
console.log('success');  // âŒ ä¿¡æ¯ä¸æ¸…æ™°
console.log(filePath);   // âŒ æ²¡æœ‰ä¸Šä¸‹æ–‡
console.log(err);        // âŒ ç›´æ¥è¾“å‡ºå¯¹è±¡
```

#### æµ‹è¯•è¦†ç›–è¦æ±‚

**æ ¸å¿ƒæ¨¡å—å¿…é¡»æœ‰æµ‹è¯•**:

| æ¨¡å— | æµ‹è¯•æ–‡ä»¶ | æœ€ä½è¦†ç›–ç‡ |
|------|---------|-----------|
| [lib/generator.js](lib/generator.js) | `tests/generator.test.js` | 80% |
| [lib/symlink-manager.js](lib/symlink-manager.js) | `tests/symlink-manager.test.js` | 80% |
| [lib/project-analyzer.js](lib/project-analyzer.js) | `tests/project-analyzer.test.js` | 70% |
| [lib/config.js](lib/config.js) | `tests/config.test.js` | 90% |

**æµ‹è¯•ç±»å‹**:

```javascript
// å•å…ƒæµ‹è¯•ç¤ºä¾‹
describe('Generator', () => {
  describe('_buildReplacements', () => {
    it('åº”æ­£ç¡®æ›¿æ¢PROJECT_PATH', () => {
      const generator = new Generator();
      const replacements = generator._buildReplacements('/path/to/project');
      expect(replacements['{{PROJECT_PATH}}']).toBe('/path/to/project');
    });
  });
});

// é›†æˆæµ‹è¯•ç¤ºä¾‹
describe('initmc', () => {
  it('åº”æˆåŠŸåˆå§‹åŒ–æ–°é¡¹ç›®', async () => {
    const testProject = '/tmp/test-project';
    await initmc(testProject);

    expect(fs.existsSync(path.join(testProject, 'CLAUDE.md'))).toBe(true);
    expect(fs.existsSync(path.join(testProject, '.claude/commands'))).toBe(true);
  });
});
```

---

## ğŸ”‘ ç¬¬å››ç« ï¼šæ ¸å¿ƒæœºåˆ¶è¯¦è§£

### 4.1 åŒå±‚æ–‡æ¡£æ¶æ„ï¼ˆv16.0æ ¸å¿ƒè®¾è®¡ï¼‰

#### 4.1.1 è®¾è®¡ç›®æ ‡ä¸æ™ºèƒ½æŸ¥é˜…ç­–ç•¥

**è®¾è®¡ç›®æ ‡**: å…è®¸ä¸Šæ¸¸å·¥ä½œæµå‡çº§ï¼ŒåŒæ—¶ä¿æŠ¤ä¸‹æ¸¸é¡¹ç›®å®šåˆ¶ã€‚

**æ ¸å¿ƒç†å¿µ**:
- **ä¸Šæ¸¸åŸºçº¿å±‚**: å·¥ä½œæµæ ¸å¿ƒæ–‡æ¡£ï¼ˆ[markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/)ï¼‰é€šè¿‡è½¯è¿æ¥éƒ¨ç½²åˆ° `.claude/core-docs/`
- **é¡¹ç›®è¦†ç›–å±‚**: ç”¨æˆ·å¯åœ¨ `markdown/core/` åˆ›å»ºåŒåæ–‡æ¡£è¦†ç›–ä¸Šæ¸¸åŸºçº¿
- **æ™ºèƒ½é™çº§**: AIæŸ¥é˜…æ–‡æ¡£æ—¶è‡ªåŠ¨é€‰æ‹©ï¼šé¡¹ç›®å®šåˆ¶ç‰ˆï¼ˆå¦‚å­˜åœ¨ï¼‰ â†’ ä¸Šæ¸¸åŸºçº¿ç‰ˆ

**æ™ºèƒ½æŸ¥é˜…ç­–ç•¥æµç¨‹å›¾**:

```mermaid
graph TD
    Start[AIéœ€è¦æŸ¥é˜…å¼€å‘è§„èŒƒ.md] --> Check1{markdown/core/å¼€å‘è§„èŒƒ.md å­˜åœ¨?}
    Check1 -->|æ˜¯| Read1[è¯»å–é¡¹ç›®å®šåˆ¶ç‰ˆæœ¬<br/>ä¼˜å…ˆçº§æœ€é«˜]
    Check1 -->|å¦| Check2{.claude/core-docs/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md å­˜åœ¨?}
    Check2 -->|æ˜¯| Read2[è¯»å–ä¸Šæ¸¸åŸºçº¿ç‰ˆæœ¬<br/>æ ‡å‡†å·¥ä½œæµ]
    Check2 -->|å¦| Error[æ–‡æ¡£ç¼ºå¤±é”™è¯¯<br/>æç¤ºæ‰§è¡Œ initmc --sync]

    Read1 --> Done[å®ŒæˆæŸ¥é˜…]
    Read2 --> Done

    style Read1 fill:#4caf50,color:#fff
    style Read2 fill:#2196f3,color:#fff
    style Error fill:#f44336,color:#fff
```

**è®¾è®¡ä¼˜åŠ¿**:
1. âœ… **é›¶å†²çªå‡çº§**: `initmc --sync` åªæ›´æ–° `.claude/core-docs/`ï¼Œä¸å½±å“ `markdown/core/`
2. âœ… **çµæ´»å®šåˆ¶**: ç”¨æˆ·å¯è¦†ç›–ä»»æ„æ ¸å¿ƒæ–‡æ¡£ï¼Œæ»¡è¶³é¡¹ç›®ç‰¹æ®Šéœ€æ±‚
3. âœ… **è‡ªåŠ¨åŒæ­¥**: è½¯è¿æ¥æ¨¡å¼ä¸‹ï¼Œä¸Šæ¸¸æ–‡æ¡£å®æ—¶åŒæ­¥
4. âœ… **é™çº§ä¿æŠ¤**: æƒé™ä¸è¶³æ—¶è‡ªåŠ¨åˆ›å»ºåªè¯»å‰¯æœ¬ï¼ŒåŠŸèƒ½å®Œå…¨æ­£å¸¸

---

#### 4.1.2 è½¯è¿æ¥ç®¡ç†å™¨å®ç°

æ ¸å¿ƒç±»: `SymlinkManager` ([lib/symlink-manager.js](lib/symlink-manager.js))

**å…³é”®æ–¹æ³•è¯¦è§£**:

##### 1. `createAllSymlinks()` - ä¸»å…¥å£æ–¹æ³•

**ä½ç½®**: [lib/symlink-manager.js:23-50](lib/symlink-manager.js#L23-L50)

**èŒè´£**: æ‰¹é‡åˆ›å»ºæ‰€æœ‰æ ¸å¿ƒæ–‡æ¡£çš„è½¯è¿æ¥

**è¿”å›å€¼**:
```javascript
{
  symlinks: [],         // æˆåŠŸåˆ›å»ºçš„è½¯è¿æ¥åˆ—è¡¨
  readonlyCopies: [],   // é™çº§ä¸ºåªè¯»å‰¯æœ¬çš„åˆ—è¡¨
  failed: []            // åˆ›å»ºå¤±è´¥çš„åˆ—è¡¨
}
```

**æ ¸å¿ƒé€»è¾‘**:
```javascript
async createAllSymlinks() {
  console.log('ğŸ“‚ åˆ›å»ºä¸Šæ¸¸æ–‡æ¡£å¼•ç”¨...\n');

  fs.ensureDirSync(this.coreDocsPath);  // ç¡®ä¿ .claude/core-docs/ å­˜åœ¨

  const coreFiles = this._getCoreFiles();  // åŠ¨æ€æ‰«æéœ€è¦éƒ¨ç½²çš„æ–‡ä»¶
  const results = { symlinks: [], readonlyCopies: [], failed: [] };

  for (const file of coreFiles) {
    const result = await this.createSymlink(file);  // é€ä¸ªåˆ›å»ºè½¯è¿æ¥

    // æ ¹æ®åˆ›å»ºç»“æœåˆ†ç±»ç»Ÿè®¡
    if (result.type === 'symlink') {
      results.symlinks.push(file);
    } else if (result.type === 'readonly-copy') {
      results.readonlyCopies.push(file);
    } else {
      results.failed.push({ file, error: result.error });
    }
  }

  this._printResults(results);  // è¾“å‡ºç»Ÿè®¡æŠ¥å‘Š
  return results;
}
```

---

##### 2. `_getCoreFiles()` - åŠ¨æ€æ‰«ææ ¸å¿ƒæ–‡ä»¶

**ä½ç½®**: [lib/symlink-manager.js:192-239](lib/symlink-manager.js#L192-L239)

**å®ç°**: ä½¿ç”¨ glob æ¨¡å¼åŒ¹é…ï¼Œé›¶ç»´æŠ¤æˆæœ¬

**åŒ…å«æ¨¡å¼**:
```javascript
const includePatterns = [
  'æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/**/*.md',   // å¼€å‘è§„èŒƒã€é—®é¢˜æ’æŸ¥ã€å¿«é€Ÿå¼€å§‹
  'æ¦‚å¿µå‚è€ƒ/**/*.md',          // MODSDKæ ¸å¿ƒæ¦‚å¿µã€APIé€ŸæŸ¥
  'æ·±åº¦æŒ‡å—/**/*.md',          // æ€§èƒ½ä¼˜åŒ–ã€äº‹ä»¶ç³»ç»Ÿã€ECSæ¶æ„
  'ai',                        // AIä»»åŠ¡ç­–ç•¥è¡¨ã€å¿«é€Ÿé€šé“æµç¨‹
  'å¯é€‰å·¥å…·è¯´æ˜.md'            // å¯é€‰å·¥å…·æ–‡æ¡£
];
```

**æ’é™¤æ¨¡å¼**ï¼ˆä¸‹æ¸¸é¡¹ç›®ç‰¹å®šæ–‡æ¡£ï¼‰:
```javascript
const excludePatterns = [
  '**/ç´¢å¼•.md',                // é¡¹ç›®ç´¢å¼•ï¼ˆAIè‡ªåŠ¨ç»´æŠ¤ï¼‰
  '**/é¡¹ç›®çŠ¶æ€.md',            // é¡¹ç›®çŠ¶æ€ï¼ˆAIè‡ªåŠ¨ç»´æŠ¤ï¼‰
  '**/æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md',      // å¾…åŠæ¸…å•ï¼ˆAIè‡ªåŠ¨ç»´æŠ¤ï¼‰
  'systems/**',                // Systemæ–‡æ¡£æ¨¡æ¿ï¼ˆä¸éƒ¨ç½²ï¼‰
  'core/**',                   // é¡¹ç›®è¦†ç›–å±‚ï¼ˆä¸éƒ¨ç½²ï¼‰
  'README.md'                  // æ ¹READMEï¼ˆä¸‹æ¸¸æœ‰è‡ªå·±çš„ï¼‰
];
```

**ä»£ç ç‰‡æ®µ**:
```javascript
_getCoreFiles() {
  const glob = require('glob');
  const coreFiles = [];
  const markdownRoot = path.join(this.upstreamPath, 'markdown');

  // æ‰«æåŒ¹é…çš„æ–‡ä»¶
  for (const pattern of includePatterns) {
    const files = glob.sync(pattern, {
      cwd: markdownRoot,
      nodir: pattern === 'ai' ? false : true,  // aiç›®å½•éœ€è¦åˆ›å»ºè½¯è¿æ¥
      dot: false
    });

    // è¿‡æ»¤æ’é™¤æ¨¡å¼
    const filtered = files.filter(file => {
      return !excludePatterns.some(exclude => {
        const excludeRegex = new RegExp(exclude.replace(/\*\*/g, '.*').replace(/\*/g, '[^/]*'));
        return excludeRegex.test(file);
      });
    });

    coreFiles.push(...filtered);
  }

  return [...new Set(coreFiles)];  // å»é‡
}
```

---

#### 4.1.3 Windows è·¨å¹³å°æ”¯æŒ

**é—®é¢˜**: Windowsä¸‹æ™®é€šç”¨æˆ·é»˜è®¤æ— æ³•åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™æˆ–å¼€å‘è€…æ¨¡å¼ï¼‰

**è§£å†³æ–¹æ¡ˆ**: ä¸‰çº§é™çº§ç­–ç•¥

**é™çº§æµç¨‹å›¾**:

```mermaid
graph TD
    Start[å°è¯•åˆ›å»ºè½¯è¿æ¥] --> Platform{æ“ä½œç³»ç»Ÿ?}

    Platform -->|Windows| Win1[å°è¯•åˆ›å»ºJunction<br/>ç›®å½•: junction<br/>æ–‡ä»¶: file]
    Platform -->|Linux/Mac| Unix1[åˆ›å»ºç¬¦å·é“¾æ¥<br/>fs.symlinkSync]

    Win1 --> Check1{æˆåŠŸ?}
    Unix1 --> Check1

    Check1 -->|æ˜¯| Success[âœ… è½¯è¿æ¥åˆ›å»ºæˆåŠŸ<br/>å®æ—¶åŒæ­¥ä¸Šæ¸¸æ–‡æ¡£]
    Check1 -->|å¦<br/>EPERMé”™è¯¯| Fallback[âš ï¸ æƒé™ä¸è¶³<br/>é™çº§ä¸ºåªè¯»å‰¯æœ¬]

    Fallback --> Copy[å¤åˆ¶æ–‡ä»¶/ç›®å½•<br/>fs.copySync]
    Copy --> AddHeader[æ·»åŠ åªè¯»æ ‡è®°<br/>Markdownå¤´éƒ¨è­¦å‘Š]
    AddHeader --> SetPerm[è®¾ç½®åªè¯»æƒé™<br/>chmod 0o444]
    SetPerm --> FallbackDone[ğŸ“‹ åªè¯»å‰¯æœ¬åˆ›å»ºæˆåŠŸ<br/>åŠŸèƒ½å®Œå…¨æ­£å¸¸]

    Check1 -->|å¦<br/>å…¶ä»–é”™è¯¯| Failed[âŒ åˆ›å»ºå¤±è´¥<br/>è®°å½•é”™è¯¯æ—¥å¿—]

    style Success fill:#4caf50,color:#fff
    style FallbackDone fill:#ff9800,color:#fff
    style Failed fill:#f44336,color:#fff
```

**æ ¸å¿ƒä»£ç **ï¼ˆ[lib/symlink-manager.js:80-100](lib/symlink-manager.js#L80-L100)ï¼‰:

```javascript
async _tryCreateSymlink(targetPath, linkPath, relativePath) {
  const isDirectory = fs.statSync(targetPath).isDirectory();

  try {
    if (process.platform === 'win32') {
      // Windows: ä½¿ç”¨Junctionï¼ˆä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
      const type = isDirectory ? 'junction' : 'file';
      fs.symlinkSync(targetPath, linkPath, type);
    } else {
      // Linux/Mac: æ ‡å‡†ç¬¦å·é“¾æ¥
      fs.symlinkSync(targetPath, linkPath);
    }

    console.log(`   âœ… è½¯è¿æ¥: ${relativePath} â†’ ä¸Šæ¸¸`);
    return { type: 'symlink' };

  } catch (err) {
    // é™çº§ï¼šåˆ›å»ºåªè¯»å‰¯æœ¬
    return await this._createReadonlyCopy(targetPath, linkPath, relativePath, isDirectory);
  }
}
```

---

#### 4.1.4 é™çº§ç­–ç•¥ï¼šåªè¯»å‰¯æœ¬æœºåˆ¶

**åªè¯»å‰¯æœ¬ç‰¹æ€§**:
1. âœ… **åŠŸèƒ½å®Œæ•´**: AIå¯æ­£å¸¸è¯»å–æ–‡æ¡£å†…å®¹
2. âœ… **ç¼–è¾‘ä¿æŠ¤**: æ–‡ä»¶æƒé™è®¾ä¸ºåªè¯»ï¼ˆ`0o444`ï¼‰
3. âœ… **æ˜ç¡®æç¤º**: Markdownå¤´éƒ¨æ·»åŠ åªè¯»è­¦å‘Š
4. âœ… **å‡çº§å‹å¥½**: `initmc --sync` è‡ªåŠ¨é‡æ–°å¤åˆ¶æœ€æ–°ç‰ˆæœ¬

**åªè¯»æ ‡è®°ç¤ºä¾‹**ï¼ˆ[lib/symlink-manager.js:142-166](lib/symlink-manager.js#L142-L166)ï¼‰:

```markdown
<!--
âš ï¸ **åªè¯»æ–‡æ¡£**

æ­¤æ–‡æ¡£æ¥è‡ªä¸Šæ¸¸å·¥ä½œæµï¼Œè¯·å‹¿ç›´æ¥ç¼–è¾‘ã€‚

å¦‚éœ€å®šåˆ¶ï¼š
1. å¤åˆ¶åˆ° markdown/core/å¼€å‘è§„èŒƒ.md
2. ç¼–è¾‘é¡¹ç›®å‰¯æœ¬
3. AIä¼šè‡ªåŠ¨ä¼˜å…ˆè¯»å–é¡¹ç›®å®šåˆ¶ç‰ˆæœ¬

æ‰§è¡Œ `initmc --sync` å¯æ›´æ–°æ­¤æ–‡æ¡£ã€‚
-->

# å¼€å‘è§„èŒƒ
...
```

**åˆ›å»ºåªè¯»å‰¯æœ¬ä»£ç **:

```javascript
async _createReadonlyCopy(targetPath, linkPath, relativePath, isDirectory) {
  try {
    console.log(`   âš ï¸  æ— æ³•åˆ›å»ºè½¯è¿æ¥ï¼Œé™çº§ä¸ºåªè¯»å‰¯æœ¬: ${relativePath}`);

    if (isDirectory) {
      // å¤åˆ¶ç›®å½•
      fs.copySync(targetPath, linkPath);

      // ä¸ºç›®å½•ä¸­çš„æ¯ä¸ª.mdæ–‡ä»¶æ·»åŠ æ ‡è®°
      const mdFiles = this._findMarkdownFiles(linkPath);
      for (const mdFile of mdFiles) {
        this._addReadonlyHeader(mdFile);
      }
    } else {
      // å¤åˆ¶æ–‡ä»¶
      fs.copySync(targetPath, linkPath);

      // æ·»åŠ åªè¯»æ ‡è®°
      if (relativePath.endsWith('.md')) {
        this._addReadonlyHeader(linkPath);
      }
    }

    // è®¾ç½®åªè¯»æƒé™ï¼ˆå°½åŠ›è€Œä¸ºï¼‰
    try {
      this._setReadonly(linkPath, isDirectory);
    } catch {}

    return { type: 'readonly-copy' };

  } catch (copyErr) {
    return { type: 'failed', error: copyErr.message };
  }
}
```

---

### 4.2 æ–‡æ¡£ç”Ÿæˆå™¨ï¼ˆlib/generator.jsï¼‰

#### 4.2.1 Layer 1/2/3 ä¸‰å±‚æ¶æ„

**æ ¸å¿ƒç±»**: `DocumentGenerator` ([lib/generator.js](lib/generator.js))

**ä¸‰å±‚ç”Ÿæˆæ¶æ„**:

| Layer | åç§° | å†…å®¹ | ç”Ÿæˆæ—¶æœº | æ›´æ–°é¢‘ç‡ |
|-------|------|------|---------|---------|
| **Layer 1** | **é€šç”¨å±‚** | CLAUDE.mdã€.claude/commands/ã€README.mdã€è½¯è¿æ¥ | `initmc` åˆå§‹åŒ– | å‡çº§æ—¶æ›´æ–° |
| **Layer 2** | **æ¶æ„å±‚** | markdown/systems/ï¼ˆSystemæ–‡æ¡£ï¼‰ | é¦–æ¬¡ `initmc` | AIæ£€æµ‹ç¼ºå¤±æ—¶ç”Ÿæˆ |
| **Layer 3** | **ä¸šåŠ¡å±‚** | markdown/NEWRPG/ï¼ˆä¸šåŠ¡æ¡†æ¶ï¼‰ | æ ¹æ®é¡¹ç›®ç±»å‹ | AIå¼€å‘æ—¶è¡¥å…… |

**ç”Ÿæˆæµç¨‹å›¾**:

```mermaid
graph TD
    Start[è°ƒç”¨ generateAll] --> Check{minimalMode?}

    Check -->|æ˜¯| Layer1Only[åªç”ŸæˆLayer 1]
    Check -->|å¦| Layer1[ç”ŸæˆLayer 1]

    Layer1Only --> L1_CLAUDE[CLAUDE.md]
    Layer1Only --> L1_Commands[.claude/commands/<br/>6ä¸ªå‘½ä»¤]
    Layer1Only --> L1_Symlinks[è½¯è¿æ¥ä¸Šæ¸¸æ–‡æ¡£<br/>.claude/core-docs/]
    Layer1Only --> L1_Manifest[workflow-manifest.json]
    Layer1Only --> L1_Docs[markdown/README.md]
    Layer1Only --> EndMinimal[å®Œæˆ: æœ€å°åŒ–éƒ¨ç½²]

    Layer1 --> L1_CLAUDE
    Layer1 --> L1_Commands
    Layer1 --> L1_Symlinks
    Layer1 --> L1_Manifest
    Layer1 --> L1_Docs

    L1_Docs --> Layer2[ç”ŸæˆLayer 2]

    Layer2 --> L2_Systems[markdown/systems/<br/>Systemæ–‡æ¡£]
    Layer2 --> L2_Adaptive[è‡ªé€‚åº”ç»„ä»¶ç»´æŠ¤<br/>DocMappingInference]

    L2_Adaptive --> Layer3[ç”ŸæˆLayer 3]

    Layer3 --> BusinessType{ä¸šåŠ¡ç±»å‹?}
    BusinessType -->|RPG| L3_RPG[markdown/NEWRPG/]
    BusinessType -->|ECPreset| L3_Preset[markdown/presets/]
    BusinessType -->|é€šç”¨| L3_Generic[Systemsæ–‡æ¡£]

    L3_RPG --> TodoList[ç”Ÿæˆæ–‡æ¡£å¾…è¡¥å……æ¸…å•]
    L3_Preset --> TodoList
    L3_Generic --> TodoList

    TodoList --> EndFull[å®Œæˆ: å®Œæ•´éƒ¨ç½²]

    style Layer1 fill:#4caf50,color:#fff
    style Layer2 fill:#2196f3,color:#fff
    style Layer3 fill:#ff9800,color:#fff
```

---

#### 4.2.2 æ ¸å¿ƒæ–¹æ³•è¯¦è§£

##### 1. `_generateLayer1()` - é€šç”¨å±‚ç”Ÿæˆ

**ä½ç½®**: [lib/generator.js:125-183](lib/generator.js#L125-L183)

**å…³é”®æ­¥éª¤**:

```javascript
async _generateLayer1(targetPath) {
  console.log('[ç”Ÿæˆå™¨] ç”ŸæˆLayer 1ï¼ˆé€šç”¨å±‚ - v16.0åŒå±‚æ¶æ„ï¼‰...');

  const replacements = this._buildReplacements(targetPath);  // è®¡ç®—å ä½ç¬¦

  // 1. CLAUDE.mdï¼ˆä¸‹æ¸¸å‰¯æœ¬ï¼Œå‡çº§æ—¶ä¼šè¢«æ›¿æ¢ï¼‰
  this._generateFromTemplate('CLAUDE.md', targetPath, 'CLAUDE.md', replacements);

  // 2. Claudeå‘½ä»¤æ–‡ä»¶ï¼ˆv17.1: ç»Ÿä¸€/mcå‰ç¼€ï¼‰
  this._cleanupOldCommands(targetPath);  // æ¸…ç†v16åŠä»¥å‰çš„æ—§å‘½ä»¤
  this._generateFromTemplate('mc.md', targetPath, '.claude/commands/mc.md', replacements);
  this._generateFromTemplate('mc-review.md', targetPath, '.claude/commands/mc-review.md', replacements);
  this._generateFromTemplate('mc-perf.md', targetPath, '.claude/commands/mc-perf.md', replacements);
  this._generateFromTemplate('mc-docs.md', targetPath, '.claude/commands/mc-docs.md', replacements);
  this._generateFromTemplate('mc-why.md', targetPath, '.claude/commands/mc-why.md', replacements);
  this._generateFromTemplate('mc-discover.md', targetPath, '.claude/commands/mc-discover.md', replacements);

  // 3. README.md
  this._generateFromTemplate('README.md', targetPath, 'README.md', replacements);

  // 4. â­ åˆ›å»º.claude/core-docs/è½¯è¿æ¥ï¼ˆä¸Šæ¸¸åŸºçº¿å±‚ï¼‰
  console.log('[ç”Ÿæˆå™¨] åˆ›å»ºä¸Šæ¸¸æ–‡æ¡£å¼•ç”¨ï¼ˆ.claude/core-docs/ï¼‰...');
  const symlinkManager = new SymlinkManager(this.upstreamPath, targetPath);
  await symlinkManager.createAllSymlinks();
  console.log('[ç”Ÿæˆå™¨] âœ… ä¸Šæ¸¸æ–‡æ¡£å¼•ç”¨åˆ›å»ºå®Œæˆ');

  // 5. â­ ç”Ÿæˆmarkdown/README.mdï¼ˆå¯¼èˆªæ–‡æ¡£ï¼‰
  this._generateFromTemplate('markdown/README.md', targetPath, 'markdown/README.md', replacements);

  // 6. åˆ›å»ºmarkdown/core/ç›®å½•ï¼ˆé¡¹ç›®è¦†ç›–å±‚ï¼‰
  ensureDir(path.join(targetPath, 'markdown/core'));

  // 7. åˆ›å»ºtasks/README.md
  writeFile(path.join(targetPath, 'tasks/README.md'), this._generateTasksReadme());

  // 8. â­ ç”Ÿæˆ.claude/workflow-manifest.jsonï¼ˆç‰ˆæœ¬è¿½è¸ªï¼‰
  const versionChecker = new VersionChecker(this.upstreamPath, targetPath);
  const baselineHashes = versionChecker.computeBaselineHashes();
  versionChecker.writeManifest({
    version: VERSION,
    baselineHashes: baselineHashes,
    installedAt: new Date().toISOString()
  });

  console.log('[ç”Ÿæˆå™¨] Layer 1 å®Œæˆ âœ…');
}
```

---

##### 2. `_generateLayer2()` - æ¶æ„å±‚ç”Ÿæˆ

**ä½ç½®**: [lib/generator.js:189-237](lib/generator.js#L189-L237)

**æ™ºèƒ½æ–‡æ¡£æ£€æµ‹**:

```javascript
async _generateLayer2(targetPath) {
  console.log('[ç”Ÿæˆå™¨] ç”ŸæˆLayer 2ï¼ˆç³»ç»Ÿæ–‡æ¡£ï¼‰...');

  const systemsDir = path.join(targetPath, 'markdown/systems');

  // Systems README
  const systemsReadme = this._generateSystemsReadme();
  writeFile(path.join(systemsDir, 'README.md'), systemsReadme);

  let generatedCount = 0;
  let skippedCount = 0;

  // ä¸ºæ¯ä¸ªSystemç”Ÿæˆæ–‡æ¡£ï¼ˆå¸¦æ™ºèƒ½æ£€æµ‹ï¼‰
  for (const [systemName, systemInfo] of Object.entries(this.codeStructure.systems)) {
    const existingDoc = this._detectExistingSystemDoc(systemName, systemsDir);

    if (existingDoc) {
      console.log(`[ç”Ÿæˆå™¨] æ£€æµ‹åˆ°ç°æœ‰æ–‡æ¡£: ${existingDoc.fileName} (è´¨é‡è¯„åˆ†: ${existingDoc.quality}/5)`);

      if (existingDoc.quality >= 3) {
        // é«˜è´¨é‡æ–‡æ¡£ï¼Œè·³è¿‡ç”Ÿæˆ
        console.log(`[ç”Ÿæˆå™¨] âœ“ ä¿ç•™é«˜è´¨é‡æ–‡æ¡£: ${existingDoc.fileName}`);
        skippedCount++;
        continue;
      } else {
        // ä½è´¨é‡æ–‡æ¡£ï¼Œæç¤ºç”¨æˆ·
        console.log(`[ç”Ÿæˆå™¨] âš ï¸  å‘ç°ä½è´¨é‡æ–‡æ¡£: ${existingDoc.fileName}ï¼Œå°†è¦†ç›–ç”Ÿæˆæ–°æ–‡æ¡£`);
      }
    }

    const docContent = this._generateSystemDoc(systemName, systemInfo, targetPath);

    // â­ ä½¿ç”¨AIæ™ºèƒ½å‘½åï¼ˆè€Œéç¡¬ç¼–ç è‹±æ–‡ç±»åï¼‰
    const systemFilePath = systemInfo.filePath;
    const maintenance = new IntelligentDocMaintenance(targetPath);
    const chineseFileName = maintenance._inferChineseNameByAI(
      systemFilePath,
      systemName,
      { type: 'system', subtype: 'system' }
    );

    writeFile(path.join(systemsDir, chineseFileName), docContent);
    generatedCount++;
  }

  console.log(`[ç”Ÿæˆå™¨] ç”Ÿæˆäº† ${generatedCount} ä¸ªç³»ç»Ÿæ–‡æ¡£ï¼Œè·³è¿‡ ${skippedCount} ä¸ªç°æœ‰æ–‡æ¡£ âœ…`);
}
```

---

#### 4.2.3 CLAUDE.md å››æ®µå¼ç»“æ„

**è®¾è®¡ç›®æ ‡**: åˆ†ç¦»ç”¨æˆ·å¯ç¼–è¾‘åŒºåŸŸå’Œå·¥ä½œæµè‡ªåŠ¨ç®¡ç†åŒºåŸŸ

**å››æ®µå¼ç»“æ„** (v16.1+):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. é¡¹ç›®é…ç½®åŒºï¼ˆç”¨æˆ·å¯ç¼–è¾‘ï¼‰                  â”‚
â”‚    - é¡¹ç›®åç§°ã€è·¯å¾„ã€ç±»å‹                    â”‚
â”‚    - åŸºç¡€é…ç½®ä¿¡æ¯                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. å·¥ä½œæµå†…å®¹åŒºï¼ˆâš ï¸ è‡ªåŠ¨ç®¡ç†ï¼‰              â”‚
â”‚    - æ ¸å¿ƒå·¥ä½œæµé€»è¾‘                          â”‚
â”‚    - å‡çº§æ—¶ç²¾ç¡®æ›¿æ¢                          â”‚
â”‚    - âš ï¸ ç¦æ­¢æ‰‹åŠ¨ç¼–è¾‘                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. é¡¹ç›®æ‰©å±•åŒºï¼ˆç”¨æˆ·å¯ç¼–è¾‘ï¼‰                  â”‚
â”‚    - é¡¹ç›®ç‰¹å®šè§„èŒƒ                            â”‚
â”‚    - å›¢é˜Ÿåä½œæµç¨‹                            â”‚
â”‚    - è‡ªå®šä¹‰æ¶æ„æ¨¡å¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. æ–‡æ¡£å…ƒæ•°æ®åŒºï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰                  â”‚
â”‚    - å·¥ä½œæµç‰ˆæœ¬å·                            â”‚
â”‚    - ç”Ÿæˆæ—¶é—´æˆ³                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**HTMLæ³¨é‡Šæ ‡è®°**ï¼ˆ[lib/generator.js:631-723](lib/generator.js#L631-L723)ï¼‰:

```html
<!-- ==================== é¡¹ç›®é…ç½®åŒº START ==================== -->
<!-- ç”¨æˆ·å¯ç¼–è¾‘ï¼šåŸºç¡€é¡¹ç›®ä¿¡æ¯ -->
...
<!-- ==================== é¡¹ç›®é…ç½®åŒº END ==================== -->

<!-- ==================== å·¥ä½œæµå†…å®¹ START v16.1 ==================== -->
<!-- âš ï¸ è­¦å‘Šï¼šä»¥ä¸‹å†…å®¹ç”±å·¥ä½œæµè‡ªåŠ¨ç®¡ç†ï¼Œå‡çº§æ—¶ä¼šç²¾ç¡®æ›¿æ¢æ­¤åŒºåŸŸ -->
<!-- âš ï¸ è¯·å‹¿æ‰‹åŠ¨ç¼–è¾‘ï¼Œæ‰€æœ‰ä¿®æ”¹å°†åœ¨å‡çº§æ—¶ä¸¢å¤± -->
<!-- âš ï¸ å¦‚éœ€æ·»åŠ é¡¹ç›®ç‰¹å®šè§„èŒƒï¼Œè¯·ä½¿ç”¨ä¸‹æ–¹çš„"é¡¹ç›®æ‰©å±•åŒº" -->
...
<!-- ==================== å·¥ä½œæµå†…å®¹ END v16.1 ==================== -->

<!-- ==================== é¡¹ç›®æ‰©å±•åŒº START ==================== -->
<!-- ç”¨æˆ·å¯ç¼–è¾‘ï¼šæ·»åŠ é¡¹ç›®ç‰¹å®šè§„èŒƒ -->
<!-- âš ï¸ æœ¬åŒºåŸŸå†…å®¹ä¼šåœ¨å‡çº§æ—¶è‡ªåŠ¨ä¿ç•™ -->
...
<!-- ==================== é¡¹ç›®æ‰©å±•åŒº END ==================== -->
```

**æ™ºèƒ½åˆå¹¶é€»è¾‘**ï¼ˆ`_mergeCLAUDEmd` æ–¹æ³•ï¼‰:

1. **æå–ç°æœ‰å†…å®¹**: ä»æ—§æ–‡ä»¶æå–ç”¨æˆ·ç¼–è¾‘çš„"é¡¹ç›®é…ç½®åŒº"å’Œ"é¡¹ç›®æ‰©å±•åŒº"
2. **æå–æ–°æ¨¡æ¿**: ä»æ–°æ¨¡æ¿æå–æœ€æ–°çš„"å·¥ä½œæµå†…å®¹åŒº"
3. **æ™ºèƒ½ç»„è£…**: ä¿ç•™ç”¨æˆ·ç¼–è¾‘ + æ›´æ–°å·¥ä½œæµå†…å®¹
4. **å»é™¤å†—ä½™æ³¨é‡Š**: é¿å…é‡å¤ç´¯ç§¯ç”¨æˆ·ç¼–è¾‘æç¤º

---

#### 4.2.4 æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤

**ç°æœ‰æ–‡æ¡£æ£€æµ‹**ï¼ˆ`_detectExistingSystemDoc` æ–¹æ³•ï¼Œ[lib/generator.js:245-308](lib/generator.js#L245-L308)ï¼‰:

**åŒ¹é…ç­–ç•¥**ï¼ˆ4çº§æ™ºèƒ½åŒ¹é…ï¼‰:

1. **ç²¾ç¡®æ–‡ä»¶ååŒ¹é…**: `ShopServerSystem.md`
2. **æ ‡é¢˜åŒ¹é…**: `# ShopServerSystem` æˆ– `# å•†åº—ç³»ç»Ÿ`
3. **Front MatteråŒ¹é…**: YAMLå…ƒæ•°æ®ä¸­å£°æ˜äº†ç³»ç»Ÿå
4. **ä»£ç å—åŒ¹é…**: æ–‡æ¡£ä¸­å¼•ç”¨äº† `class ShopServerSystem`

**è´¨é‡è¯„åˆ†ç®—æ³•**ï¼ˆ`_assessDocQuality` æ–¹æ³•ï¼Œ[lib/generator.js:361-390](lib/generator.js#L361-L390)ï¼‰:

**è¯„åˆ†æ ‡å‡†ï¼ˆ0-5åˆ†åˆ¶ï¼‰**:

| å› ç´  | åŠ åˆ† | æ£€æµ‹è§„åˆ™ |
|------|------|---------|
| **ä»£ç å—ç¤ºä¾‹** | +1 | åŒ…å« ` ``` ` |
| **å›¾è¡¨** | +1 | åŒ…å« `mermaid`/`graph`/`flowchart` |
| **ç¤ºä¾‹è¯´æ˜** | +1 | åŒ…å«"ç¤ºä¾‹"/"Example"/"æ¡ˆä¾‹"/"ä½¿ç”¨æ–¹æ³•" |
| **å†…å®¹ä¸°å¯Œ** | +1 | å­—ç¬¦æ•° > 500 |
| **éå¾…è¡¥å……æ¨¡æ¿** | +1 | ä¸åŒ…å«"âš ï¸ **å¾…è¡¥å……**" |

**è¯„åˆ†ä»£ç **:

```javascript
_assessDocQuality(content) {
  let score = 0;

  // å› ç´ 1: æœ‰ä»£ç å—ç¤ºä¾‹ (+1)
  if (/```/.test(content)) {
    score += 1;
  }

  // å› ç´ 2: æœ‰å›¾è¡¨ï¼ˆmermaid/flowchartï¼‰(+1)
  if (/mermaid|graph|flowchart|```diagram/.test(content)) {
    score += 1;
  }

  // å› ç´ 3: æœ‰ç¤ºä¾‹è¯´æ˜ (+1)
  if (/ç¤ºä¾‹|Example|æ¡ˆä¾‹|ä½¿ç”¨æ–¹æ³•|Usage/.test(content)) {
    score += 1;
  }

  // å› ç´ 4: å†…å®¹ä¸°å¯Œï¼ˆ>500å­—ç¬¦ï¼‰(+1)
  if (content.length > 500) {
    score += 1;
  }

  // å› ç´ 5: ä¸æ˜¯"å¾…è¡¥å……"æ¨¡æ¿ (+1)
  if (!/âš ï¸\s*\*\*å¾…è¡¥å……\*\*/.test(content)) {
    score += 1;
  }

  return score;
}
```

**å†³ç­–é€»è¾‘**:

- **è´¨é‡ â‰¥ 3åˆ†**: ä¿ç•™ç°æœ‰æ–‡æ¡£ï¼Œè·³è¿‡ç”Ÿæˆ
- **è´¨é‡ < 3åˆ†**: æç¤ºç”¨æˆ·ï¼Œè¦†ç›–ç”Ÿæˆæ–°æ–‡æ¡£

---

### 4.3 æ¨¡æ¿ç³»ç»Ÿ

#### 4.3.1 èŒè´£è¾¹ç•Œï¼ˆv16.3é‡æ„ï¼‰

**æ ¸å¿ƒåŸåˆ™**: `markdown/` æ˜¯å•ä¸€çœŸå®æºï¼Œ`templates/` åªåŒ…å«é¡¹ç›®ç‰¹å®šæ¨¡æ¿

**v16.3é‡æ„å‰åå¯¹æ¯”**:

| ç›®å½• | v16.2åŠä¹‹å‰ | v16.3é‡æ„å | å˜åŒ– |
|------|-----------|-----------|------|
| **markdown/** | æ ¸å¿ƒæ–‡æ¡£ | æ ¸å¿ƒæ–‡æ¡£ï¼ˆå•ä¸€çœŸå®æºï¼‰ | âœ… ä¿æŒä¸å˜ |
| **templates/markdown/** | æ ¸å¿ƒæ–‡æ¡£å‰¯æœ¬ + é¡¹ç›®æ¨¡æ¿<br/>ï¼ˆâŒ å†—ä½™75KB+ï¼‰ | âœ… åªä¿ç•™é¡¹ç›®æ¨¡æ¿ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰ | âœ… æ¶ˆé™¤å†—ä½™ |
| **éƒ¨ç½²æ–¹å¼** | ä»æ¨¡æ¿ç”Ÿæˆ â†’ åŒä»½ç»´æŠ¤ | è½¯è¿æ¥å¼•ç”¨ â†’ é›¶ç»´æŠ¤ | âœ… æ¶æ„ä¼˜åŒ– |

**templates/ ç›®å½•ç»“æ„** (v16.3+):

```
templates/
â”œâ”€ CLAUDE.md.template                        # ä¸‹æ¸¸AIæŒ‡å¯¼æ–‡æ¡£
â”œâ”€ README.md.template                        # é¡¹ç›®è¯´æ˜
â”œâ”€ .claude/commands/                         # 6ä¸ªClaudeå‘½ä»¤æ¨¡æ¿
â”‚   â”œâ”€ mc.md.template                         # /mc ä¸»å‘½ä»¤
â”‚   â”œâ”€ mc-review.md.template                  # /mc-review æ–¹æ¡ˆå®¡æŸ¥
â”‚   â”œâ”€ mc-perf.md.template                    # /mc-perf æ€§èƒ½åˆ†æ
â”‚   â”œâ”€ mc-docs.md.template                    # /mc-docs æ–‡æ¡£å®¡è®¡
â”‚   â”œâ”€ mc-why.md.template                     # /mc-why åŸç†è§£é‡Š
â”‚   â””â”€ mc-discover.md.template                # /mc-discover ç»“æ„å‘ç°
â””â”€ markdown/                                  # é¡¹ç›®ç‰¹å®šæ–‡æ¡£æ¨¡æ¿ï¼ˆ4ä¸ªï¼‰
    â”œâ”€ README.md.template                     # æ–‡æ¡£å¯¼èˆª
    â”œâ”€ ç´¢å¼•.md.template                       # å¿«é€Ÿç´¢å¼•
    â”œâ”€ é¡¹ç›®çŠ¶æ€.md.template                   # é¡¹ç›®çŠ¶æ€
    â””â”€ æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md.template             # å¾…åŠæ¸…å•
```

**åˆ é™¤çš„æ–‡ä»¶**ï¼ˆv16.3é‡æ„ï¼‰:

```
âŒ templates/markdown/å¼€å‘è§„èŒƒ.md.template (1157è¡Œ, è¿‡æ—¶ç‰ˆæœ¬)
âŒ templates/markdown/é—®é¢˜æ’æŸ¥.md.template (39KB)
âŒ templates/markdown/å¿«é€Ÿå¼€å§‹.md.template (4.6KB)
âŒ templates/markdown/AIç­–ç•¥æ–‡æ¡£/ (ç¼ºå°‘æ–‡ä»¶)
```

**è¿ç§»è·¯å¾„**:

- **æ—§ç‰ˆæœ¬ (v16.2åŠä¹‹å‰)**: ä» `templates/markdown/` ç”Ÿæˆæ ¸å¿ƒæ–‡æ¡£
- **æ–°ç‰ˆæœ¬ (v16.3+)**: é€šè¿‡è½¯è¿æ¥å¼•ç”¨ `markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/`
- **è‡ªåŠ¨è¿ç§»**: `initmc --sync` è‡ªåŠ¨æ¸…ç†æ—§ç”Ÿæˆæ–‡ä»¶ï¼Œåˆ›å»ºè½¯è¿æ¥

---

#### 4.3.2 å ä½ç¬¦ç³»ç»Ÿ

**å ä½ç¬¦å®šä¹‰** ([lib/config.js:66-81](lib/config.js#L66-L81)):

```javascript
const PLACEHOLDERS = {
  PROJECT_PATH: '{{PROJECT_PATH}}',              // é¡¹ç›®è·¯å¾„
  PROJECT_NAME: '{{PROJECT_NAME}}',              // é¡¹ç›®åç§°
  EXAMPLE_TASKS: '{{EXAMPLE_TASKS}}',            // ç¤ºä¾‹ä»»åŠ¡
  SDK_DOC_PATH: '{{SDK_DOC_PATH}}',              // SDKæ–‡æ¡£è·¯å¾„
  CRITICAL_RULES: '{{CRITICAL_RULES}}',          // CRITICALè§„èŒƒ
  CORE_PATHS: '{{CORE_PATHS}}',                  // æ ¸å¿ƒè·¯å¾„åˆ—è¡¨
  ARCHITECTURE_DOCS: '{{ARCHITECTURE_DOCS_SECTION}}',  // æ¶æ„æ–‡æ¡£
  BUSINESS_DOCS: '{{BUSINESS_DOCS_SECTION}}',    // ä¸šåŠ¡æ–‡æ¡£
  NBT_CHECK_SECTION: '{{NBT_CHECK_SECTION}}',    // NBTæ£€æŸ¥
  LOG_FILES: '{{LOG_FILES}}',                    // æ—¥å¿—æ–‡ä»¶
  CURRENT_DATE: '{{CURRENT_DATE}}',              // å½“å‰æ—¥æœŸ
  PROJECT_DESCRIPTION: '{{PROJECT_DESCRIPTION}}',// é¡¹ç›®æè¿°
  EXTRA_DOCS: '{{EXTRA_DOCS}}',                  // é¢å¤–æ–‡æ¡£é“¾æ¥
  CRITICAL_RULES_EXTRA: '{{CRITICAL_RULES_EXTRA}}'// é¢å¤–CRITICALè§„èŒƒ
};
```

**å ä½ç¬¦è®¡ç®—** ([lib/generator.js:458-481](lib/generator.js#L458-L481)):

```javascript
_buildReplacements(targetPath) {
  const normalizedPath = normalizePathForMarkdown(targetPath);

  return {
    '{{PROJECT_PATH}}': normalizedPath,
    '{{PROJECT_NAME}}': this.metadata.projectName,
    '{{CURRENT_DATE}}': getCurrentDate(),
    '{{PROJECT_STATUS}}': 'ç”Ÿäº§å°±ç»ª (Production Ready)',
    '{{VERSION}}': VERSION,  // å·¥ä½œæµç‰ˆæœ¬å·
    '{{EXAMPLE_TASKS}}': this._generateExampleTasks(),
    '{{LOG_FILES}}': this._generateLogFiles(targetPath),
    '{{ARCHITECTURE_DOCS_SECTION}}': this._generateArchitectureDocs(),
    '{{BUSINESS_DOCS_SECTION}}': this._generateBusinessDocs(),
    '{{PRESETS_DOCS_SECTION}}': this._generatePresetsDocs(),
    '{{NBT_CHECK_SECTION}}': this.metadata.businessType === 'RPG' ? this._generateNBTSection() : '',
    '{{CRITICAL_RULES}}': this._generateCriticalRulesSection(),
    '{{CRITICAL_RULES_EXTRA}}': this._generateCriticalRules(),
    '{{PROJECT_DESCRIPTION}}': `${this.metadata.businessType}ç±»å‹MODSDKé¡¹ç›®`,
    '{{EXTRA_DOCS}}': this._generateExtraDocs(),
    '{{QUICK_INDEX_EXTRA}}': '',  // å¿«é€Ÿç´¢å¼•æ‰©å±•ï¼ˆé¢„ç•™ï¼‰
    '{{SDK_DOC_PATH}}': 'D:\\EcWork\\netease-modsdk-wiki',
    '{{CORE_PATHS}}': this._generateCorePaths(normalizedPath)
  };
}
```

**åŠ¨æ€å†…å®¹ç”Ÿæˆ**ï¼ˆæ ¹æ®é¡¹ç›®ç±»å‹ï¼‰:

| å ä½ç¬¦ | RPGé¡¹ç›® | BedWarsé¡¹ç›® | é€šç”¨é¡¹ç›® |
|-------|---------|------------|---------|
| `{{EXAMPLE_TASKS}}` | æˆ˜æ–—ç³»ç»ŸBUGä¿®å¤<br/>è£…å¤‡å……èƒ½åŠŸèƒ½ | å•†åº—é¢„è®¾é”™è¯¯<br/>é˜Ÿä¼èŠå¤©åŠŸèƒ½ | Systemåˆå§‹åŒ–é”™è¯¯<br/>æ–°åŠŸèƒ½æ¨¡å— |
| `{{BUSINESS_DOCS_SECTION}}` | NEWRPGè¯¦ç»†æŠ€æœ¯æ–‡æ¡£ | Systemsæ–‡æ¡£ | Systemsæ–‡æ¡£ |
| `{{NBT_CHECK_SECTION}}` | NBTå…¼å®¹æ€§æ£€æŸ¥ | ï¼ˆç©ºï¼‰ | ï¼ˆç©ºï¼‰ |
| `{{ARCHITECTURE_DOCS}}` | Apolloæ¶æ„æ–‡æ¡£ | ï¼ˆå¦‚ä½¿ç”¨Apolloï¼‰ | ï¼ˆå¦‚ä½¿ç”¨Apolloï¼‰ |

---

#### 4.3.3 æ¨¡æ¿è·¯å¾„æ˜ å°„

**æ˜ å°„å‡½æ•°** ([lib/config.js:110-137](lib/config.js#L110-L137)):

```javascript
function getTemplatePath(templateName, projectType = 'General') {
  if (templateName === 'CLAUDE.md') {
    return path.join(TEMPLATES_DIR, 'CLAUDE.md.template');
  }
  // v17.1: 6ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼ˆç»Ÿä¸€/mcå‰ç¼€ï¼‰
  else if (templateName === 'mc.md') {
    return path.join(TEMPLATES_DIR, '.claude', 'commands', 'mc.md.template');
  } else if (templateName === 'mc-review.md') {
    return path.join(TEMPLATES_DIR, '.claude', 'commands', 'mc-review.md.template');
  } else if (templateName === 'mc-perf.md') {
    return path.join(TEMPLATES_DIR, '.claude', 'commands', 'mc-perf.md.template');
  } else if (templateName === 'mc-docs.md') {
    return path.join(TEMPLATES_DIR, '.claude', 'commands', 'mc-docs.md.template');
  } else if (templateName === 'mc-why.md') {
    return path.join(TEMPLATES_DIR, '.claude', 'commands', 'mc-why.md.template');
  } else if (templateName === 'mc-discover.md') {
    return path.join(TEMPLATES_DIR, '.claude', 'commands', 'mc-discover.md.template');
  }
  // å…¶ä»–æ¨¡æ¿
  else if (templateName === 'README.md') {
    return path.join(TEMPLATES_DIR, 'README.md.template');
  } else if (templateName === 'markdown/README.md') {
    // v16.0: markdownç›®å½•å¯¼èˆªæ–‡æ¡£
    return path.join(TEMPLATES_DIR, 'markdown', 'README.md.template');
  } else {
    return path.join(TEMPLATES_DIR, templateName);
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:

```javascript
// ç”ŸæˆCLAUDE.md
this._generateFromTemplate('CLAUDE.md', targetPath, 'CLAUDE.md', replacements);

// ç”Ÿæˆ/mcå‘½ä»¤
this._generateFromTemplate('mc.md', targetPath, '.claude/commands/mc.md', replacements);

// ç”Ÿæˆæ–‡æ¡£å¯¼èˆª
this._generateFromTemplate('markdown/README.md', targetPath, 'markdown/README.md', replacements);
```

---

### 4.4 å…¨å±€å®‰è£…æœºåˆ¶ï¼ˆWindowsæ”¯æŒï¼‰

#### 4.4.1 å®‰è£…æµç¨‹

**æ ¸å¿ƒè„šæœ¬**: [bin/install-global.js](bin/install-global.js)

**å®‰è£…æ­¥éª¤**:

```
1. å¤åˆ¶å·¥ä½œæµæ–‡ä»¶åˆ° ~/.claude-modsdk-workflow/
   â”œâ”€ lib/           æ ¸å¿ƒç”Ÿæˆå™¨ï¼ˆ22ä¸ªæ¨¡å—ï¼‰
   â”œâ”€ bin/           CLIå·¥å…·ï¼ˆ7ä¸ªè„šæœ¬ï¼‰
   â”œâ”€ markdown/      å·¥ä½œæµçŸ¥è¯†åº“ï¼ˆ80+ æ–‡ä»¶ï¼‰
   â”œâ”€ templates/     é¡¹ç›®æ¨¡æ¿ï¼ˆ12ä¸ªæ–‡ä»¶ï¼‰
   â”œâ”€ docs/          å®˜æ–¹æ–‡æ¡£ï¼ˆGit Submoduleï¼‰
   â””â”€ package.json   é¡¹ç›®é…ç½®

2. ç”Ÿæˆè·¨å¹³å°å¯åŠ¨è„šæœ¬
   Windows: initmc.cmd, initmc.ps1
   Linux/Mac: initmc (Bashè„šæœ¬)

3. æ·»åŠ åˆ°ç³»ç»ŸPATH
   Windows: ç”¨æˆ·ç¯å¢ƒå˜é‡ + æ³¨å†Œè¡¨ï¼ˆå¯é€‰ï¼‰
   Linux/Mac: ~/.bashrc æˆ– ~/.zshrc

4. éªŒè¯å®‰è£…
   æ‰§è¡Œ: where initmc (Windows) æˆ– which initmc (Linux/Mac)
```

**å®‰è£…å‘½ä»¤**:

```bash
# åœ¨å·¥ä½œæµç›®å½•æ‰§è¡Œ
npm run install-global

# éªŒè¯å®‰è£…
where initmc  # Windows
which initmc  # Linux/Mac

# æµ‹è¯•åŠŸèƒ½
initmc --version
```

---

#### 4.4.2 è·¨å¹³å°è„šæœ¬ç”Ÿæˆ

**Windows CMDè„šæœ¬** (`initmc.cmd`):

```batch
@echo off
:: NeteaseMod-Claude Workflow - initmc å‘½ä»¤
:: å…¨å±€å®‰è£…ç‰ˆæœ¬
setlocal enabledelayedexpansion

:: è®¾ç½®å·¥ä½œæµç›®å½•
set "WORKFLOW_HOME=%USERPROFILE%\.claude-modsdk-workflow"

:: æ£€æŸ¥Node.js
where node >nul 2>nul
if %errorlevel% neq 0 (
    echo é”™è¯¯: æœªæ‰¾åˆ° Node.js
    echo è¯·å…ˆå®‰è£… Node.js: https://nodejs.org/
    exit /b 1
)

:: æ‰§è¡Œinitmc
node "%WORKFLOW_HOME%\bin\initmc.js" %*
```

**Windows PowerShellè„šæœ¬** (`initmc.ps1`):

```powershell
# NeteaseMod-Claude Workflow - initmc å‘½ä»¤
# å…¨å±€å®‰è£…ç‰ˆæœ¬

$WorkflowHome = Join-Path $env:USERPROFILE ".claude-modsdk-workflow"

# æ£€æŸ¥Node.js
if (!(Get-Command node -ErrorAction SilentlyContinue)) {
    Write-Error "æœªæ‰¾åˆ° Node.js"
    Write-Host "è¯·å…ˆå®‰è£… Node.js: https://nodejs.org/"
    exit 1
}

# æ‰§è¡Œinitmc
& node (Join-Path $WorkflowHome "bin\initmc.js") $args
```

**Linux/Mac Bashè„šæœ¬** (`initmc`):

```bash
#!/usr/bin/env bash
# NeteaseMod-Claude Workflow - initmc å‘½ä»¤
# å…¨å±€å®‰è£…ç‰ˆæœ¬

WORKFLOW_HOME="$HOME/.claude-modsdk-workflow"

# æ£€æŸ¥Node.js
if ! command -v node &> /dev/null; then
    echo "é”™è¯¯: æœªæ‰¾åˆ° Node.js"
    echo "è¯·å…ˆå®‰è£… Node.js: https://nodejs.org/"
    exit 1
fi

# æ‰§è¡Œinitmc
node "$WORKFLOW_HOME/bin/initmc.js" "$@"
```

---

#### 4.4.3 éªŒè¯æ–¹æ³•

**éªŒè¯è„šæœ¬** ([bin/install-global.js](bin/install-global.js) å†…ç½®):

```javascript
// éªŒè¯å®‰è£…
console.log('éªŒè¯å®‰è£…...\n');

// 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
const requiredFiles = [
  'lib/generator.js',
  'lib/symlink-manager.js',
  'lib/config.js',
  'bin/initmc.js',
  'markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md',
  'templates/CLAUDE.md.template'
];

for (const file of requiredFiles) {
  const filePath = path.join(GLOBAL_WORKFLOW_HOME, file);
  if (!fs.existsSync(filePath)) {
    console.error(`âŒ ç¼ºå°‘æ–‡ä»¶: ${file}`);
    hasError = true;
  } else {
    console.log(`âœ… ${file}`);
  }
}

// 2. æ£€æŸ¥å‘½ä»¤æ˜¯å¦å¯ç”¨
console.log('\næµ‹è¯•å‘½ä»¤...\n');
const testCommand = process.platform === 'win32' ? 'where initmc' : 'which initmc';
const { stdout, stderr } = execSync(testCommand, { encoding: 'utf-8' });

if (stdout.trim()) {
  console.log(`âœ… initmc å‘½ä»¤å·²æ³¨å†Œ: ${stdout.trim()}`);
} else {
  console.error('âŒ initmc å‘½ä»¤æœªæ‰¾åˆ°');
  hasError = true;
}

// 3. æ£€æŸ¥ç‰ˆæœ¬
console.log('\néªŒè¯ç‰ˆæœ¬...\n');
const { stdout: versionOutput } = execSync('initmc --version', { encoding: 'utf-8' });
console.log(`âœ… ${versionOutput.trim()}`);
```

**æ‰‹åŠ¨éªŒè¯æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥å…¨å±€ç›®å½•
ls ~/.claude-modsdk-workflow  # Linux/Mac
dir %USERPROFILE%\.claude-modsdk-workflow  # Windows

# 2. æ£€æŸ¥å‘½ä»¤å¯ç”¨æ€§
which initmc  # åº”è¾“å‡ºè„šæœ¬è·¯å¾„
where initmc  # Windows

# 3. æµ‹è¯•åŠŸèƒ½
initmc --version  # åº”è¾“å‡ºç‰ˆæœ¬å·
initmc --help     # åº”è¾“å‡ºå¸®åŠ©ä¿¡æ¯

# 4. æµ‹è¯•åˆå§‹åŒ–ï¼ˆåœ¨æµ‹è¯•é¡¹ç›®ï¼‰
cd /path/to/test-project
initmc  # åº”æˆåŠŸç”Ÿæˆå·¥ä½œæµæ–‡ä»¶
```

---

### 4.5 é¡¹ç›®åˆ†æå™¨ï¼ˆlib/analyzer.jsï¼‰

#### 4.5.1 åˆ†ææµç¨‹ï¼ˆ5æ­¥ï¼‰

**æ ¸å¿ƒç±»**: `ProjectAnalyzer` ([lib/analyzer.js](lib/analyzer.js))

**å®Œæ•´åˆ†ææµç¨‹**:

```mermaid
graph TD
    Start[å¼€å§‹åˆ†æ] --> Step1[æ­¥éª¤1: æ£€æµ‹é¡¹ç›®ç±»å‹]

    Step1 --> Detect1[æŸ¥æ‰¾ modMain.py]
    Detect1 --> Detect2{æ‰¾åˆ°?}
    Detect2 -->|æ˜¯| SetModMain[è®¾ç½® modMainPath]
    Detect2 -->|å¦| Detect3[æ£€æµ‹ behavior_packs/]
    Detect3 --> Detect4[æ£€æµ‹ deploy.json<br/>Apolloç‰¹å¾]

    SetModMain --> Step2[æ­¥éª¤2: æ‰«æä»£ç ç»“æ„]
    Detect4 --> Step2

    Step2 --> Scan1[éå†æ‰€æœ‰.pyæ–‡ä»¶]
    Scan1 --> Scan2[æ­£åˆ™åŒ¹é…Systemç±»]
    Scan2 --> Scan3[æ­£åˆ™åŒ¹é…Presetç±»]
    Scan3 --> Scan4[è®¡ç®—å¤æ‚åº¦è¯„åˆ†]

    Scan4 --> Step25[æ­¥éª¤2.5: è‡ªé€‚åº”ç»“æ„å‘ç°<br/>ProjectDiscovery]

    Step25 --> Discover1[æ‰«æè‡ªå®šä¹‰ç»„ä»¶ç›®å½•]
    Discover1 --> Discover2[æ‰«æé…ç½®æ–‡ä»¶]
    Discover2 --> Discover3[åˆå¹¶åˆ°codeStructure]

    Discover3 --> Step3[æ­¥éª¤3: æ£€æŸ¥ç°æœ‰æ–‡æ¡£]

    Step3 --> Doc1[æ‰«æmarkdown/ç›®å½•]
    Doc1 --> Doc2[ç»Ÿè®¡ç°æœ‰.mdæ–‡ä»¶]

    Doc2 --> Step4[æ­¥éª¤4: è®¡ç®—é¡¹ç›®è§„æ¨¡]

    Step4 --> Scale{Systemsæ•°é‡?}
    Scale -->|â‰¤10| ScaleSmall[è§„æ¨¡: small]
    Scale -->|11-30| ScaleMedium[è§„æ¨¡: medium]
    Scale -->|>30| ScaleLarge[è§„æ¨¡: large]

    ScaleSmall --> Step5[æ­¥éª¤5: ç”Ÿæˆåˆ†ææŠ¥å‘Š]
    ScaleMedium --> Step5
    ScaleLarge --> Step5

    Step5 --> Report[AnalysisReport<br/>metadata + codeStructure + docCoverage]

    Report --> End[åˆ†æå®Œæˆ]

    style Step1 fill:#4caf50,color:#fff
    style Step2 fill:#2196f3,color:#fff
    style Step25 fill:#ff9800,color:#fff
    style Step3 fill:#9c27b0,color:#fff
    style Step4 fill:#f44336,color:#fff
```

**æ ¸å¿ƒä»£ç ** ([lib/analyzer.js:33-54](lib/analyzer.js#L33-L54)):

```javascript
analyze() {
  console.log('[åˆ†æå™¨] å¼€å§‹åˆ†æé¡¹ç›®...');
  console.log(`[åˆ†æå™¨] é¡¹ç›®è·¯å¾„: ${this.projectPath}`);

  // æ­¥éª¤1: æ£€æµ‹é¡¹ç›®ç±»å‹
  this._detectProjectType();

  // æ­¥éª¤2: æ‰«æä»£ç ç»“æ„ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼Œä¿ç•™å‘åå…¼å®¹ï¼‰
  this._scanCodeStructure();

  // â­ æ­¥éª¤2.5: è‡ªé€‚åº”é¡¹ç›®ç»“æ„å‘ç°ï¼ˆæ–°å¢ï¼‰
  this._discoverProjectStructure();

  // æ­¥éª¤3: æ£€æŸ¥ç°æœ‰æ–‡æ¡£
  this._checkDocumentation();

  // æ­¥éª¤4: è®¡ç®—é¡¹ç›®è§„æ¨¡
  this._calculateProjectScale();

  console.log('[åˆ†æå™¨] åˆ†æå®Œæˆ');
  return this.generateReport();
}
```

---

#### 4.5.2 ä»£ç è¯†åˆ«è§„åˆ™ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰

**Systemç±»è¯†åˆ«** ([lib/analyzer.js:160-166](lib/analyzer.js#L160-L166)):

```javascript
// æ£€æµ‹Systemç±»
const systemPattern = /class\s+(\w+)\s*\(\s*(ServerSystem|ClientSystem)\s*\)/g;
let match;
while ((match = systemPattern.exec(content)) !== null) {
  const [, className, baseClass] = match;
  this.codeStructure.addSystem(className, filePath, baseClass, content);
}
```

**åŒ¹é…ç¤ºä¾‹**:

```python
# âœ… åŒ¹é…æˆåŠŸ
class ShopServerSystem(ServerSystem):  # â†’ className="ShopServerSystem", baseClass="ServerSystem"
class PlayerClientSystem(ClientSystem):  # â†’ className="PlayerClientSystem", baseClass="ClientSystem"

# âŒ ä¸åŒ¹é…
class ShopSystem:  # ç¼ºå°‘åŸºç±»
class MySystem(object):  # åŸºç±»ä¸æ˜¯ServerSystem/ClientSystem
```

**Presetç±»è¯†åˆ«** ([lib/analyzer.js:168-173](lib/analyzer.js#L168-L173)):

```javascript
// æ£€æµ‹Presetç±»
const presetPattern = /class\s+(\w+)\s*\(\s*ECPresetDefinition\s*\)/g;
while ((match = presetPattern.exec(content)) !== null) {
  const [, className] = match;
  this.codeStructure.addPreset(className, filePath, content);
}
```

**åŒ¹é…ç¤ºä¾‹**:

```python
# âœ… åŒ¹é…æˆåŠŸ
class ShopPreset(ECPresetDefinition):  # â†’ className="ShopPreset"
class WeaponPreset(ECPresetDefinition):  # â†’ className="WeaponPreset"

# âŒ ä¸åŒ¹é…
class ShopPreset(BasePreset):  # åŸºç±»ä¸æ˜¯ECPresetDefinition
class ShopPreset:  # ç¼ºå°‘åŸºç±»
```

---

#### 4.5.3 å¤æ‚åº¦è¯„åˆ†ç®—æ³•

**è¯„åˆ†ç»´åº¦**ï¼ˆå‚è€ƒ Pythonç‰ˆæœ¬ `analyzer.py`ï¼‰:

| ç»´åº¦ | æƒé‡ | è®¡ç®—å…¬å¼ | è¯´æ˜ |
|------|------|---------|------|
| **ä»£ç è¡Œæ•°** | 30% | `min(linesOfCode / 100, 3)` | æœ€é«˜3åˆ† |
| **æ–¹æ³•æ•°é‡** | 25% | `min(methodCount / 10, 2.5)` | æœ€é«˜2.5åˆ† |
| **å¤æ‚åº¦** | 20% | `min(cyclomaticComplexity / 20, 2)` | æœ€é«˜2åˆ† |
| **ä¾èµ–å…³ç³»** | 15% | `min(dependencies / 5, 1.5)` | æœ€é«˜1.5åˆ† |
| **äº‹ä»¶ç›‘å¬** | 10% | `min(eventListeners / 5, 1)` | æœ€é«˜1åˆ† |

**æ€»åˆ†è®¡ç®—**:

```
ComplexityScore = (ä»£ç è¡Œæ•°å¾—åˆ† * 0.3) +
                  (æ–¹æ³•æ•°é‡å¾—åˆ† * 0.25) +
                  (åœˆå¤æ‚åº¦å¾—åˆ† * 0.2) +
                  (ä¾èµ–å…³ç³»å¾—åˆ† * 0.15) +
                  (äº‹ä»¶ç›‘å¬å¾—åˆ† * 0.1)

æœ€ç»ˆå¾—åˆ† = min(ComplexityScore, 10.0)
```

**è¯¦ç»†åº¦æ¨è**:

- **score â‰¥ 8**: `detailed` - å¤æ‚Systemï¼Œç”Ÿæˆè¯¦ç»†æ–‡æ¡£ï¼ˆ~3000å­—ï¼‰
- **5 â‰¤ score < 8**: `medium` - ä¸­ç­‰Systemï¼Œç”Ÿæˆä¸­ç­‰æ–‡æ¡£ï¼ˆ~1500å­—ï¼‰
- **score < 5**: `simple` - ç®€å•Systemï¼Œç”Ÿæˆç®€æ´æ–‡æ¡£ï¼ˆ~500å­—ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼ˆç®€åŒ–ç‰ˆï¼‰:

```javascript
class SystemInfo {
  constructor(name, filePath, type, content) {
    this.name = name;
    this.filePath = filePath;
    this.type = type;
    this.content = content;
    this.linesOfCode = content.split('\n').length;
    this.methodCount = (content.match(/def\s+\w+\s*\(/g) || []).length;
    this.eventListeners = (content.match(/ListenForEvent/g) || []).length;
    this.dependencies = this._extractDependencies(content).length;
    this.complexityScore = this._calculateComplexity();
  }

  _calculateComplexity() {
    const locScore = Math.min(this.linesOfCode / 100, 3) * 0.3;
    const methodScore = Math.min(this.methodCount / 10, 2.5) * 0.25;
    const eventScore = Math.min(this.eventListeners / 5, 1) * 0.1;
    const depScore = Math.min(this.dependencies / 5, 1.5) * 0.15;

    // åœˆå¤æ‚åº¦ç®€åŒ–è®¡ç®—ï¼ˆåˆ†æ”¯æ•°é‡ï¼‰
    const branches = (this.content.match(/\b(if|elif|for|while|and|or)\b/g) || []).length;
    const cyclomaticScore = Math.min(branches / 20, 2) * 0.2;

    return Math.min(locScore + methodScore + eventScore + depScore + cyclomaticScore, 10.0);
  }

  getDetailLevel() {
    if (this.complexityScore >= 8) return 'detailed';
    if (this.complexityScore >= 5) return 'medium';
    return 'simple';
  }
}
```

---

#### 4.5.4 ä¸šåŠ¡ç±»å‹æ¨æ–­ç®—æ³•

**æ¨æ–­é€»è¾‘** ([lib/analyzer.js](lib/analyzer.js)):

```javascript
_inferBusinessType() {
  const allCode = this._collectAllCode();
  const lowerCode = allCode.toLowerCase();

  // å…³é”®è¯åŒ¹é…ï¼ˆåŠ æƒè¯„åˆ†ï¼‰
  const keywords = {
    RPG: ['rpg', 'combat', 'weapon', 'armor', 'skill', 'equipment', 'inventory', 'quest'],
    BedWars: ['bedwars', 'bed', 'generator', 'team', 'forge', 'shop'],
    PVP: ['pvp', 'arena', 'duel', 'match'],
    Survival: ['survival', 'hunger', 'thirst']
  };

  const scores = {};
  for (const [type, typeKeywords] of Object.entries(keywords)) {
    scores[type] = 0;
    for (const keyword of typeKeywords) {
      // è®¡ç®—å…³é”®è¯å‡ºç°æ¬¡æ•°
      const matches = (lowerCode.match(new RegExp(keyword, 'g')) || []).length;
      scores[type] += matches;
    }
  }

  // é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç±»å‹
  const maxType = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b);

  // å¾—åˆ†å¤ªä½æ—¶è¿”å›Generic
  if (scores[maxType] < 3) {
    return 'Generic';
  }

  return maxType;
}
```

**æ¨æ–­ç¤ºä¾‹**:

```
ä»£ç ä¸­åŒ…å«å…³é”®è¯:
- "rpg": 5æ¬¡
- "combat": 8æ¬¡
- "weapon": 12æ¬¡
- "armor": 7æ¬¡
- "skill": 6æ¬¡
â†’ RPGå¾—åˆ† = 5+8+12+7+6 = 38
â†’ å…¶ä»–ç±»å‹å¾—åˆ† < 5
â†’ æ¨æ–­ç»“æœ: RPG
```

---

#### 4.5.5 Apollo/ECPreset æ£€æµ‹

**Apolloæ£€æµ‹** ([lib/analyzer.js:274-295](lib/analyzer.js#L274-L295)):

```javascript
_detectApollo(detectionResult = {}) {
  // æ–¹å¼1: æ£€æŸ¥ modMain.py å†…å®¹
  if (this.metadata.modMainPath) {
    const content = readFile(this.metadata.modMainPath);
    if (content.toLowerCase().includes('apollo')) {
      return true;
    }
  }

  // æ–¹å¼2: æ£€æŸ¥ deploy.json
  const deployJsonPath = path.join(this.projectPath, 'deploy.json');
  if (fs.existsSync(deployJsonPath)) {
    return true;
  }

  // æ–¹å¼3: ä»æ£€æµ‹ç»“æœæ¨æ–­
  if (detectionResult.projectType === 'apollo') {
    return true;
  }

  return false;
}
```

**ECPresetæ£€æµ‹**:

```javascript
_detectEcpreset() {
  // æ£€æŸ¥æ˜¯å¦æœ‰ECPresetDefinitionç±»
  return Object.keys(this.codeStructure.presets).length > 0;
}
```

---

#### 4.5.6 è‡ªé€‚åº”ç»“æ„å‘ç°ï¼ˆProjectDiscoveryï¼‰

**æ ¸å¿ƒç±»**: `ProjectDiscovery` (lib/project-discovery.js)

**å‘ç°ç›®æ ‡**:
1. **è‡ªå®šä¹‰ç»„ä»¶ç›®å½•**: `components/`, `modules/`, `plugins/` ç­‰
2. **é…ç½®æ–‡ä»¶ç›®å½•**: `configs/`, `settings/`, `data/` ç­‰
3. **ä¸šåŠ¡é€»è¾‘ç›®å½•**: `business/`, `gameplay/`, `managers/` ç­‰

**å‘ç°æµç¨‹**:

```mermaid
graph TD
    Start[å¼€å§‹å‘ç°] --> Scan1[æ‰«æé¡¹ç›®ç›®å½•]
    Scan1 --> Pattern1[åŒ¹é…è‡ªå®šä¹‰ç»„ä»¶æ¨¡å¼<br/>components/, modules/]
    Scan1 --> Pattern2[åŒ¹é…é…ç½®æ–‡ä»¶æ¨¡å¼<br/>configs/, data/]
    Scan1 --> Pattern3[åŒ¹é…ä¸šåŠ¡é€»è¾‘æ¨¡å¼<br/>business/, gameplay/]

    Pattern1 --> Analyze1[åˆ†æç›®å½•å†…å®¹]
    Pattern2 --> Analyze2[åˆ†ææ–‡ä»¶ç±»å‹]
    Pattern3 --> Analyze3[åˆ†æä»£ç ç»“æ„]

    Analyze1 --> Merge[åˆå¹¶å‘ç°ç»“æœ]
    Analyze2 --> Merge
    Analyze3 --> Merge

    Merge --> Result[discoveredStructure<br/>customComponents + configFiles]

    style Start fill:#4caf50,color:#fff
    style Result fill:#2196f3,color:#fff
```

**ä½¿ç”¨ç¤ºä¾‹**:

```javascript
// åœ¨ProjectAnalyzerä¸­è°ƒç”¨
_discoverProjectStructure() {
  console.log('[åˆ†æå™¨] æ‰§è¡Œè‡ªé€‚åº”ç»“æ„å‘ç°...');

  const discovery = new ProjectDiscovery(this.projectPath);
  this.discoveredStructure = discovery.discover();

  // åˆå¹¶å‘ç°çš„ç»„ä»¶åˆ° codeStructure
  this._mergeDiscoveredComponents();
}

_mergeDiscoveredComponents() {
  const customCount = Object.keys(this.discoveredStructure.customComponents).length;
  const configCount = Object.keys(this.discoveredStructure.configFiles).length;

  console.log(`[åˆ†æå™¨] å‘ç° ${customCount} ä¸ªè‡ªå®šä¹‰ç»„ä»¶ç›®å½•`);
  console.log(`[åˆ†æå™¨] å‘ç° ${configCount} ä¸ªé…ç½®æ–‡ä»¶ç›®å½•`);

  // å­˜å‚¨åˆ° codeStructure
  if (!this.codeStructure.discoveredComponents) {
    this.codeStructure.discoveredComponents = this.discoveredStructure;
  }
}
```

---

## ğŸ”§ ç¬¬äº”ç« ï¼šé…ç½®ç³»ç»Ÿè¯¦è§£ï¼ˆlib/config.jsï¼‰

### 5.1 è·¯å¾„é…ç½®

**å…¨å±€å®‰è£…è·¯å¾„** ([lib/config.js:10-17](lib/config.js#L10-L17)):

```javascript
// å…¨å±€å®‰è£…è·¯å¾„
const GLOBAL_WORKFLOW_HOME = path.join(os.homedir(), '.claude-modsdk-workflow');

// æœ¬åœ°å¼€å‘è·¯å¾„ï¼ˆlibç›®å½•çš„ä¸Šä¸€çº§ï¼‰
const LOCAL_WORKFLOW_HOME = path.resolve(__dirname, '..');

// æ™ºèƒ½é€‰æ‹©å·¥ä½œç›®å½•ï¼šä¼˜å…ˆä½¿ç”¨å…¨å±€ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨æœ¬åœ°å¼€å‘ç›®å½•
const WORKFLOW_HOME = fs.existsSync(GLOBAL_WORKFLOW_HOME)
  ? GLOBAL_WORKFLOW_HOME
  : LOCAL_WORKFLOW_HOME;
```

**è·¯å¾„ä¼˜å…ˆçº§**:

```
1. å…¨å±€ç›®å½•ï¼ˆä¼˜å…ˆï¼‰: ~/.claude-modsdk-workflow/
   - Windows: C:\Users\YourName\.claude-modsdk-workflow\
   - Linux/Mac: ~/.claude-modsdk-workflow/
   - ä½¿ç”¨åœºæ™¯: npm run install-global å

2. æœ¬åœ°å¼€å‘ç›®å½•ï¼ˆé™çº§ï¼‰: D:\EcWork\åŸºäºClaudeçš„MODSDKå¼€å‘å·¥ä½œæµ\
   - ä½¿ç”¨åœºæ™¯: å¼€å‘è°ƒè¯•æ—¶
```

**èµ„æºç›®å½•** ([lib/config.js:19-22](lib/config.js#L19-L22)):

```javascript
const TEMPLATES_DIR = path.join(WORKFLOW_HOME, 'templates');
const RULES_LIBRARY_DIR = path.join(WORKFLOW_HOME, 'rules-library');
const DOC_TEMPLATES_DIR = path.join(WORKFLOW_HOME, 'doc-templates');
```

---

### 5.2 ç‰ˆæœ¬ç®¡ç†

**ç‰ˆæœ¬å·å®šä¹‰** ([lib/config.js:29](lib/config.js#L29)):

```javascript
const VERSION = '17.3.0';
```

**âš ï¸ ç‰ˆæœ¬å·åŒæ­¥è¦æ±‚**:

ä¿®æ”¹ç‰ˆæœ¬å·æ—¶**å¿…é¡»**åŒæ­¥æ›´æ–°ä»¥ä¸‹3ä¸ªä½ç½®ï¼š

1. [lib/config.js:29](lib/config.js#L29) - `const VERSION = '17.3.0';`
2. [package.json:3](package.json#L3) - `"version": "17.3.0"`
3. [CLAUDE.md:7](CLAUDE.md#L7) - æ–‡æ¡£é¡¶éƒ¨ç‰ˆæœ¬å£°æ˜

**ç›¸å…³é…ç½®**:

```javascript
// æ–‡æ¡£è¯¦ç»†åº¦é…ç½®
const DETAIL_LEVELS = {
  simple: {
    wordCount: 500,
    description: 'ç®€å•æ–‡æ¡£ï¼ˆç±»ç»“æ„ã€æ–¹æ³•åˆ—è¡¨ï¼‰'
  },
  medium: {
    wordCount: 1500,
    description: 'ä¸­ç­‰è¯¦ç»†åº¦ï¼ˆæ¶æ„ã€æ•°æ®æµã€APIï¼‰'
  },
  detailed: {
    wordCount: 3000,
    description: 'è¯¦ç»†æ–‡æ¡£ï¼ˆå®Œæ•´ä¸šåŠ¡é€»è¾‘ã€ç¤ºä¾‹ï¼‰'
  }
};

// å¤æ‚åº¦è¯„åˆ†é˜ˆå€¼
const COMPLEXITY_THRESHOLDS = {
  detailed: 8,   // score >= 8 â†’ detailed
  medium: 5      // score >= 5 â†’ medium, < 5 â†’ simple
};

// é¡¹ç›®è§„æ¨¡é˜ˆå€¼
const SCALE_THRESHOLDS = {
  small: 10,     // â‰¤10 Systems
  medium: 30     // 11-30 Systems, >30 â†’ large
};
```

---

### 5.3 å ä½ç¬¦å®šä¹‰ï¼ˆå®Œæ•´åˆ—è¡¨ï¼‰

è¯¦è§ [4.3.2 å ä½ç¬¦ç³»ç»Ÿ](#432-å ä½ç¬¦ç³»ç»Ÿ)

---

### 5.4 CRITICALè§„èŒƒæ˜ å°„

**è§„èŒƒæ˜ å°„è¡¨** ([lib/config.js:84-94](lib/config.js#L84-L94)):

```javascript
const CRITICAL_RULES_MAP = {
  general: [
    'Systemç”Ÿå‘½å‘¨æœŸ',
    'æ¨¡å—å¯¼å…¥è§„èŒƒ',
    'åŒç«¯éš”ç¦»',
    'Python2.7å…¼å®¹æ€§'
  ],
  apollo: ['Apollo1.0æ¶æ„'],
  ecpreset: ['ECPresetæ•°æ®å­˜å‚¨'],
  rpg: ['RPG-NBTå…¼å®¹æ€§']
};
```

**ä½¿ç”¨åœºæ™¯**:

æ ¹æ®é¡¹ç›®ç±»å‹åŠ¨æ€é€‰æ‹©éœ€è¦å¼ºè°ƒçš„CRITICALè§„èŒƒã€‚

**ç¤ºä¾‹**:

```javascript
// RPGé¡¹ç›® + Apolloæ¶æ„ + ECPreset
const applicableRules = [
  ...CRITICAL_RULES_MAP.general,  // é€šç”¨è§„èŒƒï¼ˆ4æ¡ï¼‰
  ...CRITICAL_RULES_MAP.apollo,   // Apolloè§„èŒƒï¼ˆ1æ¡ï¼‰
  ...CRITICAL_RULES_MAP.ecpreset, // ECPresetè§„èŒƒï¼ˆ1æ¡ï¼‰
  ...CRITICAL_RULES_MAP.rpg       // RPGè§„èŒƒï¼ˆ1æ¡ï¼‰
];
// æ€»å…±: 7æ¡CRITICALè§„èŒƒ
```

---

### 5.5 é¡¹ç›®ç±»å‹è¯†åˆ«å…³é”®è¯

**å…³é”®è¯å®šä¹‰** ([lib/config.js:97-102](lib/config.js#L97-L102)):

```javascript
const PROJECT_TYPE_KEYWORDS = {
  RPG: ['rpg', 'combat', 'weapon', 'armor', 'skill', 'equipment'],
  BedWars: ['bedwars', 'bed', 'generator', 'team'],
  PVP: ['pvp', 'arena', 'duel'],
  Survival: ['survival', 'hunger', 'thirst']
};
```

**ä½¿ç”¨åœºæ™¯**:

åœ¨ `ProjectAnalyzer._inferBusinessType()` ä¸­ï¼Œæ‰«æä»£ç æ–‡ä»¶ï¼Œç»Ÿè®¡å…³é”®è¯å‡ºç°æ¬¡æ•°ï¼Œé€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç±»å‹ã€‚

---

### 5.6 æ¨¡æ¿è·¯å¾„æ˜ å°„å‡½æ•°

è¯¦è§ [4.3.3 æ¨¡æ¿è·¯å¾„æ˜ å°„](#433-æ¨¡æ¿è·¯å¾„æ˜ å°„)

---

## ğŸ“š ç¬¬å…­ç« ï¼šæ–‡æ¡£ç”Ÿæˆå™¨æ·±åº¦è§£æ

### 6.1 ä¸‰å±‚ç”Ÿæˆæ¶æ„æµç¨‹å›¾

è¯¦è§ [4.2.1 Layer 1/2/3 ä¸‰å±‚æ¶æ„](#421-layer-123-ä¸‰å±‚æ¶æ„)

---

### 6.2 Layer 1: é€šç”¨å±‚å®ç°

è¯¦è§ [4.2.2 æ ¸å¿ƒæ–¹æ³•è¯¦è§£ - 1. _generateLayer1()](#1-_generatelayer1---é€šç”¨å±‚ç”Ÿæˆ)

---

### 6.3 Layer 2: æ¶æ„å±‚å®ç°

è¯¦è§ [4.2.2 æ ¸å¿ƒæ–¹æ³•è¯¦è§£ - 2. _generateLayer2()](#2-_generatelayer2---æ¶æ„å±‚ç”Ÿæˆ)

---

### 6.4 Layer 3: ä¸šåŠ¡å±‚å®ç°

**æ ¸å¿ƒæ–¹æ³•**: `_generateLayer3()` ([lib/generator.js:396-416](lib/generator.js#L396-L416))

**é€»è¾‘**:

```javascript
async _generateLayer3(targetPath) {
  console.log('[ç”Ÿæˆå™¨] ç”ŸæˆLayer 3ï¼ˆä¸šåŠ¡å±‚æ¡†æ¶ï¼‰...');

  const businessType = this.metadata.businessType;

  if (businessType === 'RPG') {
    // RPGé¡¹ç›®ï¼šåˆ›å»ºNEWRPGç›®å½•
    ensureDir(path.join(targetPath, 'markdown/NEWRPG'));
    writeFile(
      path.join(targetPath, 'markdown/NEWRPG/README.md'),
      '# NEWRPG ç³»ç»Ÿæ–‡æ¡£\n\nâš ï¸ **å¾…è¡¥å……**: AIå°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€æ­¥å®Œå–„ã€‚\n'
    );
  } else if (this.metadata.usesEcpreset) {
    // ECPreseté¡¹ç›®ï¼šåˆ›å»ºpresetsç›®å½•
    ensureDir(path.join(targetPath, 'markdown/presets'));
    writeFile(
      path.join(targetPath, 'markdown/presets/README.md'),
      '# Presets æ–‡æ¡£\n\nâš ï¸ **å¾…è¡¥å……**: AIå°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€æ­¥å®Œå–„ã€‚\n'
    );
  }

  console.log('[ç”Ÿæˆå™¨] Layer 3 æ¡†æ¶åˆ›å»ºå®Œæˆ âœ…');
}
```

**å†³ç­–é€»è¾‘**:

- **businessType === 'RPG'**: åˆ›å»º `markdown/NEWRPG/` ç›®å½•
- **usesEcpreset === true**: åˆ›å»º `markdown/presets/` ç›®å½•
- **å…¶ä»–**: ä¸åˆ›å»ºä¸šåŠ¡å±‚ç›®å½•ï¼Œä½¿ç”¨ `markdown/systems/` å³å¯

---

### 6.5 è´¨é‡è¯„ä¼°ç®—æ³•ï¼ˆ0-5åˆ†åˆ¶ï¼‰

è¯¦è§ [4.2.4 æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤ - è´¨é‡è¯„åˆ†ç®—æ³•](#421-æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤)

---

### 6.6 ç°æœ‰æ–‡æ¡£æ£€æµ‹ï¼ˆæ™ºèƒ½åŒ¹é…ï¼‰

è¯¦è§ [4.2.4 æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤ - ç°æœ‰æ–‡æ¡£æ£€æµ‹](#421-æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤)

---

## ğŸ”— ç¬¬ä¸ƒç« ï¼šè½¯è¿æ¥ç®¡ç†å™¨å®ç°

### 7.1 æ ¸å¿ƒç±»è®¾è®¡ï¼ˆSymlinkManagerï¼‰

**ç±»ç»“æ„**:

```javascript
class SymlinkManager {
  constructor(upstreamPath, downstreamPath) {
    this.upstreamPath = upstreamPath;           // ä¸Šæ¸¸å·¥ä½œæµè·¯å¾„
    this.downstreamPath = downstreamPath;       // ä¸‹æ¸¸é¡¹ç›®è·¯å¾„
    this.coreDocsPath = path.join(downstreamPath, '.claude', 'core-docs');
    this.markdownPath = path.join(downstreamPath, 'markdown');
  }

  // ä¸»å…¥å£æ–¹æ³•
  async createAllSymlinks() { ... }

  // åˆ›å»ºå•ä¸ªè½¯è¿æ¥
  async createSymlink(relativePath) { ... }

  // æ›´æ–°å·²æœ‰çš„è½¯è¿æ¥
  async updateSymlinks() { ... }

  // ç§æœ‰æ–¹æ³•
  async _tryCreateSymlink(targetPath, linkPath, relativePath) { ... }
  async _createReadonlyCopy(targetPath, linkPath, relativePath, isDirectory) { ... }
  _getCoreFiles() { ... }
  _addReadonlyHeader(filePath) { ... }
  _setReadonly(targetPath, isDirectory) { ... }
  _findMarkdownFiles(dir) { ... }
  _findAllFiles(dir) { ... }
  _printResults(results) { ... }
  _printUpdateResults(results) { ... }
}
```

---

### 7.2 createAllSymlinks() ä¸»æµç¨‹

è¯¦è§ [4.1.2 è½¯è¿æ¥ç®¡ç†å™¨å®ç° - 1. createAllSymlinks()](#1-createallsymlinks---ä¸»å…¥å£æ–¹æ³•)

---

### 7.3 _getCoreFiles() åŠ¨æ€æ‰«æ

è¯¦è§ [4.1.2 è½¯è¿æ¥ç®¡ç†å™¨å®ç° - 2. _getCoreFiles()](#2-_getcorefiles---åŠ¨æ€æ‰«ææ ¸å¿ƒæ–‡ä»¶)

---

### 7.4 è·¨å¹³å°åˆ›å»ºç­–ç•¥

è¯¦è§ [4.1.3 Windows è·¨å¹³å°æ”¯æŒ](#413-windows-è·¨å¹³å°æ”¯æŒ)

---

### 7.5 åªè¯»å‰¯æœ¬é™çº§æ–¹æ¡ˆ

è¯¦è§ [4.1.4 é™çº§ç­–ç•¥ï¼šåªè¯»å‰¯æœ¬æœºåˆ¶](#414-é™çº§ç­–ç•¥åªè¯»å‰¯æœ¬æœºåˆ¶)

---

### 7.6 æ™ºèƒ½é™çº§æµç¨‹å›¾

è¯¦è§ [4.1.3 Windows è·¨å¹³å°æ”¯æŒ - é™çº§æµç¨‹å›¾](#413-windows-è·¨å¹³å°æ”¯æŒ)

---

## ğŸ” ç¬¬å…«ç« ï¼šé¡¹ç›®åˆ†æå™¨å®ç°

> **æ ¸å¿ƒæ¨¡å—**: [lib/analyzer.js](lib/analyzer.js) (560è¡Œ)
>
> **èŒè´£**: è‡ªåŠ¨åˆ†æMODSDKé¡¹ç›®ç»“æ„ã€è¯„ä¼°ä»£ç å¤æ‚åº¦ã€ç”Ÿæˆåˆ†ææŠ¥å‘Š

### 8.1 å®Œæ•´åˆ†ææµç¨‹ï¼ˆ5æ­¥è¯¦è§£ï¼‰

é¡¹ç›®åˆ†æå™¨é€šè¿‡5ä¸ªæ­¥éª¤å®Œæ•´åˆ†æMODSDKé¡¹ç›®ï¼š

```mermaid
graph TD
    A[å¼€å§‹åˆ†æ] --> B[æ­¥éª¤1: æ£€æµ‹é¡¹ç›®ç±»å‹]
    B --> C[æ­¥éª¤2: æ‰«æä»£ç ç»“æ„]
    C --> D[æ­¥éª¤2.5: è‡ªé€‚åº”ç»“æ„å‘ç°â­]
    D --> E[æ­¥éª¤3: æ£€æŸ¥ç°æœ‰æ–‡æ¡£]
    E --> F[æ­¥éª¤4: è®¡ç®—é¡¹ç›®è§„æ¨¡]
    F --> G[ç”Ÿæˆåˆ†ææŠ¥å‘Š]

    B --> B1[æŸ¥æ‰¾modMain.py]
    B --> B2[æ£€æµ‹Apollo/ECPreset]
    B --> B3[æ¨æ–­ä¸šåŠ¡ç±»å‹]

    C --> C1[éå†Pythonæ–‡ä»¶]
    C --> C2[è¯†åˆ«Systemç±»]
    C --> C3[è¯†åˆ«Presetç±»]

    D --> D1[ProjectDiscoveryæ‰«æ]
    D --> D2[å‘ç°è‡ªå®šä¹‰ç»„ä»¶]
    D --> D3[åˆå¹¶åˆ°codeStructure]

    E --> E1[æ‰«æmarkdownç›®å½•]
    E --> E2[ç»Ÿè®¡ç°æœ‰æ–‡æ¡£]

    F --> F1[ç»Ÿè®¡Systemæ•°é‡]
    F --> F2[åˆ¤æ–­è§„æ¨¡ç­‰çº§]

    style D fill:#ff9800,color:#fff
    style D1 fill:#ff9800,color:#fff
```

---

#### 8.1.1 æ­¥éª¤1: æ£€æµ‹é¡¹ç›®ç±»å‹

**æ ¸å¿ƒæ–¹æ³•**: `_detectProjectType()` ([lib/analyzer.js:90-127](lib/analyzer.js#L90-L127))

**æ£€æµ‹æ–¹å¼**ï¼ˆå¤šç§æ–¹å¼é™çº§ï¼‰:

```javascript
// æ–¹å¼1: æŸ¥æ‰¾modMain.pyï¼ˆæ ‡å‡†MODSDKé¡¹ç›®ï¼‰
const modMainPath = findFile(this.projectPath, 'modMain.py');
if (modMainPath) {
  result.modMainPath = modMainPath;
  result.projectType = 'standard';
  return result;
}

// æ–¹å¼2: behavior_packs/ï¼ˆç½‘æ˜“åœ°å›¾ï¼‰
const behaviorPacksPath = path.join(this.projectPath, 'behavior_packs');
if (fs.existsSync(behaviorPacksPath)) {
  result.projectType = 'netease-map';
  result.hints.push('behavior_packs/');
}

// æ–¹å¼3: deploy.jsonï¼ˆApolloï¼‰
const deployJsonPath = path.join(this.projectPath, 'deploy.json');
if (fs.existsSync(deployJsonPath)) {
  result.projectType = 'apollo';
  result.hints.push('deploy.json');
}

// æ–¹å¼4: .mcs/ï¼ˆç½‘æ˜“å¼€å‘å·¥å…·ï¼‰
const mcsPath = path.join(this.projectPath, '.mcs');
if (fs.existsSync(mcsPath)) {
  result.hints.push('.mcs/');
}
```

**æ£€æµ‹Apolloæ¶æ„**:

æ ¸å¿ƒæ–¹æ³•: `_detectApollo()` ([lib/analyzer.js:274-295](lib/analyzer.js#L274-L295))

```javascript
// æ–¹å¼1: æ£€æŸ¥modMain.pyå†…å®¹
if (this.metadata.modMainPath) {
  const content = readFile(this.metadata.modMainPath);
  if (content.toLowerCase().includes('apollo')) {
    return true;
  }
}

// æ–¹å¼2: æ£€æŸ¥deploy.json
if (fs.existsSync(path.join(this.projectPath, 'deploy.json'))) {
  return true;
}
```

---

#### 8.1.2 æ­¥éª¤2: æ‰«æä»£ç ç»“æ„

**æ ¸å¿ƒæ–¹æ³•**: `_scanCodeStructure()` ([lib/analyzer.js:132-151](lib/analyzer.js#L132-L151))

**æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«**:

```javascript
// è¯†åˆ«Systemç±»ï¼ˆServerSystem/ClientSystemï¼‰
const systemPattern = /class\s+(\w+)\s*\(\s*(ServerSystem|ClientSystem)\s*\)/g;
while ((match = systemPattern.exec(content)) !== null) {
  const [, className, baseClass] = match;
  this.codeStructure.addSystem(className, filePath, baseClass, content);
}

// è¯†åˆ«Presetç±»ï¼ˆECPresetDefinitionï¼‰
const presetPattern = /class\s+(\w+)\s*\(\s*ECPresetDefinition\s*\)/g;
while ((match = presetPattern.exec(content)) !== null) {
  const [, className] = match;
  this.codeStructure.addPreset(className, filePath, content);
}
```

**Systemä¿¡æ¯æå–** ([lib/analyzer.js:363-437](lib/analyzer.js#L363-L437)):

```javascript
class SystemInfo {
  constructor(name, filePath, type, content) {
    this.name = name;
    this.filePath = filePath;
    this.type = type; // ServerSystem / ClientSystem
    this.content = content;

    // åˆ†æä»£ç ç‰¹å¾
    this.linesOfCode = content.split('\n').length;
    this.methodCount = (content.match(/def\s+\w+\s*\(/g) || []).length;
    this.eventListeners = (content.match(/ListenForEvent/g) || []).length;

    // è®¡ç®—å¤æ‚åº¦åˆ†æ•°
    this.complexityScore = this._calculateComplexity();
  }
}
```

---

#### 8.1.3 æ­¥éª¤2.5: è‡ªé€‚åº”ç»“æ„å‘ç°ï¼ˆv2.0æ–°å¢ï¼‰â­

**æ ¸å¿ƒæ–¹æ³•**: `_discoverProjectStructure()` ([lib/analyzer.js:59-67](lib/analyzer.js#L59-L67))

**ä¸ºä»€ä¹ˆéœ€è¦**:
- ä¼ ç»Ÿæ‰«æåªè¯†åˆ«æ ‡å‡†System/Preset
- æ— æ³•å‘ç°è‡ªå®šä¹‰ç»„ä»¶ç›®å½•ï¼ˆå¦‚ `scripts/utils/`, `common/`ï¼‰
- æ— æ³•è¯†åˆ«é…ç½®æ–‡ä»¶ç›®å½•ï¼ˆå¦‚ `configs/`, `data/`ï¼‰

**å®ç°æ–¹å¼**:

```javascript
_discoverProjectStructure() {
  console.log('[åˆ†æå™¨] æ‰§è¡Œè‡ªé€‚åº”ç»“æ„å‘ç°...');

  const discovery = new ProjectDiscovery(this.projectPath);
  this.discoveredStructure = discovery.discover();

  // åˆå¹¶å‘ç°çš„ç»„ä»¶åˆ° codeStructure
  this._mergeDiscoveredComponents();
}

_mergeDiscoveredComponents() {
  const customCount = Object.keys(this.discoveredStructure.customComponents).length;
  const configCount = Object.keys(this.discoveredStructure.configFiles).length;

  console.log(`[åˆ†æå™¨] å‘ç° ${customCount} ä¸ªè‡ªå®šä¹‰ç»„ä»¶ç›®å½•`);
  console.log(`[åˆ†æå™¨] å‘ç° ${configCount} ä¸ªé…ç½®æ–‡ä»¶ç›®å½•`);

  // å°†å‘ç°çš„ç»„ä»¶ä¿¡æ¯å­˜å‚¨åˆ° codeStructure
  if (!this.codeStructure.discoveredComponents) {
    this.codeStructure.discoveredComponents = this.discoveredStructure;
  }
}
```

**ProjectDiscoveryæ¨¡å—** ([lib/project-discovery.js](lib/project-discovery.js)):

è¯¦è§ [4.5.5 è‡ªé€‚åº”ç»„ä»¶å‘ç°ï¼ˆProjectDiscoveryï¼‰](#455-è‡ªé€‚åº”ç»„ä»¶å‘ç°projectdiscovery)

---

#### 8.1.4 æ­¥éª¤3: æ£€æŸ¥ç°æœ‰æ–‡æ¡£

**æ ¸å¿ƒæ–¹æ³•**: `_checkDocumentation()` ([lib/analyzer.js:179-196](lib/analyzer.js#L179-L196))

```javascript
_checkDocumentation() {
  console.log('[åˆ†æå™¨] æ£€æŸ¥ç°æœ‰æ–‡æ¡£...');

  const markdownDir = path.join(this.projectPath, 'markdown');
  if (!fs.existsSync(markdownDir)) {
    console.log('[åˆ†æå™¨] markdown/ç›®å½•ä¸å­˜åœ¨');
    return;
  }

  walkDir(markdownDir, (filePath) => {
    if (filePath.endsWith('.md')) {
      this.docCoverage.addExistingDoc(filePath);
    }
  });

  console.log(`[åˆ†æå™¨] å‘ç° ${this.docCoverage.existingDocs.length} ä¸ªç°æœ‰æ–‡æ¡£`);
}
```

---

#### 8.1.5 æ­¥éª¤4: è®¡ç®—é¡¹ç›®è§„æ¨¡

**æ ¸å¿ƒæ–¹æ³•**: `_calculateProjectScale()` ([lib/analyzer.js:200-212](lib/analyzer.js#L200-L212))

**è§„æ¨¡é˜ˆå€¼** ([lib/config.js:43-47](lib/config.js#L43-L47)):

```javascript
const SCALE_THRESHOLDS = {
  small: 5,   // â‰¤5ä¸ªSystems: å°å‹é¡¹ç›®
  medium: 15  // 6-15ä¸ªSystems: ä¸­å‹é¡¹ç›®
              // >15ä¸ªSystems: å¤§å‹é¡¹ç›®
};
```

**åˆ¤æ–­é€»è¾‘**:

```javascript
_calculateProjectScale() {
  const systemsCount = Object.keys(this.codeStructure.systems).length;

  if (systemsCount <= SCALE_THRESHOLDS.small) {
    this.metadata.scale = 'small';
  } else if (systemsCount <= SCALE_THRESHOLDS.medium) {
    this.metadata.scale = 'medium';
  } else {
    this.metadata.scale = 'large';
  }

  console.log(`[åˆ†æå™¨] é¡¹ç›®è§„æ¨¡: ${this.metadata.scale} (${systemsCount} Systems)`);
}
```

---

### 8.2 å¤æ‚åº¦è¯„åˆ†ç®—æ³•ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰

**æ ¸å¿ƒæ–¹æ³•**: `SystemInfo._calculateComplexity()` ([lib/analyzer.js:383-422](lib/analyzer.js#L383-L422))

#### 8.2.1 è¯„åˆ†å…¬å¼

$$
\text{ComplexityScore} = \text{LOC}_{\text{score}} + \text{Method}_{\text{score}} + \text{Event}_{\text{score}} + \text{Core}_{\text{score}} + \text{Import}_{\text{score}}
$$

**å„å› ç´ è¯„åˆ†è§„åˆ™**:

| å› ç´  | æ¡ä»¶ | å¾—åˆ† | æƒé‡è¯´æ˜ |
|------|------|------|----------|
| **ä»£ç è¡Œæ•°** (LOC) | >500è¡Œ | +3 | ä»£ç é‡å¤§ï¼Œç»´æŠ¤å¤æ‚ |
| | 200-500è¡Œ | +2 | ä¸­ç­‰ä»£ç é‡ |
| | <200è¡Œ | +1 | ä»£ç é‡å° |
| **æ–¹æ³•æ•°é‡** (Method) | >15ä¸ªæ–¹æ³• | +2 | åŠŸèƒ½ç¹å¤š |
| | 5-15ä¸ªæ–¹æ³• | +1 | åŠŸèƒ½é€‚ä¸­ |
| | <5ä¸ªæ–¹æ³• | +0 | åŠŸèƒ½ç®€å• |
| **äº‹ä»¶ç›‘å¬** (Event) | >5ä¸ªäº‹ä»¶ | +1 | äº‹ä»¶äº¤äº’å¤æ‚ |
| **æ ¸å¿ƒSystem** (Core) | åŒ…å«core/manager/gameç­‰å…³é”®è¯ | +2 | æ ¸å¿ƒæ¨¡å—æƒé‡é«˜ |
| **ä¾èµ–å…³ç³»** (Import) | >5ä¸ªimport | +2 | ä¾èµ–å¤šï¼Œè€¦åˆåº¦é«˜ |
| | 2-5ä¸ªimport | +1 | ä¾èµ–é€‚ä¸­ |
| | <2ä¸ªimport | +0 | ä¾èµ–å°‘ |

#### 8.2.2 å®Œæ•´ä»£ç å®ç°

```javascript
/**
 * è®¡ç®—å¤æ‚åº¦åˆ†æ•° (0-10åˆ†)
 * @returns {number}
 */
_calculateComplexity() {
  let score = 0;

  // å› ç´ 1: ä»£ç è¡Œæ•° (+1~3åˆ†)
  if (this.linesOfCode > 500) {
    score += 3;
  } else if (this.linesOfCode > 200) {
    score += 2;
  } else {
    score += 1;
  }

  // å› ç´ 2: æ–¹æ³•æ•°é‡ (+0~2åˆ†)
  if (this.methodCount > 15) {
    score += 2;
  } else if (this.methodCount > 5) {
    score += 1;
  }

  // å› ç´ 3: äº‹ä»¶ç›‘å¬æ•°é‡ (+0~1åˆ†)
  if (this.eventListeners > 5) {
    score += 1;
  }

  // å› ç´ 4: æ ¸å¿ƒSystemåˆ¤æ–­ (+0~2åˆ†)
  const coreKeywords = ['core', 'manager', 'game', 'state', 'main'];
  if (coreKeywords.some(keyword => this.name.toLowerCase().includes(keyword))) {
    score += 2;
  }

  // å› ç´ 5: ä¾èµ–å…³ç³» (+0~2åˆ†)
  const importCount = (this.content.match(/from\s+\w+\s+import/g) || []).length;
  if (importCount > 5) {
    score += 2;
  } else if (importCount > 2) {
    score += 1;
  }

  return score;
}
```

#### 8.2.3 å¤æ‚åº¦â†’è¯¦ç»†åº¦æ˜ å°„

**æ ¸å¿ƒæ–¹æ³•**: `getDetailLevel()` ([lib/analyzer.js:428-436](lib/analyzer.js#L428-L436))

**é˜ˆå€¼å®šä¹‰** ([lib/config.js:49-53](lib/config.js#L49-L53)):

```javascript
const COMPLEXITY_THRESHOLDS = {
  simple: 3,   // 0-3åˆ†: ç®€å•System
  medium: 6,   // 4-6åˆ†: ä¸­ç­‰å¤æ‚åº¦System
  detailed: 10 // 7-10åˆ†: é«˜å¤æ‚åº¦System
};
```

**æ˜ å°„é€»è¾‘**:

```javascript
getDetailLevel() {
  if (this.complexityScore >= COMPLEXITY_THRESHOLDS.detailed) {
    return 'detailed';  // ç”Ÿæˆè¯¦ç»†æ–‡æ¡£ï¼ˆ~2500å­—ï¼‰
  } else if (this.complexityScore >= COMPLEXITY_THRESHOLDS.medium) {
    return 'medium';    // ç”Ÿæˆä¸­ç­‰æ–‡æ¡£ï¼ˆ~1500å­—ï¼‰
  } else {
    return 'simple';    // ç”Ÿæˆç®€å•æ–‡æ¡£ï¼ˆ~800å­—ï¼‰
  }
}
```

---

### 8.3 ä¸šåŠ¡ç±»å‹æ¨æ–­ç®—æ³•

**æ ¸å¿ƒæ–¹æ³•**: `_inferBusinessType()` ([lib/analyzer.js:309-323](lib/analyzer.js#L309-L323))

#### 8.3.1 å…³é”®è¯æ˜ å°„è¡¨

**é…ç½®å®šä¹‰** ([lib/config.js:83-96](lib/config.js#L83-L96)):

```javascript
const PROJECT_TYPE_KEYWORDS = {
  'PVP': ['pvp', 'arena', 'battle', 'combat', 'team', 'rank'],
  'PVE': ['pve', 'monster', 'dungeon', 'boss', 'raid', 'quest'],
  'RPG': ['rpg', 'skill', 'level', 'exp', 'attribute', 'talent', 'equipment'],
  'Economy': ['shop', 'trade', 'money', 'coin', 'economy', 'market', 'bank'],
  'Survival': ['survival', 'hunger', 'thirst', 'temperature', 'weather'],
  'Adventure': ['adventure', 'explore', 'map', 'teleport', 'portal'],
  'Building': ['build', 'construct', 'architecture', 'blueprint'],
  'Social': ['social', 'friend', 'guild', 'party', 'chat', 'mail']
};
```

#### 8.3.2 åŒ¹é…ç®—æ³•ï¼ˆå…³é”®è¯è®¡æ•°ï¼‰

```javascript
_inferBusinessType() {
  const systemNames = Object.keys(this.codeStructure.systems)
    .map(name => name.toLowerCase());

  // è®¡ç®—æ¯ç§ç±»å‹çš„åŒ¹é…åˆ†æ•°
  const scores = {};
  for (const [businessType, keywords] of Object.entries(PROJECT_TYPE_KEYWORDS)) {
    scores[businessType] = systemNames.reduce((score, name) => {
      return score + (keywords.some(keyword => name.includes(keyword)) ? 1 : 0);
    }, 0);
  }

  // é€‰æ‹©å¾—åˆ†æœ€é«˜çš„ç±»å‹
  const maxType = Object.keys(scores).reduce((a, b) =>
    scores[a] > scores[b] ? a : b, 'General'
  );

  return scores[maxType] > 0 ? maxType : 'General';
}
```

**ç¤ºä¾‹**:

```javascript
// ç¤ºä¾‹é¡¹ç›®Systems:
// - ShopServerSystem
// - TradeServerSystem
// - CoinManagerSystem
// - MarketClientSystem

// å…³é”®è¯åŒ¹é…:
// Economy: shop(1) + trade(1) + coin(1) + market(1) = 4åˆ† â­ æœ€é«˜
// RPG: 0åˆ†
// PVP: 0åˆ†

// æ¨æ–­ç»“æœ: 'Economy'
```

---

### 8.4 åˆ†ææŠ¥å‘Šç”Ÿæˆï¼ˆMarkdownæ ¼å¼ï¼‰

**æ ¸å¿ƒæ–¹æ³•**: `AnalysisReport.toMarkdown()` ([lib/analyzer.js:479-549](lib/analyzer.js#L479-L549))

#### 8.4.1 æŠ¥å‘Šç»“æ„

**å®Œæ•´æŠ¥å‘ŠåŒ…å«7ä¸ªç« èŠ‚**:

```markdown
# ğŸ“Š é¡¹ç›®åˆ†ææŠ¥å‘Š

## ğŸ¯ é¡¹ç›®æ¦‚å†µ
- é¡¹ç›®åç§°ã€ç±»å‹ã€è§„æ¨¡
- æ¶æ„ç‰¹å¾ï¼ˆApolloã€ECPresetï¼‰

## ğŸ“ ä»£ç ç»“æ„
- Systems/Presetsæ•°é‡ç»Ÿè®¡

## Systemsæ¸…å•ï¼ˆæŒ‰å¤æ‚åº¦æ’åºï¼Œå‰10ä¸ªï¼‰
| Systemåç§° | ç±»å‹ | ä»£ç è¡Œæ•° | æ–¹æ³•æ•° | å¤æ‚åº¦ | æ¨èè¯¦ç»†åº¦ |

## ğŸ“š æ–‡æ¡£è¦†ç›–ç‡
- ç°æœ‰æ–‡æ¡£æ•°é‡
- ç¼ºå¤±æ–‡æ¡£æ•°é‡

## ğŸ“ é¢„è®¡ç”Ÿæˆæ–‡æ¡£
- Layer 1ï¼ˆé€šç”¨å±‚ï¼‰: CLAUDE.md, .claude/commands/, ...
- Layer 2ï¼ˆæ¶æ„å±‚ï¼‰: Systemsæ–‡æ¡£
- Layer 3ï¼ˆä¸šåŠ¡å±‚ï¼‰: æ¡†æ¶æ–‡æ¡£

## â±ï¸ é¢„ä¼°æ¶ˆè€—
- Tokenæ¶ˆè€—ä¼°ç®—
- æ‰§è¡Œæ—¶é—´ä¼°ç®—
```

#### 8.4.2 é¢„ä¼°ç®—æ³•

```javascript
// Tokenæ¶ˆè€—ä¼°ç®—å…¬å¼
const systemsCount = Object.keys(this.codeStructure.systems).length;
const estimatedTokens = 30000 + systemsCount * 1000;
// åŸºç¡€æ¶ˆè€—30kï¼ˆLayer 1ï¼‰+ æ¯ä¸ªSystem 1k

// æ‰§è¡Œæ—¶é—´ä¼°ç®—å…¬å¼
const estimatedTime = Math.max(5, Math.floor(systemsCount / 3));
// è‡³å°‘5åˆ†é’Ÿï¼Œæ¯3ä¸ªSystemå¢åŠ 1åˆ†é’Ÿ
```

---

### 8.5 å…³é”®æ•°æ®ç»“æ„

#### 8.5.1 ProjectMetadataï¼ˆé¡¹ç›®å…ƒæ•°æ®ï¼‰

```javascript
class ProjectMetadata {
  constructor() {
    this.isModsdk = false;           // æ˜¯å¦æ˜¯MODSDKé¡¹ç›®
    this.projectName = '';            // é¡¹ç›®åç§°
    this.modMainPath = '';            // modMain.pyè·¯å¾„
    this.usesApollo = false;          // æ˜¯å¦ä½¿ç”¨Apolloæ¶æ„
    this.usesEcpreset = false;        // æ˜¯å¦ä½¿ç”¨ECPresetæ¡†æ¶
    this.businessType = 'General';    // ä¸šåŠ¡ç±»å‹ï¼ˆRPG/PVP/Economyç­‰ï¼‰
    this.scale = 'small';             // é¡¹ç›®è§„æ¨¡ï¼ˆsmall/medium/largeï¼‰
  }
}
```

#### 8.5.2 CodeStructureï¼ˆä»£ç ç»“æ„ï¼‰

```javascript
class CodeStructure {
  constructor() {
    this.systems = {};        // {systemName: SystemInfo}
    this.presets = {};        // {presetName: PresetInfo}
    this.dependencies = {};   // {systemName: [ä¾èµ–çš„system]}
  }

  addSystem(name, filePath, type, content) {
    this.systems[name] = new SystemInfo(name, filePath, type, content);
  }

  addPreset(name, filePath, content) {
    this.presets[name] = new PresetInfo(name, filePath, content);
  }
}
```

#### 8.5.3 DocumentationCoverageï¼ˆæ–‡æ¡£è¦†ç›–ç‡ï¼‰

```javascript
class DocumentationCoverage {
  constructor() {
    this.existingDocs = [];      // ç°æœ‰æ–‡æ¡£è·¯å¾„åˆ—è¡¨
    this.missingDocs = [];       // ç¼ºå¤±æ–‡æ¡£åˆ—è¡¨
    this.lowQualityDocs = [];    // ä½è´¨é‡æ–‡æ¡£åˆ—è¡¨
  }

  addExistingDoc(docPath) {
    this.existingDocs.push(docPath);
  }
}
```

---

## ğŸ”„ ç¬¬ä¹ç« ï¼šç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ

> **æ ¸å¿ƒæ¨¡å—**: [lib/version-checker.js](lib/version-checker.js) (330è¡Œ)
>
> **èŒè´£**: ç‰ˆæœ¬æ£€æµ‹ã€æ¯”è¾ƒã€è¿ç§»è·¯å¾„ç®¡ç†ã€é…ç½®æ–‡ä»¶å“ˆå¸Œè¿½è¸ª

### 9.1 ç‰ˆæœ¬æ£€æŸ¥æœºåˆ¶

**æ ¸å¿ƒç±»**: `VersionChecker` ([lib/version-checker.js:10-329](lib/version-checker.js#L10-L329))

#### 9.1.1 ä¸»è¦æ–¹æ³•

**checkVersion()** - ä¸»å…¥å£æ–¹æ³• ([lib/version-checker.js:21-33](lib/version-checker.js#L21-L33)):

```javascript
/**
 * æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°
 * @returns {Object} {needsUpdate, local, upstream, changelog}
 */
checkVersion() {
  const localVersion = this.getLocalVersion();
  const upstreamVersion = this.getUpstreamVersion();

  const needsUpdate = this._compareVersions(localVersion, upstreamVersion) < 0;

  return {
    needsUpdate,
    local: localVersion,
    upstream: upstreamVersion,
    changelog: needsUpdate ? this._getChangelog(localVersion, upstreamVersion) : null
  };
}
```

**ä½¿ç”¨ç¤ºä¾‹** ([lib/init-workflow.js:147-152](lib/init-workflow.js#L147-L152)):

```javascript
const versionChecker = new VersionChecker(WORKFLOW_HOME, targetPath);
const check = versionChecker.checkVersion();

console.log(`ğŸ“Š ç‰ˆæœ¬å¯¹æ¯”:`);
console.log(`   æœ¬åœ°: v${check.local}`);
console.log(`   ä¸Šæ¸¸: v${check.upstream}\n`);

if (check.needsUpdate) {
  console.log('âš ï¸  æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬ï¼\n');
  console.log(check.changelog);
}
```

---

#### 9.1.2 æœ¬åœ°ç‰ˆæœ¬æ£€æµ‹ï¼ˆæ™ºèƒ½é™çº§ï¼‰

**getLocalVersion()** ([lib/version-checker.js:39-65](lib/version-checker.js#L39-L65)):

**é™çº§ç­–ç•¥**ï¼ˆå…¼å®¹v15.x â†’ v16.0+ â†’ v17.0+ï¼‰:

```javascript
getLocalVersion() {
  try {
    // 1. ä¼˜å…ˆæ£€æŸ¥workflow-version.jsonï¼ˆv15.xçš„ç‰ˆæœ¬æ–‡ä»¶ï¼‰
    const versionPath = path.join(this.downstreamPath, '.claude', 'workflow-version.json');
    if (fs.existsSync(versionPath)) {
      const versionFile = JSON.parse(fs.readFileSync(versionPath, 'utf-8'));
      const version = versionFile.version || '15.0.0';

      // v15.xä½¿ç”¨çš„ç‰ˆæœ¬æ ¼å¼æ˜¯"15.0"ï¼Œéœ€è¦æ ‡å‡†åŒ–ä¸º"15.0.0"
      if (version && !version.includes('.', version.indexOf('.') + 1)) {
        return version + '.0';
      }
      return version;
    }

    // 2. é™çº§æ£€æŸ¥workflow-manifest.jsonï¼ˆv16.0+çš„ç‰ˆæœ¬æ–‡ä»¶ï¼‰
    if (!fs.existsSync(this.manifestPath)) {
      // å®Œå…¨æ²¡æœ‰ç‰ˆæœ¬æ–‡ä»¶ï¼Œè®¤ä¸ºæ˜¯å…¨æ–°é¡¹ç›®
      return '0.0.0';
    }

    const manifest = JSON.parse(fs.readFileSync(this.manifestPath, 'utf-8'));
    return manifest.version || '15.1.0';
  } catch (err) {
    return '15.1.0';
  }
}
```

**å…³é”®è®¾è®¡**:
- âœ… ä¼˜å…ˆè¯»å–æ—§ç‰ˆé…ç½®æ–‡ä»¶ï¼ˆv15.xä½¿ç”¨çš„ `workflow-version.json`ï¼‰
- âœ… é™çº§è¯»å–æ–°ç‰ˆé…ç½®æ–‡ä»¶ï¼ˆv16.0+ä½¿ç”¨çš„ `workflow-manifest.json`ï¼‰
- âœ… ç‰ˆæœ¬å·æ ‡å‡†åŒ–ï¼ˆ`15.0` â†’ `15.0.0`ï¼‰
- âœ… å¼‚å¸¸å®¹é”™ï¼ˆè¿”å›é»˜è®¤ç‰ˆæœ¬ `15.1.0`ï¼‰

---

#### 9.1.3 ä¸Šæ¸¸ç‰ˆæœ¬æ£€æµ‹

**getUpstreamVersion()** ([lib/version-checker.js:70-78](lib/version-checker.js#L70-L78)):

```javascript
/**
 * è·å–ä¸Šæ¸¸å·¥ä½œæµç‰ˆæœ¬
 */
getUpstreamVersion() {
  try {
    const packagePath = path.join(this.upstreamPath, 'package.json');
    const pkg = JSON.parse(fs.readFileSync(packagePath, 'utf-8'));
    return pkg.version || '16.0.0';
  } catch (err) {
    return '16.0.0';
  }
}
```

**ç‰ˆæœ¬å·æ¥æº**: [package.json:3](package.json#L3)

---

### 9.2 ç‰ˆæœ¬æ¯”è¾ƒç®—æ³•ï¼ˆSemantic Versioningï¼‰

**æ ¸å¿ƒæ–¹æ³•**: `_compareVersions()` ([lib/version-checker.js:84-97](lib/version-checker.js#L84-L97))

#### 9.2.1 ç®—æ³•å®ç°

```javascript
/**
 * æ¯”è¾ƒç‰ˆæœ¬å·ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒï¼‰
 * @param {string} v1 - ç‰ˆæœ¬1ï¼ˆå¦‚ "15.0.0"ï¼‰
 * @param {string} v2 - ç‰ˆæœ¬2ï¼ˆå¦‚ "16.1.0"ï¼‰
 * @returns {number} -1: v1<v2, 0: v1==v2, 1: v1>v2
 */
_compareVersions(v1, v2) {
  const parts1 = v1.split('.').map(Number);
  const parts2 = v2.split('.').map(Number);

  for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
    const p1 = parts1[i] || 0;
    const p2 = parts2[i] || 0;

    if (p1 < p2) return -1;
    if (p1 > p2) return 1;
  }

  return 0;
}
```

#### 9.2.2 ç®—æ³•ç¤ºä¾‹

| v1 | v2 | æ¯”è¾ƒè¿‡ç¨‹ | ç»“æœ |
|----|----|---------|------|
| `15.0.0` | `16.1.0` | 15<16 | -1 (v1 < v2) |
| `16.1.0` | `16.1.0` | å…¨ç›¸ç­‰ | 0 (v1 == v2) |
| `17.0.0` | `16.1.0` | 17>16 | 1 (v1 > v2) |
| `16.1` | `16.1.0` | è¡¥0åæ¯”è¾ƒ | 0 (v1 == v2) |
| `16.1.1` | `16.1.0` | å‰ä¸¤ä½ç›¸ç­‰ï¼Œ1>0 | 1 (v1 > v2) |

---

### 9.3 Manifestç»“æ„ï¼ˆworkflow-manifest.jsonï¼‰

**åˆ›å»ºæ–¹æ³•**: `_createDefaultManifest()` ([lib/version-checker.js:166-173](lib/version-checker.js#L166-L173))

#### 9.3.1 æ•°æ®ç»“æ„

```javascript
{
  "version": "17.2.0",              // å½“å‰å·¥ä½œæµç‰ˆæœ¬
  "createdAt": "2025-11-12T10:30:00.000Z",  // é¦–æ¬¡éƒ¨ç½²æ—¶é—´
  "updatedAt": "2025-11-12T15:00:00.000Z",  // æœ€åæ›´æ–°æ—¶é—´
  "baselineHashes": {               // ä¸Šæ¸¸æ–‡æ¡£å“ˆå¸Œå€¼ï¼ˆç”¨äºæ£€æµ‹æ–‡æ¡£å˜æ›´ï¼‰
    "å¼€å‘è§„èŒƒ.md": "a3f5e9...",
    "é—®é¢˜æ’æŸ¥.md": "b7c2d1...",
    "MODSDKæ ¸å¿ƒæ¦‚å¿µ.md": "e8a4f6...",
    // ...
  },
  "obsoleteFiles": []               // åºŸå¼ƒæ–‡ä»¶åˆ—è¡¨
}
```

#### 9.3.2 è¯»å†™æ–¹æ³•

**readManifest()** ([lib/version-checker.js:135-145](lib/version-checker.js#L135-L145)):

```javascript
readManifest() {
  try {
    if (!fs.existsSync(this.manifestPath)) {
      return this._createDefaultManifest();
    }

    return JSON.parse(fs.readFileSync(this.manifestPath, 'utf-8'));
  } catch (err) {
    return this._createDefaultManifest();
  }
}
```

**writeManifest()** ([lib/version-checker.js:150-161](lib/version-checker.js#L150-L161)):

```javascript
writeManifest(data) {
  const manifest = {
    ...this.readManifest(),
    ...data,
    updatedAt: new Date().toISOString()  // è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
  };

  fs.ensureDirSync(path.dirname(this.manifestPath));
  fs.writeFileSync(this.manifestPath, JSON.stringify(manifest, null, 2), 'utf-8');

  return manifest;
}
```

---

### 9.4 å“ˆå¸Œè®¡ç®—å’Œå¯¹æ¯”

#### 9.4.1 æ–‡ä»¶å“ˆå¸Œè®¡ç®—ï¼ˆSHA256ï¼‰

**æ ¸å¿ƒæ–¹æ³•**: `getFileHash()` ([lib/version-checker.js:206-213](lib/version-checker.js#L206-L213))

```javascript
/**
 * è®¡ç®—æ–‡ä»¶SHA256å“ˆå¸Œ
 * @param {string} filePath - æ–‡ä»¶ç»å¯¹è·¯å¾„
 * @returns {string|null} - å“ˆå¸Œå€¼ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰
 */
getFileHash(filePath) {
  try {
    const content = fs.readFileSync(filePath);
    return crypto.createHash('sha256').update(content).digest('hex');
  } catch (err) {
    return null;
  }
}
```

**ç¤ºä¾‹è¾“å‡º**:

```javascript
getFileHash('markdown/å¼€å‘è§„èŒƒ.md');
// è¿”å›: "a3f5e9c2b1d8f7a6e4c3b2a1f9e8d7c6b5a4f3e2d1c0b9a8f7e6d5c4b3a2f1e0"
```

---

#### 9.4.2 åŸºçº¿å“ˆå¸Œè®¡ç®—

**æ ¸å¿ƒæ–¹æ³•**: `computeBaselineHashes()` ([lib/version-checker.js:179-201](lib/version-checker.js#L179-L201))

**è®¡ç®—æ ¸å¿ƒæ–‡æ¡£çš„å“ˆå¸Œå€¼**:

```javascript
computeBaselineHashes() {
  const coreFiles = [
    'å¼€å‘è§„èŒƒ.md',
    'é—®é¢˜æ’æŸ¥.md',
    'å¿«é€Ÿå¼€å§‹.md',
    'MODSDKæ ¸å¿ƒæ¦‚å¿µ.md',
    'APIé€ŸæŸ¥.md',
    'å®˜æ–¹æ–‡æ¡£æŸ¥è¯¢æŒ‡å—.md',
    'è¿ç§»æŒ‡å—-v15.0.md'
  ];

  const hashes = {};

  for (const file of coreFiles) {
    const filePath = path.join(this.upstreamPath, 'markdown', file);

    if (fs.existsSync(filePath)) {
      hashes[file] = this.getFileHash(filePath);
    }
  }

  return hashes;
}
```

**ç”¨é€”**:
- âœ… æ£€æµ‹ä¸Šæ¸¸æ–‡æ¡£æ˜¯å¦å˜æ›´
- âœ… æ£€æµ‹ç”¨æˆ·æ˜¯å¦å®šåˆ¶äº†æ–‡æ¡£ï¼ˆå“ˆå¸Œä¸åŒ¹é…ï¼‰
- âœ… æé†’ç”¨æˆ·åˆå¹¶ä¸Šæ¸¸æ›´æ–°

---

#### 9.4.3 æ–‡æ¡£å®šåˆ¶æ£€æµ‹

**æ ¸å¿ƒæ–¹æ³•**: `isFileCustomized()` ([lib/version-checker.js:221-228](lib/version-checker.js#L221-L228))

```javascript
/**
 * æ£€æµ‹æ–‡ä»¶æ˜¯å¦è¢«ç”¨æˆ·å®šåˆ¶è¿‡
 * @param {string} filePath - æ–‡ä»¶ç»å¯¹è·¯å¾„
 * @param {string} baselineHash - åŸºçº¿å“ˆå¸Œï¼ˆä»manifestè¯»å–ï¼‰
 * @returns {boolean} true=å·²å®šåˆ¶, false=æœªå®šåˆ¶
 */
isFileCustomized(filePath, baselineHash) {
  if (!fs.existsSync(filePath)) {
    return false;
  }

  const currentHash = this.getFileHash(filePath);
  return currentHash !== baselineHash;
}
```

**ä½¿ç”¨åœºæ™¯** ([lib/version-checker.js:264-300](lib/version-checker.js#L264-L300)):

```javascript
async detectOverrideConflicts() {
  const conflicts = [];
  const overrideDir = path.join(this.downstreamPath, 'markdown', 'core');

  if (!fs.existsSync(overrideDir)) {
    return conflicts;
  }

  const manifest = this.readManifest();
  const baselineHashes = manifest.baselineHashes || {};
  const currentBaselineHashes = this.computeBaselineHashes();

  // éå†è¦†ç›–å±‚æ–‡ä»¶
  const overrideFiles = fs.readdirSync(overrideDir).filter(f => f.endsWith('.md'));

  for (const file of overrideFiles) {
    const oldBaselineHash = baselineHashes[file];
    const newBaselineHash = currentBaselineHashes[file];

    // å¦‚æœä¸Šæ¸¸æ–‡æ¡£æœ‰å˜åŒ–
    if (oldBaselineHash && newBaselineHash && oldBaselineHash !== newBaselineHash) {
      conflicts.push({
        file,
        overridePath: path.join(overrideDir, file),
        upstreamPath: path.join(this.upstreamPath, 'markdown', file),
        oldBaselineHash,
        newBaselineHash,
        description: 'ä¸Šæ¸¸æ–‡æ¡£æœ‰æ›´æ–°ï¼Œå»ºè®®å®¡æŸ¥å¹¶åˆå¹¶'
      });
    }
  }

  return conflicts;
}
```

---

### 9.5 åºŸå¼ƒæ–‡ä»¶æ£€æµ‹

**æ ¸å¿ƒæ–¹æ³•**: `detectObsoleteFiles()` ([lib/version-checker.js:236-258](lib/version-checker.js#L236-L258))

#### 9.5.1 ç‰ˆæœ¬è¿ç§»è§„åˆ™

**v16.0è¿ç§»è§„åˆ™**ï¼ˆä»v15.xå‡çº§åˆ°v16.0ï¼‰:

```javascript
detectObsoleteFiles(fromVersion, toVersion) {
  const obsolete = [];

  // v16.0: markdown/ä¸‹çš„æ ¸å¿ƒæ–‡æ¡£åº”ç§»è‡³.claude/core-docs/å¼•ç”¨
  if (this._compareVersions(fromVersion, '16.0.0') < 0 &&
      this._compareVersions(toVersion, '16.0.0') >= 0) {

    const v16CoreFiles = [
      'markdown/å¼€å‘è§„èŒƒ.md',
      'markdown/é—®é¢˜æ’æŸ¥.md',
      'markdown/å¿«é€Ÿå¼€å§‹.md',
      'markdown/MODSDKæ ¸å¿ƒæ¦‚å¿µ.md',
      'markdown/APIé€ŸæŸ¥.md',
      'markdown/å®˜æ–¹æ–‡æ¡£æŸ¥è¯¢æŒ‡å—.md',
      'markdown/è¿ç§»æŒ‡å—-v15.0.md',
      'markdown/AIç­–ç•¥æ–‡æ¡£' // ç›®å½•
    ];

    obsolete.push(...v16CoreFiles);
  }

  return obsolete;
}
```

**è®¾è®¡æ€æƒ³**:
- æ¯ä¸ªå¤§ç‰ˆæœ¬å¯å®šä¹‰è‡ªå·±çš„åºŸå¼ƒæ–‡ä»¶è§„åˆ™
- é€šè¿‡ç‰ˆæœ¬å·èŒƒå›´åˆ¤æ–­æ˜¯å¦éœ€è¦æ¸…ç†
- è¿”å›å¾…æ¸…ç†çš„æ–‡ä»¶è·¯å¾„åˆ—è¡¨

---

#### 9.5.2 è‡ªåŠ¨æ¸…ç†æµç¨‹

**åœ¨ initmc --sync ä¸­è°ƒç”¨** ([lib/init-workflow.js:169-213](lib/init-workflow.js#L169-L213)):

```javascript
// æ­¥éª¤3: æ£€æµ‹åºŸå¼ƒæ–‡ä»¶ï¼ˆä½¿ç”¨æ–°çš„æ£€æµ‹å™¨ï¼‰
console.log('ğŸ§¹ æ£€æµ‹åºŸå¼ƒæ–‡ä»¶...\n');
const detector = new ObsoleteFileDetector(targetPath);
const obsoleteFiles = detector.detect(check.local, check.upstream);

if (obsoleteFiles.length > 0) {
  console.log(`âš ï¸  å‘ç° ${obsoleteFiles.length} ä¸ªåºŸå¼ƒæ–‡ä»¶\n`);

  // æ˜¾ç¤ºæ‘˜è¦
  const grouped = {};
  for (const item of obsoleteFiles) {
    if (!grouped[item.action]) {
      grouped[item.action] = [];
    }
    grouped[item.action].push(item);
  }

  for (const [action, items] of Object.entries(grouped)) {
    console.log(`   [${action.toUpperCase()}] ${items.length} ä¸ªæ–‡ä»¶`);
  }
  console.log('');

  // è¯¢é—®ç”¨æˆ·
  const answer = await askUser('æ˜¯å¦è‡ªåŠ¨å¤„ç†ï¼Ÿ[Y/n]: ');

  if (answer !== 'n' && answer !== 'no') {
    // ä½¿ç”¨æ–°çš„æ£€æµ‹å™¨å¤„ç†åºŸå¼ƒæ–‡ä»¶
    await detector.process(obsoleteFiles, { autoConfirm: true });
  } else {
    console.log('   â„¹ï¸  è·³è¿‡åºŸå¼ƒæ–‡ä»¶å¤„ç†');
    console.log('   ğŸ’¡ å¯æ‰‹åŠ¨æ‰§è¡Œ: detect-obsolete\n');
  }
} else {
  console.log('   â„¹ï¸  æ— åºŸå¼ƒæ–‡ä»¶\n');
}
```

---

### 9.6 ç‰ˆæœ¬å‡çº§æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant CLI as initmc --sync
    participant VC as VersionChecker
    participant Detector as ObsoleteFileDetector
    participant SM as SymlinkManager
    participant Manifest as workflow-manifest.json

    User->>CLI: æ‰§è¡Œ initmc --sync
    CLI->>VC: checkVersion()
    VC->>Manifest: readManifest() è¯»å–æœ¬åœ°ç‰ˆæœ¬
    VC->>VC: getUpstreamVersion() è¯»å–ä¸Šæ¸¸ç‰ˆæœ¬
    VC->>VC: _compareVersions() æ¯”è¾ƒç‰ˆæœ¬

    alt éœ€è¦æ›´æ–°
        VC-->>CLI: {needsUpdate: true, changelog}
        CLI->>User: æ˜¾ç¤ºæ›´æ–°æ—¥å¿—

        CLI->>SM: updateSymlinks() æ›´æ–°è½¯è¿æ¥

        CLI->>Detector: detect() æ£€æµ‹åºŸå¼ƒæ–‡ä»¶
        Detector-->>CLI: åºŸå¼ƒæ–‡ä»¶åˆ—è¡¨

        CLI->>User: è¯¢é—®æ˜¯å¦æ¸…ç†
        User-->>CLI: ç¡®è®¤

        CLI->>Detector: process() æ¸…ç†åºŸå¼ƒæ–‡ä»¶

        CLI->>VC: detectOverrideConflicts() æ£€æµ‹è¦†ç›–å±‚å†²çª
        VC-->>CLI: å†²çªåˆ—è¡¨

        alt æœ‰å†²çª
            CLI->>User: æç¤ºæ‰‹åŠ¨åˆå¹¶
        end

        CLI->>VC: writeManifest() æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
        VC->>VC: computeBaselineHashes() è®¡ç®—æ–°å“ˆå¸Œ
        VC->>Manifest: å†™å…¥æ–°manifest

        CLI-->>User: âœ… åŒæ­¥å®Œæˆ
    else å·²æ˜¯æœ€æ–°ç‰ˆæœ¬
        VC-->>CLI: {needsUpdate: false}
        CLI-->>User: âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬
    end
```

---

### 9.7 è¿ç§»è·¯å¾„ï¼ˆv15.x â†’ v17.xï¼‰

**æ”¯æŒçš„è¿ç§»è·¯å¾„**:

```
v15.0 â”€â”€â”
v15.1 â”€â”€â”¼â”€â†’ v16.0 â”€â”€â”€â†’ v16.1 â”€â”€â”€â†’ v16.3 â”€â”€â”€â†’ v17.0 â”€â”€â”€â†’ v17.1 â”€â”€â”€â†’ v17.2
v15.x â”€â”€â”˜
```

**å…³é”®è¿ç§»æ¨¡å—**:

| è¿ç§»è„šæœ¬ | è¿ç§»è·¯å¾„ | æ ¸å¿ƒå˜æ›´ |
|---------|---------|---------|
| [lib/migration-v16.js](lib/migration-v16.js) | v15.x â†’ v16.0 | åŒå±‚æ–‡æ¡£æ¶æ„ |
| [lib/migration-v16.1.js](lib/migration-v16.1.js) | v16.0 â†’ v16.1 | é…ç½®æ–‡ä»¶å‡çº§ |

**è°ƒç”¨æ—¶æœº** ([lib/init-workflow.js:43-59](lib/init-workflow.js#L43-L59)):

```javascript
// æ£€æŸ¥æ˜¯å¦éœ€è¦è¿ç§»ï¼ˆä¼˜å…ˆçº§ï¼šv16.0â†’v16.1 > v15.xâ†’v16.0ï¼‰
const migrationV161 = new MigrationV161(WORKFLOW_HOME, targetPath);
if (migrationV161.needsMigration()) {
  const result = await migrationV161.migrate({ autoConfirm: false });
  if (result.success) {
    return; // è¿ç§»å®Œæˆï¼Œé€€å‡º
  }
  // è¿ç§»å¤±è´¥æˆ–å–æ¶ˆï¼Œç»§ç»­å¸¸è§„éƒ¨ç½²
}

const migrationV16 = new MigrationV16(WORKFLOW_HOME, targetPath);
if (migrationV16.needsMigration()) {
  const result = await migrationV16.migrate({ autoConfirm: false });
  if (result.success) {
    return; // è¿ç§»å®Œæˆï¼Œé€€å‡º
  }
  // è¿ç§»å¤±è´¥æˆ–å–æ¶ˆï¼Œç»§ç»­å¸¸è§„éƒ¨ç½²
}
```

---

## ğŸš€ ç¬¬åç« ï¼šå®Œæ•´å·¥ä½œæµç¨‹

> **ç†è§£æœ¬ç« **: ä»ç”¨æˆ·è§†è§’å’Œç³»ç»Ÿè§†è§’ï¼Œå®Œæ•´å±•ç¤ºå·¥ä½œæµçš„éƒ¨ç½²å’Œæ‰§è¡Œè¿‡ç¨‹

### 10.1 åœºæ™¯1ï¼šå¼€å‘è€…å®‰è£…å·¥ä½œæµ

**æ‰§è¡Œå‘½ä»¤**: `npm run install-global`

**æ ¸å¿ƒæ¨¡å—**: [bin/install-global.js](bin/install-global.js)

#### 10.1.1 å®‰è£…æµç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant Dev as å¼€å‘è€…
    participant NPM as npm run
    participant IG as install-global.js
    participant FS as æ–‡ä»¶ç³»ç»Ÿ
    participant Shell as Shellç¯å¢ƒ

    Dev->>NPM: npm run install-global
    NPM->>IG: æ‰§è¡Œ bin/install-global.js

    IG->>IG: è·å–é¡¹ç›®æ ¹ç›®å½•
    IG->>FS: åˆ›å»º ~/.claude-modsdk-workflow/

    IG->>FS: å¤åˆ¶ lib/**
    IG->>FS: å¤åˆ¶ bin/**
    IG->>FS: å¤åˆ¶ markdown/**
    IG->>FS: å¤åˆ¶ templates/**
    IG->>FS: å¤åˆ¶ docs/** (Git Submodule)

    IG->>Shell: åˆ›å»º initmc å…¨å±€å‘½ä»¤

    alt Windows
        IG->>FS: åˆ›å»º initmc.cmd (CMDè„šæœ¬)
        IG->>FS: åˆ›å»º initmc.ps1 (PowerShellè„šæœ¬)
        IG->>FS: æ·»åŠ åˆ° PATH
    else Linux/Mac
        IG->>FS: åˆ›å»º initmc (Bashè„šæœ¬)
        IG->>FS: chmod +x initmc
        IG->>FS: æ·»åŠ åˆ° PATH
    end

    IG-->>Dev: âœ… å®‰è£…å®Œæˆ
    Dev->>Shell: which initmc / where initmc
    Shell-->>Dev: C:\Users\xxx\.claude-modsdk-workflow\bin\initmc.cmd
```

#### 10.1.2 è·¨å¹³å°è„šæœ¬ç”Ÿæˆ

**Windows CMDè„šæœ¬** (`initmc.cmd`):

```batch
@echo off
node "%~dp0initmc.js" %*
```

**Windows PowerShellè„šæœ¬** (`initmc.ps1`):

```powershell
#!/usr/bin/env pwsh
$basedir=Split-Path $MyInvocation.MyCommand.Definition -Parent
& node "$basedir\initmc.js" $args
```

**Linux/Mac Bashè„šæœ¬** (`initmc`):

```bash
#!/usr/bin/env bash
basedir=$(dirname "$(echo "$0" | sed -e 's,\\,/,g')")
exec node "$basedir/initmc.js" "$@"
```

---

### 10.2 åœºæ™¯2ï¼šç”¨æˆ·åˆå§‹åŒ–MODSDKé¡¹ç›®

**æ‰§è¡Œå‘½ä»¤**: `cd /path/to/modsdk-project && initmc`

**æ ¸å¿ƒæ¨¡å—**: [bin/initmc.js](bin/initmc.js) + [lib/init-workflow.js](lib/init-workflow.js)

#### 10.2.1 åˆå§‹åŒ–æµç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant initmc as bin/initmc.js
    participant IW as init-workflow.js
    participant Analyzer as ProjectAnalyzer
    participant Generator as DocumentGenerator
    participant SM as SymlinkManager
    participant FS as ä¸‹æ¸¸é¡¹ç›®

    User->>initmc: initmc
    initmc->>IW: main()

    Note over IW: æ­¥éª¤1: æ£€æŸ¥è¿ç§»éœ€æ±‚
    IW->>IW: æ£€æµ‹æ˜¯å¦éœ€è¦v16.0/v16.1è¿ç§»

    alt éœ€è¦è¿ç§»
        IW->>User: æ˜¾ç¤ºè¿ç§»é¢„è§ˆ
        User-->>IW: ç¡®è®¤è¿ç§»
        IW->>FS: æ‰§è¡Œè¿ç§»è„šæœ¬
        IW-->>User: âœ… è¿ç§»å®Œæˆ
    end

    Note over IW: æ­¥éª¤2: åˆ†æé¡¹ç›®
    IW->>Analyzer: analyze()
    Analyzer->>Analyzer: _detectProjectType()
    Analyzer->>Analyzer: _scanCodeStructure()
    Analyzer->>Analyzer: _discoverProjectStructure() â­ v2.0
    Analyzer->>Analyzer: _checkDocumentation()
    Analyzer->>Analyzer: _calculateProjectScale()
    Analyzer-->>IW: AnalysisReport

    IW->>User: æ˜¾ç¤ºåˆ†ææŠ¥å‘Š

    Note over IW: æ­¥éª¤3: ç”Ÿæˆæ–‡æ¡£ï¼ˆLayer 1æ ¸å¿ƒå·¥ä½œæµï¼‰
    IW->>Generator: generateAll(minimalMode=true)
    Generator->>Generator: _generateLayer1()
    Generator->>FS: ç”Ÿæˆ CLAUDE.md
    Generator->>FS: ç”Ÿæˆ .claude/commands/ (6ä¸ªå‘½ä»¤)
    Generator->>FS: ç”Ÿæˆ markdown/README.md

    Note over IW: æ­¥éª¤4: åˆ›å»ºè½¯è¿æ¥
    IW->>SM: createAllSymlinks()
    SM->>SM: _getCoreFiles() æ‰«ææ ¸å¿ƒæ–‡æ¡£

    loop æ¯ä¸ªæ ¸å¿ƒæ–‡æ¡£
        SM->>FS: å°è¯•åˆ›å»ºè½¯è¿æ¥

        alt æƒé™ä¸è¶³
            SM->>FS: é™çº§ä¸ºåªè¯»å‰¯æœ¬
        end
    end

    SM-->>IW: {symlinks, readonlyCopies, failed}

    Note over IW: æ­¥éª¤5: åˆ›å»ºmarkdown/è½¯è¿æ¥ï¼ˆv16.2ï¼‰
    IW->>SM: createMarkdownSymlinks()
    SM->>FS: è½¯è¿æ¥ ai/ ç­‰ç›®å½•

    IW-->>User: âœ… æ ¸å¿ƒå·¥ä½œæµéƒ¨ç½²å®Œæˆ
    IW->>User: æ˜¾ç¤ºéƒ¨ç½²å†…å®¹æ¸…å•
    IW->>User: æç¤ºä¸‹ä¸€æ­¥ï¼š/mc-discover
```

#### 10.2.2 ç”Ÿæˆæ–‡ä»¶æ¸…å•

**éƒ¨ç½²åçš„é¡¹ç›®ç»“æ„**:

```
ä¸‹æ¸¸MODSDKé¡¹ç›®/
â”œâ”€ CLAUDE.md                          â† ä»æ¨¡æ¿ç”Ÿæˆ
â”œâ”€ README.md                          â† ä»æ¨¡æ¿ç”Ÿæˆ
â”‚
â”œâ”€ .claude/
â”‚   â”œâ”€ commands/                      â† 6ä¸ªClaudeå‘½ä»¤ï¼ˆv17.1ï¼‰
â”‚   â”‚   â”œâ”€ mc.md
â”‚   â”‚   â”œâ”€ mc-review.md
â”‚   â”‚   â”œâ”€ mc-perf.md
â”‚   â”‚   â”œâ”€ mc-docs.md
â”‚   â”‚   â”œâ”€ mc-why.md
â”‚   â”‚   â””â”€ mc-discover.md
â”‚   â”‚
â”‚   â”œâ”€ core-docs/                     â† è½¯è¿æ¥åˆ°ä¸Šæ¸¸ï¼ˆv16.0ï¼‰
â”‚   â”‚   â”œâ”€ æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/ â†’ [ä¸Šæ¸¸ markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/]
â”‚   â”‚   â”œâ”€ æ¦‚å¿µå‚è€ƒ/ â†’ [ä¸Šæ¸¸ markdown/æ¦‚å¿µå‚è€ƒ/]
â”‚   â”‚   â”œâ”€ æ·±åº¦æŒ‡å—/ â†’ [ä¸Šæ¸¸ markdown/æ·±åº¦æŒ‡å—/]
â”‚   â”‚   â””â”€ AIç­–ç•¥æ–‡æ¡£/ â†’ [ä¸Šæ¸¸ markdown/AIç­–ç•¥æ–‡æ¡£/]
â”‚   â”‚
â”‚   â”œâ”€ docs/                          â† è½¯è¿æ¥åˆ°ä¸Šæ¸¸ï¼ˆå¯é€‰ï¼‰
â”‚   â”‚   â”œâ”€ modsdk-wiki/ â†’ [ä¸Šæ¸¸ docs/modsdk-wiki/]
â”‚   â”‚   â””â”€ bedrock-wiki/ â†’ [ä¸Šæ¸¸ docs/bedrock-wiki/]
â”‚   â”‚
â”‚   â””â”€ workflow-manifest.json         â† ç‰ˆæœ¬è¿½è¸ªæ–‡ä»¶
â”‚
â””â”€ markdown/
    â”œâ”€ README.md                      â† æ–‡æ¡£å¯¼èˆªï¼ˆä»æ¨¡æ¿ç”Ÿæˆï¼‰
    â”œâ”€ ç´¢å¼•.md                        â† å¿«é€Ÿç´¢å¼•ï¼ˆä»æ¨¡æ¿ç”Ÿæˆï¼‰
    â”œâ”€ é¡¹ç›®çŠ¶æ€.md                    â† é¡¹ç›®çŠ¶æ€ï¼ˆä»æ¨¡æ¿ç”Ÿæˆï¼‰
    â””â”€ æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md              â† å¾…åŠæ¸…å•ï¼ˆä»æ¨¡æ¿ç”Ÿæˆï¼‰
```

---

### 10.3 åœºæ™¯3ï¼šAIæ‰§è¡Œ /mc å‘½ä»¤

**æ‰§è¡Œå‘½ä»¤**: Claude Codeä¸­æ‰§è¡Œ `/mc "ä¿®å¤å•†åº—è´­ä¹°BUG"`

**æ ¸å¿ƒæ¨¡å—**: [templates/.claude/commands/mc.md.template](templates/.claude/commands/mc.md.template)

#### 10.3.1 å·¥ä½œæµæ‰§è¡Œåºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Claude as Claude Code
    participant MC as /mc å‘½ä»¤
    participant Docs as æ–‡æ¡£ç³»ç»Ÿ
    participant Code as ä»£ç åº“
    participant Review as ä¸“å®¶å®¡æ ¸ï¼ˆå¯é€‰ï¼‰

    User->>Claude: /mc "ä¿®å¤å•†åº—è´­ä¹°BUG"
    Claude->>MC: è§£æå‘½ä»¤

    Note over Claude: æ­¥éª¤1: ç†è§£ä»»åŠ¡
    MC->>Claude: è¯†åˆ«ä»»åŠ¡ç±»å‹
    Claude->>Claude: åˆ¤æ–­: ğŸŸ¡ æ ‡å‡†ä»»åŠ¡ï¼ˆæ¶‰åŠ3-8æ–‡ä»¶ï¼‰
    Claude->>Claude: åˆ›å»º tasks/task-001-ä¿®å¤å•†åº—BUG/

    Claude->>Docs: æŸ¥çœ‹ tasks/ å†å²ä¸Šä¸‹æ–‡
    Claude->>Docs: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æ¶‰åŠï¼‰
    Claude->>Claude: æ ‡è®°éœ€è¦æŸ¥é˜…çš„æ–‡æ¡£

    Note over Claude: æ­¥éª¤2: æŸ¥é˜…æ–‡æ¡£ â­ æ ¸å¿ƒæ­¥éª¤
    Claude->>Docs: Read(.claude/core-docs/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md)
    Docs-->>Claude: CRITICALè§„èŒƒå†…å®¹

    Claude->>Docs: Read(.claude/core-docs/æ¦‚å¿µå‚è€ƒ/MODSDKæ ¸å¿ƒæ¦‚å¿µ.md)
    Docs-->>Claude: System/Component/Eventæ¦‚å¿µ

    Claude->>Docs: Read(markdown/systems/ShopServerSystem.md)
    Docs-->>Claude: å•†åº—ç³»ç»Ÿæ–‡æ¡£

    Claude->>Claude: æå–å…³é”®åŸåˆ™ï¼ˆç¦æ­¢/åº”è¯¥/åŸå› ï¼‰
    Claude->>User: è¾“å‡ºæ­¥éª¤2æ£€æŸ¥ç‚¹æŠ¥å‘Š

    Note over Claude: æ­¥éª¤2.5: æ–¹æ¡ˆè‡ªæ£€ä¸ä¸“å®¶å®¡æ ¸ â­ v17.1
    Claude->>Claude: æ‰§è¡Œ5é¡¹è‡ªæ£€æ¸…å•
    Claude->>User: è¾“å‡ºè‡ªæ£€æŠ¥å‘Š

    alt æœ‰é”™è¯¯é¡¹
        Claude->>Claude: è‡ªåŠ¨ä¿®æ­£æ–¹æ¡ˆ
        Claude->>Claude: é‡æ–°æ‰§è¡Œè‡ªæ£€
    end

    alt è§¦å‘ä¸“å®¶å®¡æ ¸ï¼ˆ2è½®ä¿®å¤/è·¨5+ System/ç”¨æˆ·è¦æ±‚ï¼‰
        Claude->>Review: è°ƒç”¨ /mc-review å­ä»£ç†
        Review->>Review: æ·±åº¦å®¡æ ¸æ–¹æ¡ˆ
        Review-->>Claude: å®¡æ ¸æŠ¥å‘Šï¼ˆè¯„åˆ†/é—®é¢˜/å»ºè®®ï¼‰

        alt è¯„åˆ†<8åˆ†
            Claude->>Claude: æ ¹æ®å»ºè®®ä¿®æ”¹æ–¹æ¡ˆ
            Claude->>Review: é‡æ–°å®¡æ ¸
        end

        Review->>User: è¯·å®¡é˜…æ–¹æ¡ˆ
        User-->>Claude: ç¡®è®¤/è°ƒæ•´/é‡æ–°è®¾è®¡
    end

    Note over Claude: æ­¥éª¤3: æ‰§è¡Œä¸æ”¶å°¾
    Claude->>Code: æ¢ç´¢ç›¸å…³ä»£ç 
    Claude->>Code: è®¾è®¡ä¿®å¤æ–¹æ¡ˆ
    Claude->>Code: Edit ä¿®æ”¹ä»£ç 

    Claude->>User: è¯¢é—®: è¯·æµ‹è¯•ä¿®å¤æ•ˆæœ
    User-->>Claude: å·²ä¿®å¤

    Claude->>Docs: æ£€æŸ¥æ–‡æ¡£è¡¥å……æ ‡è®°
    Claude->>Docs: è‡ªåŠ¨è¡¥å……ç¼ºå¤±æ–‡æ¡£ï¼ˆâ‰¤2ä¸ªï¼‰
    Claude->>Docs: æ¸…ç†DEBUGä»£ç 
    Claude->>Docs: å½’æ¡£ä»»åŠ¡

    Claude-->>User: âœ… ä»»åŠ¡å®Œæˆ
```

#### 10.3.2 å…³é”®æ£€æŸ¥ç‚¹

**æ­¥éª¤2æ£€æŸ¥ç‚¹è¾“å‡ºç¤ºä¾‹**:

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… æ­¥éª¤2æ£€æŸ¥ç‚¹ï¼šæ–‡æ¡£æŸ¥é˜…æŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ğŸ“š å·²æŸ¥é˜…æ–‡æ¡£ï¼ˆè‡³å°‘3ä¸ªï¼‰:
   - .claude/core-docs/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md - CRITICALè§„èŒƒ (ç¬¬164-210è¡Œ)
   - .claude/core-docs/æ¦‚å¿µå‚è€ƒ/MODSDKæ ¸å¿ƒæ¦‚å¿µ.md - Partè®¾è®¡æ¨¡å¼ (ç¬¬50-80è¡Œ)
   - markdown/systems/ShopServerSystem.md - å•†åº—ç³»ç»Ÿæ¶æ„ (å…¨æ–‡)

2. ğŸ”‘ æå–çš„å…³é”®åŸåˆ™:
   â›” ç¦æ­¢: åœ¨Part.__init__()ä¸­è°ƒç”¨ä»»ä½•MODSDK API
   âœ… åº”è¯¥: åœ¨Create()æ–¹æ³•ä¸­åˆå§‹åŒ–Componentå’Œæ³¨å†Œäº‹ä»¶
   ğŸ“š åŸå› : ç½‘æ˜“å¼•æ“çš„Systemç”Ÿå‘½å‘¨æœŸé™åˆ¶ï¼Œ__init__æ—¶å¼•æ“å°šæœªå®Œæˆåˆå§‹åŒ–

   â›” ç¦æ­¢: ä½¿ç”¨GetSystemè·¨ç«¯è·å–Systemå®ä¾‹
   âœ… åº”è¯¥: ä½¿ç”¨NotifyToClient/NotifyToServerè¿›è¡ŒåŒç«¯é€šä¿¡
   ğŸ“š åŸå› : åŒç«¯éš”ç¦»åŸåˆ™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è¿è¡Œåœ¨ä¸åŒè¿›ç¨‹

3. ğŸ“‹ æ–‡æ¡£ä¾æ®æ¸…å•:
   - å¼€å‘è§„èŒƒ.md:164 - Systemç”Ÿå‘½å‘¨æœŸè§„èŒƒ
   - å¼€å‘è§„èŒƒ.md:210 - åŒç«¯éš”ç¦»åŸåˆ™
   - MODSDKæ ¸å¿ƒæ¦‚å¿µ.md:72 - Partåˆå§‹åŒ–æµç¨‹è¯´æ˜

âš ï¸ ç¡®è®¤æ£€æŸ¥ç‚¹è¾“å‡ºå®Œæˆåï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€æ­¥ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

### 10.4 åœºæ™¯4ï¼šå‡çº§ç°æœ‰é¡¹ç›®ï¼ˆinitmc --syncï¼‰

**æ‰§è¡Œå‘½ä»¤**: `initmc --sync`

**æ ¸å¿ƒå‡½æ•°**: `syncWorkflow()` ([lib/init-workflow.js:139-253](lib/init-workflow.js#L139-L253))

#### 10.4.1 åŒæ­¥æµç¨‹åºåˆ—å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant CLI as initmc --sync
    participant VC as VersionChecker
    participant SM as SymlinkManager
    participant Detector as ObsoleteFileDetector
    participant FS as ä¸‹æ¸¸é¡¹ç›®

    User->>CLI: initmc --sync

    Note over CLI: æ­¥éª¤1: ç‰ˆæœ¬æ£€æµ‹
    CLI->>VC: checkVersion()
    VC->>VC: getLocalVersion() è¯»å–æœ¬åœ°ç‰ˆæœ¬
    VC->>VC: getUpstreamVersion() è¯»å–ä¸Šæ¸¸ç‰ˆæœ¬
    VC->>VC: _compareVersions() æ¯”è¾ƒç‰ˆæœ¬
    VC-->>CLI: {needsUpdate, local, upstream, changelog}

    CLI->>User: æ˜¾ç¤ºç‰ˆæœ¬å¯¹æ¯”

    alt å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ && éå¼ºåˆ¶é‡ç½®
        CLI-->>User: âœ… å·²æ˜¯æœ€æ–°ç‰ˆæœ¬
    else éœ€è¦æ›´æ–°
        CLI->>User: æ˜¾ç¤ºæ›´æ–°æ—¥å¿—

        Note over CLI: æ­¥éª¤2: æ›´æ–°è½¯è¿æ¥
        CLI->>SM: updateSymlinks()
        SM->>FS: æ›´æ–° .claude/core-docs/

        Note over CLI: æ­¥éª¤3: æ£€æµ‹åºŸå¼ƒæ–‡ä»¶
        CLI->>Detector: detect(local, upstream)
        Detector-->>CLI: åºŸå¼ƒæ–‡ä»¶åˆ—è¡¨

        alt æœ‰åºŸå¼ƒæ–‡ä»¶
            CLI->>User: æ˜¾ç¤ºåºŸå¼ƒæ–‡ä»¶æ‘˜è¦
            CLI->>User: è¯¢é—®æ˜¯å¦è‡ªåŠ¨å¤„ç†
            User-->>CLI: ç¡®è®¤

            CLI->>Detector: process(obsoleteFiles)
            Detector->>FS: åˆ é™¤/ç§»åŠ¨/å¤‡ä»½åºŸå¼ƒæ–‡ä»¶
        end

        Note over CLI: æ­¥éª¤4: æ£€æµ‹è¦†ç›–å±‚å†²çª
        CLI->>VC: detectOverrideConflicts()
        VC->>VC: æ¯”è¾ƒ markdown/core/ ä¸ä¸Šæ¸¸å“ˆå¸Œ
        VC-->>CLI: å†²çªåˆ—è¡¨

        alt æœ‰å†²çª
            CLI->>User: æç¤º: ä¸Šæ¸¸æ–‡æ¡£æœ‰æ›´æ–°
            CLI->>User: å»ºè®®: æ‰§è¡Œ merge-conflicts åˆå¹¶
        end

        Note over CLI: æ­¥éª¤5: æ›´æ–°manifest
        CLI->>VC: writeManifest()
        VC->>VC: computeBaselineHashes() è®¡ç®—æ–°å“ˆå¸Œ
        VC->>FS: å†™å…¥ workflow-manifest.json

        Note over CLI: æ­¥éª¤6: æ¸…ç†æ—§ç‰ˆæœ¬æ–‡ä»¶
        CLI->>FS: åˆ é™¤ .claude/workflow-version.json (v15.x)

        CLI-->>User: âœ… åŒæ­¥å®Œæˆ
    end
```

#### 10.4.2 åºŸå¼ƒæ–‡ä»¶å¤„ç†ç­–ç•¥

**ObsoleteFileDetectorå¤„ç†åŠ¨ä½œ** ([lib/obsolete-file-detector.js](lib/obsolete-file-detector.js)):

| æ–‡ä»¶ç±»å‹ | åŠ¨ä½œ | è¯´æ˜ |
|---------|------|------|
| **æ ¸å¿ƒæ–‡æ¡£** | `MOVE` | ç§»åŠ¨åˆ° `.obsolete/` å¤‡ä»½ |
| **ç”¨æˆ·å®šåˆ¶æ–‡æ¡£** | `BACKUP` | å¤‡ä»½åˆ° `.obsolete/` å¹¶ä¿ç•™åŸæ–‡ä»¶ |
| **ä¸´æ—¶æ–‡ä»¶** | `DELETE` | ç›´æ¥åˆ é™¤ |
| **è½¯è¿æ¥** | `UNLINK` | è§£é™¤è½¯è¿æ¥ |

**ç¤ºä¾‹è¾“å‡º**:

```
ğŸ§¹ æ£€æµ‹åºŸå¼ƒæ–‡ä»¶...

âš ï¸  å‘ç° 8 ä¸ªåºŸå¼ƒæ–‡ä»¶

   [MOVE] 6 ä¸ªæ–‡ä»¶
   [BACKUP] 1 ä¸ªæ–‡ä»¶
   [DELETE] 1 ä¸ªæ–‡ä»¶

æ˜¯å¦è‡ªåŠ¨å¤„ç†ï¼Ÿ[Y/n]: Y

âœ… å·²å¤„ç† 8 ä¸ªåºŸå¼ƒæ–‡ä»¶
   - ç§»åŠ¨: 6 ä¸ª â†’ .obsolete/
   - å¤‡ä»½: 1 ä¸ª
   - åˆ é™¤: 1 ä¸ª
```

---

## ğŸ® ç¬¬åä¸€ç« ï¼šClaudeå‘½ä»¤ç³»ç»Ÿï¼ˆv17.1ï¼‰

> **æ ¸å¿ƒç‰¹æ€§**: 6ä¸ªç»Ÿä¸€å‘½ä»¤ä½“ç³»ï¼Œè¦†ç›–å¼€å‘å…¨æµç¨‹
>
> **å‘½ä»¤å‰ç¼€**: `/mc` (MODSDK Claude)

### 11.1 6ä¸ªæ ¸å¿ƒå‘½ä»¤æ€»è§ˆ

**å‘½ä»¤æ¨¡æ¿ä½ç½®**: [templates/.claude/commands/](templates/.claude/commands/)

| å‘½ä»¤ | æ¨¡æ¿æ–‡ä»¶ | èŒè´£ | Tokenæ¶ˆè€— | é€‚ç”¨åœºæ™¯ |
|------|---------|------|-----------|----------|
| **/mc** | [mc.md.template](templates/.claude/commands/mc.md.template) | ä¸»å‘½ä»¤ï¼šä»»åŠ¡æ‰§è¡Œ + è‡ªæ£€ + å®¡æ ¸ | 20-100k | æ‰€æœ‰å¼€å‘ä»»åŠ¡ |
| **/mc-review** | [mc-review.md.template](templates/.claude/commands/mc-review.md.template) | æ–¹æ¡ˆå®¡æŸ¥ä¸ä¸“å®¶å®¡æ ¸ | 10-30k | å¤æ‚æ–¹æ¡ˆå®¡æ ¸ |
| **/mc-perf** | [mc-perf.md.template](templates/.claude/commands/mc-perf.md.template) | æ€§èƒ½åˆ†æä¸ä¼˜åŒ– | 15-40k | æ€§èƒ½é—®é¢˜æ’æŸ¥ |
| **/mc-docs** | [mc-docs.md.template](templates/.claude/commands/mc-docs.md.template) | æ–‡æ¡£å®¡è®¡ä¸ç»´æŠ¤ | 5-20k | æ‰¹é‡æ–‡æ¡£ç»´æŠ¤ |
| **/mc-why** | [mc-why.md.template](templates/.claude/commands/mc-why.md.template) | ä»£ç æ„å›¾è¿½æº¯ | 3-10k | ç†è§£ä»£ç è®¾è®¡ |
| **/mc-discover** | [mc-discover.md.template](templates/.claude/commands/mc-discover.md.template) | é¡¹ç›®ç»“æ„å‘ç° | 10-30k | æ–°é¡¹ç›®ç†è§£ |

---

### 11.2 /mc - ä¸»å‘½ä»¤å·¥ä½œæµ

**æ¨¡æ¿æ–‡ä»¶**: [templates/.claude/commands/mc.md.template](templates/.claude/commands/mc.md.template) (843è¡Œ)

#### 11.2.1 æ ¸å¿ƒå·¥ä½œæµï¼ˆ3æ­¥æ³•ï¼‰

```
ğŸ¯ æ­¥éª¤1: ç†è§£ä»»åŠ¡ï¼ˆç¦æ­¢è¯»ä»£ç ï¼‰
   â”œâ”€ æ£€æŸ¥å†å²ä¸Šä¸‹æ–‡ï¼ˆtasks/ï¼‰
   â”œâ”€ è¯†åˆ«ä»»åŠ¡ç±»å‹ï¼ˆå¾®/æ ‡å‡†/å¤æ‚ï¼‰
   â”œâ”€ ç†è§£é—®é¢˜ç°è±¡ï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼Œç¦æ­¢Searchä»£ç ï¼‰
   â””â”€ æ ‡è®°éœ€è¦æŸ¥é˜…çš„æ–‡æ¡£

â¬‡

ğŸ“š æ­¥éª¤2: æŸ¥é˜…æ–‡æ¡£ â­ æ ¸å¿ƒæ­¥éª¤
   â”œâ”€ å¼ºåˆ¶è¦æ±‚: è‡³å°‘Read 3ä¸ªmarkdownæ–‡æ¡£
   â”œâ”€ ç¦æ­¢Search/Read Pythonä»£ç ï¼ˆ.pyæ–‡ä»¶ï¼‰
   â”œâ”€ æ™ºèƒ½é™çº§æŸ¥é˜…:
   â”‚   1. ä¼˜å…ˆ: markdown/core/å¼€å‘è§„èŒƒ.mdï¼ˆé¡¹ç›®å®šåˆ¶ç‰ˆï¼‰
   â”‚   2. é™çº§: .claude/core-docs/å¼€å‘è§„èŒƒ.mdï¼ˆä¸Šæ¸¸åŸºçº¿ï¼‰
   â”œâ”€ å®˜æ–¹æ–‡æ¡£æŸ¥é˜…ï¼ˆä¸‰çº§é™çº§ï¼‰:
   â”‚   1. ä¼˜å…ˆ: .claude/docs/modsdk-wiki/ï¼ˆæœ¬åœ°ç¦»çº¿ï¼‰
   â”‚   2. é™çº§: WebFetch GitHubåŸå§‹æ–‡ä»¶ï¼ˆåœ¨çº¿ï¼‰
   â””â”€ è¾“å‡ºæ ¸å¿ƒæ£€æŸ¥ç‚¹æŠ¥å‘Š

â¬‡

ğŸš¦ æ­¥éª¤2.5: æ–¹æ¡ˆè‡ªæ£€ä¸ä¸“å®¶å®¡æ ¸ â­ v17.1æ–°å¢
   â”œâ”€ ä»»åŠ¡çº§åˆ«åˆ†æ”¯å†³ç­–:
   â”‚   â”œâ”€ ğŸ”´ å¤æ‚ä»»åŠ¡: å¼ºåˆ¶è§¦å‘ä¸“å®¶å®¡æ ¸ï¼ˆæ­¥éª¤2åç›´æ¥è·³è½¬ï¼‰
   â”‚   â”œâ”€ ğŸŸ¡ æ ‡å‡†ä»»åŠ¡: æ‰§è¡Œè‡ªæ£€æ¸…å• â†’ æ™ºèƒ½è§¦å‘ä¸“å®¶å®¡æ ¸
   â”‚   â””â”€ âšª å¾®ä»»åŠ¡: è·³è¿‡æ­¤æ­¥éª¤
   â”‚
   â”œâ”€ è‡ªæ£€æ¸…å•ï¼ˆ5é¡¹æ£€æŸ¥ï¼Œå†…å­˜ä¸ºä¸»ï¼‰:
   â”‚   1. CRITICALè§„èŒƒéªŒè¯ â­â­â­
   â”‚   2. åŒç«¯éš”ç¦»éªŒè¯
   â”‚   3. äº‹ä»¶/APIå­˜åœ¨æ€§éªŒè¯ï¼ˆå¯é€‰GrepæŸ¥è¯¢ï¼‰
   â”‚   4. æ•°æ®æµå®Œæ•´æ€§
   â”‚   5. æœ€ä½³å®è·µéµå¾ª
   â”‚
   â”œâ”€ å¤„ç†å†³ç­–:
   â”‚   â”œâ”€ æœ‰é”™è¯¯é¡¹ â†’ è‡ªåŠ¨ä¿®æ­£ â†’ é‡æ–°è‡ªæ£€
   â”‚   â”œâ”€ åªæœ‰è­¦å‘Šé¡¹ â†’ è¯¢é—®ç”¨æˆ·æ˜¯å¦ç»§ç»­
   â”‚   â””â”€ å…¨éƒ¨é€šè¿‡ â†’ åˆ¤æ–­ä»»åŠ¡çº§åˆ«
   â”‚
   â””â”€ ä¸“å®¶å®¡æ ¸æµç¨‹ï¼ˆè§¦å‘æ¡ä»¶ï¼‰:
       â”œâ”€ ğŸ”´ å¤æ‚ä»»åŠ¡: å¼ºåˆ¶è§¦å‘ï¼ˆæ­¥éª¤2åï¼‰
       â””â”€ ğŸŸ¡ æ ‡å‡†ä»»åŠ¡ï¼ˆæ»¡è¶³ä»¥ä¸‹ä¹‹ä¸€ï¼‰:
           â”œâ”€ 2è½®ä»¥ä¸ŠBugä¿®å¤æœªæˆåŠŸ
           â”œâ”€ è®¾è®¡è·¨è¶Š>5ä¸ªSystem
           â””â”€ ç”¨æˆ·æ˜ç¡®è¦æ±‚å®¡æ ¸

â¬‡

ğŸ”§ æ­¥éª¤3: æ‰§è¡Œä¸æ”¶å°¾
   â”œâ”€ å¾®ä»»åŠ¡: ç›´æ¥Edit + è½»é‡çº§æ–‡æ¡£ç»´æŠ¤
   â”œâ”€ æ ‡å‡†/å¤æ‚ä»»åŠ¡:
   â”‚   â”œâ”€ åˆ›å»ºä»»åŠ¡ä¸Šä¸‹æ–‡ï¼ˆtasks/ï¼‰
   â”‚   â”œâ”€ æ¢ç´¢ä»£ç  + è®¾è®¡æ–¹æ¡ˆ
   â”‚   â”œâ”€ æ‰§è¡Œä¿®æ”¹ï¼ˆæ·»åŠ æ³¨é‡Šï¼‰
   â”‚   â”œâ”€ å¤„ç†ä¸­é€”åé¦ˆ
   â”‚   â””â”€ éªŒè¯ä¿®å¤
   â””â”€ æ”¶å°¾å·¥ä½œï¼ˆç”¨æˆ·æ˜ç¡®"å·²ä¿®å¤"åï¼‰:
       â”œâ”€ æ–‡æ¡£æ›´æ–°ï¼ˆè‡ªåŠ¨è¡¥å……â‰¤2ä¸ªæ–‡æ¡£ï¼‰
       â”œâ”€ DEBUGæ¸…ç†
       â””â”€ å½’æ¡£ä»»åŠ¡
```

---

#### 11.2.2 å¼ºåˆ¶æ–‡æ¡£æŸ¥é˜…æœºåˆ¶ï¼ˆv17.2å¼ºåŒ–ï¼‰

**æ ¸å¿ƒè¦æ±‚**ï¼ˆå¿…é¡»éµå®ˆï¼Œå¦åˆ™è§†ä¸ºè·³è¿‡å·¥ä½œæµï¼‰:

```markdown
âš ï¸ **å¼ºåˆ¶è¦æ±‚**:

1. **å¿…é¡»è‡³å°‘Read 3ä¸ªmarkdownæ–‡æ¡£**ï¼ˆæ¥è‡ª `markdown/` æˆ– `.claude/core-docs/`ï¼‰
2. **å¿…é¡»è¾“å‡º"æ ¸å¿ƒæ£€æŸ¥ç‚¹"æŠ¥å‘Š**ï¼ˆè§æ ¼å¼è¦æ±‚ï¼‰
3. **ç¦æ­¢åœ¨æ­¤æ­¥éª¤Search/Read Pythonä»£ç æ–‡ä»¶**ï¼ˆ`.py`ç»“å°¾çš„æ–‡ä»¶ï¼‰
   - ä¾‹å¤–ï¼šæŸ¥é˜…æ–‡æ¡£ä¸­å¼•ç”¨çš„ä»£ç ç¤ºä¾‹

**âš ï¸ è‡ªæ£€æé†’**:
- å¦‚æœä½ å‘ç°è‡ªå·±åœ¨ä½¿ç”¨ `Search("**/*.py")` æˆ– `Grep(pattern, path="behavior_packs")`
- è¯´æ˜ä½ **è·³è¿‡äº†æ­¥éª¤2çš„æ–‡æ¡£æŸ¥é˜…**ï¼Œè¯·ç«‹å³åœæ­¢å¹¶è¿”å›æœ¬æ­¥éª¤ï¼
```

**æ ¸å¿ƒæ£€æŸ¥ç‚¹æ ¼å¼**ï¼ˆ1127-232è¡Œï¼‰:

```markdown
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… æ­¥éª¤2æ£€æŸ¥ç‚¹ï¼šæ–‡æ¡£æŸ¥é˜…æŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ğŸ“š å·²æŸ¥é˜…æ–‡æ¡£ï¼ˆè‡³å°‘3ä¸ªï¼‰:
   - .claude/core-docs/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md - CRITICALè§„èŒƒ (ç¬¬164-210è¡Œ)
   - .claude/core-docs/æ¦‚å¿µå‚è€ƒ/MODSDKæ ¸å¿ƒæ¦‚å¿µ.md - Partè®¾è®¡æ¨¡å¼ (ç¬¬50-80è¡Œ)
   - markdown/systems/CombatSystem.md - æˆ˜æ–—ç³»ç»Ÿæ¶æ„ (å…¨æ–‡)

2. ğŸ”‘ æå–çš„å…³é”®åŸåˆ™ï¼ˆå¿…é¡»æ¥è‡ªæ–‡æ¡£ï¼Œç¦æ­¢è‡ªè¡Œæ¨æµ‹ï¼‰:
   â›” ç¦æ­¢: åœ¨Part.__init__()ä¸­è°ƒç”¨ä»»ä½•MODSDK API
   âœ… åº”è¯¥: åœ¨Create()æ–¹æ³•ä¸­åˆå§‹åŒ–Componentå’Œæ³¨å†Œäº‹ä»¶
   ğŸ“š åŸå› : ç½‘æ˜“å¼•æ“çš„Systemç”Ÿå‘½å‘¨æœŸé™åˆ¶

3. ğŸ“‹ æ–‡æ¡£ä¾æ®æ¸…å•ï¼ˆç²¾ç¡®åˆ°è¡Œå·ï¼‰:
   - å¼€å‘è§„èŒƒ.md:164 - Systemç”Ÿå‘½å‘¨æœŸè§„èŒƒ
   - MODSDKæ ¸å¿ƒæ¦‚å¿µ.md:72 - Partåˆå§‹åŒ–æµç¨‹è¯´æ˜

4. ğŸŒ å®˜æ–¹æ–‡æ¡£æŸ¥é˜…ï¼ˆå¦‚æœ‰ï¼‰:
   - ğŸ“¦ æœ¬åœ°ç¦»çº¿æ–‡æ¡£ï¼š[è·¯å¾„] - [æŸ¥é˜…çš„API]
   - ğŸŒ åœ¨çº¿æŸ¥è¯¢ï¼š[GitHubè·¯å¾„] - [æŸ¥é˜…çš„API]

âš ï¸ ç¡®è®¤æ£€æŸ¥ç‚¹è¾“å‡ºå®Œæˆåï¼Œæ‰èƒ½è¿›å…¥ä¸‹ä¸€æ­¥ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

#### 11.2.3 æ–¹æ¡ˆè‡ªæ£€æ¸…å•ï¼ˆ5é¡¹æ£€æŸ¥ï¼‰

**æ ¸å¿ƒè®¾è®¡**: å†…å­˜æ£€æŸ¥ä¸ºä¸»ï¼Œæœ€å¤š2æ¬¡GrepæŸ¥è¯¢

**æ£€æŸ¥1: CRITICALè§„èŒƒéªŒè¯**ï¼ˆ260-290è¡Œï¼‰â­â­â­:

```python
violations = []

# è§„èŒƒ1: åŒç«¯éš”ç¦»åŸåˆ™
if æ–¹æ¡ˆä¸­å­˜åœ¨è·¨ç«¯GetSystem:
    violations.append("âŒ è¿åè§„èŒƒ1: è·¨ç«¯GetSystem")

# è§„èŒƒ2: Systemç”Ÿå‘½å‘¨æœŸé™åˆ¶
if __init__ä¸­è°ƒç”¨API ä¸” æœªæ‰‹åŠ¨è°ƒç”¨self.Create():
    violations.append("âŒ è¿åè§„èŒƒ2: __init__ä¸­è°ƒç”¨API")

# è§„èŒƒ3: EventDataåºåˆ—åŒ–é™åˆ¶
if EventDataä¸­ä½¿ç”¨tuple:
    violations.append("âŒ è¿åè§„èŒƒ3: tupleç±»å‹")

# è§„èŒƒ4: AOIæ„Ÿåº”åŒºèŒƒå›´é™åˆ¶
if AddAoiå‚æ•°è¶…è¿‡2000:
    violations.append("âŒ è¿åè§„èŒƒ4: AOIè¶…é™")
```

**æ£€æŸ¥3: äº‹ä»¶/APIå­˜åœ¨æ€§éªŒè¯**ï¼ˆ291-299è¡Œï¼‰:

```python
# å¯é€‰ï¼šæŸ¥è¯¢ç´¢å¼•è¡¨ï¼ˆæ¯ä¸ª<150 tokensï¼‰
for event_name in æ–¹æ¡ˆä¸­çš„äº‹ä»¶åˆ—è¡¨:
    Grep(event_name, path=".claude/docs/modsdk-wiki/.../äº‹ä»¶ç´¢å¼•è¡¨.md")
    # éªŒè¯: äº‹ä»¶å­˜åœ¨? ç«¯åˆ«åŒ¹é…?

for api_name in æ–¹æ¡ˆä¸­çš„APIåˆ—è¡¨:
    Grep(api_name, path=".claude/docs/modsdk-wiki/.../Apiç´¢å¼•è¡¨.md")
    # éªŒè¯: APIå­˜åœ¨? ç«¯åˆ«åŒ¹é…?
```

**æ£€æŸ¥4: æ•°æ®æµå®Œæ•´æ€§**ï¼ˆ300-307è¡Œï¼‰:

```python
# ç»˜åˆ¶æ•°æ®æµå›¾ï¼Œæ£€æŸ¥:
# - æ˜¯å¦é—­ç¯? (è¾“å…¥â†’å¤„ç†â†’è¾“å‡º)
# - æ˜¯å¦é—æ¼å…³é”®æ­¥éª¤? (æƒé™æ ¡éªŒ/é”™è¯¯å¤„ç†/ç”¨æˆ·åé¦ˆ)
# - æ˜¯å¦å­˜åœ¨å¾ªç¯ä¾èµ–?
```

---

#### 11.2.4 å¤„ç†å†³ç­–æµç¨‹

**å†³ç­–æ ‘**ï¼ˆ357-433è¡Œï¼‰:

```python
# å†³ç­–1: æœ‰é”™è¯¯é¡¹ â†’ è‡ªåŠ¨ä¿®æ­£
if error_count > 0:
    print("## ğŸ”§ è‡ªåŠ¨ä¿®æ­£æ–¹æ¡ˆ")

    for error in errors:
        if error["type"] == "è¿åè§„èŒƒ2":
            # å°†__init__ä¸­çš„APIè°ƒç”¨ç§»åˆ°Create()
            ä¿®æ­£ä»£ç æ¡†æ¶
        elif error["type"] == "è·¨ç«¯GetSystem":
            # æ›¿æ¢ä¸ºNotifyToClient/NotifyToServer
            ä¿®æ­£åŒç«¯é€šä¿¡

    print("âœ… ä¿®æ­£å®Œæˆï¼Œé‡æ–°æ‰§è¡Œè‡ªæ£€...")
    goto 2.5.1  # é‡æ–°è‡ªæ£€

# å†³ç­–2: åªæœ‰è­¦å‘Šé¡¹ â†’ è¯¢é—®ç”¨æˆ·
if error_count == 0 and warning_count > 0:
    print("## âš ï¸ å‘ç° {} ä¸ªè­¦å‘Šé¡¹".format(warning_count))
    è¯¢é—®: "å‘ç°è­¦å‘Šé¡¹ï¼Œæ˜¯å¦ç»§ç»­å®æ–½ï¼Ÿ[ç»§ç»­/ä¼˜åŒ–åå†å®æ–½]"

# å†³ç­–3: å…¨éƒ¨é€šè¿‡ â†’ åˆ¤æ–­ä»»åŠ¡çº§åˆ«
if error_count == 0 and warning_count == 0:
    # 3.1 å¤æ‚ä»»åŠ¡ â†’ å¼ºåˆ¶è§¦å‘ä¸“å®¶å®¡æ ¸
    if ä»»åŠ¡çº§åˆ« == "ğŸ”´ å¤æ‚ä»»åŠ¡":
        goto æ­¥éª¤2.5.4_ä¸“å®¶å®¡æ ¸

    # 3.2 æ ‡å‡†ä»»åŠ¡ â†’ æ™ºèƒ½è§¦å‘ï¼ˆ3é¡¹æ£€æŸ¥ï¼‰
    elif ä»»åŠ¡çº§åˆ« == "ğŸŸ¡ æ ‡å‡†ä»»åŠ¡":
        # æ£€æŸ¥1: 2è½®ä»¥ä¸ŠBugä¿®å¤?
        if ç”¨æˆ·éœ€æ±‚åŒ…å«["ä¿®å¤","BUG"]å…³é”®è¯:
            æ‰§è¡ŒBash: ls -d tasks/*ä¿®å¤* tasks/*bug* 2>/dev/null | wc -l
            if å†å²ä»»åŠ¡æ•° >= 2:
                goto æ­¥éª¤2.5.4_ä¸“å®¶å®¡æ ¸

        # æ£€æŸ¥2: æ¶‰åŠ>5ä¸ªSystem?
        å›é¡¾è‡ªæ£€æŠ¥å‘Šï¼Œç»Ÿè®¡Systemæ•°é‡
        if Systemæ•°é‡ > 5:
            goto æ­¥éª¤2.5.4_ä¸“å®¶å®¡æ ¸

        # æ£€æŸ¥3: ç”¨æˆ·è¦æ±‚å®¡æ ¸?
        if ç”¨æˆ·éœ€æ±‚åŒ…å«["å®¡æ ¸","review"]å…³é”®è¯:
            goto æ­¥éª¤2.5.4_ä¸“å®¶å®¡æ ¸

        # æœªè§¦å‘ â†’ ç›´æ¥å®æ–½
        goto æ­¥éª¤3

    # 3.3 å¾®ä»»åŠ¡ â†’ ç›´æ¥å®æ–½
    else:
        goto æ­¥éª¤3
```

---

### 11.3 /mc-review - æ–¹æ¡ˆå®¡æŸ¥ä¸ä¸“å®¶å®¡æ ¸

**æ¨¡æ¿æ–‡ä»¶**: [templates/.claude/commands/mc-review.md.template](templates/.claude/commands/mc-review.md.template) (379è¡Œ)

#### 11.3.1 ä¸“å®¶å®¡æ ¸è¯„åˆ†ä½“ç³»

**æ€»åˆ†**: 10åˆ†

| è¯„åˆ†é¡¹ | åˆ†å€¼ | æ£€æŸ¥ç‚¹ |
|-------|------|--------|
| **éœ€æ±‚è¦†ç›–ç‡** | 2åˆ† | æ˜¯å¦å®Œæ•´æ»¡è¶³ç”¨æˆ·éœ€æ±‚ |
| **CRITICALè§„èŒƒç¬¦åˆæ€§** | 3åˆ† | 4é¡¹CRITICALè§„èŒƒï¼Œæ¯è¿åä¸€é¡¹-1åˆ† |
| **æ¶æ„åˆç†æ€§** | 1åˆ† | ç«¯åˆ«åˆ†å·¥ã€æ•°æ®æµã€æ¨¡å—åˆ’åˆ† |
| **API/äº‹ä»¶é€‰æ‹©** | 1åˆ† | APIé€‰æ‹©æœ€ä¼˜ã€äº‹ä»¶ç›‘å¬å®Œæ•´ |
| **è¾¹ç•Œåœºæ™¯** | 2åˆ† | é”™è¯¯å¤„ç†ã€å¹¶å‘é—®é¢˜ã€æ€§èƒ½å½±å“ |
| **å®ç°ç»†èŠ‚** | 1åˆ† | ä»£ç æ¡†æ¶ã€å‘½åè§„èŒƒã€æ³¨é‡Šæ–‡æ¡£ |

#### 11.3.2 CRITICALè§„èŒƒç¬¦åˆæ€§æ£€æŸ¥

**æ£€æŸ¥ç‚¹**ï¼ˆ43-69è¡Œï¼‰:

```markdown
**æ£€æŸ¥ç‚¹**:
- [ ] **è§„èŒƒ1: åŒç«¯éš”ç¦»åŸåˆ™**
  - æ˜¯å¦è·¨ç«¯GetSystemï¼Ÿ
  - åŒç«¯é€šä¿¡æ˜¯å¦ä½¿ç”¨Notifyæ–¹æ³•ï¼Ÿ

- [ ] **è§„èŒƒ2: Systemç”Ÿå‘½å‘¨æœŸé™åˆ¶**
  - æ˜¯å¦åœ¨__init__ä¸­è°ƒç”¨APIï¼Ÿ
  - æ˜¯å¦æ‰‹åŠ¨è°ƒç”¨Create()ï¼Ÿ

- [ ] **è§„èŒƒ3: EventDataåºåˆ—åŒ–é™åˆ¶**
  - EventDataä¸­æ˜¯å¦ä½¿ç”¨tupleï¼Ÿ

- [ ] **è§„èŒƒ4: AOIæ„Ÿåº”åŒºèŒƒå›´é™åˆ¶**
  - AOIèŒƒå›´æ˜¯å¦è¶…è¿‡2000æ ¼ï¼Ÿ

**è¾“å‡ºæ ¼å¼**:
```markdown
### CRITICALè§„èŒƒç¬¦åˆæ€§
**è¯„åˆ†**: X/3ï¼ˆæ¯è¿åä¸€é¡¹-1åˆ†ï¼‰

**æ£€æŸ¥ç»“æœ**:
- âœ… è§„èŒƒ1: åŒç«¯éš”ç¦» - [é€šè¿‡/è¿å: å…·ä½“é—®é¢˜]
- âœ… è§„èŒƒ2: Systemç”Ÿå‘½å‘¨æœŸ - [é€šè¿‡/è¿å: å…·ä½“é—®é¢˜]
- âœ… è§„èŒƒ3: EventDataåºåˆ—åŒ– - [é€šè¿‡/è¿å: å…·ä½“é—®é¢˜]
- âœ… è§„èŒƒ4: AOIèŒƒå›´é™åˆ¶ - [é€šè¿‡/è¿å: å…·ä½“é—®é¢˜]
```

#### 11.3.3 å®¡æ ¸æŠ¥å‘Šæ ¼å¼

**å®Œæ•´æŠ¥å‘Š**ï¼ˆ239-321è¡Œï¼‰:

```markdown
# MODSDKæ–¹æ¡ˆæ·±åº¦å®¡æ ¸æŠ¥å‘Š

## ğŸ¯ å®¡æ ¸è¯„åˆ†

**æ€»åˆ†**: X/10

- éœ€æ±‚è¦†ç›–ç‡: X/2
- æŠ€æœ¯æ–¹æ¡ˆ: X/5
  - CRITICALè§„èŒƒç¬¦åˆæ€§: X/3
  - æ¶æ„åˆç†æ€§: X/1
  - API/äº‹ä»¶é€‰æ‹©: X/1
- è¾¹ç•Œåœºæ™¯: X/2
- å®ç°ç»†èŠ‚: X/1

---

## âŒ ä¸¥é‡é—®é¢˜ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰

### é—®é¢˜1: [é—®é¢˜æ ‡é¢˜]
- **ä½ç½®**: [ä»£ç ä½ç½®]
- **é—®é¢˜æè¿°**: [è¯¦ç»†æè¿°]
- **ä¿®æ­£å»ºè®®**: [å¦‚ä½•ä¿®æ”¹]
- **å½±å“**: [ä¸ä¿®æ”¹çš„åæœ]
- **æ–‡æ¡£ä¾æ®**: [å¼•ç”¨ç›¸å…³æ–‡æ¡£]

---

## âš ï¸ è­¦å‘Šé—®é¢˜ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰

### è­¦å‘Š1: [è­¦å‘Šæ ‡é¢˜]
- **ä½ç½®**: [ä»£ç ä½ç½®]
- **ä¼˜åŒ–å»ºè®®**: [å¦‚ä½•ä¼˜åŒ–]
- **å½±å“**: [ä¸ä¼˜åŒ–çš„å½±å“]

---

## âœ… æ–¹æ¡ˆä¼˜ç‚¹

1. [ä¼˜ç‚¹1] - [å…·ä½“è¯´æ˜]
2. [ä¼˜ç‚¹2] - ...

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### å»ºè®®1: [å»ºè®®æ ‡é¢˜]
- **ç†ç”±**: [ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–]
- **æ–¹æ¡ˆ**: [å…·ä½“ä¼˜åŒ–æ–¹æ¡ˆ]
- **é¢„æœŸæ”¶ç›Š**: [ä¼˜åŒ–åçš„æ•ˆæœ]

---

## ğŸ“ å®¡æ ¸ç»“è®º

**ç»¼åˆè¯„ä»·**: [æ–¹æ¡ˆæ•´ä½“è¯„ä»·]

**æ˜¯å¦å»ºè®®é€šè¿‡**:
- âœ… é€šè¿‡ï¼ˆè¯„åˆ†â‰¥8åˆ†ï¼‰- æ–¹æ¡ˆè´¨é‡ä¼˜ç§€ï¼Œå¯ä»¥å®æ–½
- âš ï¸ æœ‰æ¡ä»¶é€šè¿‡ï¼ˆè¯„åˆ†6-7åˆ†ï¼‰- éœ€æ ¹æ®å»ºè®®è°ƒæ•´åå®æ–½
- âŒ ä¸é€šè¿‡ï¼ˆè¯„åˆ†<6åˆ†ï¼‰- å­˜åœ¨ä¸¥é‡é—®é¢˜ï¼Œéœ€é‡æ–°è®¾è®¡

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
- [çˆ¶ä»£ç†åº”è¯¥é‡‡å–çš„è¡ŒåŠ¨]
```

---

### 11.4 /mc-perf - æ€§èƒ½åˆ†æä¸ä¼˜åŒ–

**æ¨¡æ¿æ–‡ä»¶**: [templates/.claude/commands/mc-perf.md.template](templates/.claude/commands/mc-perf.md.template)

**æ ¸å¿ƒèŒè´£**:
- ğŸ” æ€§èƒ½é—®é¢˜è¯Šæ–­ï¼ˆTické¢‘ç‡ã€å†…å­˜å ç”¨ã€ç½‘ç»œæµé‡ï¼‰
- ğŸ“Š æ€§èƒ½æ•°æ®åˆ†æï¼ˆæ—¥å¿—åˆ†æã€æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡ï¼‰
- ğŸ’¡ ä¼˜åŒ–å»ºè®®ï¼ˆç¼“å­˜æœºåˆ¶ã€ç®—æ³•ä¼˜åŒ–ã€æ•°æ®ç»“æ„æ”¹è¿›ï¼‰

**å…¸å‹ä½¿ç”¨åœºæ™¯**:
```
/mc-perf "æœåŠ¡å™¨æ¯éš”å‡ ç§’å°±å¡é¡¿ä¸€ä¸‹"
/mc-perf "å®¢æˆ·ç«¯å†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜"
/mc-perf "å¤§é‡ç©å®¶åœ¨çº¿æ—¶å»¶è¿Ÿä¸¥é‡"
```

---

### 11.5 /mc-docs - æ–‡æ¡£å®¡è®¡ä¸ç»´æŠ¤

**æ¨¡æ¿æ–‡ä»¶**: [templates/.claude/commands/mc-docs.md.template](templates/.claude/commands/mc-docs.md.template)

**æ ¸å¿ƒèŒè´£**:
- ğŸ“ æ–‡æ¡£è´¨é‡è¯„ä¼°ï¼ˆå®Œæ•´æ€§ã€å‡†ç¡®æ€§ã€æ¸…æ™°åº¦ï¼‰
- ğŸ” æ–‡æ¡£ç¼ºå¤±æ£€æµ‹ï¼ˆsystems/ã€æ¡†æ¶æ–‡æ¡£ï¼‰
- âœï¸ æ‰¹é‡æ–‡æ¡£æ›´æ–°ï¼ˆSystemæ–‡æ¡£ç”Ÿæˆ/æ›´æ–°ï¼‰

**å…¸å‹ä½¿ç”¨åœºæ™¯**:
```
/mc-docs "å®¡è®¡æ‰€æœ‰Systemæ–‡æ¡£è´¨é‡"
/mc-docs "æ‰¹é‡ç”Ÿæˆç¼ºå¤±çš„Systemæ–‡æ¡£"
/mc-docs "æ›´æ–°è¿‡æ—¶çš„æ–‡æ¡£"
```

---

### 11.6 /mc-why - ä»£ç æ„å›¾è¿½æº¯

**æ¨¡æ¿æ–‡ä»¶**: [templates/.claude/commands/mc-why.md.template](templates/.claude/commands/mc-why.md.template)

**æ ¸å¿ƒèŒè´£**:
- ğŸ” ä»£ç è®¾è®¡æ„å›¾è§£é‡Š
- ğŸ“– å†å²ä¸Šä¸‹æ–‡è¿½æº¯ï¼ˆGitå†å²ã€ä»»åŠ¡è®°å½•ï¼‰
- ğŸ’¡ è®¾è®¡æ¨¡å¼è¯†åˆ«ï¼ˆPartæ¨¡å¼ã€çŠ¶æ€æœºã€è§‚å¯Ÿè€…æ¨¡å¼ï¼‰

**å…¸å‹ä½¿ç”¨åœºæ™¯**:
```
/mc-why "ä¸ºä»€ä¹ˆCombatSystemè¦åœ¨Createä¸­åˆå§‹åŒ–Componentï¼Ÿ"
/mc-why "ä¸ºä»€ä¹ˆWeaponPartä½¿ç”¨äº†è¿™ç§è®¾è®¡æ¨¡å¼ï¼Ÿ"
/mc-why "ä¸ºä»€ä¹ˆè¦ä½¿ç”¨NotifyToClientè€Œä¸æ˜¯ç›´æ¥GetSystemï¼Ÿ"
```

---

### 11.7 /mc-discover - é¡¹ç›®ç»“æ„å‘ç°

**æ¨¡æ¿æ–‡ä»¶**: [templates/.claude/commands/mc-discover.md.template](templates/.claude/commands/mc-discover.md.template)

**æ ¸å¿ƒèŒè´£**:
- ğŸ” è‡ªåŠ¨å‘ç°é¡¹ç›®ç»„ä»¶ï¼ˆSystemsã€Presetsã€è‡ªå®šä¹‰ç»„ä»¶ï¼‰
- ğŸ“Š ç”Ÿæˆé¡¹ç›®ç»“æ„æŠ¥å‘Š
- ğŸ’¡ æ¨æ–­è§„èŒƒåŒ–æ–‡æ¡£ç»“æ„

**å…¸å‹ä½¿ç”¨åœºæ™¯**:
```
/mc-discover  # å…¨é¢å‘ç°é¡¹ç›®ç»“æ„
```

**è¾“å‡ºç¤ºä¾‹**:

```markdown
# ğŸ“Š é¡¹ç›®ç»“æ„å‘ç°æŠ¥å‘Š

## ğŸ¯ é¡¹ç›®æ¦‚å†µ
- é¡¹ç›®åç§°: MyRPGGame
- é¡¹ç›®ç±»å‹: RPG
- é¡¹ç›®è§„æ¨¡: medium (12 Systems)

## ğŸ“ ä»£ç ç»“æ„

### Systemsæ¸…å•ï¼ˆæŒ‰å¤æ‚åº¦æ’åºï¼‰
| Systemåç§° | ç±»å‹ | ä»£ç è¡Œæ•° | å¤æ‚åº¦ | æ¨èè¯¦ç»†åº¦ |
|-----------|------|---------|--------|-----------|
| CombatServerSystem | ServerSystem | 680 | 9/10 | detailed |
| SkillServerSystem | ServerSystem | 520 | 8/10 | detailed |
| PlayerDataServerSystem | ServerSystem | 380 | 6/10 | medium |
| ...

### è‡ªå®šä¹‰ç»„ä»¶ç›®å½•
- scripts/utils/ - å·¥å…·å‡½æ•°
- scripts/common/ - é€šç”¨æ¨¡å—
- configs/ - é…ç½®æ–‡ä»¶

## ğŸ“š æ¨èæ–‡æ¡£ç»“æ„

å»ºè®®åˆ›å»ºä»¥ä¸‹æ–‡æ¡£:

- markdown/systems/CombatServerSystem.md (è¯¦ç»†æ–‡æ¡£ï¼Œ~2500å­—)
- markdown/systems/SkillServerSystem.md (è¯¦ç»†æ–‡æ¡£ï¼Œ~2500å­—)
- markdown/systems/PlayerDataServerSystem.md (ä¸­ç­‰æ–‡æ¡£ï¼Œ~1500å­—)
- markdown/æ¡†æ¶/RPGæ¡†æ¶æ€»è§ˆ.md
```

---

### 11.8 å‘½ä»¤åä½œå…³ç³»å›¾

```mermaid
graph TB
    User[ç”¨æˆ·] --> MC[/mc ä¸»å‘½ä»¤]

    MC --> Step1[æ­¥éª¤1: ç†è§£ä»»åŠ¡]
    MC --> Step2[æ­¥éª¤2: æŸ¥é˜…æ–‡æ¡£]
    MC --> Step25[æ­¥éª¤2.5: è‡ªæ£€ä¸å®¡æ ¸]
    MC --> Step3[æ­¥éª¤3: æ‰§è¡Œä¸æ”¶å°¾]

    Step25 --> SelfCheck{è‡ªæ£€æ¸…å•}
    SelfCheck -->|æœ‰é”™è¯¯é¡¹| AutoFix[è‡ªåŠ¨ä¿®æ­£]
    AutoFix --> SelfCheck

    SelfCheck -->|å…¨éƒ¨é€šè¿‡| TaskLevel{ä»»åŠ¡çº§åˆ«}

    TaskLevel -->|å¤æ‚ä»»åŠ¡| Review[/mc-review ä¸“å®¶å®¡æ ¸]
    TaskLevel -->|æ ‡å‡†ä»»åŠ¡+è§¦å‘æ¡ä»¶| Review
    TaskLevel -->|æ ‡å‡†ä»»åŠ¡+æœªè§¦å‘| Step3
    TaskLevel -->|å¾®ä»»åŠ¡| Step3

    Review --> ReviewReport[å®¡æ ¸æŠ¥å‘Š]
    ReviewReport -->|è¯„åˆ†â‰¥8| Step3
    ReviewReport -->|è¯„åˆ†<8| Modify[ä¿®æ”¹æ–¹æ¡ˆ]
    Modify --> Review

    Step3 --> Docs[/mc-docs æ–‡æ¡£ç»´æŠ¤]

    User -.ç‹¬ç«‹ä½¿ç”¨.-> Discover[/mc-discover ç»“æ„å‘ç°]
    User -.ç‹¬ç«‹ä½¿ç”¨.-> Perf[/mc-perf æ€§èƒ½åˆ†æ]
    User -.ç‹¬ç«‹ä½¿ç”¨.-> Why[/mc-why æ„å›¾è¿½æº¯]

    Step2 -.æŸ¥é˜….-> CoreDocs[.claude/core-docs/]
    Step2 -.æŸ¥é˜….-> SystemDocs[markdown/systems/]
    Step2 -.æŸ¥é˜….-> OfficialDocs[.claude/docs/]

    style MC fill:#4caf50,color:#fff
    style Review fill:#ff9800,color:#fff
    style SelfCheck fill:#2196f3,color:#fff
    style TaskLevel fill:#9c27b0,color:#fff
```

---

## ğŸ“ é™„å½•

### A. ç‰ˆæœ¬å†å²

è¯¦è§ [CHANGELOG.md](CHANGELOG.md)

**ä¸»è¦é‡Œç¨‹ç¢‘**:

| ç‰ˆæœ¬ | å‘å¸ƒæ—¥æœŸ | æ ¸å¿ƒç‰¹æ€§ |
|------|---------|---------|
| **v17.3.0** | 2025-11-12 | ä¿®å¤ä¸“å®¶å®¡æ ¸è§¦å‘æœºåˆ¶ï¼ˆå¤æ‚ä»»åŠ¡å‰ç§»+æ ‡å‡†ä»»åŠ¡æ˜¾å¼æ£€æŸ¥ï¼‰ |
| **v17.2.0** | 2025-11-12 | å¼ºåŒ–æ­¥éª¤2å¼ºåˆ¶æ–‡æ¡£æŸ¥é˜…æœºåˆ¶ |
| **v17.1.0** | 2025-11-12 | æ–¹æ¡ˆè‡ªæ£€ä¸ä¸“å®¶å®¡æ ¸æµç¨‹ |
| **v16.3.0** | 2025-11-11 | æ¸…ç†templates/å†—ä½™æ–‡æ¡£ |
| **v16.0.0** | 2025-11-05 | åŒå±‚æ–‡æ¡£æ¶æ„ |

---

### B. ç›¸å…³èµ„æºé“¾æ¥

- **GitHubä»“åº“**: https://github.com/jju666/NeteaseMod-Claude
- **é—®é¢˜è¿½è¸ª**: https://github.com/jju666/NeteaseMod-Claude/issues
- **ç½‘æ˜“MODSDKæ–‡æ¡£**: https://github.com/EaseCation/netease-modsdk-wiki
- **Bedrock Wiki**: https://github.com/Bedrock-OSS/bedrock-wiki

---

### C. æœ¯è¯­è¡¨

| æœ¯è¯­ | è‹±æ–‡ | è¯´æ˜ |
|-----|------|------|
| **ä¸Šæ¸¸é¡¹ç›®** | Upstream Project | NeteaseMod-Claude æœ¬èº«ï¼ˆå·¥ä½œæµç”Ÿæˆå™¨ï¼‰ |
| **ä¸‹æ¸¸é¡¹ç›®** | Downstream Project | ç”¨æˆ·çš„MODSDKæ¸¸æˆé¡¹ç›® |
| **åŒå±‚æ–‡æ¡£æ¶æ„** | Dual-Layer Architecture | ä¸Šæ¸¸åŸºçº¿å±‚ + é¡¹ç›®è¦†ç›–å±‚ |
| **è½¯è¿æ¥** | Symlink | æ–‡ä»¶ç³»ç»Ÿé“¾æ¥ï¼ˆjunction on Windowsï¼‰ |
| **Layer 1/2/3** | - | æ–‡æ¡£ç”Ÿæˆä¸‰å±‚æ¶æ„ï¼ˆé€šç”¨/æ¶æ„/ä¸šåŠ¡ï¼‰ |
| **å ä½ç¬¦** | Placeholder | æ¨¡æ¿å˜é‡ï¼ˆå¦‚ `{{PROJECT_PATH}}`ï¼‰ |

---

## âš¡ ç¬¬åäºŒç« :å…³é”®ç‰¹æ€§ä¸æŠ€æœ¯äº®ç‚¹

> **æœ¬ç« å¯¼èˆª**: å±•ç¤ºNeteaseMod-Claudeå·¥ä½œæµçš„æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°ç‚¹å’Œè®¾è®¡äº®ç‚¹

### 12.1 åŒå±‚æ–‡æ¡£æ¶æ„ï¼ˆâ­â­â­â­â­ï¼‰

**æŠ€æœ¯è¯„åˆ†**: 5/5ï¼ˆæ ¸å¿ƒåˆ›æ–°ï¼‰

**è®¾è®¡ç›®æ ‡**: è§£å†³å·¥ä½œæµå‡çº§ä¸ç”¨æˆ·å®šåˆ¶çš„å†²çªé—®é¢˜

**å®ç°æœºåˆ¶**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸Šæ¸¸åŸºçº¿å±‚ï¼ˆ.claude/core-docs/ï¼‰    â”‚
â”‚ - è½¯è¿æ¥åˆ°ä¸Šæ¸¸markdown/             â”‚
â”‚ - å‡çº§æ—¶è‡ªåŠ¨åŒæ­¥                    â”‚
â”‚ - ç”¨æˆ·åªè¯»è®¿é—®                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ AIæ™ºèƒ½é™çº§æŸ¥é˜…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡¹ç›®è¦†ç›–å±‚ï¼ˆmarkdown/core/ï¼‰        â”‚
â”‚ - ç”¨æˆ·å¯ç¼–è¾‘å®šåˆ¶                    â”‚
â”‚ - å‡çº§æ—¶å®Œå…¨ä¿ç•™                    â”‚
â”‚ - ä¼˜å…ˆçº§é«˜äºä¸Šæ¸¸åŸºçº¿                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **é›¶å†²çªå‡çº§**: `initmc --sync` åªæ›´æ–°è½¯è¿æ¥,ä¸å½±å“ç”¨æˆ·å®šåˆ¶
2. **çµæ´»å®šåˆ¶**: ç”¨æˆ·å¯è¦†ç›–ä»»æ„æ ¸å¿ƒæ–‡æ¡£
3. **è‡ªåŠ¨åŒæ­¥**: è½¯è¿æ¥æ¨¡å¼ä¸‹,ä¸Šæ¸¸æ–‡æ¡£å®æ—¶åŒæ­¥
4. **é™çº§ä¿æŠ¤**: Windowsæƒé™ä¸è¶³æ—¶è‡ªåŠ¨åˆ›å»ºåªè¯»å‰¯æœ¬

**åº”ç”¨åœºæ™¯**:
- å¤šä¸ªMODSDKé¡¹ç›®å…±ç”¨ä¸€å¥—å·¥ä½œæµ
- å›¢é˜Ÿåä½œæ—¶ç»Ÿä¸€è§„èŒƒ+é¡¹ç›®ç‰¹æ®Šéœ€æ±‚
- å·¥ä½œæµé¢‘ç¹è¿­ä»£ä½†ä¸å½±å“å·²éƒ¨ç½²é¡¹ç›®

**è¯¦è§**: [ç¬¬å››ç« : æ ¸å¿ƒæœºåˆ¶è¯¦è§£ - 4.1 åŒå±‚æ–‡æ¡£æ¶æ„](#41-åŒå±‚æ–‡æ¡£æ¶æ„v160æ ¸å¿ƒè®¾è®¡)

---

### 12.2 ä¸‰å±‚æ–‡æ¡£ç”Ÿæˆï¼ˆâ­â­â­â­ï¼‰

**æŠ€æœ¯è¯„åˆ†**: 4/5ï¼ˆæ¶æ„è®¾è®¡ä¼˜ç§€ï¼‰

**è®¾è®¡ç›®æ ‡**: åˆ†å±‚ç”Ÿæˆ,æŒ‰éœ€éƒ¨ç½²,é¿å…è¿‡åº¦ç”Ÿæˆ

**ä¸‰å±‚æ¶æ„**:

| Layer | åç§° | ç”Ÿæˆæ—¶æœº | æ›´æ–°é¢‘ç‡ | å…¸å‹å†…å®¹ |
|-------|------|---------|---------|---------|
| **Layer 1** | é€šç”¨å±‚ | é¦–æ¬¡`initmc` | å‡çº§æ—¶æ›´æ–° | CLAUDE.mdã€.claude/commands/ã€è½¯è¿æ¥ |
| **Layer 2** | æ¶æ„å±‚ | é¦–æ¬¡`initmc` | AIæ£€æµ‹ç¼ºå¤±æ—¶ç”Ÿæˆ | markdown/systems/ï¼ˆSystemæ–‡æ¡£ï¼‰ |
| **Layer 3** | ä¸šåŠ¡å±‚ | æ ¹æ®é¡¹ç›®ç±»å‹ | AIå¼€å‘æ—¶è¡¥å…… | markdown/NEWRPG/ï¼ˆä¸šåŠ¡æ¡†æ¶ï¼‰ |

**æ™ºèƒ½ç”Ÿæˆå†³ç­–**:

```python
# æ–‡æ¡£è´¨é‡è¯„ä¼°ï¼ˆ0-5åˆ†åˆ¶ï¼‰
quality_score = assess_doc_quality(existing_doc)

if quality_score >= 3:
    skip_generation()  # ä¿ç•™é«˜è´¨é‡æ–‡æ¡£
elif quality_score < 3:
    regenerate_with_warning()  # æç¤ºè¦†ç›–ä½è´¨é‡æ–‡æ¡£
```

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **æŒ‰éœ€ç”Ÿæˆ**: é¿å…è¦†ç›–ç”¨æˆ·å·²ç¼–å†™çš„é«˜è´¨é‡æ–‡æ¡£
2. **æ¸è¿›å¼**: å¯ä»¥å…ˆéƒ¨ç½²Layer 1,åç»­æŒ‰éœ€ç”ŸæˆLayer 2/3
3. **æ™ºèƒ½æ£€æµ‹**: é€šè¿‡4çº§åŒ¹é…ç­–ç•¥è¯†åˆ«ç°æœ‰æ–‡æ¡£
4. **è´¨é‡è¯„ä¼°**: 0-5åˆ†åˆ¶è¯„ä¼°æ–‡æ¡£è´¨é‡,å†³å®šæ˜¯å¦ä¿ç•™

**æ€§èƒ½ä¼˜åŒ–**:
- é¦–æ¬¡éƒ¨ç½²: 20-35k tokensï¼ˆLayer 1 + Layer 2æ¡†æ¶ï¼‰
- å¢é‡æ›´æ–°: 5-10k tokensï¼ˆåªæ›´æ–°å˜åŒ–éƒ¨åˆ†ï¼‰

**è¯¦è§**: [ç¬¬å…­ç« : æ–‡æ¡£ç”Ÿæˆå™¨æ·±åº¦è§£æ](#-ç¬¬å…­ç« æ–‡æ¡£ç”Ÿæˆå™¨æ·±åº¦è§£æ)

---

### 12.3 è‡ªé€‚åº”ç»„ä»¶å‘ç°ï¼ˆâ­â­â­â­ï¼‰

**æŠ€æœ¯è¯„åˆ†**: 4/5ï¼ˆv2.0æ ¸å¿ƒç‰¹æ€§ï¼‰

**è®¾è®¡ç›®æ ‡**: è‡ªåŠ¨å‘ç°éæ ‡å‡†ç»„ä»¶,é¿å…æ‰‹åŠ¨ç»´æŠ¤

**å‘ç°èŒƒå›´**:

```
1. æ ‡å‡†ç»„ä»¶ï¼ˆä¼ ç»Ÿæ–¹å¼,æ­£åˆ™åŒ¹é…ï¼‰
   â””â”€ Systemç±»ï¼ˆServerSystem/ClientSystemï¼‰
   â””â”€ Presetç±»ï¼ˆECPresetDefinitionï¼‰

2. è‡ªå®šä¹‰ç»„ä»¶ï¼ˆv2.0æ–°å¢,ProjectDiscoveryï¼‰
   â””â”€ è‡ªå®šä¹‰ç»„ä»¶ç›®å½•ï¼ˆcomponents/, modules/, plugins/ï¼‰
   â””â”€ é…ç½®æ–‡ä»¶ç›®å½•ï¼ˆconfigs/, data/, settings/ï¼‰
   â””â”€ ä¸šåŠ¡é€»è¾‘ç›®å½•ï¼ˆbusiness/, gameplay/, managers/ï¼‰
```

**å‘ç°ç®—æ³•**:

```javascript
// ProjectDiscovery.discover()
function discover(projectPath) {
  const discovered = {
    customComponents: {},
    configFiles: {},
    businessLogic: {}
  };

  // 1. æ‰«æé¡¹ç›®ç›®å½•
  const allDirs = scanDirectories(projectPath);

  // 2. æ¨¡å¼åŒ¹é…ï¼ˆè‡ªå®šä¹‰ç»„ä»¶ç›®å½•ï¼‰
  const componentPatterns = [
    'components/**',
    'modules/**',
    'plugins/**',
    'utils/**',
    'common/**'
  ];

  for (const pattern of componentPatterns) {
    const matches = glob.sync(pattern, { cwd: projectPath });
    discovered.customComponents.push(...matches);
  }

  // 3. åˆ†æç›®å½•å†…å®¹
  for (const dir of discovered.customComponents) {
    const files = analyzeDirectory(dir);
    discovered.customComponents[dir] = {
      fileCount: files.length,
      types: inferComponentTypes(files)
    };
  }

  return discovered;
}
```

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **é›¶é…ç½®**: æ— éœ€æ‰‹åŠ¨å£°æ˜è‡ªå®šä¹‰ç»„ä»¶
2. **è‡ªåŠ¨è¡¥å…¨**: è‡ªåŠ¨ç”Ÿæˆè‡ªå®šä¹‰ç»„ä»¶æ–‡æ¡£
3. **æ™ºèƒ½æ¨æ–­**: æ ¹æ®ç›®å½•ç»“æ„æ¨æ–­ç»„ä»¶ç±»å‹
4. **å…¼å®¹ä¼ ç»Ÿ**: ä¸å½±å“å·²æœ‰çš„System/Presetè¯†åˆ«

**åº”ç”¨åœºæ™¯**:
- å¤æ‚é¡¹ç›®ï¼ˆè‡ªå®šä¹‰å·¥å…·å‡½æ•°ã€é€šç”¨æ¨¡å—ï¼‰
- æ¡†æ¶åŒ–é¡¹ç›®ï¼ˆApolloã€NEWRPGç­‰ï¼‰
- å¤šå±‚çº§ç›®å½•ç»“æ„

**è¯¦è§**: [ç¬¬å…«ç« : é¡¹ç›®åˆ†æå™¨å®ç° - 8.6 è‡ªé€‚åº”ç»“æ„å‘ç°](#86-è‡ªé€‚åº”ç»“æ„å‘ç°projectdiscovery)

---

### 12.4 æ™ºèƒ½æ–‡æ¡£è´¨é‡è¯„ä¼°ï¼ˆâ­â­â­ï¼‰

**æŠ€æœ¯è¯„åˆ†**: 3/5ï¼ˆå®ç”¨ç‰¹æ€§ï¼‰

**è®¾è®¡ç›®æ ‡**: é¿å…è¦†ç›–ç”¨æˆ·å·²ç¼–å†™çš„é«˜è´¨é‡æ–‡æ¡£

**è¯„åˆ†ç®—æ³•**ï¼ˆ0-5åˆ†åˆ¶ï¼‰:

| è¯„åˆ†å› ç´  | æ£€æµ‹è§„åˆ™ | å¾—åˆ† |
|---------|---------|------|
| **ä»£ç å—ç¤ºä¾‹** | åŒ…å«` ``` ` | +1 |
| **å›¾è¡¨** | åŒ…å«`mermaid`/`graph`/`flowchart` | +1 |
| **ç¤ºä¾‹è¯´æ˜** | åŒ…å«"ç¤ºä¾‹"/"Example"/"æ¡ˆä¾‹"/"ä½¿ç”¨æ–¹æ³•" | +1 |
| **å†…å®¹ä¸°å¯Œ** | å­—ç¬¦æ•° > 500 | +1 |
| **éå¾…è¡¥å……æ¨¡æ¿** | ä¸åŒ…å«"âš ï¸ **å¾…è¡¥å……**" | +1 |

**å†³ç­–é€»è¾‘**:

```python
quality_score = assess_doc_quality(content)

if quality_score >= 3:
    # é«˜è´¨é‡æ–‡æ¡£,ä¿ç•™
    print("âœ“ ä¿ç•™é«˜è´¨é‡æ–‡æ¡£: system_doc.md (è¯„åˆ†: 4/5)")
    skip_generation()

elif quality_score < 3:
    # ä½è´¨é‡æ–‡æ¡£,æç¤ºè¦†ç›–
    print("âš ï¸ å‘ç°ä½è´¨é‡æ–‡æ¡£: system_doc.md (è¯„åˆ†: 1/5)")
    print("   å°†è¦†ç›–ç”Ÿæˆæ–°æ–‡æ¡£")
    regenerate()
```

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **ä¿æŠ¤ç”¨æˆ·å·¥ä½œ**: ä¸è¦†ç›–ç”¨æˆ·ç²¾å¿ƒç¼–å†™çš„æ–‡æ¡£
2. **æ™ºèƒ½å†³ç­–**: åŸºäºå®¢è§‚æŒ‡æ ‡è¯„åˆ†
3. **å¯è§†åŒ–åé¦ˆ**: è¾“å‡ºè¯„åˆ†ç»“æœ,ç”¨æˆ·å¯å¹²é¢„
4. **çµæ´»è°ƒæ•´**: è¯„åˆ†é˜ˆå€¼å¯é…ç½®ï¼ˆé»˜è®¤3åˆ†ï¼‰

**æ€§èƒ½æŒ‡æ ‡**:
- è¯„åˆ†é€Ÿåº¦: <10ms/æ–‡æ¡£
- å‡†ç¡®ç‡: ~85%ï¼ˆåŸºäºå¯å‘å¼è§„åˆ™ï¼‰

**è¯¦è§**: [ç¬¬å…­ç« : æ–‡æ¡£ç”Ÿæˆå™¨æ·±åº¦è§£æ - 6.5 è´¨é‡è¯„ä¼°ç®—æ³•](#65-è´¨é‡è¯„ä¼°ç®—æ³•0-5åˆ†åˆ¶)

---

### 12.5 ç‰ˆæœ¬è¿½è¸ªå’Œå‡çº§ï¼ˆâ­â­â­â­ï¼‰

**æŠ€æœ¯è¯„åˆ†**: 4/5ï¼ˆä¼ä¸šçº§ç‰¹æ€§ï¼‰

**è®¾è®¡ç›®æ ‡**: å¹³æ»‘å‡çº§,ä¿ç•™ç”¨æˆ·æ•°æ®,è‡ªåŠ¨è¿ç§»

**æ ¸å¿ƒæœºåˆ¶**:

1. **ç‰ˆæœ¬è¿½è¸ª**ï¼ˆworkflow-manifest.jsonï¼‰

```json
{
  "version": "v17.2.0",
  "createdAt": "2025-11-12T10:30:00.000Z",
  "updatedAt": "2025-11-12T15:00:00.000Z",
  "baselineHashes": {
    "å¼€å‘è§„èŒƒ.md": "a3f5e9c2b1d8f7a6...",
    "é—®é¢˜æ’æŸ¥.md": "b7c2d1e4f8a9c3...",
    "MODSDKæ ¸å¿ƒæ¦‚å¿µ.md": "e8a4f6c9b2d5..."
  },
  "obsoleteFiles": []
}
```

2. **ç‰ˆæœ¬æ¯”è¾ƒç®—æ³•**ï¼ˆSemantic Versioningï¼‰

```javascript
function compareVersions(v1, v2) {
  const parts1 = v1.split('.').map(Number);  // [17, 2, 0]
  const parts2 = v2.split('.').map(Number);  // [17, 1, 0]

  for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
    const p1 = parts1[i] || 0;
    const p2 = parts2[i] || 0;

    if (p1 < p2) return -1;  // v1 < v2
    if (p1 > p2) return 1;   // v1 > v2
  }

  return 0;  // v1 == v2
}
```

3. **å“ˆå¸Œå¯¹æ¯”**ï¼ˆæ£€æµ‹æ–‡æ¡£å˜æ›´ï¼‰

```javascript
// è®¡ç®—æ–‡ä»¶SHA256å“ˆå¸Œ
const hash = crypto.createHash('sha256')
  .update(fs.readFileSync(filePath))
  .digest('hex');

// æ¯”è¾ƒå“ˆå¸Œ
if (currentHash !== baselineHash) {
  conflicts.push({
    file: filename,
    message: 'ä¸Šæ¸¸æ–‡æ¡£æœ‰æ›´æ–°,å»ºè®®å®¡æŸ¥å¹¶åˆå¹¶'
  });
}
```

4. **è‡ªåŠ¨è¿ç§»æœºåˆ¶**

```javascript
// v16.0 â†’ v16.1è¿ç§»è„šæœ¬
async function migrateFromV16_to_V161(projectPath) {
  // 1. å¤‡ä»½å…³é”®æ–‡ä»¶
  await backupFiles(projectPath, ['CLAUDE.md', '.claude/']);

  // 2. è½¬æ¢é…ç½®æ–‡ä»¶æ ¼å¼
  const oldConfig = readJSON('.claude/workflow-version.json');
  const newConfig = {
    version: 'v16.1.0',
    workflowVersion: oldConfig.workflow_version,
    // ... è½¬æ¢é€»è¾‘
  };
  writeJSON('.claude/workflow-manifest.json', newConfig);

  // 3. è¿ç§»ç”¨æˆ·å®šåˆ¶æ–‡ä»¶ï¼ˆä¿ç•™ï¼‰
  preserveUserCustomizations('markdown/core/');

  // 4. æ¸…ç†åºŸå¼ƒæ–‡ä»¶
  removeObsoleteFiles(['old-config.json']);
}
```

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **å‘åå…¼å®¹**: æ”¯æŒv15.x â†’ v16.x â†’ v17.xå¹³æ»‘å‡çº§
2. **è‡ªåŠ¨è¿ç§»**: è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬å¹¶æ‰§è¡Œè¿ç§»è„šæœ¬
3. **å†²çªæ£€æµ‹**: å“ˆå¸Œå¯¹æ¯”æ£€æµ‹æ–‡æ¡£å˜æ›´
4. **å¯å›æ»š**: å¤‡ä»½å…³é”®æ–‡ä»¶,å¤±è´¥å¯æ¢å¤

**æ”¯æŒçš„å‡çº§è·¯å¾„**:

```
v15.0 â”€â”€â”
v15.1 â”€â”€â”¼â”€â†’ v16.0 â”€â”€â”€â†’ v16.1 â”€â”€â”€â†’ v16.3 â”€â”€â”€â†’ v17.0 â”€â”€â”€â†’ v17.1 â”€â”€â”€â†’ v17.2
v15.x â”€â”€â”˜
```

**è¯¦è§**: [ç¬¬ä¹ç« : ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ](#-ç¬¬ä¹ç« ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ)

---

### 12.6 v17.1æ–¹æ¡ˆè‡ªæ£€ä¸ä¸“å®¶å®¡æ ¸ï¼ˆâ­â­â­â­â­ï¼‰

**æŠ€æœ¯è¯„åˆ†**: 5/5ï¼ˆv17.1æ ¸å¿ƒåˆ›æ–°ï¼‰

**è®¾è®¡ç›®æ ‡**: å‡å°‘ä½è´¨é‡æ–¹æ¡ˆ,æå‡é¦–æ¬¡æˆåŠŸç‡

**å·¥ä½œæµç¨‹**:

```
æ­¥éª¤2: æŸ¥é˜…æ–‡æ¡£
    â†“
æ­¥éª¤2.5: æ–¹æ¡ˆè‡ªæ£€ â­ v17.1æ–°å¢
    â”œâ”€ 5é¡¹æ£€æŸ¥æ¸…å•ï¼ˆå†…å­˜æ£€æŸ¥ä¸ºä¸»ï¼‰
    â”œâ”€ è‡ªåŠ¨ä¿®æ­£é”™è¯¯é¡¹
    â””â”€ æ™ºèƒ½è§¦å‘ä¸“å®¶å®¡æ ¸
    â†“
æ­¥éª¤2.5.4: ä¸“å®¶å®¡æ ¸ï¼ˆæ»¡è¶³è§¦å‘æ¡ä»¶æ—¶ï¼‰
    â”œâ”€ /mc-review å­ä»£ç†æ·±åº¦å®¡æ ¸
    â”œâ”€ 10åˆ†åˆ¶è¯„åˆ†ä½“ç³»
    â””â”€ è¯„åˆ†<8åˆ† â†’ ä¿®æ”¹æ–¹æ¡ˆ â†’ é‡æ–°å®¡æ ¸
    â†“
æ­¥éª¤3: æ‰§è¡Œä¸æ”¶å°¾
```

**è‡ªæ£€æ¸…å•**ï¼ˆ5é¡¹æ£€æŸ¥,~2åˆ†é’Ÿï¼‰:

| æ£€æŸ¥é¡¹ | æ£€æŸ¥æ–¹å¼ | Tokenæ¶ˆè€— |
|-------|---------|-----------|
| 1. CRITICALè§„èŒƒéªŒè¯ | å†…å­˜æ£€æŸ¥ï¼ˆè§„èŒƒè¡¨ï¼‰ | ~0 tokens |
| 2. åŒç«¯éš”ç¦»éªŒè¯ | å†…å­˜æ£€æŸ¥ï¼ˆè·¨ç«¯GetSystemï¼‰ | ~0 tokens |
| 3. äº‹ä»¶/APIå­˜åœ¨æ€§ | å¯é€‰GrepæŸ¥è¯¢ï¼ˆç´¢å¼•è¡¨ï¼‰ | <300 tokens |
| 4. æ•°æ®æµå®Œæ•´æ€§ | ç»˜åˆ¶æµç¨‹å›¾ | ~0 tokens |
| 5. æœ€ä½³å®è·µéµå¾ª | å†…å­˜æ£€æŸ¥ï¼ˆåæ¨¡å¼æ¸…å•ï¼‰ | ~0 tokens |

**ä¸“å®¶å®¡æ ¸è§¦å‘æ¡ä»¶**:

```python
# 1. å¤æ‚ä»»åŠ¡ï¼šå¼ºåˆ¶è§¦å‘ï¼ˆæ­¥éª¤2åï¼‰
if task_level == "ğŸ”´ å¤æ‚ä»»åŠ¡":
    trigger_expert_review()

# 2. æ ‡å‡†ä»»åŠ¡ï¼šæ™ºèƒ½è§¦å‘ï¼ˆ3é¡¹æ£€æŸ¥ï¼‰
elif task_level == "ğŸŸ¡ æ ‡å‡†ä»»åŠ¡":
    if (
        bug_fix_count >= 2 or      # 2è½®ä»¥ä¸ŠBugä¿®å¤
        system_count > 5 or        # è·¨è¶Š>5ä¸ªSystem
        user_requires_review       # ç”¨æˆ·è¦æ±‚
    ):
        trigger_expert_review()
```

**å®¡æ ¸è¯„åˆ†ä½“ç³»**ï¼ˆ10åˆ†åˆ¶ï¼‰:

| è¯„åˆ†é¡¹ | åˆ†å€¼ | æ£€æŸ¥ç‚¹ |
|-------|------|--------|
| éœ€æ±‚è¦†ç›–ç‡ | 2åˆ† | æ˜¯å¦å®Œæ•´æ»¡è¶³ç”¨æˆ·éœ€æ±‚ |
| CRITICALè§„èŒƒç¬¦åˆæ€§ | 3åˆ† | 4é¡¹CRITICALè§„èŒƒ,æ¯è¿å-1åˆ† |
| æ¶æ„åˆç†æ€§ | 1åˆ† | ç«¯åˆ«åˆ†å·¥ã€æ•°æ®æµã€æ¨¡å—åˆ’åˆ† |
| API/äº‹ä»¶é€‰æ‹© | 1åˆ† | APIé€‰æ‹©æœ€ä¼˜ã€äº‹ä»¶ç›‘å¬å®Œæ•´ |
| è¾¹ç•Œåœºæ™¯ | 2åˆ† | é”™è¯¯å¤„ç†ã€å¹¶å‘é—®é¢˜ã€æ€§èƒ½å½±å“ |
| å®ç°ç»†èŠ‚ | 1åˆ† | ä»£ç æ¡†æ¶ã€å‘½åè§„èŒƒã€æ³¨é‡Šæ–‡æ¡£ |

**æŠ€æœ¯ä¼˜åŠ¿**:

1. **æå‰å‘ç°é—®é¢˜**: æ–¹æ¡ˆé˜¶æ®µå°±å‘ç°CRITICALè¿è§„
2. **è‡ªåŠ¨ä¿®æ­£**: å¸¸è§é”™è¯¯è‡ªåŠ¨ä¿®æ­£åé‡æ–°è‡ªæ£€
3. **å‡å°‘è¿”å·¥**: å¤æ‚æ–¹æ¡ˆå¿…é¡»é€šè¿‡ä¸“å®¶å®¡æ ¸æ‰å®æ–½
4. **è´¨é‡ä¿è¯**: è¯„åˆ†<8åˆ†å¼ºåˆ¶ä¿®æ”¹

**æ€§èƒ½å¯¹æ¯”**:

| åœºæ™¯ | v17.0åŠä¹‹å‰ | v17.1ï¼ˆè‡ªæ£€+å®¡æ ¸ï¼‰ | æå‡ |
|------|------------|-------------------|------|
| æ ‡å‡†ä»»åŠ¡é¦–æ¬¡æˆåŠŸç‡ | ~65% | ~85% | +20% |
| å¤æ‚ä»»åŠ¡é¦–æ¬¡æˆåŠŸç‡ | ~40% | ~75% | +35% |
| Tokenæ¶ˆè€—ï¼ˆæ ‡å‡†ä»»åŠ¡ï¼‰ | 20-35k | 25-40k | +20% |
| Tokenæ¶ˆè€—ï¼ˆå¤æ‚ä»»åŠ¡ï¼‰ | 50-100k | 60-110k | +10% |

**è¯¦è§**: [ç¬¬åä¸€ç« : Claudeå‘½ä»¤ç³»ç»Ÿ - 11.2 /mcä¸»å‘½ä»¤å·¥ä½œæµ](#112-mc---ä¸»å‘½ä»¤å·¥ä½œæµ)

---

### 12.7 æ€§èƒ½ä¼˜åŒ–ä¸Tokenæˆæœ¬æ§åˆ¶

**æŠ€æœ¯è¯„åˆ†**: 3/5ï¼ˆæŒç»­ä¼˜åŒ–ï¼‰

**è®¾è®¡ç›®æ ‡**: åœ¨åŠŸèƒ½å®Œæ•´æ€§ä¸æˆæœ¬ä¹‹é—´å–å¾—å¹³è¡¡

**ä¼˜åŒ–ç­–ç•¥**:

1. **ä¸‰çº§ä»»åŠ¡åˆ†ç±»**

| ä»»åŠ¡çº§åˆ« | Tokenæ¶ˆè€— | æ‰§è¡Œæ—¶é—´ | ä½¿ç”¨åœºæ™¯ |
|---------|-----------|---------|---------|
| ğŸŸ¢ å¾®ä»»åŠ¡ | <2k | <1min | å•æ–‡ä»¶ä¿®æ”¹,ç®€å•BUG |
| ğŸŸ¡ æ ‡å‡†ä»»åŠ¡ | 20-35k | 5-15min | æ¶‰åŠ3-8æ–‡ä»¶,å¸¸è§„åŠŸèƒ½ |
| ğŸ”´ å¤æ‚ä»»åŠ¡ | 50-100k | 20-60min | è·¨10+æ–‡ä»¶,æ¶æ„é‡æ„ |

2. **å†…å­˜ä¼˜å…ˆæ£€æŸ¥**

```python
# âŒ v17.0åŠä¹‹å‰ï¼šå¤§é‡GrepæŸ¥è¯¢éªŒè¯
for event_name in all_events:
    Grep(event_name, path="...")  # æ¯ä¸ªäº‹ä»¶~150 tokens
# æ€»è®¡ï¼š20ä¸ªäº‹ä»¶ Ã— 150 = 3,000 tokens

# âœ… v17.1ï¼šå†…å­˜æ£€æŸ¥ + å¯é€‰Grep
# æ­¥éª¤1ï¼šå†…å­˜æ£€æŸ¥CRITICALè§„èŒƒï¼ˆ~0 tokensï¼‰
violations = check_critical_rules_in_memory()

# æ­¥éª¤2ï¼šä»…å¯¹å¯ç–‘äº‹ä»¶/APIæŸ¥è¯¢ç´¢å¼•è¡¨ï¼ˆ<300 tokensï¼‰
for suspicious_event in violations:
    Grep(suspicious_event, path="ç´¢å¼•è¡¨.md")
```

3. **è½¯è¿æ¥å‡å°‘æ–‡æ¡£å†—ä½™**

```
v16.3ä¹‹å‰ï¼štemplates/markdown/ å†—ä½™75KB+æ ¸å¿ƒæ–‡æ¡£
â†’ æ¯æ¬¡initmcç”Ÿæˆï¼š~1,500 tokens

v16.3é‡æ„ï¼šè½¯è¿æ¥å¼•ç”¨,é›¶ç”Ÿæˆ
â†’ æ¯æ¬¡initmcï¼š~0 tokensï¼ˆåªåˆ›å»ºé“¾æ¥ï¼‰
```

4. **æ™ºèƒ½æ–‡æ¡£ç”Ÿæˆ**

```python
# è´¨é‡è¯„ä¼° â†’ è·³è¿‡å·²æœ‰é«˜è´¨é‡æ–‡æ¡£
if existing_doc_quality >= 3:
    skip_generation()  # èŠ‚çœ~800 tokens/æ–‡æ¡£

# Layer 1æ ¸å¿ƒå·¥ä½œæµï¼ˆæœ€å°éƒ¨ç½²ï¼‰
initmc(minimalMode=true)  # åªç”ŸæˆCLAUDE.md + å‘½ä»¤

# Layer 2/3æŒ‰éœ€ç”Ÿæˆï¼ˆAIæ£€æµ‹ç¼ºå¤±æ—¶ï¼‰
if missing_system_docs:
    generate_layer2()  # ä»…ç”Ÿæˆç¼ºå¤±éƒ¨åˆ†
```

**æ€§èƒ½æŒ‡æ ‡**:

| æ“ä½œ | Tokenæ¶ˆè€— | ä¼˜åŒ–å‰ï¼ˆv16.2ï¼‰ | ä¼˜åŒ–åï¼ˆv17.2ï¼‰ | æå‡ |
|------|-----------|----------------|----------------|------|
| é¦–æ¬¡éƒ¨ç½²ï¼ˆå°é¡¹ç›®,<10 Systemsï¼‰ | - | 35k | 25k | -29% |
| é¦–æ¬¡éƒ¨ç½²ï¼ˆä¸­é¡¹ç›®,10-30 Systemsï¼‰ | - | 80k | 60k | -25% |
| å‡çº§åŒæ­¥ï¼ˆ`initmc --sync`ï¼‰ | - | 10k | 2k | -80% |
| /mcå¾®ä»»åŠ¡æ‰§è¡Œ | - | 5k | 2k | -60% |
| /mcæ ‡å‡†ä»»åŠ¡ï¼ˆå«è‡ªæ£€ï¼‰ | - | 30k | 35k | +17% âš ï¸ |
| /mcå¤æ‚ä»»åŠ¡ï¼ˆå«å®¡æ ¸ï¼‰ | - | 80k | 95k | +19% âš ï¸ |

**æˆæœ¬åˆ†æ**:

```
å‡è®¾Claude APIå®šä»·ï¼š$0.015/1k tokens

å°é¡¹ç›®ç”Ÿå‘½å‘¨æœŸæˆæœ¬ï¼š
- é¦–æ¬¡éƒ¨ç½²ï¼š25k Ã— $0.015/1k = $0.375
- 20æ¬¡æ ‡å‡†ä»»åŠ¡ï¼š35k Ã— 20 Ã— $0.015/1k = $10.50
- 5æ¬¡å¤æ‚ä»»åŠ¡ï¼š95k Ã— 5 Ã— $0.015/1k = $7.125
- æ€»è®¡ï¼š$18.00ï¼ˆå¯æ¥å—ï¼‰

ä¸­é¡¹ç›®ç”Ÿå‘½å‘¨æœŸæˆæœ¬ï¼š
- é¦–æ¬¡éƒ¨ç½²ï¼š60k Ã— $0.015/1k = $0.90
- 50æ¬¡æ ‡å‡†ä»»åŠ¡ï¼š35k Ã— 50 Ã— $0.015/1k = $26.25
- 10æ¬¡å¤æ‚ä»»åŠ¡ï¼š95k Ã— 10 Ã— $0.015/1k = $14.25
- æ€»è®¡ï¼š$41.40ï¼ˆåˆç†ï¼‰
```

**æƒè¡¡åˆ†æ**:

- âœ… **å¾®ä»»åŠ¡**: æˆæœ¬å¤§å¹…é™ä½(-60%),é€‚åˆé¢‘ç¹å°ä¿®æ”¹
- âš ï¸ **æ ‡å‡†/å¤æ‚ä»»åŠ¡**: æˆæœ¬ç•¥å¢(+17%~19%),ä½†é¦–æ¬¡æˆåŠŸç‡æå‡20-35%
- âœ… **æ€»ä½“**: å‡å°‘è¿”å·¥æ¬¡æ•°,å®é™…æ€»æˆæœ¬é™ä½

**è¯¦è§**: [ç¬¬åç« : å®Œæ•´å·¥ä½œæµç¨‹](#-ç¬¬åç« å®Œæ•´å·¥ä½œæµç¨‹)

---

## ğŸ› ç¬¬åä¸‰ç« ï¼šé—®é¢˜æ’æŸ¥æŒ‡å—

> **æœ¬ç« å¯¼èˆª**: å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆã€è°ƒè¯•æŠ€å·§å’Œæ€§èƒ½ä¼˜åŒ–å»ºè®®
>
> **æ–‡æ¡£æ¥æº**: æœ¬ç« å†…å®¹æ¥è‡ª [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md) (v4.1)

### 13.1 å·¥ä½œæµéƒ¨ç½²é—®é¢˜

#### é—®é¢˜1: è½¯è¿æ¥åˆ›å»ºå¤±è´¥

**ç—‡çŠ¶**: Windowsä¸‹æ‰§è¡Œ`initmc`åæŠ¥é”™"æƒé™ä¸è¶³"æˆ–è½¯è¿æ¥æœªåˆ›å»º

**åŸå› **: Windowsæ™®é€šç”¨æˆ·é»˜è®¤æ— ç¬¦å·é“¾æ¥åˆ›å»ºæƒé™

**è§£å†³æ–¹æ¡ˆ**: è‡ªåŠ¨é™çº§ä¸ºåªè¯»å‰¯æœ¬ï¼ˆv16.0+å·²å†…ç½®ï¼‰

```
1. å·¥ä½œæµä¼šè‡ªåŠ¨æ£€æµ‹æƒé™
2. æƒé™ä¸è¶³æ—¶é™çº§ä¸ºåªè¯»å‰¯æœ¬
3. åŠŸèƒ½å®Œå…¨æ­£å¸¸,åªæ˜¯ä¸æ”¯æŒå®æ—¶åŒæ­¥

éªŒè¯æ–¹æ³•ï¼š
ls -la .claude/core-docs/  # Linux/Mac
dir /AL .claude\core-docs\  # Windows
```

**é«˜çº§è§£å†³æ–¹æ¡ˆ**ï¼ˆå¯é€‰,éœ€ç®¡ç†å‘˜æƒé™ï¼‰:

```powershell
# æ–¹æ¡ˆ1: å¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼ˆWindows 10+ï¼‰
è®¾ç½® â†’ æ›´æ–°å’Œå®‰å…¨ â†’ å¼€å‘è€…é€‰é¡¹ â†’ å¼€å‘äººå‘˜æ¨¡å¼

# æ–¹æ¡ˆ2: ç»„ç­–ç•¥æˆæƒï¼ˆä¼ä¸šç‰ˆï¼‰
è¿è¡Œ gpedit.msc
â†’ è®¡ç®—æœºé…ç½® â†’ Windowsè®¾ç½® â†’ å®‰å…¨è®¾ç½® â†’ æœ¬åœ°ç­–ç•¥ â†’ ç”¨æˆ·æƒé™åˆ†é…
â†’ "åˆ›å»ºç¬¦å·é“¾æ¥" â†’ æ·»åŠ å½“å‰ç”¨æˆ·
```

**è¯¦è§**: [ç¬¬ä¸ƒç« : è½¯è¿æ¥ç®¡ç†å™¨å®ç° - 7.5 åªè¯»å‰¯æœ¬é™çº§æ–¹æ¡ˆ](#75-åªè¯»å‰¯æœ¬é™çº§æ–¹æ¡ˆ)

---

#### é—®é¢˜2: å…¨å±€å®‰è£…å initmc å‘½ä»¤ä¸å¯ç”¨

**ç—‡çŠ¶**: æ‰§è¡Œ`npm run install-global`å,ç»ˆç«¯æç¤º"initmcä¸æ˜¯å¯è¯†åˆ«çš„å‘½ä»¤"

**æ’æŸ¥æ­¥éª¤**:

**æ­¥éª¤1**: æ£€æŸ¥å…¨å±€ç›®å½•æ˜¯å¦å­˜åœ¨

```bash
# Windows
dir %USERPROFILE%\.claude-modsdk-workflow\bin\

# Linux/Mac
ls ~/.claude-modsdk-workflow/bin/
```

**æ­¥éª¤2**: æ£€æŸ¥PATHç¯å¢ƒå˜é‡

```bash
# Windows CMD
echo %PATH% | findstr "claude-modsdk-workflow"

# Windows PowerShell
$env:PATH -split ';' | Select-String "claude-modsdk-workflow"

# Linux/Mac
echo $PATH | grep "claude-modsdk-workflow"
```

**æ­¥éª¤3**: æ‰‹åŠ¨æ·»åŠ åˆ°PATHï¼ˆå¦‚æœç¼ºå¤±ï¼‰

```bash
# Windows CMDï¼ˆä¸´æ—¶ï¼‰
set PATH=%PATH%;%USERPROFILE%\.claude-modsdk-workflow\bin

# Windows CMDï¼ˆæ°¸ä¹…ï¼‰
setx PATH "%PATH%;%USERPROFILE%\.claude-modsdk-workflow\bin"

# Linux/Macï¼ˆæ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrcï¼‰
echo 'export PATH="$HOME/.claude-modsdk-workflow/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc
```

**æ­¥éª¤4**: é‡å¯ç»ˆç«¯å¹¶éªŒè¯

```bash
where initmc  # Windows
which initmc  # Linux/Mac
```

**è¯¦è§**: [ç¬¬å››ç« : æ ¸å¿ƒæœºåˆ¶è¯¦è§£ - 4.4.3 éªŒè¯æ–¹æ³•](#443-éªŒè¯æ–¹æ³•)

---

#### é—®é¢˜3: æ¨¡æ¿æ–‡ä»¶æœªæ‰¾åˆ°

**ç—‡çŠ¶**: `initmc`æ‰§è¡Œæ—¶æŠ¥é”™"æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨: xxx.template"

**åŸå› **: å…¨å±€å®‰è£…ç›®å½•ä¸å®Œæ•´æˆ–æŸå

**è§£å†³æ–¹æ¡ˆ**:

```bash
# æ­¥éª¤1: åˆ é™¤æ—§çš„å…¨å±€å®‰è£…
rm -rf ~/.claude-modsdk-workflow  # Linux/Mac
rd /s /q "%USERPROFILE%\.claude-modsdk-workflow"  # Windows

# æ­¥éª¤2: é‡æ–°å…‹éš†ä»“åº“
cd /path/to/workspace
git clone https://github.com/jju666/NeteaseMod-Claude.git
cd NeteaseMod-Claude

# æ­¥éª¤3: é‡æ–°å…¨å±€å®‰è£…
npm run install-global

# æ­¥éª¤4: éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
ls ~/.claude-modsdk-workflow/templates/CLAUDE.md.template  # åº”å­˜åœ¨
```

**è¯¦è§**: [ç¬¬å››ç« : æ ¸å¿ƒæœºåˆ¶è¯¦è§£ - 4.3 æ¨¡æ¿ç³»ç»Ÿ](#43-æ¨¡æ¿ç³»ç»Ÿ)

---

#### é—®é¢˜4: æ–‡æ¡£å†—ä½™ï¼ˆv16.3å·²ä¿®å¤ï¼‰

**ç—‡çŠ¶**: å‘ç°`templates/markdown/`å’Œ`markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/`æœ‰é‡å¤æ–‡æ¡£

**è¯´æ˜**: è¿™æ˜¯v16.2åŠä¹‹å‰ç‰ˆæœ¬çš„å·²çŸ¥é—®é¢˜,v16.3å·²ä¿®å¤

**å¦‚æœä½ æ˜¯å·¥ä½œæµå¼€å‘è€…**:

```bash
# å‡çº§åˆ°v16.3+
git pull
npm run install-global

# éªŒè¯ä¿®å¤
ls templates/markdown/  # åº”åªæœ‰4ä¸ªæ–‡ä»¶:
# README.md.template, ç´¢å¼•.md.template,
# é¡¹ç›®çŠ¶æ€.md.template, æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md.template
```

**å¦‚æœä½ æ˜¯å·¥ä½œæµä½¿ç”¨è€…**:

```bash
# åœ¨ä½ çš„MODSDKé¡¹ç›®æ‰§è¡Œ
initmc --sync  # è‡ªåŠ¨æ¸…ç†å†—ä½™æ–‡æ¡£
```

**è¯¦è§**: [ç¬¬ä¸‰ç« : å¼€å‘è§„èŒƒ - 3.1 èŒè´£è¾¹ç•Œè§„èŒƒ](#31-èŒè´£è¾¹ç•Œè§„èŒƒv163é‡æ„å)

---

### 13.2 MODSDKå¼€å‘é—®é¢˜

> **è¯´æ˜**: ä»¥ä¸‹é—®é¢˜æ¥è‡ª [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md) (v4.1)
>
> å®Œæ•´å†…å®¹è¯¦è§å·¥ä½œæµçŸ¥è¯†åº“,æ­¤å¤„ä»…åˆ—å‡ºæ ¸å¿ƒé—®é¢˜

#### é—®é¢˜5: è·¨ç«¯GetSystemè¿”å›None

**ç—‡çŠ¶**: æœåŠ¡ç«¯å°è¯•GetSystemè·å–å®¢æˆ·ç«¯ç³»ç»Ÿè¿”å›None

**åŸå› **: Serverå’ŒClientè¿è¡Œåœ¨å®Œå…¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨NotifyToClient/NotifyToServeråŒç«¯é€šä¿¡

```python
# âœ… æ­£ç¡® - æœåŠ¡ç«¯å‘é€äº‹ä»¶
self.NotifyToClient(playerId, "UpdateUI", data)

# âœ… æ­£ç¡® - å®¢æˆ·ç«¯ç›‘å¬
self.ListenForEvent("MyMod", "MyServerSystem", "UpdateUI", self, self.OnUpdate)
```

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - é—®é¢˜1](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#é—®é¢˜1è·¨ç«¯getsystemè¿”å›none)

---

#### é—®é¢˜6: __init__ä¸­è°ƒç”¨APIè¿”å›None

**ç—‡çŠ¶**: åœ¨Systemçš„`__init__`ä¸­è°ƒç”¨APIå¤±è´¥

**åŸå› **: `__init__`æ—¶æ¸¸æˆå¼•æ“æœªå®Œæˆåˆå§‹åŒ–

**è§£å†³æ–¹æ¡ˆ**: æ‰‹åŠ¨è°ƒç”¨Create()

```python
class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        ServerSystem.__init__(self, namespace, systemName)
        self.gameComp = None
        self.Create()  # âš ï¸ æ‰‹åŠ¨è°ƒç”¨

    def Create(self):
        # âœ… åœ¨è¿™é‡Œåˆå§‹åŒ–
        self.gameComp = serverApi.GetEngineCompFactory().CreateGame(levelId)
```

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - é—®é¢˜2](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#é—®é¢˜2__init__ä¸­è°ƒç”¨apiè¿”å›none)

---

#### é—®é¢˜7: EventDataåºåˆ—åŒ–å¤±è´¥

**ç—‡çŠ¶**: ä½¿ç”¨NotifyToClient/NotifyToServerå‘é€æ•°æ®æ—¶å¤±è´¥

**åŸå› **: EventDataä¸æ”¯æŒtupleç±»å‹

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨listä»£æ›¿tuple

```python
# âŒ é”™è¯¯
data["position"] = (100, 64, 100)  # tupleä¸æ”¯æŒ

# âœ… æ­£ç¡®
data["position"] = [100, 64, 100]  # ä½¿ç”¨list
```

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - é—®é¢˜3](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#é—®é¢˜3eventdataåºåˆ—åŒ–å¤±è´¥)

---

#### é—®é¢˜8: æ¸¸æˆå¡é¡¿,æœåŠ¡å™¨TPSé™ä½

**ç—‡çŠ¶**: æœåŠ¡å™¨TPSä»20é™è‡³10ä»¥ä¸‹

**åŸå› **: Update()ä¸­æ‰§è¡Œå¤æ‚è®¡ç®—

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨èŠ‚æµ

```python
class LeaderboardServerSystem(ServerSystem):
    def __init__(self, namespace, systemName):
        ServerSystem.__init__(self, namespace, systemName)
        self.tick_counter = 0

    def Update(self):
        self.tick_counter += 1
        # æ¯100 tickï¼ˆ5ç§’ï¼‰æ‰§è¡Œä¸€æ¬¡
        if self.tick_counter % 100 == 0:
            self.UpdateLeaderboard()
```

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - é—®é¢˜12](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#é—®é¢˜12æ¸¸æˆå¡é¡¿æœåŠ¡å™¨tpsé™ä½)

---

#### é—®é¢˜9: Systemæœªä½¿ç”¨RegisterViewå¯¼è‡´æ€§èƒ½ä¸‹é™

**ç—‡çŠ¶**: å®ä½“æ•°é‡å¢åŠ åæ¸¸æˆæ˜æ˜¾å˜å¡

**åŸå› **: é»˜è®¤éå†æ‰€æœ‰Entity

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨RegisterViewè¿‡æ»¤

```python
class HealthRegenServerSystem(ServerSystem):
    def __init__(self, namespace, systemName):
        ServerSystem.__init__(self, namespace, systemName)
        # æ³¨å†Œè§†å›¾ï¼šåªç›‘è§†æ‹¥æœ‰Healthç»„ä»¶çš„å®ä½“
        self.RegisterView('PlayersWithHealth', ['Minecraft:Health'])
        self.Create()

    def Update(self):
        # åªéå†ç©å®¶å’Œç”Ÿç‰©ï¼ˆçº¦100ä¸ªï¼‰
        for entity in self.GetEntitiesInView('PlayersWithHealth'):
            self.RegenHealth(entity)
```

**æ€§èƒ½å¯¹æ¯”**: 100å€æå‡ï¼ˆä»éå†10,000ä¸ªå®ä½“é™è‡³100ä¸ªï¼‰

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - é—®é¢˜14](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#é—®é¢˜14systemæœªä½¿ç”¨registerviewå¯¼è‡´æ€§èƒ½ä¸‹é™)

---

### 13.3 è°ƒè¯•æŠ€å·§

#### 1. ä½¿ç”¨print()è¾“å‡ºæ—¥å¿—

**æ¨èæ ¼å¼**:

```python
print("[INFO] [ç³»ç»Ÿå] æ¶ˆæ¯å†…å®¹")
print("[ERROR] [ç³»ç»Ÿå] é”™è¯¯ä¿¡æ¯")
print("[DEBUG] [ç³»ç»Ÿå] è°ƒè¯•ä¿¡æ¯")
```

#### 2. å¼‚å¸¸æ•è·

```python
try:
    result = self.doSomething()
except Exception as e:
    print("[ERROR] å‘ç”Ÿå¼‚å¸¸:", e)
    import traceback
    traceback.print_exc()
```

#### 3. äº‹ä»¶è°ƒè¯•

```python
def OnPlayerJoin(self, args):
    print("[DEBUG] OnPlayerJoin args:", args)
    for key, value in args.items():
        print("[DEBUG] {}: {}".format(key, value))
```

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - è°ƒè¯•æŠ€å·§](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#è°ƒè¯•æŠ€å·§)

---

### 13.4 æ€§èƒ½é—®é¢˜

#### å¸¸è§æ€§èƒ½é—®é¢˜

| é—®é¢˜ | ç—‡çŠ¶ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| **Tickæ€§èƒ½ä½** | Update()é¢‘ç¹æ‰§è¡Œ | ä½¿ç”¨è®¡æ•°å™¨é™ä½é¢‘ç‡ |
| **å†…å­˜æ³„æ¼** | é•¿æ—¶é—´è¿è¡Œå†…å­˜å¢é•¿ | Destroy()ä¸­æ¸…ç†èµ„æº |
| **å¤§é‡æ—¥å¿—** | æ—¥å¿—è¾“å‡ºå½±å“æ€§èƒ½ | ä½¿ç”¨DEBUGå¼€å…³ |
| **é¢‘ç¹RPC** | ç½‘ç»œå»¶è¿Ÿé«˜ | èŠ‚æµ+å¢é‡æ›´æ–° |
| **å¤æ‚è®¡ç®—** | Updateä¸­å¡é¡¿ | é™é¢‘+ç¼“å­˜+å¼‚æ­¥é˜Ÿåˆ— |

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - æ€§èƒ½é—®é¢˜](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#æ€§èƒ½é—®é¢˜)

---

### 13.5 ç½‘æ˜“å¼•æ“é™åˆ¶

| é™åˆ¶ç±»å‹ | è¯´æ˜ |
|---------|------|
| **Pythonç‰ˆæœ¬** | å¿…é¡»å…¼å®¹Python 2.7 |
| **EventData** | ä¸æ”¯æŒtuple,åªæ”¯æŒdict/list/str/int/float/bool |
| **åŒç«¯éš”ç¦»** | ä¸èƒ½è·¨ç«¯GetSystem,å¿…é¡»ä½¿ç”¨Notifyé€šä¿¡ |
| **AOIèŒƒå›´** | æ„Ÿåº”åŒºé•¿å®½ä¸èƒ½è¶…è¿‡2000æ ¼ |
| **Systemç”Ÿå‘½å‘¨æœŸ** | ä¸èƒ½åœ¨__init__ä¸­è°ƒç”¨API |

**è¯¦è§**: [é—®é¢˜æ’æŸ¥.md - ç½‘æ˜“å¼•æ“é™åˆ¶](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md#ç½‘æ˜“å¼•æ“é™åˆ¶)

---

### 13.6 è·å–å¸®åŠ©

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜:

1. **æŸ¥çœ‹ç›¸å…³æ–‡æ¡£**:
   - [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/å¼€å‘è§„èŒƒ.md) - CRITICALè§„èŒƒ
   - [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/é—®é¢˜æ’æŸ¥.md) - å®Œæ•´é—®é¢˜æ’æŸ¥æŒ‡å—

2. **æŸ¥é˜…å®˜æ–¹æ–‡æ¡£**:
   - [ç½‘æ˜“MODSDK Wiki](https://github.com/EaseCation/netease-modsdk-wiki) - å®˜æ–¹APIæ–‡æ¡£
   - [åŸºå²©ç‰ˆWiki](https://github.com/Bedrock-OSS/bedrock-wiki) - åŸç‰ˆæœºåˆ¶å‚è€ƒ

3. **æäº¤Issue**:
   - [GitHub Issues](https://github.com/jju666/NeteaseMod-Claude/issues)

---

## ğŸ“ ç¬¬åå››ç« ï¼šæŠ€æœ¯å‚è€ƒ

> **æœ¬ç« å¯¼èˆª**: å…³é”®ç®—æ³•å…¬å¼ã€æ€§èƒ½æŒ‡æ ‡ã€æ–‡ä»¶æ¸…å•

### 14.1 å…³é”®ç®—æ³•å’Œå…¬å¼

#### 14.1.1 å¤æ‚åº¦è¯„åˆ†å…¬å¼ï¼ˆè¯¦ç»†æ³¨é‡Šï¼‰

**æ ¸å¿ƒæ–¹æ³•**: `SystemInfo._calculateComplexity()` ([lib/analyzer.js:383-422](lib/analyzer.js#L383-L422))

**è¯„åˆ†å…¬å¼**:

$$
\text{ComplexityScore} = \text{LOC}_{\text{score}} + \text{Method}_{\text{score}} + \text{Event}_{\text{score}} + \text{Core}_{\text{score}} + \text{Import}_{\text{score}}
$$

**å„å› ç´ è¯¦ç»†è¯´æ˜**:

```javascript
/**
 * 1. ä»£ç è¡Œæ•°å¾—åˆ†ï¼ˆ+1~3åˆ†ï¼‰
 */
let locScore = 0;
if (linesOfCode > 500) {
  locScore = 3;  // ä»£ç é‡å¤§ï¼Œç»´æŠ¤å¤æ‚
} else if (linesOfCode > 200) {
  locScore = 2;  // ä¸­ç­‰ä»£ç é‡
} else {
  locScore = 1;  // ä»£ç é‡å°
}

/**
 * 2. æ–¹æ³•æ•°é‡å¾—åˆ†ï¼ˆ+0~2åˆ†ï¼‰
 */
let methodScore = 0;
if (methodCount > 15) {
  methodScore = 2;  // åŠŸèƒ½ç¹å¤š
} else if (methodCount > 5) {
  methodScore = 1;  // åŠŸèƒ½é€‚ä¸­
}
// methodCount â‰¤ 5: 0åˆ†

/**
 * 3. äº‹ä»¶ç›‘å¬å¾—åˆ†ï¼ˆ+0~1åˆ†ï¼‰
 */
let eventScore = 0;
if (eventListeners > 5) {
  eventScore = 1;  // äº‹ä»¶äº¤äº’å¤æ‚
}

/**
 * 4. æ ¸å¿ƒSystemåˆ¤æ–­ï¼ˆ+0~2åˆ†ï¼‰
 */
let coreScore = 0;
const coreKeywords = ['core', 'manager', 'game', 'state', 'main'];
if (coreKeywords.some(keyword => systemName.toLowerCase().includes(keyword))) {
  coreScore = 2;  // æ ¸å¿ƒæ¨¡å—æƒé‡é«˜
}

/**
 * 5. ä¾èµ–å…³ç³»å¾—åˆ†ï¼ˆ+0~2åˆ†ï¼‰
 */
let importScore = 0;
const importCount = (content.match(/from\s+\w+\s+import/g) || []).length;
if (importCount > 5) {
  importScore = 2;  // ä¾èµ–å¤šï¼Œè€¦åˆåº¦é«˜
} else if (importCount > 2) {
  importScore = 1;  // ä¾èµ–é€‚ä¸­
}

/**
 * æœ€ç»ˆå¾—åˆ†ï¼ˆ0-10åˆ†ï¼‰
 */
const totalScore = locScore + methodScore + eventScore + coreScore + importScore;
return totalScore;
```

**å¤æ‚åº¦â†’è¯¦ç»†åº¦æ˜ å°„**:

| å¤æ‚åº¦åˆ†æ•° | è¯¦ç»†åº¦ | æ–‡æ¡£å­—æ•° | é€‚ç”¨åœºæ™¯ |
|-----------|--------|---------|---------|
| 0-3åˆ† | simple | ~800å­— | ç®€å•Systemï¼ˆå·¥å…·ç±»ï¼‰ |
| 4-6åˆ† | medium | ~1500å­— | ä¸­ç­‰å¤æ‚åº¦ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ |
| 7-10åˆ† | detailed | ~2500å­— | é«˜å¤æ‚åº¦ï¼ˆæ ¸å¿ƒæ¶æ„ï¼‰ |

---

#### 14.1.2 æ–‡æ¡£è´¨é‡è¯„åˆ†å…¬å¼

**æ ¸å¿ƒæ–¹æ³•**: `DocumentGenerator._assessDocQuality()` ([lib/generator.js:361-390](lib/generator.js#L361-L390))

**è¯„åˆ†å…¬å¼**ï¼ˆ0-5åˆ†åˆ¶ï¼‰:

$$
\text{QualityScore} = \sum_{i=1}^{5} \text{Factor}_i \quad (\text{æ¯ä¸ªå› ç´ 0æˆ–1åˆ†})
$$

**å› ç´ å®šä¹‰**:

```javascript
let score = 0;

// å› ç´ 1: æœ‰ä»£ç å—ç¤ºä¾‹ (+1)
if (/```/.test(content)) {
  score += 1;
}

// å› ç´ 2: æœ‰å›¾è¡¨ï¼ˆmermaid/flowchartï¼‰(+1)
if (/mermaid|graph|flowchart|```diagram/.test(content)) {
  score += 1;
}

// å› ç´ 3: æœ‰ç¤ºä¾‹è¯´æ˜ (+1)
if (/ç¤ºä¾‹|Example|æ¡ˆä¾‹|ä½¿ç”¨æ–¹æ³•|Usage/.test(content)) {
  score += 1;
}

// å› ç´ 4: å†…å®¹ä¸°å¯Œï¼ˆ>500å­—ç¬¦ï¼‰(+1)
if (content.length > 500) {
  score += 1;
}

// å› ç´ 5: ä¸æ˜¯"å¾…è¡¥å……"æ¨¡æ¿ (+1)
if (!/âš ï¸\s*\*\*å¾…è¡¥å……\*\*/.test(content)) {
  score += 1;
}

return score;  // 0-5åˆ†
```

**å†³ç­–é€»è¾‘**:

- **score â‰¥ 3**: ä¿ç•™ç°æœ‰æ–‡æ¡£ï¼ˆé«˜è´¨é‡ï¼‰
- **score < 3**: è¦†ç›–ç”Ÿæˆæ–°æ–‡æ¡£ï¼ˆä½è´¨é‡ï¼‰

---

#### 14.1.3 ç‰ˆæœ¬æ¯”è¾ƒç®—æ³•

**æ ¸å¿ƒæ–¹æ³•**: `VersionChecker._compareVersions()` ([lib/version-checker.js:84-97](lib/version-checker.js#L84-L97))

**ç®—æ³•å®ç°**ï¼ˆSemantic Versioningï¼‰:

```javascript
/**
 * æ¯”è¾ƒç‰ˆæœ¬å·
 * @param {string} v1 - ç‰ˆæœ¬1ï¼ˆå¦‚ "15.0.0"ï¼‰
 * @param {string} v2 - ç‰ˆæœ¬2ï¼ˆå¦‚ "16.1.0"ï¼‰
 * @returns {number} -1: v1<v2, 0: v1==v2, 1: v1>v2
 */
function compareVersions(v1, v2) {
  const parts1 = v1.split('.').map(Number);  // [15, 0, 0]
  const parts2 = v2.split('.').map(Number);  // [16, 1, 0]

  for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {
    const p1 = parts1[i] || 0;  // ç¼ºå¤±éƒ¨åˆ†è¡¥0
    const p2 = parts2[i] || 0;

    if (p1 < p2) return -1;
    if (p1 > p2) return 1;
  }

  return 0;
}
```

**ç¤ºä¾‹**:

| v1 | v2 | ç»“æœ | è¯´æ˜ |
|----|----|------|------|
| `15.0.0` | `16.1.0` | -1 | v1 < v2 |
| `16.1.0` | `16.1.0` | 0 | v1 == v2 |
| `17.0.0` | `16.1.0` | 1 | v1 > v2 |
| `16.1` | `16.1.0` | 0 | è¡¥0åç›¸ç­‰ |

---

### 14.2 æ–‡ä»¶æ¸…å•å’Œè·¯å¾„æ˜ å°„

#### 14.2.1 bin/ ç›®å½•å®Œæ•´æ¸…å•ï¼ˆ7ä¸ªCLIå·¥å…·ï¼‰

| æ–‡ä»¶ | è¡Œæ•° | èŒè´£ | å…¨å±€å‘½ä»¤ |
|------|------|------|---------|
| [initmc.js](bin/initmc.js) | 50 | åˆå§‹åŒ–ä¸‹æ¸¸é¡¹ç›®å·¥ä½œæµ | `initmc` |
| [install-global.js](bin/install-global.js) | 280 | å…¨å±€å®‰è£…åˆ°~/.claude-modsdk-workflow/ | - |
| [uninstallmc.js](bin/uninstallmc.js) | 120 | æ¸…ç†ä¸‹æ¸¸é¡¹ç›®å·¥ä½œæµ | - |
| [quick-deploy.js](bin/quick-deploy.js) | 30 | å¿«é€Ÿéƒ¨ç½²ï¼ˆåˆ«åï¼‰ | - |
| [merge-conflicts.js](bin/merge-conflicts.js) | 200 | åˆå¹¶è¦†ç›–å±‚å†²çªï¼ˆå¯é€‰ï¼‰ | - |
| [detect-obsolete.js](bin/detect-obsolete.js) | 180 | æ£€æµ‹åºŸå¼ƒæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ | - |
| [uninstall-global.js](bin/uninstall-global.js) | 80 | å¸è½½å…¨å±€å®‰è£… | - |

**æ€»è¡Œæ•°**: ~940è¡Œ

---

#### 14.2.2 lib/ ç›®å½•å®Œæ•´æ¸…å•ï¼ˆ22ä¸ªæ ¸å¿ƒæ¨¡å—ï¼‰

| æ–‡ä»¶ | è¡Œæ•° | èŒè´£ | å…³é”®æ–¹æ³• |
|------|------|------|---------|
| [config.js](lib/config.js) | 180 | ç‰ˆæœ¬å·ã€è·¯å¾„ã€å ä½ç¬¦é…ç½® | `getTemplatePath()` |
| [generator.js](lib/generator.js) | 850 | æ–‡æ¡£ç”Ÿæˆå™¨ï¼ˆLayer 1/2/3ï¼‰ | `generateAll()`, `_generateLayer1/2/3()` |
| [symlink-manager.js](lib/symlink-manager.js) | 380 | è½¯è¿æ¥ç®¡ç†ï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰ | `createAllSymlinks()`, `updateSymlinks()` |
| [analyzer.js](lib/analyzer.js) | 560 | é¡¹ç›®åˆ†æå™¨ï¼ˆ5æ­¥åˆ†æï¼‰ | `analyze()`, `_calculateComplexity()` |
| [version-checker.js](lib/version-checker.js) | 330 | ç‰ˆæœ¬æ£€æŸ¥ã€è¿ç§»è·¯å¾„ç®¡ç† | `checkVersion()`, `detectObsoleteFiles()` |
| [init-workflow.js](lib/init-workflow.js) | 280 | åˆå§‹åŒ–ä¸»æµç¨‹ | `main()`, `syncWorkflow()` |
| [utils.js](lib/utils.js) | 250 | å·¥å…·å‡½æ•° | `readFile()`, `writeFile()`, `walkDir()` |
| [project-discovery.js](lib/project-discovery.js) | 200 | è‡ªé€‚åº”ç»„ä»¶å‘ç°ï¼ˆv2.0ï¼‰ | `discover()` |
| [obsolete-file-detector.js](lib/obsolete-file-detector.js) | 280 | åºŸå¼ƒæ–‡ä»¶æ£€æµ‹ä¸æ¸…ç† | `detect()`, `process()` |
| [migration-v16.js](lib/migration-v16.js) | 220 | v15.xâ†’v16.0è¿ç§»è„šæœ¬ | `migrateFromV15_to_V16()` |
| [migration-v16.1.js](lib/migration-v16.1.js) | 180 | v16.0â†’v16.1è¿ç§»è„šæœ¬ | `migrateFromV16_to_V161()` |
| ... (å…¶ä»–11ä¸ªè¾…åŠ©æ¨¡å—) | ~1500 | æ–‡æ¡£æ¨¡æ¿ã€æ™ºèƒ½ç»´æŠ¤ã€æ€§èƒ½ä¼˜åŒ– | - |

**æ€»è¡Œæ•°**: ~5,200è¡Œ

**æ ¸å¿ƒèŒè´£åˆ†ç±»**:

| èŒè´£ | æ¨¡å—æ•°é‡ | æ€»è¡Œæ•° |
|------|---------|--------|
| æ–‡æ¡£ç”Ÿæˆä¸æ¨¡æ¿ | 5ä¸ª | ~1,500è¡Œ |
| è½¯è¿æ¥ä¸ç‰ˆæœ¬ç®¡ç† | 4ä¸ª | ~1,200è¡Œ |
| é¡¹ç›®åˆ†æä¸å‘ç° | 3ä¸ª | ~950è¡Œ |
| å·¥å…·å‡½æ•°ä¸è¾…åŠ© | 10ä¸ª | ~1,550è¡Œ |

---

#### 14.2.3 templates/ ç›®å½•æ¸…å•ï¼ˆç²¾ç®€åï¼‰

**v16.3é‡æ„ååªä¿ç•™12ä¸ªæ–‡ä»¶**:

```
templates/
â”œâ”€ CLAUDE.md.template                        # ä¸‹æ¸¸AIæŒ‡å¯¼æ–‡æ¡£ï¼ˆ843è¡Œï¼‰
â”œâ”€ README.md.template                        # é¡¹ç›®è¯´æ˜ï¼ˆ120è¡Œï¼‰
â”œâ”€ .claude/commands/                         # 6ä¸ªClaudeå‘½ä»¤æ¨¡æ¿
â”‚   â”œâ”€ mc.md.template                         # /mc ä¸»å‘½ä»¤ï¼ˆ843è¡Œï¼‰
â”‚   â”œâ”€ mc-review.md.template                  # /mc-review æ–¹æ¡ˆå®¡æŸ¥ï¼ˆ379è¡Œï¼‰
â”‚   â”œâ”€ mc-perf.md.template                    # /mc-perf æ€§èƒ½åˆ†æï¼ˆ250è¡Œï¼‰
â”‚   â”œâ”€ mc-docs.md.template                    # /mc-docs æ–‡æ¡£å®¡è®¡ï¼ˆ180è¡Œï¼‰
â”‚   â”œâ”€ mc-why.md.template                     # /mc-why åŸç†è§£é‡Šï¼ˆ120è¡Œï¼‰
â”‚   â””â”€ mc-discover.md.template                # /mc-discover ç»“æ„å‘ç°ï¼ˆ150è¡Œï¼‰
â””â”€ markdown/                                  # é¡¹ç›®ç‰¹å®šæ–‡æ¡£æ¨¡æ¿ï¼ˆ4ä¸ªï¼‰
    â”œâ”€ README.md.template                     # æ–‡æ¡£å¯¼èˆªï¼ˆ80è¡Œï¼‰
    â”œâ”€ ç´¢å¼•.md.template                       # å¿«é€Ÿç´¢å¼•ï¼ˆ60è¡Œï¼‰
    â”œâ”€ é¡¹ç›®çŠ¶æ€.md.template                   # é¡¹ç›®çŠ¶æ€ï¼ˆ50è¡Œï¼‰
    â””â”€ æ–‡æ¡£å¾…è¡¥å……æ¸…å•.md.template             # å¾…åŠæ¸…å•ï¼ˆ40è¡Œï¼‰
```

**æ€»è¡Œæ•°**: ~3,115è¡Œ

---

#### 14.2.4 markdown/ çŸ¥è¯†åº“ç›®å½•ï¼ˆ80+æ–‡ä»¶ï¼‰

```
markdown/
â”œâ”€ æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/                          # 13ä¸ªæ ¸å¿ƒæ–‡æ¡£
â”‚   â”œâ”€ å¼€å‘è§„èŒƒ.md                          # 1858è¡Œï¼ˆv3.1ï¼‰
â”‚   â”œâ”€ é—®é¢˜æ’æŸ¥.md                          # 1077è¡Œï¼ˆv4.1ï¼‰
â”‚   â”œâ”€ å¿«é€Ÿå¼€å§‹.md                          # 280è¡Œ
â”‚   â”œâ”€ å¼€å‘æŒ‡å—.md                          # 850è¡Œ
â”‚   â””â”€ ... (å…¶ä»–9ä¸ª)
â”‚
â”œâ”€ æ¦‚å¿µå‚è€ƒ/                                # 15ä¸ªæ¦‚å¿µæ–‡æ¡£
â”‚   â”œâ”€ MODSDKæ ¸å¿ƒæ¦‚å¿µ.md                    # 1200è¡Œ
â”‚   â”œâ”€ APIé€ŸæŸ¥.md                           # 650è¡Œ
â”‚   â”œâ”€ å®˜æ–¹æ–‡æ¡£æŸ¥è¯¢æŒ‡å—.md                  # 420è¡Œ
â”‚   â””â”€ ... (å…¶ä»–12ä¸ª)
â”‚
â”œâ”€ æ·±åº¦æŒ‡å—/                                # 20ä¸ªæ·±åº¦æ–‡æ¡£
â”‚   â”œâ”€ æ·±å…¥ç†è§£ECSæ¶æ„.md                   # 980è¡Œ
â”‚   â”œâ”€ æ€§èƒ½ä¼˜åŒ–å®Œæ•´æŒ‡å—.md                  # 1450è¡Œ
â”‚   â”œâ”€ äº‹ä»¶ç³»ç»Ÿæ·±åº¦è§£æ.md                  # 720è¡Œ
â”‚   â””â”€ ... (å…¶ä»–17ä¸ª)
â”‚
â”œâ”€ ai/                                      # 6ä¸ªAIç­–ç•¥æ–‡æ¡£
â”‚   â”œâ”€ ä»»åŠ¡æ¨¡å¼ç­–ç•¥è¡¨.md                    # 380è¡Œ
â”‚   â”œâ”€ å¿«é€Ÿé€šé“æµç¨‹.md                      # 250è¡Œ
â”‚   â””â”€ ... (å…¶ä»–4ä¸ª)
â”‚
â”œâ”€ systems/                                 # Systemæ–‡æ¡£æ¨¡æ¿ï¼ˆä¸éƒ¨ç½²ï¼‰
â”‚   â””â”€ _template.md                         # 150è¡Œ
â”‚
â””â”€ å¯é€‰å·¥å…·è¯´æ˜.md                          # 180è¡Œ
```

**æ€»è¡Œæ•°**: ~15,000è¡Œ+

---

### 14.3 æ€§èƒ½æŒ‡æ ‡

#### 14.3.1 æ—¶é—´å¤æ‚åº¦åˆ†æ

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | è¯´æ˜ |
|------|-----------|------|
| **é¡¹ç›®åˆ†æï¼ˆå°é¡¹ç›®<10 Systemsï¼‰** | O(n) | n=æ–‡ä»¶æ•°é‡ï¼Œ~2ç§’ |
| **é¡¹ç›®åˆ†æï¼ˆä¸­é¡¹ç›®10-30 Systemsï¼‰** | O(n) | n=æ–‡ä»¶æ•°é‡ï¼Œ~5ç§’ |
| **è½¯è¿æ¥åˆ›å»ºï¼ˆ80ä¸ªæ–‡ä»¶ï¼‰** | O(n) | n=æ ¸å¿ƒæ–‡æ¡£æ•°é‡ï¼Œ~1ç§’ |
| **ç‰ˆæœ¬æ¯”è¾ƒ** | O(k) | k=ç‰ˆæœ¬å·æ®µæ•°ï¼ˆé€šå¸¸3ï¼‰ï¼Œ<1ms |
| **æ–‡æ¡£è´¨é‡è¯„ä¼°** | O(1) | æ­£åˆ™åŒ¹é…ï¼Œ<10ms/æ–‡æ¡£ |
| **å¤æ‚åº¦è¯„åˆ†** | O(1) | ä»£ç æ‰«æï¼Œ<50ms/System |

---

#### 14.3.2 Tokenæˆæœ¬ä¼˜åŒ–ç­–ç•¥

**ä¼˜åŒ–å‰åå¯¹æ¯”**ï¼ˆv16.2 â†’ v17.2ï¼‰:

| æ“ä½œåœºæ™¯ | v16.2 Tokenæ¶ˆè€— | v17.2 Tokenæ¶ˆè€— | ä¼˜åŒ–å¹…åº¦ |
|---------|----------------|----------------|---------|
| é¦–æ¬¡éƒ¨ç½²ï¼ˆå°é¡¹ç›®ï¼‰ | 35k | 25k | -29% âœ… |
| é¦–æ¬¡éƒ¨ç½²ï¼ˆä¸­é¡¹ç›®ï¼‰ | 80k | 60k | -25% âœ… |
| å‡çº§åŒæ­¥ï¼ˆ`initmc --sync`ï¼‰ | 10k | 2k | -80% âœ… |
| /mcå¾®ä»»åŠ¡ | 5k | 2k | -60% âœ… |
| /mcæ ‡å‡†ä»»åŠ¡ï¼ˆå«è‡ªæ£€ï¼‰ | 30k | 35k | +17% âš ï¸ |
| /mcå¤æ‚ä»»åŠ¡ï¼ˆå«å®¡æ ¸ï¼‰ | 80k | 95k | +19% âš ï¸ |

**ä¼˜åŒ–ç­–ç•¥æ€»ç»“**:

1. **è½¯è¿æ¥å‡å°‘æ–‡æ¡£ç”Ÿæˆ**: -75KB+æ¨¡æ¿æ–‡ä»¶ â†’ ~0 tokens
2. **å†…å­˜ä¼˜å…ˆæ£€æŸ¥**: CRITICALè§„èŒƒéªŒè¯ä»Grepæ”¹ä¸ºå†…å­˜æ£€æŸ¥ â†’ èŠ‚çœ~3k tokens
3. **æ™ºèƒ½æ–‡æ¡£ç”Ÿæˆ**: è´¨é‡è¯„ä¼°è·³è¿‡é«˜è´¨é‡æ–‡æ¡£ â†’ èŠ‚çœ~800 tokens/æ–‡æ¡£
4. **æœ€å°åŒ–éƒ¨ç½²**: `initmc(minimalMode=true)` â†’ åªç”Ÿæˆæ ¸å¿ƒå·¥ä½œæµ

**æƒè¡¡åˆ†æ**:

- âœ… **å¾®ä»»åŠ¡æˆæœ¬å¤§å¹…é™ä½**: -60%,é€‚åˆé¢‘ç¹å°ä¿®æ”¹
- âš ï¸ **æ ‡å‡†/å¤æ‚ä»»åŠ¡æˆæœ¬ç•¥å¢**: +17%~19%,ä½†é¦–æ¬¡æˆåŠŸç‡æå‡20-35%
- âœ… **æ€»ä½“æˆæœ¬é™ä½**: å‡å°‘è¿”å·¥æ¬¡æ•°,å®é™…æ€»æˆæœ¬ä¸‹é™

---

#### 14.3.3 é¦–æ¬¡éƒ¨ç½²vså¢é‡æ›´æ–°

| æŒ‡æ ‡ | é¦–æ¬¡éƒ¨ç½²ï¼ˆinitmcï¼‰ | å¢é‡æ›´æ–°ï¼ˆinitmc --syncï¼‰ |
|------|-------------------|-------------------------|
| **æ‰§è¡Œæ—¶é—´** | 30-60ç§’ | 5-10ç§’ |
| **Tokenæ¶ˆè€—ï¼ˆå°é¡¹ç›®ï¼‰** | 25k | 2k |
| **Tokenæ¶ˆè€—ï¼ˆä¸­é¡¹ç›®ï¼‰** | 60k | 2k |
| **ç”Ÿæˆæ–‡ä»¶æ•°é‡** | 50-100ä¸ª | 0-10ä¸ªï¼ˆåªæ›´æ–°å˜åŒ–ï¼‰ |
| **è½¯è¿æ¥åˆ›å»º** | 80ä¸ª | 0-5ä¸ªï¼ˆåªæ›´æ–°å˜åŒ–ï¼‰ |

**å¢é‡æ›´æ–°ä¼˜åŒ–**:

```javascript
// æ™ºèƒ½æ£€æµ‹å˜åŒ–
const currentHash = getFileHash(file);
const baselineHash = manifest.baselineHashes[file];

if (currentHash === baselineHash) {
  skip();  // æ–‡ä»¶æœªå˜åŒ–,è·³è¿‡æ›´æ–°
} else {
  update();  // æ–‡ä»¶æœ‰å˜åŒ–,æ›´æ–°
}
```

---

### 14.4 æŠ€æœ¯æ ˆä¸ä¾èµ–

#### 14.4.1 æ ¸å¿ƒä¾èµ–è¯´æ˜

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” | å…³é”®API |
|------|------|------|--------|
| **fs-extra** | ^10.1.0 | å¢å¼ºçš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ | `ensureDir()`, `copy()`, `remove()` |
| **glob** | ^7.2.0 | æ–‡ä»¶æ¨¡å¼åŒ¹é… | `glob.sync(pattern, options)` |
| **crypto** | å†…ç½® | æ–‡ä»¶å“ˆå¸Œè®¡ç®— | `createHash('sha256')` |
| **path** | å†…ç½® | è·¯å¾„æ“ä½œ | `path.join()`, `path.resolve()` |
| **os** | å†…ç½® | ç³»ç»Ÿä¿¡æ¯ | `os.homedir()`, `os.platform()` |

---

#### 14.4.2 è®¾è®¡æ¨¡å¼åº”ç”¨

| è®¾è®¡æ¨¡å¼ | åº”ç”¨ä½ç½® | å®ç°ç»†èŠ‚ |
|---------|---------|---------|
| **ç”Ÿæˆå™¨æ¨¡å¼** | [lib/generator.js](lib/generator.js) | Layer 1/2/3åˆ†å±‚ç”Ÿæˆ |
| **ç­–ç•¥æ¨¡å¼** | [lib/symlink-manager.js](lib/symlink-manager.js) | è½¯è¿æ¥é™çº§ç­–ç•¥ï¼ˆsymlink â†’ junction â†’ readonly-copyï¼‰ |
| **å•ä¾‹æ¨¡å¼** | [lib/config.js](lib/config.js) | å…¨å±€é…ç½®ç®¡ç† |
| **æ¨¡æ¿æ–¹æ³•æ¨¡å¼** | [lib/generator.js](lib/generator.js) | `generateAll()` å®šä¹‰æµç¨‹æ¡†æ¶ï¼Œå­æ–¹æ³•å®ç°ç»†èŠ‚ |
| **è§‚å¯Ÿè€…æ¨¡å¼** | [lib/version-checker.js](lib/version-checker.js) | ç‰ˆæœ¬å˜æ›´ç›‘å¬ |

---

#### 14.4.3 è·¨å¹³å°æ”¯æŒè¯¦è§£

**æ”¯æŒçš„å¹³å°**:

| å¹³å° | æ”¯æŒçŠ¶æ€ | è½¯è¿æ¥æ–¹å¼ | æµ‹è¯•çŠ¶æ€ |
|-----|---------|-----------|---------|
| **Windows 10/11** | âœ… å®Œæ•´æ”¯æŒ | Junction â†’ Symlink â†’ ReadonlyCopy | âœ… å·²æµ‹è¯• |
| **Linuxï¼ˆUbuntuã€CentOSç­‰ï¼‰** | âœ… å®Œæ•´æ”¯æŒ | Symlink | âœ… å·²æµ‹è¯• |
| **macOS** | âœ… ç†è®ºæ”¯æŒ | Symlink | âš ï¸ æœªå…¨é¢æµ‹è¯• |

**å¹³å°ç‰¹å®šå®ç°**:

```javascript
// lib/symlink-manager.js:80-100
async _tryCreateSymlink(targetPath, linkPath, relativePath) {
  const isDirectory = fs.statSync(targetPath).isDirectory();

  try {
    if (process.platform === 'win32') {
      // Windows: ä½¿ç”¨Junctionï¼ˆä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
      const type = isDirectory ? 'junction' : 'file';
      fs.symlinkSync(targetPath, linkPath, type);
    } else {
      // Linux/Mac: æ ‡å‡†ç¬¦å·é“¾æ¥
      fs.symlinkSync(targetPath, linkPath);
    }

    console.log(`   âœ… è½¯è¿æ¥: ${relativePath} â†’ ä¸Šæ¸¸`);
    return { type: 'symlink' };

  } catch (err) {
    // é™çº§ï¼šåˆ›å»ºåªè¯»å‰¯æœ¬
    return await this._createReadonlyCopy(targetPath, linkPath, relativePath, isDirectory);
  }
}
```

---

### D. å¸¸è§é—®é¢˜FAQ

#### Q1: å¦‚ä½•åœ¨ä¸å½±å“ç”¨æˆ·çš„æƒ…å†µä¸‹ä¿®æ”¹æ ¸å¿ƒæ–‡æ¡£ï¼Ÿ

**A**: ç›´æ¥ç¼–è¾‘ [markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/](markdown/æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£/) ä¸­çš„æ–‡æ¡£ï¼Œç”¨æˆ·æ‰§è¡Œ `initmc --sync` å³å¯åŒæ­¥æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸ä¼šè¦†ç›– `markdown/core/` çš„é¡¹ç›®å®šåˆ¶ï¼‰ã€‚

---

#### Q2: å¦‚ä½•æ·»åŠ æ–°çš„æ¨¡æ¿æ–‡ä»¶ï¼Ÿ

**A**:
1. åœ¨ [templates/](templates/) ä¸­åˆ›å»º `xxx.template` æ–‡ä»¶
2. åœ¨ [lib/config.js](lib/config.js) çš„ `getTemplatePath()` ä¸­æ·»åŠ è·¯å¾„æ˜ å°„
3. åœ¨ [lib/generator.js](lib/generator.js) ä¸­è°ƒç”¨ `_generateFromTemplate('xxx', ...)`
4. æµ‹è¯•ç”Ÿæˆæ˜¯å¦æˆåŠŸ

---

#### Q3: å¦‚ä½•æµ‹è¯•å¹³æ»‘å‡çº§ï¼Ÿ

**A**:
1. åˆ›å»ºæµ‹è¯•é¡¹ç›®å¹¶åˆå§‹åŒ–ä¸ºæ—§ç‰ˆæœ¬ï¼ˆå¦‚ v16.3ï¼‰
2. ä¿®æ”¹å…¨å±€å®‰è£…ç›®å½•ä¸ºæ–°ç‰ˆæœ¬
3. åœ¨æµ‹è¯•é¡¹ç›®æ‰§è¡Œ `initmc --sync`
4. æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦è‡ªåŠ¨è¿ç§»
5. æ£€æŸ¥ç”¨æˆ·å®šåˆ¶æ–‡ä»¶ï¼ˆ`markdown/core/`ï¼‰æ˜¯å¦ä¿ç•™

---

## ğŸ‰ ç»“è¯­

æœ¬æ–‡æ¡£æ˜¯ **NeteaseMod-Claude å·¥ä½œæµç”Ÿæˆå™¨**çš„å®Œæ•´æŠ€æœ¯æŒ‡å—ã€‚å¦‚æœä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. å…ˆæŸ¥é˜… [å¿«é€ŸæŸ¥é˜…ç´¢å¼•](#-å¿«é€ŸæŸ¥é˜…ç´¢å¼•aiå¸¸ç”¨)
2. å†æŸ¥é˜… [ç¬¬åä¸‰ç« ï¼šé—®é¢˜æ’æŸ¥æŒ‡å—](#-ç¬¬åä¸‰ç« é—®é¢˜æ’æŸ¥æŒ‡å—)
3. å¦‚ä»æœªè§£å†³ï¼Œå‰å¾€ [GitHub Issues](https://github.com/jju666/NeteaseMod-Claude/issues) æé—®

**è®°ä½æ ¸å¿ƒåŸåˆ™**:
- â­ æœ¬é¡¹ç›®æ˜¯**å·¥ä½œæµç”Ÿæˆå™¨**ï¼Œä¸æ˜¯MODSDKé¡¹ç›®
- â­ `markdown/` æ˜¯å•ä¸€çœŸå®æºï¼Œ`templates/` åªåŒ…å«é¡¹ç›®ç‰¹å®šæ¨¡æ¿
- â­ é€šè¿‡è½¯è¿æ¥éƒ¨ç½²æ ¸å¿ƒæ–‡æ¡£ï¼Œè€Œéå¤åˆ¶
- â­ å¿…é¡»ä¿è¯å¹³æ»‘å‡çº§ï¼Œä¼˜å…ˆè€ƒè™‘ç”¨æˆ·ä½“éªŒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v17.2.0
**ç”Ÿæˆæ—¶é—´**: 2025-11-12
**ç»´æŠ¤è€…**: NeteaseMod-Claude Contributors
