# task-meta.json æ–‡æ¡£å®¡è®¡æŠ¥å‘Š (v21.0)

> **å®¡è®¡æ—¥æœŸ**: 2025-11-15
> **å®¡è®¡èŒƒå›´**: task-meta.jsonæ–‡ä»¶ç»“æ„.md vs å®é™…ä»£ç å®ç°
> **ä¸¥é‡æ€§çº§åˆ«**: P0 (Critical) | P1 (High) | P2 (Medium) | P3 (Low)

---

## æ‰§è¡Œæ‘˜è¦

é€šè¿‡ç³»ç»Ÿæ€§å¯¹æ¯”æ–‡æ¡£æè¿°ä¸v21.0å®é™…ä»£ç å®ç°ï¼ˆuser_prompt_handler.py + task_cancellation_handler.py + post_archive.pyï¼‰ï¼Œå‘ç°**11ä¸ªä¸ä¸€è‡´é—®é¢˜**ï¼š

- ğŸ”´ **P0 (Critical)**: 3ä¸ª - æ ¸å¿ƒå­—æ®µæè¿°é”™è¯¯
- ğŸŸ  **P1 (High)**: 5ä¸ª - ç¼ºå°‘å­—æ®µæ–‡æ¡£
- ğŸŸ¡ **P2 (Medium)**: 2ä¸ª - å€¼æ ¼å¼ä¸ä¸€è‡´
- ğŸŸ¢ **P3 (Low)**: 1ä¸ª - å†—ä½™å­—æ®µ

---

## ğŸ”´ P0 - Critical Issues

### P0-1: steps å­å­—æ®µç»“æ„æè¿°ä¸å®Œæ•´

**æ–‡æ¡£ä½ç½®**: lines 267-277

**æ–‡æ¡£æè¿°**:
```markdown
æ¯ä¸ªæ­¥éª¤åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
{
  "status": "pending | in_progress | completed",
  "started_at": "2025-11-14T15:30:22",
  "completed_at": "2025-11-14T15:32:10"  // ä»… completed çŠ¶æ€æœ‰å€¼
}
```

**å®é™…ä»£ç ** (user_prompt_handler.py lines 996-1017):
```python
"step0_context": {
    "description": "é˜…è¯»é¡¹ç›®CLAUDE.md",  # âŒ æ–‡æ¡£æœªæåŠ
    "status": "skipped",
    "prompt": "ï¼ˆç©æ³•åŒ…æ¨¡å¼ï¼šå·²è·³è¿‡ï¼‰"  # âŒ æ–‡æ¡£æœªæåŠ
}
```

**å½±å“**: æ‰€æœ‰4ä¸ªstepéƒ½åŒ…å« `description` å’Œ `prompt` å­—æ®µï¼Œä½†æ–‡æ¡£å®Œå…¨æœªæåŠï¼Œå¯¼è‡´å¼€å‘è€…æ— æ³•ç†è§£è¿™äº›å­—æ®µç”¨é€”ã€‚

**å»ºè®®ä¿®å¤**:
```markdown
#### 3.1 stepsï¼ˆæ­¥éª¤çŠ¶æ€ï¼‰

æ¯ä¸ªæ­¥éª¤çš„**é€šç”¨å­—æ®µ**ï¼š

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `description` | string | âœ… | æ­¥éª¤æè¿°ï¼ˆä¸­æ–‡ï¼‰ï¼Œç”¨äºUIå±•ç¤º |
| `status` | enum | âœ… | æ­¥éª¤çŠ¶æ€ï¼š`pending` \| `in_progress` \| `completed` \| `skipped` |
| `prompt` | string | âœ… | æ­¥éª¤æç¤ºæ–‡æœ¬ï¼Œæ³¨å…¥ç»™AIçš„æŒ‡å¯¼å†…å®¹ |
| `started_at` | ISO 8601 | âŒ | æ­¥éª¤å¼€å§‹æ—¶é—´ï¼ˆä»… in_progress/completed çŠ¶æ€ï¼‰ |
| `completed_at` | ISO 8601 | âŒ | æ­¥éª¤å®Œæˆæ—¶é—´ï¼ˆä»… completed çŠ¶æ€ï¼‰ |
```

---

### P0-2: architecture_version å€¼æ ¼å¼ä¸ä¸€è‡´

**æ–‡æ¡£ç¤ºä¾‹** (line 138):
```json
"architecture_version": "21.0"
```

**æ–‡æ¡£è¯´æ˜** (line 246):
```markdown
`architecture_version: "21.0"` - æ¶æ„ç‰ˆæœ¬æ ‡è®°
```

**å®é™…ä»£ç ** (user_prompt_handler.py line 990):
```python
"architecture_version": "v21.0"  # â† æœ‰ "v" å‰ç¼€
```

**å½±å“**:
- éªŒè¯è„šæœ¬å¦‚æœæŒ‰æ–‡æ¡£æ£€æŸ¥ `== "21.0"` ä¼šå¤±è´¥
- è¿ç§»è„šæœ¬å¯èƒ½è¯¯åˆ¤ç‰ˆæœ¬

**å»ºè®®ä¿®å¤**:
1. ç»Ÿä¸€ä»£ç å’Œæ–‡æ¡£éƒ½ä½¿ç”¨ `"v21.0"` (æ¨è)
2. æˆ–ä¿®æ”¹ä»£ç å»æ‰ `v` å‰ç¼€æ”¹ä¸º `"21.0"`

---

### P0-3: ç¤ºä¾‹JSONç¼ºå°‘å¿…éœ€å­—æ®µ

**æ–‡æ¡£ç¤ºä¾‹** (lines 136-235):

âŒ **ç¼ºå¤±å­—æ®µ**ï¼ˆä»£ç å®é™…ç”Ÿæˆä½†ç¤ºä¾‹æœªåŒ…å«ï¼‰:
- `steps.*.description`ï¼ˆæ‰€æœ‰stepéƒ½æœ‰ï¼‰
- `steps.*.prompt`ï¼ˆæ‰€æœ‰stepéƒ½æœ‰ï¼‰

âœ… **å†—ä½™å­—æ®µ**ï¼ˆç¤ºä¾‹æœ‰ä½†ä»£ç åˆå§‹åŒ–ä¸ç”Ÿæˆï¼‰:
- `bug_fix_tracking`ï¼ˆä»…bug_fixä»»åŠ¡æ‰æœ‰ï¼Œç¤ºä¾‹åº”æ ‡æ³¨æ¡ä»¶ï¼‰

**å»ºè®®**: å®Œå…¨é‡å†™ç¤ºä¾‹JSONï¼Œä¸¥æ ¼å¯¹åº”ä»£ç ç”Ÿæˆçš„åˆå§‹ç»“æ„ã€‚

---

## ğŸŸ  P1 - High Priority Issues

### P1-1: ç¼ºå°‘ `failed_at` å­—æ®µæ–‡æ¡£

**ä»£ç **: task_cancellation_handler.py
```python
meta['failed_at'] = datetime.now().isoformat()
```

**æ–‡æ¡£**: ç¬¬7èŠ‚"å½’æ¡£çŠ¶æ€" (lines 367-375) - **å®Œå…¨æœªæåŠ**

**å½±å“**: å¼€å‘è€…ä¸çŸ¥é“å¤±è´¥ä»»åŠ¡ä¼šè®°å½•å¤±è´¥æ—¶é—´

**å»ºè®®ä¿®å¤**:
```markdown
### 7. å½’æ¡£çŠ¶æ€

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `archived` | boolean | æ˜¯å¦å·²å½’æ¡£ |
| `failed` | boolean | æ˜¯å¦å¤±è´¥ä»»åŠ¡ |
| `archived_at` | ISO 8601 \| null | å½’æ¡£æ—¶é—´ï¼ˆä»»åŠ¡å½’æ¡£æ—¶è®¾ç½®ï¼‰ |
| `failed_at` | ISO 8601 \| null | å¤±è´¥æ—¶é—´ï¼ˆä»…å¤±è´¥ä»»åŠ¡ï¼Œ`failed=true`æ—¶è®¾ç½®ï¼‰ |  # â† æ–°å¢
| `cancel_type` | string \| null | å–æ¶ˆç±»å‹ï¼š`cancel` \| `fail`ï¼ˆä»…å–æ¶ˆ/å¤±è´¥ä»»åŠ¡ï¼‰ |
| `failure_reason` | string \| null | å¤±è´¥åŸå› ï¼ˆä»…å¤±è´¥ä»»åŠ¡ï¼‰ |
```

---

### P1-2: ç¼ºå°‘ `final_step` å­—æ®µæ–‡æ¡£

**ä»£ç **: task_cancellation_handler.py
```python
meta['final_step'] = current_step
```

**æ–‡æ¡£**: **å®Œå…¨æœªæåŠ**

**å½±å“**: æ— æ³•çŸ¥é“ä»»åŠ¡åœ¨å“ªä¸ªæ­¥éª¤è¢«å–æ¶ˆ/å¤±è´¥

**å»ºè®®ä¿®å¤**: åœ¨"å½’æ¡£çŠ¶æ€"èŠ‚æ·»åŠ 
```markdown
| `final_step` | string \| null | ä»»åŠ¡ç»ˆæ­¢æ—¶æ‰€åœ¨æ­¥éª¤ï¼ˆä»…å–æ¶ˆ/å¤±è´¥ä»»åŠ¡ï¼‰ |
```

---

### P1-3: `task_type` æšä¸¾å€¼ä¸ä»£ç ä¸ç¬¦

**æ–‡æ¡£** (line 254):
```markdown
`task_type`: `bug_fix` | `feature_implementation` | `general`
```

**ä»£ç ** (user_prompt_handler.py line 980):
```python
task_type = "bug_fix" if is_bugfix_task(task_desc) else "general"
# âŒ æ²¡æœ‰ "feature_implementation"
```

**å½±å“**: æ–‡æ¡£è¯¯å¯¼å¼€å‘è€…è®¤ä¸ºæœ‰3ç§ç±»å‹ï¼Œå®é™…åªæœ‰2ç§

**å»ºè®®ä¿®å¤**:
1. åˆ é™¤æ–‡æ¡£ä¸­çš„ `feature_implementation`
2. æˆ–åœ¨ä»£ç ä¸­å®ç° `feature_implementation` æ£€æµ‹é€»è¾‘

---

### P1-4: `status` æšä¸¾ç¼ºå°‘ `skipped` å€¼

**æ–‡æ¡£** (line 273):
```markdown
"status": "pending | in_progress | completed"
```

**å®é™…ä»£ç ** (user_prompt_handler.py lines 998, 1003):
```python
"status": "skipped"  # â† step0å’Œstep1ä½¿ç”¨skipped
```

**å½±å“**: æ–‡æ¡£æœªæè¿° `skipped` çŠ¶æ€çš„å«ä¹‰å’Œä½¿ç”¨åœºæ™¯

**å»ºè®®ä¿®å¤**:
```markdown
"status": "pending | in_progress | completed | skipped"

è¯´æ˜ï¼š
- `skipped`: ç©æ³•åŒ…æ¨¡å¼ä¸‹ï¼Œstep0/step1è¢«è·³è¿‡ï¼ˆå·²æä¾›ä»£ç å®ç°ï¼‰
```

---

### P1-5: bug_fix_tracking æ¡ä»¶è¯´æ˜ä¸æ¸…

**æ–‡æ¡£** (line 290):
```markdown
ä»…å½“ `task_type = "bug_fix"` æ—¶å­˜åœ¨ã€‚
```

**é—®é¢˜**:
- æ²¡æœ‰è¯´æ˜è¯¥å­—æ®µæ˜¯**åˆå§‹åŒ–æ—¶ç«‹å³ç”Ÿæˆ**ï¼Œè¿˜æ˜¯è¿è¡Œæ—¶æ·»åŠ 
- ç¤ºä¾‹JSON (line 173)ç›´æ¥åŒ…å«äº†è¯¥å­—æ®µï¼Œå®¹æ˜“è¯¯å¯¼ä»¥ä¸ºæ‰€æœ‰ä»»åŠ¡éƒ½æœ‰

**å»ºè®®ä¿®å¤**: æ·»åŠ æ˜ç¡®è¯´æ˜
```markdown
### 4. Bugä¿®å¤è¿½è¸ª

**ç”Ÿæˆæ¡ä»¶**: ä»…å½“ `task_type = "bug_fix"` æ—¶ï¼Œåœ¨**ä»»åŠ¡åˆå§‹åŒ–é˜¶æ®µ**ç«‹å³ç”Ÿæˆæ­¤å­—æ®µã€‚

**ä»£ç ä½ç½®**: `orchestrator/user_prompt_handler.py` lines 1043-1056
```

---

## ğŸŸ¡ P2 - Medium Priority Issues

### P2-1: `archived_at` åˆå§‹å€¼æ–‡æ¡£ç¼ºå¤±

**æ–‡æ¡£ç¤ºä¾‹** (line 232):
```json
"archived_at": null
```

**é—®é¢˜**:
- ä»£ç åˆå§‹åŒ–æ—¶**ä¸ç”Ÿæˆ** `archived_at` å­—æ®µ
- åªåœ¨å½’æ¡£æ—¶åŠ¨æ€æ·»åŠ  (post_archive.py)

**å»ºè®®ä¿®å¤**: ç¤ºä¾‹JSONåº”åˆ é™¤ `archived_at`ï¼Œæˆ–æ ‡æ³¨ä¸º"è¿è¡Œæ—¶æ·»åŠ "
```json
// "archived_at": null  // â† ä»…å½’æ¡£æ—¶æ·»åŠ ï¼Œåˆå§‹åŒ–ä¸ç”Ÿæˆ
```

---

### P2-2: å½’æ¡£ç›¸å…³å­—æ®µåˆå§‹åŒ–ä¸ä¸€è‡´

**æ–‡æ¡£ç¤ºä¾‹åŒ…å«**:
- `archived_at: null` (ä»£ç ä¸ç”Ÿæˆ)

**æ–‡æ¡£æœªåŒ…å«ä½†å½’æ¡£æ—¶åŠ¨æ€æ·»åŠ **:
- `failed_at` (P1-1)
- `final_step` (P1-2)
- `cancel_type` (æ–‡æ¡£æœ‰æè¿°ï¼Œä½†æœªæ ‡æ³¨"è¿è¡Œæ—¶æ·»åŠ ")
- `failure_reason` (æ–‡æ¡£æœ‰æè¿°ï¼Œä½†æœªæ ‡æ³¨"è¿è¡Œæ—¶æ·»åŠ ")

**å»ºè®®**: æ˜ç¡®åŒºåˆ†"åˆå§‹åŒ–å­—æ®µ"å’Œ"è¿è¡Œæ—¶æ·»åŠ å­—æ®µ"ï¼Œåœ¨æ–‡æ¡£ä¸­ç”¨è¡¨æ ¼åŒºåˆ†ã€‚

---

## ğŸŸ¢ P3 - Low Priority Issues

### P3-1: `bug_fix_tracking.matched_gameplay_pack` å­—æ®µå†—ä½™

**ä»£ç **:
```python
# é¡¶å±‚
task_meta["gameplay_pack_matched"] = matched_pattern['id']

# bug_fix_tracking ä¸­é‡å¤
task_meta["bug_fix_tracking"]["matched_gameplay_pack"] = matched_pattern['id']
```

**å½±å“**: æ•°æ®å†—ä½™ï¼Œç»´æŠ¤æˆæœ¬å¢åŠ 

**å»ºè®®**:
1. ä¿ç•™é¡¶å±‚ `gameplay_pack_matched`
2. åˆ é™¤ `bug_fix_tracking.matched_gameplay_pack`
3. æˆ–åœ¨æ–‡æ¡£ä¸­è¯´æ˜å†—ä½™çš„å¿…è¦æ€§

---

## å»ºè®®çš„ä¿®å¤ä¼˜å…ˆçº§

### ç«‹å³ä¿®å¤ (P0)
1. âœ… é‡å†™ steps å­—æ®µæè¿°ï¼Œæ·»åŠ  `description` å’Œ `prompt`
2. âœ… ç»Ÿä¸€ `architecture_version` å€¼æ ¼å¼ä¸º `"v21.0"`
3. âœ… é‡å†™å®Œæ•´ç¤ºä¾‹JSONï¼Œä¸¥æ ¼å¯¹åº”ä»£ç å®é™…ç”Ÿæˆçš„ç»“æ„

### è¿‘æœŸä¿®å¤ (P1)
4. âœ… æ·»åŠ  `failed_at` å’Œ `final_step` å­—æ®µæ–‡æ¡£
5. âœ… ä¿®æ­£ `task_type` æšä¸¾å€¼ï¼ˆåˆ é™¤feature_implementationæˆ–å®ç°å®ƒï¼‰
6. âœ… æ·»åŠ  `skipped` çŠ¶æ€è¯´æ˜
7. âœ… æ˜ç¡® bug_fix_tracking ç”Ÿæˆæ—¶æœº

### åç»­ä¼˜åŒ– (P2-P3)
8. â³ åŒºåˆ†åˆå§‹åŒ–å­—æ®µ vs è¿è¡Œæ—¶æ·»åŠ å­—æ®µ
9. â³ è¯„ä¼°æ˜¯å¦ç§»é™¤å†—ä½™å­—æ®µ

---

## é™„å½•ï¼šå®Œæ•´å­—æ®µå¯¹æ¯”è¡¨

| å­—æ®µè·¯å¾„ | ä»£ç åˆå§‹åŒ– | è¿è¡Œæ—¶æ·»åŠ  | æ–‡æ¡£æè¿° | çŠ¶æ€ |
|---------|-----------|-----------|---------|------|
| `architecture_version` | âœ… "v21.0" | - | âš ï¸ "21.0" | å€¼ä¸ä¸€è‡´ |
| `steps.*.description` | âœ… | - | âŒ ç¼ºå¤± | P0 |
| `steps.*.prompt` | âœ… | - | âŒ ç¼ºå¤± | P0 |
| `steps.*.status` | âœ… | - | âš ï¸ ç¼ºskipped | P1 |
| `failed_at` | - | âœ… | âŒ ç¼ºå¤± | P1 |
| `final_step` | - | âœ… | âŒ ç¼ºå¤± | P1 |
| `archived_at` | - | âœ… | âš ï¸ ç¤ºä¾‹æœ‰null | P2 |
| `cancel_type` | - | âœ… | âœ… æœ‰ | OK |
| `failure_reason` | - | âœ… | âœ… æœ‰ | OK |
| `bug_fix_tracking.matched_gameplay_pack` | âœ… | - | âœ… æœ‰ | å†—ä½™P3 |

---

**å®¡è®¡ç»“è®º**: task-meta.jsonæ–‡ä»¶ç»“æ„.md **ä¸æ»¡è¶³v21.0æ¶æ„è®¾è®¡**ï¼Œéœ€è¦å…¨é¢ä¿®è®¢ã€‚
