# æ–‡æ¡£ç”Ÿæˆå™¨ (DocumentGenerator)

> æ¨¡å—è·¯å¾„: `lib/generator.js`
> ç‰ˆæœ¬: v2.0 (é›†æˆè‡ªé€‚åº”æ–‡æ¡£ç»´æŠ¤æœºåˆ¶)
> æœ€åæ›´æ–°: 2025-11-13

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

`DocumentGenerator` æ˜¯ MODSDK å¼€å‘å·¥ä½œæµçš„æ ¸å¿ƒæ–‡æ¡£ç”Ÿæˆå¼•æ“ï¼Œè´Ÿè´£æ ¹æ® `ProjectAnalyzer` ç”Ÿæˆçš„åˆ†ææŠ¥å‘Šï¼Œåˆ›å»ºå®Œæ•´çš„ä¸‰å±‚æ–‡æ¡£æ¶æ„ï¼ˆLayer 1é€šç”¨å±‚ã€Layer 2æ¶æ„å±‚ã€Layer 3ä¸šåŠ¡å±‚ï¼‰ã€‚v2.0 ç‰ˆæœ¬é›†æˆäº†è‡ªé€‚åº”æ–‡æ¡£ç»´æŠ¤æœºåˆ¶ï¼Œèƒ½å¤Ÿæ™ºèƒ½å¤„ç†ä»»æ„ç±»å‹çš„é¡¹ç›®ç»„ä»¶ã€‚

### ä¸»è¦èŒè´£

1. **ä¸‰å±‚æ–‡æ¡£ç”Ÿæˆ**: Layer 1ï¼ˆæ ¸å¿ƒå·¥ä½œæµï¼‰ã€Layer 2ï¼ˆç³»ç»Ÿæ–‡æ¡£ï¼‰ã€Layer 3ï¼ˆä¸šåŠ¡æ–‡æ¡£ï¼‰
2. **æ¨¡æ¿æ¸²æŸ“**: ä»æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆå®é™…æ–‡æ¡£ï¼Œæ›¿æ¢å ä½ç¬¦
3. **æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤**: æ£€æµ‹ç°æœ‰æ–‡æ¡£è´¨é‡ï¼Œé¿å…è¦†ç›–é«˜è´¨é‡æ–‡æ¡£
4. **è‡ªé€‚åº”ç»„ä»¶æ–‡æ¡£**: ä¸ºè‡ªå®šä¹‰ç»„ä»¶è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ï¼ˆv2.0ï¼‰
5. **ç‰ˆæœ¬ç®¡ç†**: ç”Ÿæˆ workflow-manifest.json ç”¨äºç‰ˆæœ¬è¿½è¸ª
6. **Hookéƒ¨ç½²**: éƒ¨ç½²ä»»åŠ¡éš”ç¦»ä¸ä¸Šä¸‹æ–‡æ¢å¤çš„Hookæ–‡ä»¶ï¼ˆv18.1ï¼‰

---

## ğŸ—ï¸ æ ¸å¿ƒç±»ä¸æ–¹æ³•

### DocumentGenerator (ä¸»ç”Ÿæˆå™¨)

#### æ„é€ å‡½æ•°
```javascript
constructor(analysisReport, upstreamPath)
```
- **å‚æ•°**:
  - `analysisReport` - ProjectAnalyzerç”Ÿæˆçš„åˆ†ææŠ¥å‘Š
  - `upstreamPath` - ä¸Šæ¸¸å·¥ä½œæµä»“åº“è·¯å¾„
- **åˆå§‹åŒ–**:
  - `this.report` - å®Œæ•´åˆ†ææŠ¥å‘Š
  - `this.metadata` - é¡¹ç›®å…ƒæ•°æ®
  - `this.codeStructure` - ä»£ç ç»“æ„
  - `this.upstreamPath` - ä¸Šæ¸¸è·¯å¾„

---

### ä¸»è¦ç”Ÿæˆæ–¹æ³•

#### generateAll(targetPath, options) - ç”Ÿæˆæ‰€æœ‰æ–‡æ¡£
```javascript
async generateAll(targetPath, options = {})
```
- **å‚æ•°**:
  - `targetPath` - ç›®æ ‡é¡¹ç›®è·¯å¾„
  - `options.minimalMode` - æœ€å°åŒ–æ¨¡å¼ï¼ˆä»…éƒ¨ç½²æ ¸å¿ƒå·¥ä½œæµï¼‰
- **ç”Ÿæˆæµç¨‹**:
  1. åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„
  2. ç”Ÿæˆ Layer 1ï¼ˆé€šç”¨å±‚ï¼‰
  3. éƒ¨ç½²å®˜æ–¹æ–‡æ¡£ï¼ˆæœ€å°åŒ–æ¨¡å¼ï¼‰
  4. ç”Ÿæˆ Layer 2ï¼ˆæ¶æ„å±‚ï¼‰- éæœ€å°åŒ–æ¨¡å¼
  5. ç”Ÿæˆè‡ªé€‚åº”ç»„ä»¶æ–‡æ¡£ï¼ˆv2.0ï¼‰- éæœ€å°åŒ–æ¨¡å¼
  6. ç”Ÿæˆ Layer 3ï¼ˆä¸šåŠ¡å±‚ï¼‰- éæœ€å°åŒ–æ¨¡å¼
  7. ç”Ÿæˆæ–‡æ¡£å¾…è¡¥å……æ¸…å• - éæœ€å°åŒ–æ¨¡å¼

---

### Layer 1 ç”Ÿæˆ (é€šç”¨å±‚ - v18.0æ¶æ„)

#### _generateLayer1(targetPath) - æ ¸å¿ƒå·¥ä½œæµæ–‡æ¡£
```javascript
async _generateLayer1(targetPath)
```

**ç”Ÿæˆå†…å®¹**:

1. **CLAUDE.md** (v18.0æ”¹è¿›):
   - ä»…åœ¨é¦–æ¬¡éƒ¨ç½²ä¸”æ–‡ä»¶ä¸å­˜åœ¨æ—¶ç”Ÿæˆæœ€å°åŒ–æ¨¡æ¿
   - å·²å­˜åœ¨æ—¶è·³è¿‡ç”Ÿæˆï¼Œç”±ç”¨æˆ·è‡ªä¸»ç»´æŠ¤
   - ä½¿ç”¨ `_generateMinimalCLAUDE()` ç”Ÿæˆçº¦30è¡Œçš„ç®€æ´æ¨¡æ¿

2. **Claudeå‘½ä»¤æ–‡ä»¶** (v17.1ç»Ÿä¸€å‘½å):
   - `mc.md` - ä¸»å·¥ä½œæµå‘½ä»¤
   - `mc-review.md` - ä»£ç å®¡æŸ¥å‘½ä»¤
   - `mc-perf.md` - æ€§èƒ½åˆ†æå‘½ä»¤
   - `mc-docs.md` - æ–‡æ¡£ç®¡ç†å‘½ä»¤
   - `mc-why.md` - æ¶æ„è§£é‡Šå‘½ä»¤
   - `mc-discover.md` - ç»„ä»¶å‘ç°å‘½ä»¤
   - è‡ªåŠ¨æ¸…ç†æ—§å‘½ä»¤ï¼š`_cleanupOldCommands()`

3. **Hookæ–‡ä»¶** (v18.1ä»»åŠ¡éš”ç¦»æœºåˆ¶):
   - `.claude/settings.json` - é…ç½®æ–‡ä»¶
   - `.claude/hooks/` - Hookè„šæœ¬ç›®å½•
     - `check-critical-rules.py` - è§„èŒƒæ£€æŸ¥
     - `log-changes.py` - å˜æ›´æ—¥å¿—
     - `user-prompt-submit-hook.py` - æç¤ºæäº¤Hook
     - `enforce-step2.py` - æ­¥éª¤2å¼ºåˆ¶æ‰§è¡Œ
     - `track-doc-reading.py` - æ–‡æ¡£é˜…è¯»è¿½è¸ª
     - `enforce-cleanup.py` - æ¸…ç†å¼ºåˆ¶æ‰§è¡Œ
     - `pre-compact-reminder.py` - Compactæé†’
     - `stop-hook.py` - åœæ­¢Hook
     - `subagent-stop-hook.py` - å­Agentåœæ­¢Hook

4. **README.md** - é¡¹ç›®æ ¹README

5. **ä¸Šæ¸¸æ–‡æ¡£å¼•ç”¨** (`.claude/core-docs/`):
   - ä½¿ç”¨ `SymlinkManager` åˆ›å»ºè½¯è¿æ¥
   - æŒ‡å‘ä¸Šæ¸¸å·¥ä½œæµçš„æ ¸å¿ƒæ–‡æ¡£

6. **æ–‡æ¡£å¯¼èˆª** (`markdown/README.md`):
   - æ–‡æ¡£ç´¢å¼•å’Œå¯¼èˆª

7. **ä»»åŠ¡ç›®å½•** (`tasks/README.md`):
   - ä»»åŠ¡å­˜å‚¨è¯´æ˜

8. **å·¥ä½œæµå…ƒæ•°æ®** (`.claude/workflow-manifest.json`):
   - ç‰ˆæœ¬å·
   - åŸºçº¿æ–‡ä»¶å“ˆå¸Œå€¼
   - å®‰è£…æ—¶é—´

---

### Layer 2 ç”Ÿæˆ (æ¶æ„å±‚)

#### _generateLayer2(targetPath) - ç³»ç»Ÿæ–‡æ¡£
```javascript
async _generateLayer2(targetPath)
```

**ç”Ÿæˆå†…å®¹**:

1. **Systems README** (`markdown/systems/README.md`):
   - Systemsç´¢å¼•åˆ—è¡¨

2. **å•ä¸ªSystemæ–‡æ¡£** (æ™ºèƒ½ç”Ÿæˆ):
   ```javascript
   // æ£€æµ‹ç°æœ‰æ–‡æ¡£
   const existingDoc = _detectExistingSystemDoc(systemName, systemsDir);

   // è´¨é‡è¯„ä¼°
   if (existingDoc && existingDoc.quality >= 3) {
     // ä¿ç•™é«˜è´¨é‡æ–‡æ¡£
     continue;
   }

   // ç”Ÿæˆæ–°æ–‡æ¡£
   const docContent = _generateSystemDoc(systemName, systemInfo, targetPath);

   // AIæ™ºèƒ½å‘½åï¼ˆv2.0ï¼‰
   const chineseFileName = maintenance._inferChineseNameByAI(
     systemFilePath, systemName, { type: 'system', subtype: 'system' }
   );
   ```

**æ–‡æ¡£è´¨é‡è¯„ä¼°** (0-5åˆ†):
- æœ‰ä»£ç å—ç¤ºä¾‹ (+1)
- æœ‰å›¾è¡¨ï¼ˆmermaid/flowchartï¼‰(+1)
- æœ‰ç¤ºä¾‹è¯´æ˜ (+1)
- å†…å®¹ä¸°å¯Œï¼ˆ>500å­—ç¬¦ï¼‰(+1)
- ä¸æ˜¯"å¾…è¡¥å……"æ¨¡æ¿ (+1)

---

### è‡ªé€‚åº”ç»„ä»¶æ–‡æ¡£ (v2.0)

#### _generateAdaptiveDocs(targetPath) - æ™ºèƒ½ç»„ä»¶æ–‡æ¡£
```javascript
async _generateAdaptiveDocs(targetPath)
```

**æ‰§è¡Œæµç¨‹**:
1. æ£€æŸ¥æ˜¯å¦æœ‰å‘ç°çš„ç»„ä»¶ (`discoveredComponents`)
2. æ¨æ–­æ–‡æ¡£æ˜ å°„å…³ç³» (`DocMappingInference`)
3. æ™ºèƒ½ç»´æŠ¤æ–‡æ¡£ (`IntelligentDocMaintenance`)

**é€‚ç”¨åœºæ™¯**:
- è‡ªå®šä¹‰ç»„ä»¶ç›®å½•ï¼ˆstates/, handlers/, managers/ï¼‰
- é…ç½®æ–‡ä»¶ç›®å½•ï¼ˆconfigs/, data/ï¼‰
- ä»»ä½•éæ ‡å‡†System/Presetçš„ç»„ä»¶

---

### Layer 3 ç”Ÿæˆ (ä¸šåŠ¡å±‚)

#### _generateLayer3(targetPath) - ä¸šåŠ¡æ¡†æ¶
```javascript
async _generateLayer3(targetPath)
```

**æ ¹æ®é¡¹ç›®ç±»å‹ç”Ÿæˆ**:
- **RPGé¡¹ç›®**: `markdown/NEWRPG/README.md`
- **ECPreseté¡¹ç›®**: `markdown/presets/README.md`
- å…¶ä»–é¡¹ç›®: åˆ›å»ºåŸºç¡€æ¡†æ¶

---

### æ¨¡æ¿å¤„ç†æ–¹æ³•

#### _generateFromTemplate(templateName, targetPath, relativePath, replacements)
```javascript
_generateFromTemplate(templateName, targetPath, relativePath, replacements)
```
- **åŠŸèƒ½**: ä»æ¨¡æ¿ç”Ÿæˆæ–‡ä»¶ï¼Œæ›¿æ¢å ä½ç¬¦
- **ç‰¹æ®Šå¤„ç†**:
  - CLAUDE.md: æ™ºèƒ½åˆå¹¶ï¼Œä¿æŠ¤ç”¨æˆ·ç¼–è¾‘åŒºåŸŸ
  - å…¶ä»–æ–‡ä»¶: ç›´æ¥è¦†ç›–

#### _buildReplacements(targetPath) - æ„å»ºå ä½ç¬¦æ˜ å°„
```javascript
_buildReplacements(targetPath)
```

**å ä½ç¬¦åˆ—è¡¨**:
```javascript
{
  '{{PROJECT_PATH}}': normalizedPath,
  '{{PROJECT_NAME}}': this.metadata.projectName,
  '{{CURRENT_DATE}}': getCurrentDate(),
  '{{PROJECT_STATUS}}': 'ç”Ÿäº§å°±ç»ª (Production Ready)',
  '{{VERSION}}': VERSION,
  '{{EXAMPLE_TASKS}}': this._generateExampleTasks(),
  '{{LOG_FILES}}': this._generateLogFiles(targetPath),
  '{{ARCHITECTURE_DOCS_SECTION}}': this._generateArchitectureDocs(),
  '{{BUSINESS_DOCS_SECTION}}': this._generateBusinessDocs(),
  '{{PRESETS_DOCS_SECTION}}': this._generatePresetsDocs(),
  '{{NBT_CHECK_SECTION}}': this._generateNBTSection(),
  '{{CRITICAL_RULES}}': this._generateCriticalRulesSection(),
  '{{CRITICAL_RULES_EXTRA}}': this._generateCriticalRules(),
  '{{PROJECT_DESCRIPTION}}': `${this.metadata.businessType}ç±»å‹MODSDKé¡¹ç›®`,
  '{{EXTRA_DOCS}}': this._generateExtraDocs(),
  '{{SDK_DOC_PATH}}': 'D:\\EcWork\\netease-modsdk-wiki',
  '{{GLOBAL_DOCS_PATH}}': normalizedGlobalDocsPath,
  '{{CORE_PATHS}}': this._generateCorePaths(normalizedPath)
}
```

---

### CLAUDE.mdæ™ºèƒ½åˆå¹¶ (v16.1+)

#### _mergeCLAUDEmd(newTemplate, existingContent)
```javascript
_mergeCLAUDEmd(newTemplate, existingContent)
```

**å››æ®µå¼ç»“æ„**:
1. **é¡¹ç›®é…ç½®åŒº** (ç”¨æˆ·å¯ç¼–è¾‘):
   ```
   <!-- ==================== é¡¹ç›®é…ç½®åŒº START ==================== -->
   (ç”¨æˆ·è‡ªå®šä¹‰å†…å®¹)
   <!-- ==================== é¡¹ç›®é…ç½®åŒº END ==================== -->
   ```

2. **å·¥ä½œæµå†…å®¹åŒº** (è‡ªåŠ¨ç®¡ç†):
   ```
   <!-- ==================== å·¥ä½œæµå†…å®¹ START v16.1 ==================== -->
   (å·¥ä½œæµè‡ªåŠ¨ç”Ÿæˆå†…å®¹ï¼Œå‡çº§æ—¶ç²¾ç¡®æ›¿æ¢)
   <!-- ==================== å·¥ä½œæµå†…å®¹ END v16.1 ==================== -->
   ```

3. **é¡¹ç›®æ‰©å±•åŒº** (ç”¨æˆ·å¯ç¼–è¾‘):
   ```
   <!-- ==================== é¡¹ç›®æ‰©å±•åŒº START ==================== -->
   (ç”¨æˆ·æ·»åŠ é¡¹ç›®ç‰¹å®šè§„èŒƒ)
   <!-- ==================== é¡¹ç›®æ‰©å±•åŒº END ==================== -->
   ```

4. **æ–‡æ¡£å…ƒæ•°æ®åŒº** (è‡ªåŠ¨ç®¡ç†):
   ```
   <!-- ==================== æ–‡æ¡£å…ƒæ•°æ®åŒº START ==================== -->
   (ç‰ˆæœ¬ä¿¡æ¯ã€ç”Ÿæˆæ—¶é—´)
   <!-- ==================== æ–‡æ¡£å…ƒæ•°æ®åŒº END ==================== -->
   ```

**åˆå¹¶é€»è¾‘**:
- ä½¿ç”¨ `_extractSection()` æå–æ ‡è®°åŒºåŸŸ
- ä¿ç•™ç”¨æˆ·ç¼–è¾‘çš„é¡¹ç›®é…ç½®åŒºå’Œé¡¹ç›®æ‰©å±•åŒº
- æ›´æ–°å·¥ä½œæµå†…å®¹åŒºå’Œå…ƒæ•°æ®åŒº
- ä½¿ç”¨ `_assembleCLAUDEmd()` ç»„è£…æœ€ç»ˆæ–‡æ¡£

---

### æ–‡æ¡£æ£€æµ‹ä¸è´¨é‡è¯„ä¼°

#### _detectExistingSystemDoc(systemName, systemsDir)
```javascript
_detectExistingSystemDoc(systemName, systemsDir)
```
- **è¿”å›å€¼**: `{ fileName, filePath, quality, matchType }` æˆ– `null`
- **åŒ¹é…ç­–ç•¥**:
  1. **ç²¾ç¡®æ–‡ä»¶ååŒ¹é…**: `ShopServerSystem.md`
  2. **å†…å®¹æ™ºèƒ½åŒ¹é…**: æ ‡é¢˜/ç±»å®šä¹‰ä¸­åŒ…å«ç³»ç»Ÿå
  3. **æ ¸å¿ƒåç§°åŒ¹é…**: `ShopServerSystem` â†’ `Shop`ï¼ˆå»æ‰åç¼€ï¼‰

#### _isSystemDocMatch(systemName, content)
```javascript
_isSystemDocMatch(systemName, content)
```
- **åŒ¹é…ç­–ç•¥**:
  - æ ‡é¢˜åŒ…å«ç³»ç»Ÿå: `^#\s+.*${systemName}`
  - Front Matterå£°æ˜: `---\nsystem: ${systemName}\n---`
  - ç±»å®šä¹‰å¼•ç”¨: `class\s+${systemName}`
  - æ ¸å¿ƒåç§°åŒ¹é…: æ ‡é¢˜åŒ…å«å»æ‰Systemåç¼€çš„å…³é”®è¯

#### _assessDocQuality(content)
```javascript
_assessDocQuality(content)
```
- **è¯„åˆ†æ ‡å‡†** (0-5åˆ†):
  - æœ‰ä»£ç å— (+1)
  - æœ‰å›¾è¡¨ (+1)
  - æœ‰ç¤ºä¾‹ (+1)
  - å†…å®¹ä¸°å¯Œ (+1)
  - éå¾…è¡¥å……æ¨¡æ¿ (+1)

---

### å•ä¸ªSystemæ–‡æ¡£ç”Ÿæˆ

#### _generateSystemDoc(systemName, systemInfo, targetPath)
```javascript
_generateSystemDoc(systemName, systemInfo, targetPath)
```

**æ–‡æ¡£ç»“æ„**:
```markdown
# ${systemName}

---
type: ${systemInfo.type}
complexity: ${systemInfo.complexityScore}
detail_level: ${systemInfo.getDetailLevel()}
lines_of_code: ${systemInfo.linesOfCode}
---

> **ç±»å‹**: ${systemInfo.type}
> **æ–‡ä»¶è·¯å¾„**: `${relativePath}`
> **ä»£ç è¡Œæ•°**: ${systemInfo.linesOfCode}
> **å¤æ‚åº¦**: ${systemInfo.complexityScore}/10
> **æ¨èè¯¦ç»†åº¦**: ${systemInfo.getDetailLevel()}

---

## ğŸ“‹ æ¦‚è¿°
(å¾…è¡¥å……)

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡
### ç±»ç»“æ„
```python
class ${systemName}(${systemInfo.type}):
    # ä¸»è¦æ–¹æ³•
    def method1(...)
    def method2(...)
```

---

## ğŸ”§ ä¸»è¦æ–¹æ³•
- `method1()` - å¾…è¡¥å……è¯´æ˜
- `method2()` - å¾…è¡¥å……è¯´æ˜

---

## ğŸ“Š æ•°æ®æµ
(å¾…è¡¥å……)

---

## â“ å¸¸è§é—®é¢˜
(å¾…è¡¥å……)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£
- [å¼€å‘è§„èŒƒ](../å¼€å‘è§„èŒƒ.md)
- [é—®é¢˜æ’æŸ¥](../é—®é¢˜æ’æŸ¥.md)

---

_æœ€åæ›´æ–°: ${getCurrentDate()} | è‡ªåŠ¨ç”Ÿæˆ_
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€æ–‡æ¡£ç”Ÿæˆ
```javascript
const { ProjectAnalyzer } = require('./lib/analyzer');
const { DocumentGenerator } = require('./lib/generator');

// 1. åˆ†æé¡¹ç›®
const analyzer = new ProjectAnalyzer(projectPath);
const report = analyzer.analyze();

// 2. åˆ›å»ºç”Ÿæˆå™¨
const generator = new DocumentGenerator(report, upstreamPath);

// 3. ç”Ÿæˆæ‰€æœ‰æ–‡æ¡£
await generator.generateAll(projectPath, {
  minimalMode: false
});

console.log('âœ… æ–‡æ¡£ç”Ÿæˆå®Œæˆï¼');
```

### ç¤ºä¾‹2: æœ€å°åŒ–æ¨¡å¼éƒ¨ç½²
```javascript
// ä»…éƒ¨ç½²æ ¸å¿ƒå·¥ä½œæµï¼Œä¸ç”Ÿæˆä¸šåŠ¡æ–‡æ¡£
await generator.generateAll(projectPath, {
  minimalMode: true
});

console.log('âœ… æ ¸å¿ƒå·¥ä½œæµéƒ¨ç½²å®Œæˆï¼');
console.log('ğŸ’¡ ä½¿ç”¨ /mc-docs å‘½ä»¤å‘ç°å¹¶è§„èŒƒåŒ–é¡¹ç›®ç»„ä»¶æ–‡æ¡£');
```

### ç¤ºä¾‹3: è‡ªå®šä¹‰å ä½ç¬¦
```javascript
// è®¿é—®å†…éƒ¨æ–¹æ³•ï¼ˆä»…ç”¨äºæµ‹è¯•æˆ–æ‰©å±•ï¼‰
const replacements = generator._buildReplacements(projectPath);

// æ·»åŠ è‡ªå®šä¹‰å ä½ç¬¦
replacements['{{CUSTOM_INFO}}'] = 'My Custom Info';

// ç”Ÿæˆå•ä¸ªæ¨¡æ¿
generator._generateFromTemplate(
  'custom-template.md',
  projectPath,
  'output/custom.md',
  replacements
);
```

---

## ğŸ“Š ç”Ÿæˆæµç¨‹å›¾

### å®Œæ•´ç”Ÿæˆæµç¨‹

```mermaid
graph TB
    Start[å¼€å§‹ç”Ÿæˆ] --> CheckMode{æœ€å°åŒ–æ¨¡å¼?}

    CheckMode -->|æ˜¯| MinimalFlow[æœ€å°åŒ–æµç¨‹]
    CheckMode -->|å¦| FullFlow[å®Œæ•´æµç¨‹]

    MinimalFlow --> CreateDirs[åˆ›å»ºåŸºç¡€ç›®å½•]
    CreateDirs --> Layer1[ç”ŸæˆLayer 1]

    Layer1 --> CheckCLAUDE{CLAUDE.mdå­˜åœ¨?}
    CheckCLAUDE -->|å¦| GenMinimal[ç”Ÿæˆæœ€å°åŒ–CLAUDE.md]
    CheckCLAUDE -->|æ˜¯| SkipCLAUDE[è·³è¿‡ç”Ÿæˆ]

    GenMinimal --> CleanOld[æ¸…ç†æ—§å‘½ä»¤]
    SkipCLAUDE --> CleanOld

    CleanOld --> GenCommands[ç”Ÿæˆmcç³»åˆ—å‘½ä»¤]
    GenCommands --> DeployHooks[éƒ¨ç½²Hookæ–‡ä»¶]
    DeployHooks --> GenREADME[ç”ŸæˆREADME.md]
    GenREADME --> CreateSymlinks[åˆ›å»ºä¸Šæ¸¸æ–‡æ¡£è½¯è¿æ¥]
    CreateSymlinks --> GenNavigation[ç”Ÿæˆæ–‡æ¡£å¯¼èˆª]
    GenNavigation --> GenManifest[ç”Ÿæˆworkflow-manifest]

    GenManifest --> DeployOfficial[éƒ¨ç½²å®˜æ–¹æ–‡æ¡£]
    DeployOfficial --> MinimalEnd[æœ€å°åŒ–æ¨¡å¼å®Œæˆ]

    FullFlow --> CreateDirs2[åˆ›å»ºåŸºç¡€ç›®å½•]
    CreateDirs2 --> Layer1Full[ç”ŸæˆLayer 1]
    Layer1Full --> Layer2[ç”ŸæˆLayer 2]

    Layer2 --> GenSystemsREADME[ç”ŸæˆSystems README]
    GenSystemsREADME --> LoopSystems[éå†æ‰€æœ‰Systems]

    LoopSystems --> DetectExisting{æ£€æµ‹ç°æœ‰æ–‡æ¡£}
    DetectExisting -->|å­˜åœ¨ä¸”é«˜è´¨é‡| SkipSystem[è·³è¿‡System]
    DetectExisting -->|ä¸å­˜åœ¨æˆ–ä½è´¨é‡| GenSystem[ç”ŸæˆSystemæ–‡æ¡£]

    SkipSystem --> NextSystem{æ›´å¤šSystems?}
    GenSystem --> AIName[AIæ™ºèƒ½å‘½å]
    AIName --> NextSystem

    NextSystem -->|æ˜¯| LoopSystems
    NextSystem -->|å¦| AdaptiveDocs[ç”Ÿæˆè‡ªé€‚åº”ç»„ä»¶æ–‡æ¡£]

    AdaptiveDocs --> CheckDiscovered{æœ‰å‘ç°çš„ç»„ä»¶?}
    CheckDiscovered -->|æ˜¯| InferMapping[æ¨æ–­æ–‡æ¡£æ˜ å°„]
    CheckDiscovered -->|å¦| Layer3

    InferMapping --> MaintainDocs[æ™ºèƒ½ç»´æŠ¤æ–‡æ¡£]
    MaintainDocs --> Layer3[ç”ŸæˆLayer 3]

    Layer3 --> CheckBusiness{ä¸šåŠ¡ç±»å‹}
    CheckBusiness -->|RPG| GenRPG[ç”ŸæˆNEWRPGæ–‡æ¡£]
    CheckBusiness -->|ECPreset| GenPresets[ç”ŸæˆPresetsæ–‡æ¡£]
    CheckBusiness -->|å…¶ä»–| GenGeneric[åˆ›å»ºåŸºç¡€æ¡†æ¶]

    GenRPG --> GenTodo[ç”Ÿæˆå¾…è¡¥å……æ¸…å•]
    GenPresets --> GenTodo
    GenGeneric --> GenTodo

    GenTodo --> FullEnd[å®Œæ•´æµç¨‹å®Œæˆ]

    MinimalEnd --> End[ç”Ÿæˆå®Œæˆ]
    FullEnd --> End

    style Start fill:#90EE90
    style End fill:#90EE90
    style Layer1 fill:#87CEEB
    style Layer2 fill:#FFD700
    style Layer3 fill:#FFA500
    style AdaptiveDocs fill:#FF6B6B
    style DeployHooks fill:#DDA0DD
```

### CLAUDE.mdæ™ºèƒ½åˆå¹¶æµç¨‹

```mermaid
graph TB
    Start[æ£€æµ‹CLAUDE.md] --> Exists{æ–‡ä»¶å­˜åœ¨?}

    Exists -->|å¦| GenMinimal[ç”Ÿæˆæœ€å°åŒ–æ¨¡æ¿]
    GenMinimal --> End[å®Œæˆ]

    Exists -->|æ˜¯| ReadExisting[è¯»å–ç°æœ‰å†…å®¹]
    ReadExisting --> ReadTemplate[è¯»å–æ–°æ¨¡æ¿]

    ReadTemplate --> Extract1[æå–é¡¹ç›®é…ç½®åŒº]
    Extract1 --> Extract2[æå–é¡¹ç›®æ‰©å±•åŒº]
    Extract2 --> Extract3[æå–å·¥ä½œæµå†…å®¹åŒº]

    Extract3 --> CheckUserContent{æœ‰ç”¨æˆ·å†…å®¹?}

    CheckUserContent -->|æ˜¯| KeepUser[ä¿ç•™ç”¨æˆ·ç¼–è¾‘]
    CheckUserContent -->|å¦| UseTemplate[ä½¿ç”¨æ¨¡æ¿é»˜è®¤]

    KeepUser --> Assemble[ç»„è£…æ–°æ–‡æ¡£]
    UseTemplate --> Assemble

    Assemble --> Section1[é¡¹ç›®é…ç½®åŒº<br/>ç”¨æˆ·å†…å®¹]
    Assemble --> Section2[å·¥ä½œæµå†…å®¹åŒº<br/>æ¨¡æ¿å†…å®¹]
    Assemble --> Section3[é¡¹ç›®æ‰©å±•åŒº<br/>ç”¨æˆ·å†…å®¹]
    Assemble --> Section4[æ–‡æ¡£å…ƒæ•°æ®åŒº<br/>è‡ªåŠ¨ç”Ÿæˆ]

    Section1 --> Write[å†™å…¥æ–‡ä»¶]
    Section2 --> Write
    Section3 --> Write
    Section4 --> Write

    Write --> End

    style Start fill:#90EE90
    style End fill:#90EE90
    style KeepUser fill:#FFD700
    style Assemble fill:#87CEEB
```

---

## ğŸ”— ç±»å…³ç³»å›¾

```mermaid
classDiagram
    class DocumentGenerator {
        +AnalysisReport report
        +ProjectMetadata metadata
        +CodeStructure codeStructure
        +String upstreamPath
        +generateAll(targetPath, options) Promise
        -_generateLayer1(targetPath) Promise
        -_generateLayer2(targetPath) Promise
        -_generateAdaptiveDocs(targetPath) Promise
        -_generateLayer3(targetPath) Promise
        -_generateFromTemplate(name, path, relative, replacements)
        -_buildReplacements(targetPath) Object
        -_mergeCLAUDEmd(newTemplate, existingContent) String
        -_extractSection(content, sectionName) String
        -_assembleCLAUDEmd(params) String
        -_detectExistingSystemDoc(name, dir) Object
        -_isSystemDocMatch(name, content) Boolean
        -_assessDocQuality(content) Number
        -_generateSystemDoc(name, info, path) String
        -_deployHooks(targetPath, replacements)
        -_generateMinimalCLAUDE(targetPath, replacements)
    }

    class AnalysisReport {
        +ProjectMetadata metadata
        +CodeStructure codeStructure
        +DocumentationCoverage docCoverage
    }

    class IntelligentDocMaintenance {
        +maintainAllDocs(mappings) Promise
    }

    class DocMappingInference {
        +inferMappings(components) Array
    }

    class SymlinkManager {
        +createAllSymlinks() Promise
    }

    class VersionChecker {
        +computeBaselineHashes() Object
        +writeManifest(data)
    }

    DocumentGenerator --> AnalysisReport
    DocumentGenerator --> IntelligentDocMaintenance
    DocumentGenerator --> DocMappingInference
    DocumentGenerator --> SymlinkManager
    DocumentGenerator --> VersionChecker
```

---

## âš™ï¸ é…ç½®ä¸å¸¸é‡

### ç›®å½•ç»“æ„
```javascript
const dirs = [
  '.claude/commands',      // Claudeå‘½ä»¤æ–‡ä»¶
  'markdown/AIç­–ç•¥æ–‡æ¡£',    // AIç­–ç•¥æ–‡æ¡£
  'markdown/systems',      // Systemsæ–‡æ¡£
  'tasks'                  // ä»»åŠ¡ç›®å½•
];
```

### Hookæ–‡ä»¶åˆ—è¡¨ (v18.1)
```javascript
const coreHooks = [
  'check-critical-rules.py',
  'check-critical-rules.sh',
  'log-changes.py',
  'README.md',
  'user-prompt-submit-hook.py',
  'enforce-step2.py',
  'track-doc-reading.py',
  'enforce-cleanup.py',
  'pre-compact-reminder.py',
  'stop-hook.py',
  'subagent-stop-hook.py'
];
```

### æ—§å‘½ä»¤æ¸…ç†åˆ—è¡¨ (v17.0+)
```javascript
const oldCommands = [
  'cc.md',
  'review-design.md',
  'analyze-performance.md',
  'validate-docs.md',
  'enhance-docs.md',
  'explain-why.md',
  'discover.md',
  'validate-architecture.md',
  'generate-diagram.md'
];
```

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **åˆ†æ­¥ç”Ÿæˆ**: å…ˆç”Ÿæˆ Layer 1ï¼Œæµ‹è¯•æ— è¯¯åå†ç”Ÿæˆ Layer 2/3
2. **ä¿æŠ¤ç”¨æˆ·å†…å®¹**: ä½¿ç”¨ `_detectExistingSystemDoc` é¿å…è¦†ç›–é«˜è´¨é‡æ–‡æ¡£
3. **æ™ºèƒ½å‘½å**: ä½¿ç”¨ `IntelligentDocMaintenance._inferChineseNameByAI` ç”Ÿæˆä¸­æ–‡æ–‡æ¡£å
4. **ç‰ˆæœ¬è¿½è¸ª**: å§‹ç»ˆå†™å…¥ `workflow-manifest.json` è®°å½•ç‰ˆæœ¬ä¿¡æ¯
5. **æœ€å°åŒ–éƒ¨ç½²**: å¯¹äºæ–°é¡¹ç›®ï¼Œä¼˜å…ˆä½¿ç”¨ `minimalMode` é¿å…ç”Ÿæˆè¿‡å¤šå¾…è¡¥å……æ–‡æ¡£

---

## ğŸ“š ä¾èµ–æ¨¡å—

- `fs-extra` - å¢å¼ºæ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `path` - è·¯å¾„å¤„ç†
- `./utils` - å·¥å…·å‡½æ•°
- `./config` - é…ç½®å¸¸é‡
- `./doc-mapping-inference` - æ–‡æ¡£æ˜ å°„æ¨æ–­
- `./intelligent-doc-maintenance` - æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤
- `./symlink-manager` - è½¯è¿æ¥ç®¡ç†
- `./version-checker` - ç‰ˆæœ¬æ£€æµ‹

---

## ğŸ”„ ç‰ˆæœ¬å†å²

- **v18.1** (å½“å‰): Hookæ–‡ä»¶éƒ¨ç½²ï¼Œä»»åŠ¡éš”ç¦»æœºåˆ¶
- **v18.0**: CLAUDE.mdç”¨æˆ·è‡ªä¸»ç»´æŠ¤ï¼Œæœ€å°åŒ–æ¨¡æ¿
- **v17.1**: ç»Ÿä¸€å‘½ä»¤å‘½åï¼ˆ/mcå‰ç¼€ï¼‰ï¼Œæ¸…ç†æ—§å‘½ä»¤
- **v16.1**: CLAUDE.mdæ™ºèƒ½åˆå¹¶ï¼Œå››æ®µå¼ç»“æ„
- **v16.0**: åŒå±‚æ–‡æ¡£æ¶æ„ï¼Œä¸Šæ¸¸æ–‡æ¡£è½¯è¿æ¥
- **v2.0**: é›†æˆè‡ªé€‚åº”æ–‡æ¡£ç»´æŠ¤æœºåˆ¶
- **v1.0**: åŸºç¡€æ–‡æ¡£ç”ŸæˆåŠŸèƒ½

---

**æ–‡æ¡£å…ƒæ•°æ®**:
- ä½œè€…: MODSDKå·¥ä½œæµå›¢é˜Ÿ
- æœ€åæ›´æ–°: 2025-11-13
- ç›¸å…³æ–‡æ¡£: [é¡¹ç›®åˆ†æå™¨.md](./é¡¹ç›®åˆ†æå™¨.md), [æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤.md](./æ™ºèƒ½æ–‡æ¡£ç»´æŠ¤.md), [ç‰ˆæœ¬ç®¡ç†.md](./ç‰ˆæœ¬ç®¡ç†.md)
