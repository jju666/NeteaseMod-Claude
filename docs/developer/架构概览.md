# æ¶æ„æ¦‚è§ˆ

> **NeteaseMod-Claude ç³»ç»Ÿè®¾è®¡ä¸æ ¸å¿ƒæœºåˆ¶**
>
> v25.0 - Claude LLMè¯­ä¹‰åˆ†æ + v21.0å•ä¸€æ•°æ®æº + v3.0 FinalçŠ¶æ€æœº

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“è®¾è®¡

NeteaseMod-Claude æ˜¯ä¸€ä¸ª**AIé©±åŠ¨çš„å·¥ä½œæµå¼ºåˆ¶æ‰§è¡Œç³»ç»Ÿ**ï¼Œé€šè¿‡8ä¸ªHookååŒå·¥ä½œï¼Œå°†è‡ªç”±å¯¹è¯è½¬åŒ–ä¸ºç»“æ„åŒ–çš„4æ­¥å¼€å‘æµç¨‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Code (AI Agent)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚      Hook System (8ä¸ª)        â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Lifecycle Hooks (3ä¸ª)  â”‚  â”‚  SessionStart, Stop, SubagentStop
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚ Orchestrator Hooks (3ä¸ª) â”‚  â”‚  UserPromptHandler, PreToolUse, PostToolUse
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Archiver Hooks (1ä¸ª)   â”‚  â”‚  PostArchive
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚  â”‚  Compactor Hooks (1ä¸ª)  â”‚  â”‚  PreCompact
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Task Meta Manager       â”‚
         â”‚  (å•ä¸€æ•°æ®æºç®¡ç†å™¨)        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   task-meta.json         â”‚
         â”‚   (å”¯ä¸€æƒå¨æ•°æ®æº)         â”‚
         â”‚   + portalockeræ–‡ä»¶é”     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å•ä¸€æ•°æ®æº** (v21.0)
   - task-meta.jsonä½œä¸ºå”¯ä¸€çœŸå®æ¥æºï¼ˆSingle Source of Truthï¼‰
   - åºŸå¼ƒv20.xçš„workflow-state.jsonï¼ˆä¸‰æ–‡ä»¶åŒæ­¥é—®é¢˜ï¼‰
   - æ‰€æœ‰Hooké€šè¿‡TaskMetaManagerç»Ÿä¸€è¯»å†™

2. **å¼ºåˆ¶å·¥ä½œæµ** (v3.0 Final)
   - 4æ­¥çŠ¶æ€æœºï¼šActivation â†’ Planning â†’ Implementation â†’ Finalization
   - ç¡¬ç¼–ç è½¬ç§»è§„åˆ™ï¼ˆPreToolUseä¸­éªŒè¯ï¼‰
   - ç”¨æˆ·å¿…é¡»æ˜ç¡®ç¡®è®¤æ‰èƒ½æ¨è¿›å…³é”®é˜¶æ®µ

3. **LLMè¯­ä¹‰åˆ†æ** (v25.0)
   - ä»å…³é”®è¯åŒ¹é…å‡çº§åˆ°Claude Sonnet 4.5è¯­ä¹‰ç†è§£
   - å‡†ç¡®ç‡æå‡ï¼š85% â†’ 96.15%
   - è‡ªåŠ¨ç†è§£è½¬æŠ˜è¯­ä¹‰å’Œæ–°è¡¨è¾¾

4. **å¹¶å‘å®‰å…¨**
   - portalockerè·¨å¹³å°æ–‡ä»¶é”
   - atomic_update()åŸå­æ“ä½œï¼ˆè¯»-æ”¹-å†™åœ¨åŒä¸€é”å†…ï¼‰
   - é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š3æ¬¡ï¼Œ100mså»¶è¿Ÿï¼‰

---

## ğŸ“Š æ•°æ®æµè®¾è®¡

### å•ä¸€æ•°æ®æºæ¶æ„ (v21.0)

#### task-meta.json æ•°æ®ç»“æ„

```json
{
  "task_id": "ä»»åŠ¡-1120-ä¿®å¤ç©å®¶æ­»äº¡è£…å¤‡ä¸¢å¤±",
  "architecture_version": "21.0",
  "state_machine_version": "3.0",

  "current_stage": "implementation",
  "allowed_transitions": ["finalization", "planning"],

  "task_type": "bug_fix",
  "user_request": "/mc ä¿®å¤ç©å®¶æ­»äº¡åè£…å¤‡ä¸¢å¤±çš„BUG",

  "planning_summary": "ä¿®æ”¹æ­»äº¡/å¤æ´»äº‹ä»¶ç›‘å¬å™¨ï¼Œä¿å­˜/æ¢å¤è£…å¤‡æ•°æ®",

  "steps": [
    {
      "step_number": 1,
      "stage": "planning",
      "tool": "Grep",
      "description": "æœç´¢æ­»äº¡äº‹ä»¶å¤„ç†ä»£ç ",
      "timestamp": "2025-11-20T02:15:30Z"
    },
    {
      "step_number": 2,
      "stage": "implementation",
      "tool": "Edit",
      "parameters": {
        "file_path": "Script_NeteaseMod/systems/PlayerEventSystem.py",
        "old_string": "def OnPlayerDie(self, args):",
        "new_string": "def OnPlayerDie(self, args):\n    # ä¿å­˜è£…å¤‡æ•°æ®"
      },
      "timestamp": "2025-11-20T02:18:45Z"
    }
  ],

  "metadata": {
    "created_at": "2025-11-20T02:10:00Z",
    "last_updated": "2025-11-20T02:18:45Z",
    "total_steps": 2,
    "current_step": 2
  }
}
```

#### æ•°æ®æµè½¬è¿‡ç¨‹

```
ç”¨æˆ·è¾“å…¥ "/mc ä¿®å¤BUG"
        â†“
UserPromptHandler Hook
        â†“
åˆ›å»º task-meta.json (activationçŠ¶æ€)
        â†“
è‡ªåŠ¨æ¨è¿›åˆ° planning çŠ¶æ€
        â†“
AIè°ƒç”¨å·¥å…·ï¼ˆGrep, Readç­‰ï¼‰åˆ†æé—®é¢˜
        â†“
PostToolUse Hook è®°å½•æ¯æ¬¡å·¥å…·è°ƒç”¨åˆ°stepsæ•°ç»„
        â†“
AIè°ƒç”¨ TodoWrite åˆ¶å®šæ–¹æ¡ˆ
        â†“
Stop Hook æ£€æµ‹æ–¹æ¡ˆå®Œæˆï¼Œæç¤ºç”¨æˆ·ç¡®è®¤
        â†“
ç”¨æˆ·è¾“å…¥ "æ˜¯"
        â†“
UserPromptHandler Hook + LLMè¯­ä¹‰åˆ†æ
        â†“
çŠ¶æ€è½¬ç§»: planning â†’ implementation
        â†“
AIè°ƒç”¨ Edit/Write å®æ–½ä¿®æ”¹
        â†“
PostToolUse Hook æŒç»­è®°å½•steps
        â†“
ç”¨æˆ·è¾“å…¥ "å®Œæˆ"
        â†“
UserPromptHandler Hook + LLMè¯­ä¹‰åˆ†æ
        â†“
çŠ¶æ€è½¬ç§»: implementation â†’ finalization
        â†“
Stop Hook ç”Ÿæˆ solution.md
        â†“
PostArchive Hook å½’æ¡£ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰
```

### TaskMetaManager æ ¸å¿ƒæ¥å£

```python
class TaskMetaManager:
    """ä»»åŠ¡å…ƒæ•°æ®ç®¡ç†å™¨ - v21.0å•ä¸€æ•°æ®æºæ¶æ„"""

    def __init__(self, task_dir: str):
        """åˆå§‹åŒ–ç®¡ç†å™¨

        Args:
            task_dir: ä»»åŠ¡ç›®å½•è·¯å¾„ï¼ˆå¦‚ tasks/ä»»åŠ¡-1120-xxx/ï¼‰
        """
        self.task_dir = task_dir
        self.meta_file = os.path.join(task_dir, ".task-meta.json")
        self.lock_file = os.path.join(task_dir, ".task-meta.lock")

    def atomic_update(self, update_func: Callable[[dict], dict]) -> dict:
        """åŸå­æ›´æ–°æ“ä½œï¼ˆè¯»-æ”¹-å†™åœ¨åŒä¸€é”å†…ï¼‰

        Args:
            update_func: æ›´æ–°å‡½æ•°ï¼Œæ¥æ”¶å½“å‰metaï¼Œè¿”å›æ–°meta

        Returns:
            æ›´æ–°åçš„metaå­—å…¸

        Example:
            def set_planning_stage(meta):
                meta['current_stage'] = 'planning'
                meta['allowed_transitions'] = ['implementation', 'activation']
                return meta

            manager.atomic_update(set_planning_stage)
        """
        with portalocker.Lock(self.lock_file, timeout=5):
            meta = self._read_meta()
            updated_meta = update_func(meta)
            self._write_meta(updated_meta)
            return updated_meta

    def read_meta(self) -> dict:
        """è¯»å–ä»»åŠ¡å…ƒæ•°æ®ï¼ˆåŠ é”ï¼‰"""
        with portalocker.Lock(self.lock_file, timeout=5):
            return self._read_meta()

    def update_stage(self, new_stage: str):
        """æ›´æ–°å½“å‰çŠ¶æ€ï¼ˆå¸¦çŠ¶æ€æœºéªŒè¯ï¼‰"""
        def _update(meta):
            # éªŒè¯è½¬ç§»åˆæ³•æ€§
            if new_stage not in meta.get('allowed_transitions', []):
                raise ValueError(f"éæ³•çŠ¶æ€è½¬ç§»: {meta['current_stage']} â†’ {new_stage}")

            meta['current_stage'] = new_stage
            meta['allowed_transitions'] = self._get_allowed_transitions(new_stage)
            meta['metadata']['last_updated'] = datetime.now().isoformat()
            return meta

        return self.atomic_update(_update)

    def add_step(self, tool: str, description: str, parameters: dict = None):
        """æ·»åŠ æ­¥éª¤è®°å½•"""
        def _add(meta):
            step_number = len(meta['steps']) + 1
            step = {
                "step_number": step_number,
                "stage": meta['current_stage'],
                "tool": tool,
                "description": description,
                "timestamp": datetime.now().isoformat()
            }
            if parameters:
                step['parameters'] = parameters

            meta['steps'].append(step)
            meta['metadata']['total_steps'] = step_number
            meta['metadata']['current_step'] = step_number
            meta['metadata']['last_updated'] = datetime.now().isoformat()
            return meta

        return self.atomic_update(_add)
```

---

## ğŸ”„ 4æ­¥çŠ¶æ€æœº (v3.0 Final)

### çŠ¶æ€è½¬ç§»å›¾

```
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Activation  â”‚
                   â”‚  (ä»»åŠ¡æ¿€æ´»)   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ è‡ªåŠ¨æ¨è¿›
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â”‚   Planning   â”‚
              â”‚   â”‚  (æ–¹æ¡ˆåˆ¶å®š)   â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚          â”‚ ç”¨æˆ·ç¡®è®¤"æ˜¯"
              â”‚          â–¼
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   â”‚Implementationâ”‚â”€â”€â”€â” ç”¨æˆ·"é‡æ–°è®¾è®¡"
              â”‚   â”‚  (ä»£ç å®æ–½)   â”‚   â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â”‚          â”‚ ç”¨æˆ·ç¡®è®¤"å®Œæˆ"
              â”‚          â–¼           â”‚
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â””â”€â”€â–¶â”‚Finalization  â”‚â—€â”€â”˜
                  â”‚  (æ”¶å°¾å½’æ¡£)   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¡¬ç¼–ç è½¬ç§»è¡¨

```python
# templates/.claude/hooks/core/state_transition_validator.py
VALID_TRANSITIONS = {
    "activation": ["planning"],                      # ä»…èƒ½å‰è¿›åˆ°planning
    "planning": ["implementation", "activation"],    # å¯å‰è¿›æˆ–å›é€€åˆ°activation
    "implementation": ["finalization", "planning"],  # å¯å‰è¿›æˆ–å›é€€é‡æ–°è®¾è®¡
    "finalization": []                               # ç»ˆæ€ï¼Œæ— åç»­è½¬ç§»
}

def validate_transition(current: str, target: str) -> bool:
    """éªŒè¯çŠ¶æ€è½¬ç§»æ˜¯å¦åˆæ³•

    Returns:
        True: åˆæ³•è½¬ç§»
        False: éæ³•è½¬ç§»ï¼ŒPreToolUse Hookå°†æ‹¦æˆª
    """
    return target in VALID_TRANSITIONS.get(current, [])
```

### å„é˜¶æ®µè§„åˆ™é…ç½®

#### 1. Activation è§„åˆ™ (activation.yaml)

```yaml
stage: activation
allowed_tools:
  - Bash      # æ£€æŸ¥é¡¹ç›®çŠ¶æ€
  - Glob      # æ‰«ææ–‡ä»¶
  - Grep      # æœç´¢ä»£ç 
  - Read      # è¯»å–æ–‡ä»¶ï¼ˆäº†è§£é¡¹ç›®ç»“æ„ï¼‰

forbidden_tools:
  - Edit      # ç¦æ­¢ä¿®æ”¹ä»£ç 
  - Write     # ç¦æ­¢åˆ›å»ºæ–‡ä»¶
  - TodoWrite # ç¦æ­¢åˆ¶å®šæ–¹æ¡ˆï¼ˆç•™ç»™Planningé˜¶æ®µï¼‰

forbidden_paths:
  - "behavior_packs/**/*.py"   # ç¦æ­¢è®¿é—®MODæ ¸å¿ƒä»£ç 
  - "resource_packs/**/*.json" # ç¦æ­¢è®¿é—®èµ„æºæ–‡ä»¶

auto_transition:
  target: planning
  condition: "ä»»åŠ¡æ¿€æ´»åè‡ªåŠ¨æ¨è¿›"
```

#### 2. Planning è§„åˆ™ (planning.yaml)

```yaml
stage: planning
allowed_tools:
  - Bash
  - Glob
  - Grep
  - Read
  - TodoWrite  # å¼ºåˆ¶ä½¿ç”¨TodoWriteåˆ¶å®šæ–¹æ¡ˆ

forbidden_tools:
  - Edit       # ç¦æ­¢ä¿®æ”¹ä»£ç 
  - Write      # ç¦æ­¢åˆ›å»ºæ–‡ä»¶

required_tools:
  - TodoWrite  # Stop Hookæ£€æµ‹åˆ°TodoWriteè°ƒç”¨æ‰å…è®¸æ¨è¿›

transition_trigger:
  user_confirmation:
    - "æ˜¯"
    - "åŒæ„"
    - "å¼€å§‹å®æ–½"
    - "æ‰§è¡Œæ–¹æ¡ˆ"
  llm_semantic_analysis: true  # ä½¿ç”¨Claude LLMåˆ†æç”¨æˆ·æ„å›¾
```

#### 3. Implementation è§„åˆ™ (implementation.yaml)

```yaml
stage: implementation
allowed_tools:
  - Bash
  - Glob
  - Grep
  - Read
  - Edit       # å…è®¸ä¿®æ”¹ä»£ç 
  - Write      # å…è®¸åˆ›å»ºæ–‡ä»¶
  - TodoWrite  # å…è®¸æ›´æ–°ä»»åŠ¡åˆ—è¡¨

forbidden_paths:
  - ".claude/hooks/**"     # ç¦æ­¢ä¿®æ”¹Hookç³»ç»Ÿ
  - "node_modules/**"      # ç¦æ­¢ä¿®æ”¹ä¾èµ–
  - "lib/**"               # ç¦æ­¢ä¿®æ”¹éƒ¨ç½²å·¥å…·

semantic_validation:
  enabled: true
  check_keywords:
    - "å®Œæˆ"
    - "æµ‹è¯•é€šè¿‡"
    - "ä¿®å¤æˆåŠŸ"
  partial_keywords:
    - "åŸºæœ¬å®Œæˆ"
    - "è¿˜æœ‰BUG"
    - "éƒ¨åˆ†æ­£ç¡®"
```

#### 4. Finalization è§„åˆ™ (finalization.yaml)

```yaml
stage: finalization
allowed_tools:
  - Read       # è¯»å–æ–‡ä»¶ç”Ÿæˆæ€»ç»“
  - Write      # å†™å…¥solution.md
  - Bash       # å½’æ¡£æ“ä½œ

required_files:
  - "solution.md"  # Stop Hookå¼ºåˆ¶ç”Ÿæˆæ€»ç»“æ–‡æ¡£

archive_behavior:
  move_to: "tasks/archive/"
  preserve_structure: true
  cleanup_temp_files: true
```

---

## ğŸ¤– Claude LLMè¯­ä¹‰åˆ†æ (v25.0)

### æ¶æ„è®¾è®¡

```
ç”¨æˆ·è¾“å…¥ "åŸºæœ¬æ­£ç¡®,ä½†è¿˜æœ‰ä¸ªå°BUG"
        â†“
UserPromptHandler Hook
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ClaudeSemanticAnalyzer.analyze() â”‚
â”‚  - API: Claude Sonnet 4.5         â”‚
â”‚  - Prompt: è¯­ä¹‰åˆ†ç±»ä»»åŠ¡            â”‚
â”‚  - è¶…æ—¶: 300ç§’                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LLMè¿”å›ç»“æ„åŒ–å“åº”                 â”‚
â”‚  {                                â”‚
â”‚    "category": "partial_success", â”‚
â”‚    "confidence": 0.95,            â”‚
â”‚    "explanation": "è¯†åˆ«åˆ°è½¬æŠ˜è¯ä½†" â”‚
â”‚  }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
StateTransitionValidator.get_target_stage()
               â†“
ç¡®å®šç›®æ ‡çŠ¶æ€: implementation â†’ planning
               â–¼
TaskMetaManager.update_stage("planning")
```

### ClaudeSemanticAnalyzer æ ¸å¿ƒå®ç°

```python
class ClaudeSemanticAnalyzer:
    """Claude LLMè¯­ä¹‰åˆ†æå™¨ - v25.0æ ¸å¿ƒç»„ä»¶"""

    def __init__(self, api_key: str):
        self.client = anthropic.Anthropic(api_key=api_key)
        self.model = "claude-sonnet-4-5-20250929"  # 2025-11-20æ›´æ–°
        self.timeout = 300  # ç§’

    def analyze(self, user_input: str, current_stage: str) -> dict:
        """åˆ†æç”¨æˆ·è¾“å…¥çš„è¯­ä¹‰æ„å›¾

        Args:
            user_input: ç”¨æˆ·è¾“å…¥æ–‡æœ¬
            current_stage: å½“å‰ä»»åŠ¡çŠ¶æ€

        Returns:
            {
                "category": "complete_success" | "partial_success" | "need_redesign" | "other",
                "confidence": 0.0-1.0,
                "explanation": "åˆ†æåŸå› "
            }
        """
        prompt = f"""è¯·åˆ†æç”¨æˆ·è¾“å…¥ï¼Œåˆ¤æ–­å…¶æ„å›¾ç±»åˆ«ï¼š

ç”¨æˆ·è¾“å…¥: {user_input}
å½“å‰çŠ¶æ€: {current_stage}

åˆ†ç±»æ ‡å‡†ï¼š
1. complete_success: ä»»åŠ¡å®Œå…¨æˆåŠŸï¼ˆå¦‚"å®Œæˆ"ã€"æµ‹è¯•é€šè¿‡"ã€"éƒ½æ­£ç¡®äº†"ï¼‰
2. partial_success: éƒ¨åˆ†æˆåŠŸä½†æœ‰é—®é¢˜ï¼ˆå¦‚"åŸºæœ¬æ­£ç¡®,ä½†è¿˜æœ‰BUG"ï¼‰
3. need_redesign: éœ€è¦é‡æ–°è®¾è®¡ï¼ˆå¦‚"ä¸å¯¹"ã€"é‡æ–°è®¾è®¡"ï¼‰
4. confirmation: ç¡®è®¤æ‰§è¡Œæ–¹æ¡ˆï¼ˆå¦‚"æ˜¯"ã€"åŒæ„"ã€"å¼€å§‹"ï¼‰
5. other: å…¶ä»–ï¼ˆæ™®é€šå¯¹è¯ï¼‰

è¯·è¿”å›JSONæ ¼å¼ï¼š
{{
  "category": "ç±»åˆ«åç§°",
  "confidence": 0.95,
  "explanation": "åˆ¤æ–­ä¾æ®"
}}"""

        try:
            response = self.client.messages.create(
                model=self.model,
                max_tokens=200,
                timeout=self.timeout,
                messages=[{"role": "user", "content": prompt}]
            )

            result = json.loads(response.content[0].text)
            return result

        except anthropic.APITimeoutError:
            # è¶…æ—¶é™çº§ï¼šä½¿ç”¨å…³é”®è¯åŒ¹é…
            return self._fallback_keyword_matching(user_input, current_stage)

        except Exception as e:
            # å¼‚å¸¸éš”ç¦»ï¼šä¸å½±å“å·¥ä½œæµ
            print(f"âš ï¸ LLMåˆ†æå¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ: {e}")
            return self._fallback_keyword_matching(user_input, current_stage)

    def _fallback_keyword_matching(self, user_input: str, current_stage: str) -> dict:
        """é™çº§æ–¹æ¡ˆï¼šä¼ ç»Ÿå…³é”®è¯åŒ¹é…ï¼ˆ85%å‡†ç¡®ç‡ï¼‰"""
        text = user_input.lower()

        if current_stage == "planning":
            if any(kw in text for kw in ["æ˜¯", "åŒæ„", "å¼€å§‹", "æ‰§è¡Œ"]):
                return {"category": "confirmation", "confidence": 0.8}

        elif current_stage == "implementation":
            if any(kw in text for kw in ["å®Œæˆ", "æˆåŠŸ", "æµ‹è¯•é€šè¿‡"]):
                if any(kw in text for kw in ["ä½†", "è¿˜æœ‰", "except", "é™¤äº†"]):
                    return {"category": "partial_success", "confidence": 0.7}
                return {"category": "complete_success", "confidence": 0.8}

            if any(kw in text for kw in ["é‡æ–°", "ä¸å¯¹", "é”™äº†"]):
                return {"category": "need_redesign", "confidence": 0.8}

        return {"category": "other", "confidence": 0.5}
```

### æ€§èƒ½æŒ‡æ ‡ (v25.0ç”Ÿäº§æ•°æ®)

| æŒ‡æ ‡ | v24.2 (å…³é”®è¯) | v25.0 (LLM) | æå‡ |
|------|---------------|-------------|------|
| complete_successå‡†ç¡®ç‡ | 64.3% | **100%** | +35.7% |
| partial_successå‡†ç¡®ç‡ | 64.3% | **100%** | +35.7% |
| æ€»ä½“å¹³å‡å‡†ç¡®ç‡ | 85% | **96.15%** | +11.15% |
| P50å»¶è¿Ÿ | <1ms | 3-5ç§’ | - |
| P95å»¶è¿Ÿ | <1ms | 8-12ç§’ | - |
| è¶…æ—¶ç‡ | 0% | <5% | - |
| æœˆåº¦æˆæœ¬ (10ä»»åŠ¡) | $0 | $0.045 | - |

**å…³é”®æ”¹è¿›**ï¼š
- âœ… å®Œç¾è¯†åˆ«è½¬æŠ˜è¯­ä¹‰ï¼ˆ"åŸºæœ¬æ­£ç¡®,ä½†è¿˜æœ‰BUG" â†’ partial_successï¼‰
- âœ… è‡ªåŠ¨ç†è§£æ–°è¡¨è¾¾ï¼ˆ"éƒ½æ­£ç¡®äº†" â†’ complete_successï¼‰
- âœ… é›¶ç»´æŠ¤æˆæœ¬ï¼ˆæ— éœ€æ‰‹åŠ¨æ·»åŠ å…³é”®è¯ï¼‰
- âœ… å‹å¥½é™çº§ï¼ˆè¶…æ—¶åè‡ªåŠ¨åˆ‡æ¢åˆ°å…³é”®è¯åŒ¹é…ï¼‰

---

## ğŸ¯ 8ä¸ªHookååŒå·¥ä½œæµ

### å®Œæ•´æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·å¯åŠ¨Claude Code                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 1: SessionStart                                            â”‚
â”‚  - æ‰«ætasks/ç›®å½•                                                â”‚
â”‚  - æ£€æµ‹æœªå®Œæˆä»»åŠ¡ï¼ˆcurrent_stage != finalizationï¼‰                â”‚
â”‚  - è¯»å–task-meta.json                                            â”‚
â”‚  - æ³¨å…¥context.mdåˆ°å¯¹è¯ä¸Šä¸‹æ–‡                                     â”‚
â”‚  - æ˜¾ç¤ºä»»åŠ¡ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥: /mc ä¿®å¤BUG                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 2: UserPromptHandler                                       â”‚
â”‚  - æ£€æµ‹/mcå‘½ä»¤                                                   â”‚
â”‚  - åˆ›å»ºä»»åŠ¡ç›®å½• tasks/ä»»åŠ¡-1120-ä¿®å¤BUG/                          â”‚
â”‚  - åˆå§‹åŒ–task-meta.json (activationçŠ¶æ€)                         â”‚
â”‚  - è‡ªåŠ¨æ¨è¿›åˆ°planningçŠ¶æ€                                         â”‚
â”‚  - æ³¨å…¥æç¤ºè¯ï¼š"è¯·å…ˆåˆ†æé—®é¢˜..."                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIå‡†å¤‡è°ƒç”¨å·¥å…·: Grep "é”™è¯¯å…³é”®è¯"                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 3: PreToolUse                                              â”‚
â”‚  - è¯»å–task-meta.json (current_stage = planning)                â”‚
â”‚  - 4å±‚éªŒè¯:                                                      â”‚
â”‚    1. StageéªŒè¯: planningé˜¶æ®µå…è®¸Grep âœ…                         â”‚
â”‚    2. TooléªŒè¯: Grepåœ¨allowed_toolsåˆ—è¡¨ âœ…                       â”‚
â”‚    3. PathéªŒè¯: æœç´¢è·¯å¾„ä¸åœ¨forbidden_paths âœ…                   â”‚
â”‚    4. SemanticéªŒè¯: LLMåˆ†æå·¥å…·è°ƒç”¨æ„å›¾ âœ…                       â”‚
â”‚  - éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œå·¥å…·è°ƒç”¨                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å·¥å…·æ‰§è¡Œ: Grepå®Œæˆ                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 4: PostToolUse                                             â”‚
â”‚  - è®°å½•æ­¥éª¤åˆ°task-meta.json:                                     â”‚
â”‚    {                                                             â”‚
â”‚      "step_number": 1,                                           â”‚
â”‚      "stage": "planning",                                        â”‚
â”‚      "tool": "Grep",                                             â”‚
â”‚      "description": "æœç´¢é”™è¯¯å…³é”®è¯",                             â”‚
â”‚      "timestamp": "2025-11-20T02:15:30Z"                         â”‚
â”‚    }                                                             â”‚
â”‚  - æ›´æ–°metadata.total_steps                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        [AIç»§ç»­è°ƒç”¨Read/TodoWriteç­‰å·¥å…·...]
        [æ¯æ¬¡éƒ½ç»è¿‡PreToolUseéªŒè¯ + PostToolUseè®°å½•]
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIè°ƒç”¨TodoWriteåˆ¶å®šæ–¹æ¡ˆ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIå‡†å¤‡ç»“æŸå½“å‰è½®æ¬¡                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 5: Stop                                                    â”‚
â”‚  - æ£€æµ‹å½“å‰çŠ¶æ€: planning                                         â”‚
â”‚  - æ£€æµ‹TodoWriteå·²è°ƒç”¨ï¼ˆä»stepsæ•°ç»„ï¼‰                             â”‚
â”‚  - è¯»å–planning_summary                                          â”‚
â”‚  - æ³¨å…¥æç¤ºè¯: "æ–¹æ¡ˆå·²åˆ¶å®šï¼Œè¯·ç”¨æˆ·ç¡®è®¤..."                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥: æ˜¯                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 2: UserPromptHandler (å†æ¬¡è§¦å‘)                            â”‚
â”‚  - è°ƒç”¨ClaudeSemanticAnalyzer.analyze("æ˜¯", "planning")          â”‚
â”‚  - LLMè¿”å›: {"category": "confirmation", "confidence": 0.95}    â”‚
â”‚  - è°ƒç”¨StateTransitionValidator.get_target_stage()               â”‚
â”‚  - ç¡®å®šè½¬ç§»: planning â†’ implementation                           â”‚
â”‚  - è°ƒç”¨TaskMetaManager.update_stage("implementation")            â”‚
â”‚  - æ³¨å…¥æç¤ºè¯: "å¼€å§‹å®æ–½ä¿®å¤..."                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        [AIè°ƒç”¨Editå·¥å…·ä¿®æ”¹ä»£ç ...]
        [PreToolUseéªŒè¯implementationé˜¶æ®µå…è®¸Edit âœ…]
        [PostToolUseè®°å½•æ¯æ¬¡ä¿®æ”¹]
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥: æµ‹è¯•é€šè¿‡ï¼Œå®Œæˆ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 2: UserPromptHandler (å†æ¬¡è§¦å‘)                            â”‚
â”‚  - è°ƒç”¨ClaudeSemanticAnalyzer.analyze("æµ‹è¯•é€šè¿‡ï¼Œå®Œæˆ", "impl") â”‚
â”‚  - LLMè¿”å›: {"category": "complete_success", "confidence": 0.98}â”‚
â”‚  - çŠ¶æ€è½¬ç§»: implementation â†’ finalization                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 5: Stop (finalizationé˜¶æ®µ)                                â”‚
â”‚  - ç”Ÿæˆsolution.mdæ€»ç»“æ–‡æ¡£                                        â”‚
â”‚  - æ›´æ–°task-meta.json (current_stage = finalization)            â”‚
â”‚  - å‘é€æ¡Œé¢é€šçŸ¥: "ä»»åŠ¡å·²å®Œæˆï¼"                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 8: PostArchive (å¯é€‰)                                      â”‚
â”‚  - ç§»åŠ¨ä»»åŠ¡åˆ°tasks/archive/                                       â”‚
â”‚  - æ¸…ç†ä¸´æ—¶æ–‡ä»¶                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‰¹æ®Šåœºæ™¯ï¼šSubagenté›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AIå¯åŠ¨å­ä»£ç†: Task(subagent_type="Explore", ...)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 3: PreToolUse                                              â”‚
â”‚  - æ£€æµ‹Taskå·¥å…·è°ƒç”¨                                              â”‚
â”‚  - éªŒè¯å…è®¸åœ¨å½“å‰çŠ¶æ€è°ƒç”¨ âœ…                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        [å­ä»£ç†æ‰§è¡Œ...]
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 6: SubagentStop                                            â”‚
â”‚  - ä»stdinè¯»å–å­ä»£ç†transcript                                    â”‚
â”‚  - è§£æ<agent_output>æ ‡ç­¾                                         â”‚
â”‚  - æå–ç»“æ„åŒ–æ•°æ®ï¼ˆæ–‡ä»¶åˆ—è¡¨/åˆ†æç»“æœï¼‰                              â”‚
â”‚  - æ³¨å…¥åˆ°çˆ¶ä»£ç†ä¸Šä¸‹æ–‡                                             â”‚
â”‚  - è®°å½•åˆ°task-meta.jsonçš„stepsæ•°ç»„                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 4: PostToolUse                                             â”‚
â”‚  - è®°å½•Taskå·¥å…·è°ƒç”¨                                              â”‚
â”‚  - ä¿å­˜å­ä»£ç†ç»“æœæ‘˜è¦                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼šè¯å‹ç¼©åœºæ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è¯å†å²è¶…è¿‡ä¸Šä¸‹æ–‡é™åˆ¶ï¼ŒClaude Codeå‡†å¤‡å‹ç¼©                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Hook 7: PreCompact                                              â”‚
â”‚  - è¯»å–task-meta.json                                            â”‚
â”‚  - ç”Ÿæˆå‹ç¼©å®‰å…¨çš„ä¸Šä¸‹æ–‡æ‘˜è¦:                                       â”‚
â”‚    - å½“å‰çŠ¶æ€: implementation                                     â”‚
â”‚    - ä»»åŠ¡æè¿°: ä¿®å¤ç©å®¶æ­»äº¡è£…å¤‡ä¸¢å¤±                                â”‚
â”‚    - å·²å®Œæˆæ­¥éª¤: 12ä¸ª (GrepÃ—4, EditÃ—6, WriteÃ—2)                  â”‚
â”‚    - Planningæ€»ç»“: ...                                           â”‚
â”‚  - ä¿å­˜åˆ°context.md                                              â”‚
â”‚  - æ”¾è¡Œå‹ç¼©æ“ä½œ                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        [Claude Codeå‹ç¼©å¯¹è¯]
                       â–¼
        [ä¸‹æ¬¡SessionStartæ—¶ä»context.mdæ¢å¤ä¸Šä¸‹æ–‡]
```

---

## ğŸ›¡ï¸ å¹¶å‘å®‰å…¨æœºåˆ¶

### Portalockeræ–‡ä»¶é”

```python
import portalocker
import time

class TaskMetaManager:
    def atomic_update(self, update_func):
        """åŸå­æ›´æ–°æ“ä½œ"""
        retry_count = 0
        max_retries = 3

        while retry_count < max_retries:
            try:
                # è·å–ç‹¬å é”ï¼ˆè·¨è¿›ç¨‹ï¼‰
                with portalocker.Lock(
                    self.lock_file,
                    mode='w',
                    timeout=5,  # 5ç§’è¶…æ—¶
                    flags=portalocker.LOCK_EX  # ç‹¬å é”
                ):
                    # åŸå­æ“ä½œï¼šè¯»-æ”¹-å†™åœ¨åŒä¸€é”å†…
                    meta = self._read_meta()
                    updated_meta = update_func(meta)
                    self._write_meta(updated_meta)
                    return updated_meta

            except portalocker.LockException:
                retry_count += 1
                if retry_count >= max_retries:
                    raise
                time.sleep(0.1)  # 100mså»¶è¿Ÿåé‡è¯•
```

### é”æ–‡ä»¶å‘½åè§„èŒƒ

```
tasks/ä»»åŠ¡-1120-xxx/
  â”œâ”€â”€ .task-meta.json       # æ•°æ®æ–‡ä»¶
  â”œâ”€â”€ .task-meta.lock       # é”æ–‡ä»¶
  â”œâ”€â”€ context.md
  â””â”€â”€ solution.md
```

### å¼‚å¸¸éš”ç¦»æœºåˆ¶

```python
# æ‰€æœ‰Hookéƒ½åŒ…å«å¼‚å¸¸å¤„ç†
try:
    # Hookæ ¸å¿ƒé€»è¾‘
    manager = TaskMetaManager(task_dir)
    manager.update_stage("planning")

except Exception as e:
    # å¼‚å¸¸éš”ç¦»ï¼šä¸å½±å“Claude Codeä¸»æµç¨‹
    print(f"âš ï¸ Hookæ‰§è¡Œå¤±è´¥ï¼ˆä»»åŠ¡ç»§ç»­ï¼‰: {e}", file=sys.stderr)
    # ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…é˜»å¡AI
```

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… Hookå¤±è´¥ä¸åº”å¯¼è‡´Claude Codeå´©æºƒ
- âœ… æ‰“å°è­¦å‘Šä¿¡æ¯ä½†ç»§ç»­æ‰§è¡Œ
- âœ… å…³é”®æ“ä½œï¼ˆçŠ¶æ€è½¬ç§»ï¼‰ä½¿ç”¨é‡è¯•æœºåˆ¶
- âœ… è¶…æ—¶åå‹å¥½é™çº§ï¼ˆå¦‚LLM â†’ å…³é”®è¯åŒ¹é…ï¼‰

---

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
NeteaseMod-Claude/
â”œâ”€â”€ templates/.claude/                    # Hookç³»ç»Ÿæ¨¡æ¿ï¼ˆéƒ¨ç½²æºï¼‰
â”‚   â”œâ”€â”€ hooks/                           # 28ä¸ªHookè„šæœ¬
â”‚   â”‚   â”œâ”€â”€ core/                        # æ ¸å¿ƒæ¨¡å— (12ä¸ª)
â”‚   â”‚   â”‚   â”œâ”€â”€ task_meta_manager.py              # ä»»åŠ¡å…ƒæ•°æ®ç®¡ç†å™¨ (v21.0)
â”‚   â”‚   â”‚   â”œâ”€â”€ claude_semantic_analyzer.py       # Claude LLMåˆ†æå™¨ (v25.0)
â”‚   â”‚   â”‚   â”œâ”€â”€ state_transition_validator.py     # çŠ¶æ€è½¬ç§»éªŒè¯å™¨ (v3.0)
â”‚   â”‚   â”‚   â”œâ”€â”€ tool_matrix.py                    # å·¥å…·çŸ©é˜µé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ context_injector.py               # ä¸Šä¸‹æ–‡æ³¨å…¥å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ subagent_parser.py                # å­ä»£ç†ç»“æœè§£æå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ notification_sender.py            # æ¡Œé¢é€šçŸ¥å‘é€å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ solution_generator.py             # æ€»ç»“æ–‡æ¡£ç”Ÿæˆå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard_renderer.py             # ä»»åŠ¡ä»ªè¡¨ç›˜æ¸²æŸ“å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ archive_manager.py                # ä»»åŠ¡å½’æ¡£ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ compact_context_builder.py        # å‹ç¼©ä¸Šä¸‹æ–‡æ„å»ºå™¨
â”‚   â”‚   â”‚   â””â”€â”€ enhanced_matcher.py               # å¢å¼ºåŒ¹é…å™¨ï¼ˆç©æ³•åŒ…æ£€æµ‹ï¼‰
â”‚   â”‚   â”œâ”€â”€ lifecycle/                   # ç”Ÿå‘½å‘¨æœŸHook (5ä¸ª)
â”‚   â”‚   â”‚   â”œâ”€â”€ session_start.py                  # ä¼šè¯å¯åŠ¨ï¼ˆä»»åŠ¡æ¢å¤ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ stop.py                           # è½®æ¬¡ç»“æŸï¼ˆè¾¹ç•Œæ£€æŸ¥ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ subagent_stop.py                  # å­ä»£ç†å®Œæˆï¼ˆç»“æœæå–ï¼‰
â”‚   â”‚   â”œâ”€â”€ orchestrator/                # ç¼–æ’Hook (4ä¸ª)
â”‚   â”‚   â”‚   â”œâ”€â”€ user_prompt_handler.py            # ç”¨æˆ·è¾“å…¥å¤„ç†ï¼ˆçŠ¶æ€è½¬ç§»æ ¸å¿ƒï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ pretooluse_enforcer.py            # å·¥å…·è°ƒç”¨å‰éªŒè¯ï¼ˆ4å±‚ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ posttooluse_updater.py            # å·¥å…·è°ƒç”¨åæ›´æ–°ï¼ˆæ­¥éª¤è®°å½•ï¼‰
â”‚   â”‚   â”œâ”€â”€ archiver/                    # å½’æ¡£Hook (1ä¸ª)
â”‚   â”‚   â”‚   â””â”€â”€ post_archive.py                   # å½’æ¡£åå¤„ç†
â”‚   â”‚   â””â”€â”€ compactor/                   # å‹ç¼©Hook (1ä¸ª)
â”‚   â”‚       â””â”€â”€ pre_compact.py                    # å‹ç¼©å‰å‡†å¤‡
â”‚   â”œâ”€â”€ rules/                           # 4ä¸ªé˜¶æ®µè§„åˆ™ï¼ˆYAMLï¼‰
â”‚   â”‚   â”œâ”€â”€ activation.yaml
â”‚   â”‚   â”œâ”€â”€ planning.yaml
â”‚   â”‚   â”œâ”€â”€ implementation.yaml
â”‚   â”‚   â””â”€â”€ finalization.yaml
â”‚   â”œâ”€â”€ commands/                        # æ–œæ å‘½ä»¤æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ mc.md                        # /mcå‘½ä»¤ï¼ˆå¯åŠ¨ä»»åŠ¡ï¼‰
â”‚   â”‚   â”œâ”€â”€ code-to-docs.md              # /code-to-docså‘½ä»¤
â”‚   â”‚   â””â”€â”€ uninstallmc.md               # /uninstallmcå‘½ä»¤
â”‚   â””â”€â”€ config/                          # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚       â”œâ”€â”€ task_naming.json             # ä»»åŠ¡å‘½åè§„åˆ™
â”‚       â””â”€â”€ claude_semantic_config.json  # LLMåˆ†æå™¨é…ç½®
â”‚
â”œâ”€â”€ lib/                                 # Node.jså·¥å…·é“¾ï¼ˆä»…initmcä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ init-workflow.js                 # åˆå§‹åŒ–ä¸»æµç¨‹
â”‚   â”œâ”€â”€ analyzer.js                      # é¡¹ç›®åˆ†æå™¨
â”‚   â”œâ”€â”€ generator.js                     # æ–‡æ¡£ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ deployer.js                      # Hookéƒ¨ç½²å™¨
â”‚   â””â”€â”€ validator.js                     # é…ç½®éªŒè¯å™¨
â”‚
â”œâ”€â”€ tests/                               # æµ‹è¯•é¡¹ç›®ï¼ˆå®Œæ•´MODç¤ºä¾‹ï¼‰
â”‚   â”œâ”€â”€ .claude/                         # å·²éƒ¨ç½²çš„Hookç³»ç»Ÿ
â”‚   â”œâ”€â”€ behavior_packs/                  # è¡Œä¸ºåŒ…
â”‚   â”œâ”€â”€ resource_packs/                  # èµ„æºåŒ…
â”‚   â””â”€â”€ tasks/                           # ä»»åŠ¡å†å²è®°å½•
â”‚       â”œâ”€â”€ ä»»åŠ¡-1120-ä¿®å¤ç©å®¶æ­»äº¡è£…å¤‡ä¸¢å¤±/
â”‚       â”‚   â”œâ”€â”€ .task-meta.json
â”‚       â”‚   â”œâ”€â”€ context.md
â”‚       â”‚   â””â”€â”€ solution.md
â”‚       â””â”€â”€ archive/                     # å½’æ¡£ä»»åŠ¡
â”‚
â”œâ”€â”€ docs/developer/                      # å¼€å‘è€…æ–‡æ¡£ï¼ˆæœ¬ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ README.md                        # æ–‡æ¡£å¯¼èˆª
â”‚   â”œâ”€â”€ å¿«é€Ÿå¼€å§‹.md                      # å®‰è£…ä¸ä½¿ç”¨
â”‚   â”œâ”€â”€ æ¶æ„æ¦‚è§ˆ.md                      # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ HOOKæ­£ç¡®ç”¨æ³•æ–‡æ¡£.md              # Hookå¼€å‘æ ‡å‡†
â”‚   â”œâ”€â”€ Claudeè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨æŒ‡å—.md      # LLMé›†æˆ
â”‚   â”œâ”€â”€ HookçŠ¶æ€æœºåŠŸèƒ½å®ç°.md            # å·¥ä½œæµå®ç°
â”‚   â””â”€â”€ FAQ.md                           # å¸¸è§é—®é¢˜
â”‚
â”œâ”€â”€ CLAUDE.md                            # é¡¹ç›®çº§AIæŒ‡ä»¤
â”œâ”€â”€ CHANGELOG.md                         # ç‰ˆæœ¬æ›´æ–°è®°å½•
â”œâ”€â”€ README.md                            # é¡¹ç›®æ¦‚è¿°
â””â”€â”€ package.json                         # Node.jsé…ç½®ï¼ˆåŒ…å«initmcè„šæœ¬ï¼‰
```

### æ–‡ä»¶ç”¨é€”è¯´æ˜

| æ–‡ä»¶/ç›®å½• | ç”¨é€” | è¿è¡Œæ—¶åŠ è½½ |
|----------|------|-----------|
| `templates/.claude/` | Hookç³»ç»Ÿæ¨¡æ¿ï¼Œinitmcéƒ¨ç½²æº | âŒ ä»…éƒ¨ç½²æ—¶ |
| `lib/` | Node.jså·¥å…·é“¾ï¼Œinitmcå®ç° | âŒ ä»…éƒ¨ç½²æ—¶ |
| `ç”¨æˆ·é¡¹ç›®/.claude/hooks/` | å®é™…è¿è¡Œçš„Hookè„šæœ¬ï¼ˆä»templates/å¤åˆ¶ï¼‰ | âœ… æ¯æ¬¡Hookè§¦å‘ |
| `task-meta.json` | å”¯ä¸€æƒå¨æ•°æ®æº | âœ… æ¯æ¬¡Hookè§¦å‘ |
| `context.md` | å‹ç¼©å®‰å…¨çš„ä¸Šä¸‹æ–‡æ‘˜è¦ | âœ… SessionStartæ—¶ |
| `solution.md` | ä»»åŠ¡æ€»ç»“æ–‡æ¡£ | âŒ ä»…finalizationç”Ÿæˆ |
| `.task-meta.lock` | æ–‡ä»¶é”ï¼ˆå¹¶å‘æ§åˆ¶ï¼‰ | âœ… æ¯æ¬¡è¯»å†™æ—¶ |

---

## ğŸ”— æ‰©å±•é˜…è¯»

- **[HOOKæ­£ç¡®ç”¨æ³•æ–‡æ¡£](./HOOKæ­£ç¡®ç”¨æ³•æ–‡æ¡£.md)** - Hookå¼€å‘å”¯ä¸€æ ‡å‡†
- **[Claudeè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨æŒ‡å—](./Claudeè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨æŒ‡å—.md)** - LLMé›†æˆå®Œæ•´å®ç°
- **[HookçŠ¶æ€æœºåŠŸèƒ½å®ç°](./HookçŠ¶æ€æœºåŠŸèƒ½å®ç°.md)** - 4æ­¥çŠ¶æ€æœºè¯¦ç»†è¯´æ˜
- **[å¿«é€Ÿå¼€å§‹](./å¿«é€Ÿå¼€å§‹.md)** - å®é™…ä½¿ç”¨æ¼”ç¤º

---

**æ–‡æ¡£ç»´æŠ¤**: Claude Code Development Team
**æœ€åæ›´æ–°**: 2025-11-20
**é€‚ç”¨ç‰ˆæœ¬**: v25.0 (Claude LLM) + v21.0 (å•ä¸€æ•°æ®æº) + v3.0 Final (çŠ¶æ€æœº)
