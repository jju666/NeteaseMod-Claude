# NeteaseMod-Claude æµ‹è¯•æŒ‡å—

> **ç‰ˆæœ¬**: v2.0.0
> **æœ€åæ›´æ–°**: 2025-11-14
> **é€‚ç”¨ç‰ˆæœ¬**: v20.2.10+

---

## ç›®å½•

1. [æµ‹è¯•ç­–ç•¥æ¦‚è¿°](#æµ‹è¯•ç­–ç•¥æ¦‚è¿°)
2. [æµ‹è¯•ç¯å¢ƒè¦æ±‚](#æµ‹è¯•ç¯å¢ƒè¦æ±‚)
3. [æµ‹è¯•å‰å‡†å¤‡](#æµ‹è¯•å‰å‡†å¤‡)
4. [æ ¸å¿ƒæµ‹è¯•åœºæ™¯](#æ ¸å¿ƒæµ‹è¯•åœºæ™¯)
5. [Hookæ—¥å¿—éªŒè¯](#hookæ—¥å¿—éªŒè¯)
6. [ä»»åŠ¡ç›®å½•ç»“æ„éªŒè¯](#ä»»åŠ¡ç›®å½•ç»“æ„éªŒè¯)
7. [çŠ¶æ€æ–‡ä»¶å®Œæ•´æ€§éªŒè¯](#çŠ¶æ€æ–‡ä»¶å®Œæ•´æ€§éªŒè¯)
8. [å¸¸è§é—®é¢˜æ’æŸ¥](#å¸¸è§é—®é¢˜æ’æŸ¥)
9. [æµ‹è¯•è„šæœ¬ä½¿ç”¨](#æµ‹è¯•è„šæœ¬ä½¿ç”¨)

---

## æµ‹è¯•ç­–ç•¥æ¦‚è¿°

### å½“å‰æµ‹è¯•æ–¹æ³•

**NeteaseMod-Claude é¡¹ç›®é‡‡ç”¨æ‰‹åŠ¨æµ‹è¯•æ–¹æ³•**ï¼š

- **æ— è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶** - é¡¹ç›®å½“å‰ä¸ä½¿ç”¨ Jest/Mocha ç­‰è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·
- **ä¸‹æ¸¸é¡¹ç›®å®æµ‹** - åœ¨å®é™…çš„ç½‘æ˜“MODSDKé¡¹ç›®ä¸­æ‰§è¡Œ `/mc` å‘½ä»¤è¿›è¡ŒéªŒè¯
- **Hookæ—¥å¿—æ£€æŸ¥** - é€šè¿‡åˆ†æ `.claude/workflow-state.json` ç­‰çŠ¶æ€æ–‡ä»¶ç¡®è®¤åŠŸèƒ½æ­£å¸¸
- **ç›®å½•ç»“æ„éªŒè¯** - æ£€æŸ¥ `tasks/` ç›®å½•ä¸‹çš„ä»»åŠ¡æ–‡ä»¶å¤¹ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸ

### æµ‹è¯•ç›®æ ‡

1. **åŠŸèƒ½æ­£ç¡®æ€§** - ç¡®ä¿æ‰€æœ‰å·¥ä½œæµæ­¥éª¤æŒ‰é¢„æœŸæ‰§è¡Œ
2. **çŠ¶æ€æŒä¹…åŒ–** - éªŒè¯çŠ¶æ€æ–‡ä»¶æ­£ç¡®ä¿å­˜å’Œæ¢å¤
3. **é”™è¯¯å¤„ç†** - ç¡®è®¤å¼‚å¸¸æƒ…å†µä¸‹çš„å›æ»šå’Œé”™è¯¯æç¤º
4. **è·¨å¹³å°å…¼å®¹æ€§** - ç‰¹åˆ«æ˜¯Windowsä¸­æ–‡è·¯å¾„é—®é¢˜
5. **HookååŒå·¥ä½œ** - éªŒè¯8ä¸ªHookä¹‹é—´çš„åä½œæ— è¯¯

---

## æµ‹è¯•ç¯å¢ƒè¦æ±‚

### å¿…éœ€æ¡ä»¶

```json
{
  "node": ">=12.0.0",
  "python": ">=3.6",
  "os": "Windows/Linux/macOS",
  "claude-code": "latest"
}
```

### ä¸‹æ¸¸æµ‹è¯•é¡¹ç›®å‡†å¤‡

**éœ€è¦ä¸€ä¸ªå®é™…çš„ç½‘æ˜“MODSDKé¡¹ç›®**ï¼š

```
ä¸‹æ¸¸é¡¹ç›®ç»“æ„/
â”œâ”€â”€ modMain.py              # MODSDKå…¥å£æ–‡ä»¶
â”œâ”€â”€ server/                 # æœåŠ¡ç«¯ä»£ç 
â”‚   â””â”€â”€ XxxSystem.py
â”œâ”€â”€ client/                 # å®¢æˆ·ç«¯ä»£ç 
â”‚   â””â”€â”€ XxxSystem.py
â”œâ”€â”€ .claude/                # å·¥ä½œæµå·²éƒ¨ç½²
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â””â”€â”€ mc.md
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ unified-workflow-driver.py
â”‚   â””â”€â”€ workflow-state.json
â””â”€â”€ tasks/                  # ä»»åŠ¡ç›®å½•
```

**éƒ¨ç½²å·¥ä½œæµåˆ°ä¸‹æ¸¸é¡¹ç›®**ï¼š

```bash
cd your-modsdk-project
npx netease-mod-claude
# æˆ–
initmc
```

---

## æµ‹è¯•å‰å‡†å¤‡

### 1. æ¸…ç†æµ‹è¯•ç¯å¢ƒ

```bash
# å¤‡ä»½ç°æœ‰çŠ¶æ€
cp .claude/workflow-state.json .claude/workflow-state.json.backup

# æ¸…ç†æµ‹è¯•ä»»åŠ¡ç›®å½•
rm -rf tasks/æµ‹è¯•-*
```

### 2. è®¾ç½®æµ‹è¯•åŸºçº¿

**è®°å½•åˆå§‹çŠ¶æ€**ï¼š

```bash
# æ£€æŸ¥å½“å‰å·¥ä½œæµç‰ˆæœ¬
cat .claude/workflow-manifest.json

# æŸ¥çœ‹Hookç‰ˆæœ¬
head -20 .claude/hooks/unified-workflow-driver.py | grep "Version:"
```

### 3. å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

ç¼–è¾‘ `.claude/hooks/unified-workflow-driver.py`ï¼š

```python
# Line 50å·¦å³
DEBUG_MODE = True  # æ”¹ä¸ºTrueå¯ç”¨è¯¦ç»†æ—¥å¿—
```

---

## æ ¸å¿ƒæµ‹è¯•åœºæ™¯

### åœºæ™¯1: é¦–æ¬¡éƒ¨ç½²å·¥ä½œæµ

**æµ‹è¯•æ­¥éª¤**ï¼š

1. åœ¨ç©ºçš„MODSDKé¡¹ç›®ä¸­è¿è¡Œ `initmc`
2. éªŒè¯ç”Ÿæˆçš„ç›®å½•ç»“æ„

**é¢„æœŸç»“æœ**ï¼š

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ .claude/
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ mc.md
â”‚   â”‚   â”œâ”€â”€ mc-review.md
â”‚   â”‚   â”œâ”€â”€ mc-perf.md
â”‚   â”‚   â””â”€â”€ mc-docs.md
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ unified-workflow-driver.py
â”‚   â”‚   â”œâ”€â”€ session-start-hook.py
â”‚   â”‚   â”œâ”€â”€ session-end-hook.py
â”‚   â”‚   â””â”€â”€ ... (å…¶ä»–hooks)
â”‚   â”œâ”€â”€ workflow-config.json
â”‚   â”œâ”€â”€ workflow-manifest.json
â”‚   â””â”€â”€ workflow-state.json
â”œâ”€â”€ tasks/
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ markdown/
â”‚   â”œâ”€â”€ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ.md
â”‚   â””â”€â”€ ...
â””â”€â”€ CLAUDE.md
```

**éªŒè¯å‘½ä»¤**ï¼š

```bash
# æ£€æŸ¥å…³é”®æ–‡ä»¶
test -f .claude/commands/mc.md && echo "âœ“ mc.mdå­˜åœ¨"
test -f .claude/hooks/unified-workflow-driver.py && echo "âœ“ Hookå·²éƒ¨ç½²"
test -f CLAUDE.md && echo "âœ“ CLAUDE.mdå·²ç”Ÿæˆ"

# æ£€æŸ¥ç‰ˆæœ¬ä¿¡æ¯
cat .claude/workflow-manifest.json | grep version
```

### åœºæ™¯2: æ–°åŠŸèƒ½å¼€å‘ä»»åŠ¡

**æµ‹è¯•æ­¥éª¤**ï¼š

```bash
# åœ¨Claude Codeä¸­æ‰§è¡Œ
/mc æ·»åŠ VIPç³»ç»Ÿï¼Œç©å®¶è´­ä¹°åè·å¾—ç§»åŠ¨é€Ÿåº¦åŠ æˆ
```

**å…³é”®éªŒè¯ç‚¹**ï¼š

1. **ä»»åŠ¡ç›®å½•åˆ›å»º**ï¼š
   ```bash
   ls -la tasks/ | grep "$(date +%m%d)"
   # åº”çœ‹åˆ°: ä»»åŠ¡-1114-HHMMSS-æ·»åŠ VIPç³»ç»Ÿç©å®¶è´­ä¹°åè·å¾—ç§»åŠ¨é€Ÿåº¦åŠ æˆ/
   ```

2. **çŠ¶æ€æ–‡ä»¶åˆå§‹åŒ–**ï¼š
   ```bash
   cat .claude/workflow-state.json
   ```

   åº”åŒ…å«ï¼š
   ```json
   {
     "task_id": "ä»»åŠ¡-1114-HHMMSS-...",
     "task_type": "new_feature",
     "current_step": "step1_analysis",
     "step_status": {
       "step1_analysis": "in_progress"
     }
   }
   ```

3. **ä»»åŠ¡è¿½è¸ªæ–‡ä»¶**ï¼š
   ```bash
   cat tasks/ä»»åŠ¡-*/task-tracking.json
   ```

   åº”åŒ…å«ï¼š
   ```json
   {
     "task_id": "ä»»åŠ¡-...",
     "user_prompt": "/mc æ·»åŠ VIPç³»ç»Ÿ...",
     "task_type": "new_feature",
     "created_at": "...",
     "steps": { ... }
   }
   ```

### åœºæ™¯3: BUGä¿®å¤ä»»åŠ¡

**æµ‹è¯•æ­¥éª¤**ï¼š

```bash
/mc ä¿®å¤ç©å®¶é‡ç”Ÿä½ç½®é”™è¯¯çš„BUG
```

**ç‰¹æ®ŠéªŒè¯ç‚¹**ï¼š

1. **ä»»åŠ¡ç±»å‹è¯†åˆ«**ï¼š
   ```bash
   cat .claude/workflow-state.json | grep task_type
   # åº”è¾“å‡º: "task_type": "bug_fix"
   ```

2. **BUGä¿®å¤è¿½è¸ªåˆå§‹åŒ–**ï¼š
   ```json
   {
     "bug_fix_tracking": {
       "enabled": true,
       "loop_indicators": {
         "negative_feedback_count": 0,
         "repeated_file_edits": {},
         "max_iterations_reached": false
       }
     }
   }
   ```

3. **æ™ºèƒ½è¯Šæ–­ç³»ç»Ÿè§¦å‘** (éœ€æ»¡è¶³2-2-2æ¡ä»¶):
   - 2æ¬¡è´Ÿé¢ç”¨æˆ·åé¦ˆï¼ˆ"ä¸è¡Œ"ã€"æŠ¥é”™"ç­‰ï¼‰
   - åŒä¸€æ–‡ä»¶è¢«ä¿®æ”¹2æ¬¡
   - æ£€æŸ¥æ˜¯å¦æ³¨å…¥ä¸“å®¶åˆ†ææç¤º

### åœºæ™¯4: å·¥ä½œæµæ­¥éª¤æ¨è¿›

**æµ‹è¯•æ­¥éª¤**ï¼š

1. åˆ›å»ºä»»åŠ¡åï¼ŒAIè‡ªåŠ¨è¿›å…¥ `step1_analysis`
2. AIå®Œæˆåˆ†æï¼Œç”¨æˆ·ç¡®è®¤ â†’ æ¨è¿›åˆ° `step2_implementation`
3. AIç¼–å†™ä»£ç ï¼Œç”¨æˆ·æµ‹è¯• â†’ æ¨è¿›åˆ° `step3_verification`
4. ç”¨æˆ·ç¡®è®¤"å·²ä¿®å¤" â†’ æ¨è¿›åˆ° `step4_cleanup`

**éªŒè¯å‘½ä»¤**ï¼š

```bash
# ç›‘æ§çŠ¶æ€å˜åŒ–
watch -n 2 'cat .claude/workflow-state.json | grep current_step'
```

**é¢„æœŸè¾“å‡º**ï¼ˆéšæ—¶é—´æ¨ç§»ï¼‰ï¼š

```
"current_step": "step1_analysis"      # éœ€æ±‚åˆ†æ
"current_step": "step2_implementation" # ä»£ç å®ç°
"current_step": "step3_verification"   # æµ‹è¯•éªŒè¯
"current_step": "step4_cleanup"        # æ”¶å°¾å½’æ¡£
```

### åœºæ™¯5: Windowsä¸­æ–‡è·¯å¾„æµ‹è¯•

**æµ‹è¯•ç›®çš„**: éªŒè¯v20.2.5çš„ä¸­æ–‡è·¯å¾„ä¿®å¤

**æµ‹è¯•æ­¥éª¤**ï¼š

```bash
/mc æµ‹è¯•v20.2.5ä¸­æ–‡è·¯å¾„åˆ›å»ºåŠŸèƒ½
```

**éªŒè¯ç‚¹**ï¼š

```bash
# æ£€æŸ¥ä»»åŠ¡ç›®å½•åæ˜¯å¦åŒ…å«æ­£ç¡®çš„UTF-8ä¸­æ–‡å­—ç¬¦
ls tasks/ | grep "æµ‹è¯•.*ä¸­æ–‡è·¯å¾„"

# åº”è¯¥çœ‹åˆ°ï¼š
# ä»»åŠ¡-1114-HHMMSS-æµ‹è¯•v20.2.5ä¸­æ–‡è·¯å¾„åˆ›å»ºåŠŸèƒ½/
# è€Œä¸æ˜¯ï¼šä»»åŠ¡-1114-HHMMSS-å¨´ï¿½ï¿½ï¿½v20.2.5æ¶“ï¿½ï¿½ï¿½ (ä¹±ç )
```

**è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬**ï¼š

```bash
cd /path/to/netease-mod-claude
python scripts/test-v20.2.5-fixes.py /path/to/your-modsdk-project
```

### åœºæ™¯6: é”™è¯¯å›æ»šæœºåˆ¶æµ‹è¯•

**æµ‹è¯•æ­¥éª¤**ï¼š

1. æ‰‹åŠ¨ç ´åçŠ¶æ€æ–‡ä»¶ï¼š
   ```bash
   echo '{"task_id":' > .claude/workflow-state.json
   ```

2. è§¦å‘Hookï¼š
   ```bash
   /mc æµ‹è¯•é”™è¯¯å›æ»šæœºåˆ¶
   ```

3. æ£€æŸ¥æ—¥å¿—ï¼š
   ```bash
   # Hookåº”è¯¥æ£€æµ‹åˆ°æŸåçš„JSONå¹¶å›æ»š
   cat .claude/hooks/hook.log | grep -i "rollback"
   ```

**é¢„æœŸè¡Œä¸º**ï¼š

- Hookæ£€æµ‹åˆ°æŸåçš„çŠ¶æ€æ–‡ä»¶
- è¾“å‡º `[ROLLBACK]` æ—¥å¿—
- åˆ é™¤æˆ–é‡æ–°åˆå§‹åŒ–çŠ¶æ€æ–‡ä»¶
- ä»»åŠ¡æ­£å¸¸åˆ›å»º

---

## Hookæ—¥å¿—éªŒè¯

### æ—¥å¿—æ–‡ä»¶ä½ç½®

```
.claude/hooks/hook.log                 # ä¸»æ—¥å¿—
.claude/workflow-state.json            # çŠ¶æ€æ–‡ä»¶
tasks/<task-id>/task-tracking.json     # ä»»åŠ¡è¿½è¸ª
tasks/<task-id>/code-changes-log.json  # ä»£ç å˜æ›´è®°å½•
```

### å…³é”®æ—¥å¿—æ£€æŸ¥ç‚¹

#### 1. Hookæ‰§è¡ŒæˆåŠŸ

```bash
tail -f .claude/hooks/hook.log
```

**æ­£å¸¸è¾“å‡º**ï¼š

```
[INFO] unified-workflow-driver.py v20.2.8 å¯åŠ¨
[INFO] å·¥å…·ç±»å‹: Write
[INFO] çŠ¶æ€æ›´æ–°: code_changes = 1
[INFO] å½“å‰æ­¥éª¤: step2_implementation
[INFO] çŠ¶æ€å·²ä¿å­˜
```

**å¼‚å¸¸è¾“å‡º**ï¼ˆéœ€ä¿®å¤ï¼‰ï¼š

```
[ERROR] UnboundLocalError: local variable 'datetime' referenced before assignment
[ERROR] çŠ¶æ€ä¿å­˜å¤±è´¥: ...
[ROLLBACK] å›æ»šçŠ¶æ€æ–‡ä»¶...
```

#### 2. å¾ªç¯æ£€æµ‹æ—¥å¿—

**æ»¡è¶³2-2-2æ¡ä»¶æ—¶**ï¼š

```
[WARNING] æ£€æµ‹åˆ°å¾ªç¯æŒ‡æ ‡:
  - è´Ÿé¢åé¦ˆæ¬¡æ•°: 2
  - é‡å¤ç¼–è¾‘æ–‡ä»¶: server/VIPSystem.py (2æ¬¡)
[INFO] è§¦å‘ä¸“å®¶è¯Šæ–­ç³»ç»Ÿ
[INJECT] ä¸“å®¶åˆ†ææç¤ºå·²æ³¨å…¥
```

#### 3. æ­¥éª¤æ¨è¿›æ—¥å¿—

```
[INFO] æ­¥éª¤å®Œæˆæ£€æŸ¥:
  - step1_analysis: completed
  - step2_implementation: in_progress
[INFO] ç­‰å¾…ç”¨æˆ·ç¡®è®¤åæ¨è¿›åˆ° step3_verification
```

### æ—¥å¿—åˆ†ææŠ€å·§

```bash
# æŸ¥çœ‹æœ€è¿‘100è¡ŒHookæ—¥å¿—
tail -100 .claude/hooks/hook.log

# è¿‡æ»¤ERRORçº§åˆ«æ—¥å¿—
grep -i "\[ERROR\]" .claude/hooks/hook.log

# æŸ¥çœ‹ç‰¹å®šä»»åŠ¡çš„æ—¥å¿—
grep "ä»»åŠ¡-1114-143022" .claude/hooks/hook.log

# ç»Ÿè®¡Hookè°ƒç”¨æ¬¡æ•°
grep -c "unified-workflow-driver.py" .claude/hooks/hook.log
```

---

## ä»»åŠ¡ç›®å½•ç»“æ„éªŒè¯

### æ ‡å‡†ä»»åŠ¡ç›®å½•ç»“æ„

```
tasks/
â”œâ”€â”€ ä»»åŠ¡-1114-143022-æ·»åŠ VIPç³»ç»Ÿç©å®¶è´­ä¹°åè·å¾—ç§»åŠ¨é€Ÿåº¦åŠ æˆ/
â”‚   â”œâ”€â”€ task-tracking.json          # ä»»åŠ¡å…ƒæ•°æ®
â”‚   â”œâ”€â”€ code-changes-log.json       # ä»£ç å˜æ›´å†å²
â”‚   â”œâ”€â”€ user-feedback-history.json  # ç”¨æˆ·åé¦ˆè®°å½•
â”‚   â”œâ”€â”€ analysis/                   # éœ€æ±‚åˆ†æç»“æœ
â”‚   â”‚   â””â”€â”€ requirement-analysis.md
â”‚   â”œâ”€â”€ implementation/              # å®ç°æ–‡æ¡£
â”‚   â”‚   â””â”€â”€ vip-system-design.md
â”‚   â””â”€â”€ archived/                    # å½’æ¡£æ–‡ä»¶
â”‚       â””â”€â”€ old-version.py
â””â”€â”€ å·²å½’æ¡£/                          # å·²å®Œæˆä»»åŠ¡
    â””â”€â”€ ä»»åŠ¡-1113-092045-ä¿®å¤ç©å®¶é‡ç”ŸBUG/
```

### éªŒè¯è„šæœ¬

```bash
#!/bin/bash
# verify-task-structure.sh

TASK_DIR="$1"

if [ ! -d "$TASK_DIR" ]; then
  echo "âŒ ä»»åŠ¡ç›®å½•ä¸å­˜åœ¨: $TASK_DIR"
  exit 1
fi

echo "éªŒè¯ä»»åŠ¡ç›®å½•: $TASK_DIR"

# æ£€æŸ¥å…³é”®æ–‡ä»¶
FILES=("task-tracking.json" "code-changes-log.json")
for file in "${FILES[@]}"; do
  if [ -f "$TASK_DIR/$file" ]; then
    echo "âœ“ $file å­˜åœ¨"
  else
    echo "âœ— $file ç¼ºå¤±"
  fi
done

# æ£€æŸ¥JSONæ ¼å¼
if command -v jq &> /dev/null; then
  jq . "$TASK_DIR/task-tracking.json" > /dev/null 2>&1
  if [ $? -eq 0 ]; then
    echo "âœ“ task-tracking.json æ ¼å¼æ­£ç¡®"
  else
    echo "âœ— task-tracking.json JSONæ ¼å¼é”™è¯¯"
  fi
fi

echo "éªŒè¯å®Œæˆ"
```

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
chmod +x verify-task-structure.sh
./verify-task-structure.sh tasks/ä»»åŠ¡-1114-143022-æ·»åŠ VIPç³»ç»Ÿç©å®¶è´­ä¹°åè·å¾—ç§»åŠ¨é€Ÿåº¦åŠ æˆ
```

---

## çŠ¶æ€æ–‡ä»¶å®Œæ•´æ€§éªŒè¯

### workflow-state.json ç»“æ„

**å®Œæ•´ç¤ºä¾‹**ï¼š

```json
{
  "task_id": "ä»»åŠ¡-1114-143022-æ·»åŠ VIPç³»ç»Ÿç©å®¶è´­ä¹°åè·å¾—ç§»åŠ¨é€Ÿåº¦åŠ æˆ",
  "task_type": "new_feature",
  "user_prompt": "/mc æ·»åŠ VIPç³»ç»Ÿï¼Œç©å®¶è´­ä¹°åè·å¾—ç§»åŠ¨é€Ÿåº¦åŠ æˆ",
  "current_step": "step2_implementation",
  "step_status": {
    "step1_analysis": "completed",
    "step2_implementation": "in_progress",
    "step3_verification": "pending",
    "step4_cleanup": "pending"
  },
  "last_activity_timestamp": "2025-11-14T14:30:45.123Z",
  "code_changes": 3,
  "bug_fix_tracking": {
    "enabled": false,
    "loop_indicators": {
      "negative_feedback_count": 0,
      "repeated_file_edits": {},
      "max_iterations_reached": false
    }
  }
}
```

### éªŒè¯å·¥å…·

```python
#!/usr/bin/env python
# -*- coding: utf-8 -*-
# validate-state.py

import json
import sys

def validate_state_file(file_path):
    """éªŒè¯workflow-state.jsonæ ¼å¼å’Œå®Œæ•´æ€§"""

    required_fields = [
        "task_id",
        "task_type",
        "current_step",
        "step_status"
    ]

    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            state = json.load(f)

        # æ£€æŸ¥å¿…éœ€å­—æ®µ
        for field in required_fields:
            if field not in state:
                print(f"âœ— ç¼ºå°‘å¿…éœ€å­—æ®µ: {field}")
                return False
            else:
                print(f"âœ“ å­—æ®µ {field}: {state[field]}")

        # éªŒè¯task_typeåˆæ³•æ€§
        valid_types = ["new_feature", "bug_fix", "optimization", "documentation"]
        if state["task_type"] not in valid_types:
            print(f"âš  task_typeå€¼å¼‚å¸¸: {state['task_type']}")

        # éªŒè¯current_stepåˆæ³•æ€§
        valid_steps = ["step1_analysis", "step2_implementation", "step3_verification", "step4_cleanup"]
        if state["current_step"] not in valid_steps:
            print(f"âš  current_stepå€¼å¼‚å¸¸: {state['current_step']}")

        # éªŒè¯step_statusç»“æ„
        if "step_status" in state and isinstance(state["step_status"], dict):
            print("âœ“ step_statusç»“æ„æ­£ç¡®")
        else:
            print("âœ— step_statusç»“æ„å¼‚å¸¸")
            return False

        print("\nâœ… çŠ¶æ€æ–‡ä»¶éªŒè¯é€šè¿‡")
        return True

    except json.JSONDecodeError as e:
        print(f"âœ— JSONæ ¼å¼é”™è¯¯: {e}")
        return False
    except FileNotFoundError:
        print(f"âœ— æ–‡ä»¶ä¸å­˜åœ¨: {file_path}")
        return False
    except Exception as e:
        print(f"âœ— éªŒè¯å¤±è´¥: {e}")
        return False

if __name__ == '__main__':
    if len(sys.argv) < 2:
        print("ç”¨æ³•: python validate-state.py <workflow-state.jsonè·¯å¾„>")
        sys.exit(1)

    file_path = sys.argv[1]
    success = validate_state_file(file_path)
    sys.exit(0 if success else 1)
```

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
python validate-state.py .claude/workflow-state.json
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: ä»»åŠ¡ç›®å½•åä¹±ç 

**ç—‡çŠ¶**ï¼š

```
tasks/
â””â”€â”€ ä»»åŠ¡-1114-143022-å¨´ï¿½ï¿½ï¿½v20.2.5æ¶“ï¿½ï¿½ï¿½  # ä¹±ç 
```

**åŸå› **: Windowsç³»ç»Ÿstdinç¼–ç é—®é¢˜ï¼ˆv20.2.5å‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. å‡çº§åˆ°v20.2.5+
2. éªŒè¯ä¿®å¤ï¼š
   ```bash
   python scripts/test-v20.2.5-fixes.py /path/to/project
   ```

### é—®é¢˜2: Hookæ‰§è¡Œå¤±è´¥ - UnboundLocalError

**ç—‡çŠ¶**ï¼š

```
[ERROR] UnboundLocalError: local variable 'datetime' referenced before assignment
```

**åŸå› **: unified-workflow-driver.py Line 878çš„é‡å¤å¯¼å…¥é—®é¢˜ï¼ˆv20.2.7å‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. å‡çº§åˆ°v20.2.8+ (packageç‰ˆæœ¬20.2.10+)
2. æ£€æŸ¥Hookç‰ˆæœ¬ï¼š
   ```bash
   head -20 .claude/hooks/unified-workflow-driver.py | grep "Version:"
   # åº”è¾“å‡º: Version: v20.2.8
   ```

### é—®é¢˜3: ä»»åŠ¡ç›®å½•æœªç§»åŠ¨åˆ°å·²å½’æ¡£

**ç—‡çŠ¶**: ç”¨æˆ·è¾“å…¥"å·²ä¿®å¤"åï¼Œä»»åŠ¡ç›®å½•ä»åœ¨ `tasks/` æ ¹ç›®å½•

**æ’æŸ¥æ­¥éª¤**ï¼š

1. æ£€æŸ¥å½“å‰æ­¥éª¤ï¼š
   ```bash
   cat .claude/workflow-state.json | grep current_step
   # åº”ä¸º: "current_step": "step4_cleanup"
   ```

2. æŸ¥çœ‹Hookæ—¥å¿—ï¼š
   ```bash
   tail -50 .claude/hooks/hook.log | grep -i "cleanup"
   ```

3. æ‰‹åŠ¨å½’æ¡£ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰ï¼š
   ```bash
   mkdir -p tasks/å·²å½’æ¡£
   mv tasks/ä»»åŠ¡-* tasks/å·²å½’æ¡£/
   ```

### é—®é¢˜4: ä¸“å®¶è¯Šæ–­ç³»ç»Ÿæœªè§¦å‘

**ç—‡çŠ¶**: å³ä½¿æ»¡è¶³2-2-2æ¡ä»¶ï¼Œä¹Ÿæ²¡æœ‰çœ‹åˆ°ä¸“å®¶åˆ†ææç¤º

**éªŒè¯æ­¥éª¤**ï¼š

1. æ£€æŸ¥BUGä¿®å¤è¿½è¸ªæ˜¯å¦å¯ç”¨ï¼š
   ```bash
   cat .claude/workflow-state.json | grep -A 5 "bug_fix_tracking"
   ```

2. æ£€æŸ¥å¾ªç¯æŒ‡æ ‡ï¼š
   ```json
   {
     "negative_feedback_count": 2,  // éœ€>=2
     "repeated_file_edits": {
       "server/VIPSystem.py": 2     // éœ€>=2
     }
   }
   ```

3. æŸ¥çœ‹Hookæ—¥å¿—ï¼š
   ```bash
   grep -i "expert" .claude/hooks/hook.log
   ```

**è§£å†³æ–¹æ¡ˆ**ï¼š

- å¦‚æœHookç‰ˆæœ¬<v20.2.8ï¼Œå‡çº§å·¥ä½œæµ
- æ‰‹åŠ¨è§¦å‘è¯Šæ–­ï¼šåœ¨ä¸‹æ¬¡å›å¤ä¸­ä¸»åŠ¨è¦æ±‚AIè¿›è¡Œæ·±åº¦åˆ†æ

---

## æµ‹è¯•è„šæœ¬ä½¿ç”¨

### è„šæœ¬1: test-v20.2.5-fixes.py

**ç”¨é€”**: è‡ªåŠ¨éªŒè¯v20.2.5ä¿®å¤çš„ä¸­æ–‡è·¯å¾„ã€BUGä¿®å¤æ¨¡å¼åˆå§‹åŒ–ã€é”™è¯¯å›æ»šåŠŸèƒ½

**ä½ç½®**: `scripts/test-v20.2.5-fixes.py`

**ç”¨æ³•**ï¼š

```bash
cd /path/to/netease-mod-claude
python scripts/test-v20.2.5-fixes.py /path/to/your-modsdk-project
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
============================================================
å‡†å¤‡æµ‹è¯•ç¯å¢ƒ...
============================================================
âœ“ å·²å¤‡ä»½çŠ¶æ€æ–‡ä»¶: .claude/workflow-state.json.backup.20251114143022
âœ“ å·²æ¸…ç†æµ‹è¯•ç›®å½•: æµ‹è¯•-1113-143022-æ—§æµ‹è¯•ä»»åŠ¡
âœ“ æµ‹è¯•ç¯å¢ƒå‡†å¤‡å®Œæˆ

============================================================
æµ‹è¯•1: Windowsä¸­æ–‡è·¯å¾„åˆ›å»º
============================================================
âœ“ ä»»åŠ¡ç›®å½•åˆ›å»ºæˆåŠŸ: ä»»åŠ¡-1114-143045-æµ‹è¯•v20.2.5ä¸­æ–‡è·¯å¾„ä¿®å¤åŠŸèƒ½
âœ“ è·¯å¾„ç¼–ç æ­£ç¡® (UTF-8)

============================================================
æµ‹è¯•2: BUGä¿®å¤æ¨¡å¼çŠ¶æ€åˆå§‹åŒ–
============================================================
âœ“ task_type: bug_fix
âœ“ bug_fix_tracking.enabled: True
âœ“ loop_indicators: {'negative_feedback_count': 0, 'repeated_file_edits': {}, ...}

============================================================
æµ‹è¯•3: é”™è¯¯å›æ»šæœºåˆ¶
============================================================
âœ“ æŸåçš„æ–‡ä»¶å·²è¢«æ–°ä»»åŠ¡è¦†ç›–
âœ“ é”™è¯¯å›æ»šæœºåˆ¶å·¥ä½œæ­£å¸¸

============================================================
æµ‹è¯•ç»“æœæ±‡æ€»
============================================================
âœ“ PASS - chinese_path_creation
âœ“ PASS - bugfix_mode_initialization
âœ“ PASS - error_rollback

é€šè¿‡ç‡: 3/3 (100%)

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼v20.2.5ä¿®å¤ç”Ÿæ•ˆã€‚
```

### è„šæœ¬2: test-bugfix-guide-v20.2.4.py

**ç”¨é€”**: æµ‹è¯•v20.2.4æ–°å¢çš„BUGä¿®å¤æŒ‡å¼•ç”ŸæˆåŠŸèƒ½

**ä½ç½®**: `tests/test-bugfix-guide-v20.2.4.py`

**ç”¨æ³•**ï¼š

```bash
cd /path/to/netease-mod-claude
python tests/test-bugfix-guide-v20.2.4.py
```

**æµ‹è¯•å†…å®¹**ï¼š

1. BUGä»»åŠ¡æ£€æµ‹å‡½æ•°
2. BUGç—‡çŠ¶åˆ†æå‡½æ•°
3. çŸ¥è¯†æºè·¯ç”±å‡½æ•°
4. ä¸šåŠ¡å…³é”®è¯æå–å‡½æ•°
5. BUGä¿®å¤æŒ‡å¼•ç”Ÿæˆå‡½æ•°

---

## æµ‹è¯•æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æµ‹è¯•

- [ ] å·¥ä½œæµéƒ¨ç½²åˆ°ç©ºMODSDKé¡¹ç›®æˆåŠŸ
- [ ] ç”Ÿæˆçš„ç›®å½•ç»“æ„ç¬¦åˆé¢„æœŸ
- [ ] CLAUDE.mdä¸­æ— å ä½ç¬¦ï¼ˆå¦‚`{{PROJECT_PATH}}`ï¼‰
- [ ] workflow-manifest.jsonç‰ˆæœ¬å·æ­£ç¡®

### åŠŸèƒ½æµ‹è¯•

- [ ] æ–°åŠŸèƒ½ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼Œtask_type=new_feature
- [ ] BUGä¿®å¤ä»»åŠ¡è¯†åˆ«æ­£ç¡®ï¼Œtask_type=bug_fix
- [ ] Windowsä¸­æ–‡è·¯å¾„æ— ä¹±ç 
- [ ] ä»»åŠ¡ç›®å½•ç»“æ„å®Œæ•´ï¼ˆtask-tracking.jsonç­‰ï¼‰
- [ ] workflow-state.jsonæ ¼å¼æ­£ç¡®

### å·¥ä½œæµæµ‹è¯•

- [ ] Step1â†’Step2æ¨è¿›æ­£å¸¸
- [ ] Step2â†’Step3æ¨è¿›æ­£å¸¸
- [ ] Step3â†’Step4æ¨è¿›æ­£å¸¸
- [ ] ä»»åŠ¡å½’æ¡£åˆ° `tasks/å·²å½’æ¡£/`

### HookååŒæµ‹è¯•

- [ ] unified-workflow-driver.pyæ­£å¸¸å·¥ä½œ
- [ ] ä»£ç ä¿®æ”¹è®¡æ•°å™¨å‡†ç¡®ï¼ˆcode_changesï¼‰
- [ ] å¾ªç¯æ£€æµ‹ç®—æ³•æ­£ç¡®è§¦å‘ï¼ˆ2-2-2ï¼‰
- [ ] ä¸“å®¶è¯Šæ–­ç³»ç»Ÿå¯è§¦å‘
- [ ] æ¡Œé¢é€šçŸ¥å¼¹çª—æ˜¾ç¤º

### é”™è¯¯æ¢å¤æµ‹è¯•

- [ ] æŸåçš„workflow-state.jsonèƒ½è‡ªåŠ¨æ¢å¤
- [ ] Hookå¼‚å¸¸ä¸é˜»å¡ç”¨æˆ·äº¤äº’
- [ ] é”™è¯¯æ—¥å¿—æ¸…æ™°å¯è¿½æº¯

---

## æ€»ç»“

æœ¬æµ‹è¯•æŒ‡å—æè¿°äº†NeteaseMod-Claudeé¡¹ç›®çš„**å®é™…æµ‹è¯•æ–¹æ³•**ï¼š

1. **æ‰‹åŠ¨æµ‹è¯•ä¸ºä¸»** - åœ¨ä¸‹æ¸¸MODSDKé¡¹ç›®ä¸­ä½¿ç”¨ `/mc` å‘½ä»¤éªŒè¯
2. **Hookæ—¥å¿—éªŒè¯** - é€šè¿‡åˆ†æ `.claude/workflow-state.json` ç­‰æ–‡ä»¶ç¡®è®¤åŠŸèƒ½
3. **ç›®å½•ç»“æ„æ£€æŸ¥** - éªŒè¯ `tasks/` ç›®å½•ä¸‹çš„ä»»åŠ¡æ–‡ä»¶å¤¹ç»“æ„
4. **æµ‹è¯•è„šæœ¬è¾…åŠ©** - ä½¿ç”¨Pythonè„šæœ¬è‡ªåŠ¨åŒ–å¸¸è§æµ‹è¯•åœºæ™¯

### å…³é”®è¦ç‚¹

- æœ¬é¡¹ç›®**ä¸ä½¿ç”¨**è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼ˆJest/Mochaï¼‰
- æµ‹è¯•ä¾èµ–çœŸå®çš„MODSDKé¡¹ç›®ç¯å¢ƒ
- é‡ç‚¹éªŒè¯Hookæ—¥å¿—ã€çŠ¶æ€æ–‡ä»¶ã€ä»»åŠ¡ç›®å½•ç»“æ„
- æµ‹è¯•è„šæœ¬ä½äº `scripts/` å’Œ `tests/` ç›®å½•

### ä¸‹ä¸€æ­¥

- åœ¨ä¸‹æ¸¸é¡¹ç›®ä¸­æ‰§è¡Œæœ¬æŒ‡å—ä¸­çš„æµ‹è¯•åœºæ™¯
- å‘ç°é—®é¢˜æ—¶æŸ¥çœ‹Hookæ—¥å¿—å®šä½åŸå› 
- ä½¿ç”¨æµ‹è¯•è„šæœ¬å¿«é€ŸéªŒè¯å…³é”®åŠŸèƒ½
- å‘ä¸Šæ¸¸é¡¹ç›®æŠ¥å‘ŠBUGå’Œæµ‹è¯•ç»“æœ

---

**ç›¸å…³æ–‡æ¡£**:
- [Hookæœºåˆ¶](./Hookæœºåˆ¶.md) - Hookå·¥ä½œåŸç†ä¸çŠ¶æ€æœºè®¾è®¡
- [å¿«é€Ÿä¸Šæ‰‹](./å¿«é€Ÿä¸Šæ‰‹.md) - `/mc` å‘½ä»¤ä½¿ç”¨æ–¹æ³•
- [æŠ€æœ¯æ¶æ„](./æŠ€æœ¯æ¶æ„.md) - ç³»ç»Ÿæ•´ä½“æ¶æ„è®¾è®¡

**æœ€åæ›´æ–°**: 2025-11-14 | **ç»´æŠ¤è€…**: NeteaseMod-Claude Contributors
