# 玩法包贡献指南

> **版本**: v1.0.0
> **创建日期**: 2025-11-13
> **适用于**: NeteaseMod-Claude v19.0+
> **目标**: 帮助开发者为知识库贡献高质量玩法包

---

## 📋 目录

1. [什么是玩法包](#什么是玩法包)
2. [贡献流程](#贡献流程)
3. [玩法包结构](#玩法包结构)
4. [质量标准](#质量标准)
5. [提交指南](#提交指南)
6. [审核流程](#审核流程)
7. [常见问题](#常见问题)

---

## 什么是玩法包

### 定义

玩法包是一个**完整的、可复用的MODSDK实现方案**,包含:
- 📋 **完整代码实现**（150+行,可直接使用或修改）
- 📚 **MODSDK API详解**（参数、用法、常见陷阱）
- ⚙️ **配置指南**（如何自定义参数）
- 🐛 **常见问题解答**（已知问题和解决方案）
- 🔗 **相关玩法推荐**（可复用的代码片段）

### 价值

- ✅ **Token节省**：玩法包推送代替文档查阅,节省70-80% Token
- ✅ **效率提升**：完整代码框架,开发速度提升5-7倍
- ✅ **质量保证**：经过验证的实现方案,避免常见错误
- ✅ **知识传承**：沉淀最佳实践,减少重复劳动

### 优先级玩法列表

#### 高优先级（覆盖80%用户需求）

**战斗玩法**：
- ✅ 击杀掉落系统（已实现）
- [ ] 伤害倍率修改
- [ ] 自定义武器效果
- [ ] 击退/眩晕机制
- [ ] 经验掉落系统

**交互玩法**：
- ✅ NPC对话系统（已实现）
- ✅ 自定义商店（已实现）
- [ ] 右键方块触发事件
- [ ] 实体骑乘控制
- [ ] 物品合成配方

**世界玩法**：
- [ ] 区域传送门
- [ ] 自定义方块功能
- [ ] 粒子特效生成
- [ ] 自定义天气系统
- [ ] 区域保护

#### 中优先级（覆盖15%用户需求）

**经济玩法**：
- [ ] 货币系统
- [ ] 背包扩展
- [ ] 物品兑换

**多人玩法**：
- [ ] 队伍系统
- [ ] 排行榜

---

## 贡献流程

### 快速流程

```mermaid
graph LR
    A[选择玩法主题] --> B[研究MODSDK API]
    B --> C[编写完整代码]
    C --> D[测试验证]
    D --> E[编写玩法包JSON]
    E --> F[提交PR]
    F --> G[审核]
    G --> H[合并]
```

### 详细步骤

#### 1. 选择玩法主题（10分钟）

**方法1：从优先级列表选择**
```bash
# 查看当前知识库状态
cat .claude/knowledge-base.json | jq '.metadata'

# 选择一个未实现的高优先级玩法
```

**方法2：提议新玩法**
```bash
# 在GitHub Issues创建提议
# 标题格式: [玩法包提议] 玩法名称
# 内容包含:
# - 玩法描述
# - 应用场景
# - 预估频次（高/中/低）
```

#### 2. 研究MODSDK API（30-60分钟）

**使用子代理深度研究**:
```bash
# 启动Explore子代理
/task "研究[玩法名称]所需的MODSDK API和事件,输出完整的技术画像"

# 子代理会:
# 1. 搜索相关事件和Component
# 2. 分析API参数和用法
# 3. 提取常见陷阱
# 4. 输出结构化画像
```

**研究输出要求**:
- ✅ 核心事件列表（≥1个）
- ✅ 必需API列表（≥2个）
- ✅ 完整代码实现（≥150行）
- ✅ 常见问题记录（≥3个）

#### 3. 编写完整代码（1-2小时）

**代码要求**:
- ✅ 遵循12项CRITICAL规范
- ✅ 包含详细中文注释
- ✅ 提供配置表模板
- ✅ 处理边界情况
- ✅ 长度≥150行

**代码模板**:
```python
# -*- coding: utf-8 -*-
"""
[玩法名称]System
功能: [一句话描述]
作者: [你的名字]
创建: [日期]
"""
from __future__ import print_function
from mod.server.system.serverSystem import ServerSystem
import mod.server.extraServerApi as serverApi

class [Gameplay]ServerSystem(ServerSystem):
    """[玩法名称]服务端System"""

    def __init__(self, namespace, systemName):
        super([Gameplay]ServerSystem, self).__init__(namespace, systemName)

        # 配置表（用户可自定义）
        self.config = {
            # 配置项示例
        }

        # 组件引用
        self.comp1 = None
        self.comp2 = None

        self.Create()

    def Create(self):
        """系统初始化"""
        # 1. 创建组件
        comp_factory = serverApi.GetEngineCompFactory()
        levelId = serverApi.GetLevelId()

        self.comp1 = comp_factory.CreateXXX(levelId)
        self.comp2 = comp_factory.CreateYYY(levelId)

        # 2. 监听事件
        self.ListenForEvent(
            serverApi.GetEngineNamespace(),
            serverApi.GetEngineSystemName(),
            "EventName",
            self,
            self.OnEvent
        )

    def OnEvent(self, args):
        """
        事件处理器

        Args:
            args (dict): 事件数据
                - field1 (str): 字段说明
                - field2 (int): 字段说明
        """
        # 安全获取字段
        field1 = args.get('field1')
        if not field1:
            print("[WARNING] field1缺失")
            return

        # 业务逻辑
        # ...

    def Destroy(self):
        """系统销毁时清理"""
        self.UnListenAllEvents()
```

#### 4. 测试验证（30分钟）

**测试清单**:
- [ ] 游戏内测试通过
- [ ] 多人游戏兼容性测试
- [ ] 边界情况测试（如空值、极端数值）
- [ ] 性能测试（如大量触发时）

**测试记录**:
```markdown
## 测试报告

**测试环境**:
- 网易我的世界版本: [版本号]
- MODSDK版本: [版本号]
- 测试时间: [日期]

**测试用例**:
1. 基础功能测试
   - 步骤: [操作步骤]
   - 预期: [预期结果]
   - 实际: [实际结果]
   - 状态: ✅ 通过

2. 边界情况测试
   - ...

**已知问题**:
- [问题描述]
- [解决方案]
```

#### 5. 编写玩法包JSON（30分钟）

参考[玩法包结构](#玩法包结构)章节,创建完整的JSON条目。

#### 6. 提交PR（10分钟）

**使用辅助脚本**:
```bash
# 方法1: 使用Python脚本
python scripts/add-gameplay-pack.py

# 脚本会引导你:
# 1. 输入玩法包基本信息
# 2. 自动验证JSON格式
# 3. 更新knowledge-base.json
# 4. 生成测试用例
```

**手动提交**:
```bash
# 1. Fork仓库
# 2. 创建分支
git checkout -b gameplay/[玩法名称]

# 3. 编辑knowledge-base.json
vi .claude/knowledge-base.json

# 4. 运行测试
python tests/test-kb-loading.py
python tests/test-keyword-matching.py

# 5. 提交PR
git add .claude/knowledge-base.json
git commit -m "feat(gameplay): 添加[玩法名称]玩法包"
git push origin gameplay/[玩法名称]
```

---

## 玩法包结构

### JSON Schema

```json
{
  "id": "gameplay-id",
  "name": "玩法名称",
  "keywords": ["关键词1", "关键词2", "..."],
  "category": "战斗玩法|交互玩法|世界玩法|经济玩法|多人玩法",
  "difficulty": "简单|中等|困难",
  "estimated_time": "预计开发时间（如: 5分钟）",

  "description": "一句话描述玩法功能",

  "implementation_guide": {
    "principle": "实现原理概述（监听XX事件 → 处理逻辑 → 调用XX API）",

    "modsdk_apis": [
      {
        "name": "API名称",
        "type": "事件|组件方法|接口",
        "trigger": "触发时机（仅事件需要）",
        "fields": {
          "字段名": "类型和说明"
        },
        "params": {
          "参数名": {
            "type": "类型",
            "required": ["必需字段"],
            "example": "示例值"
          }
        },
        "doc_path": "MODSDK文档路径（相对路径）",
        "common_pitfall": "常见陷阱说明"
      }
    ],

    "complete_code": {
      "file": "推荐文件路径（如: mod/server/system/XXXSystem.py）",
      "content": "完整Python代码（≥150行,包含注释）"
    },

    "config_guide": {
      "description": "配置说明",
      "example": {
        "配置键": "配置值示例"
      },
      "fields": {
        "字段名": "字段说明"
      }
    },

    "common_issues": [
      {
        "problem": "问题描述",
        "cause": "原因分析",
        "solution": "解决方案"
      }
    ],

    "related_gameplay": [
      {
        "name": "相关玩法名称",
        "similarity": "相似点说明",
        "reusable_code": "可复用的代码片段说明"
      }
    ]
  }
}
```

### 字段说明

#### 基本信息字段

| 字段 | 类型 | 必需 | 说明 | 示例 |
|------|------|------|------|------|
| `id` | string | ✅ | 唯一标识符,kebab-case格式 | `"kill-drop-system"` |
| `name` | string | ✅ | 玩法中文名称 | `"击杀掉落系统"` |
| `keywords` | array | ✅ | 关键词列表,≥8个 | `["击杀", "掉落", "怪物"]` |
| `category` | string | ✅ | 玩法分类 | `"战斗玩法"` |
| `difficulty` | string | ✅ | 实现难度 | `"简单"` |
| `estimated_time` | string | ✅ | 预计开发时间 | `"5分钟"` |
| `description` | string | ✅ | 一句话描述 | `"玩家击杀实体后生成自定义掉落物"` |

#### implementation_guide 字段

| 字段 | 类型 | 必需 | 说明 |
|------|------|------|------|
| `principle` | string | ✅ | 实现原理概述 |
| `modsdk_apis` | array | ✅ | 所需API列表,≥2个 |
| `complete_code.content` | string | ✅ | 完整代码,≥150行 |
| `config_guide` | object | ✅ | 配置指南 |
| `common_issues` | array | ✅ | 常见问题,≥3个 |
| `related_gameplay` | array | ⚠️ | 相关玩法（可选） |

---

## 质量标准

详见[玩法包质量标准](./玩法包质量标准.md)文档。

**核心指标**:
- ✅ **匹配度≥75%**（关键词覆盖率）
- ✅ **代码长度≥150行**（包含注释）
- ✅ **关键词数量≥8个**
- ✅ **API数量≥2个**
- ✅ **常见问题≥3个**
- ✅ **文档引用准确**（精确到章节）
- ✅ **代码可执行**（测试通过）

---

## 提交指南

### PR标题格式

```
feat(gameplay): 添加[玩法名称]玩法包

# 示例
feat(gameplay): 添加区域传送门玩法包
```

### PR描述模板

```markdown
## 玩法包信息

**玩法名称**: [名称]
**玩法分类**: [分类]
**实现难度**: [难度]
**预计开发时间**: [时间]

## 核心指标

- [ ] 匹配度: [百分比]
- [ ] 代码长度: [行数]
- [ ] 关键词数量: [数量]
- [ ] API数量: [数量]
- [ ] 常见问题: [数量]

## 测试结果

- [ ] 代码可执行
- [ ] 测试用例通过
- [ ] 关键词匹配测试通过
- [ ] 文档引用准确

## 相关文件

- `.claude/knowledge-base.json` - 玩法包JSON
- `tests/test-[玩法id].py` - 测试用例（可选）

## 备注

[其他说明]
```

### 提交前检查清单

```bash
# 1. JSON格式验证
python -c "import json; json.load(open('.claude/knowledge-base.json'))"

# 2. 运行测试
python tests/test-kb-loading.py
python tests/test-keyword-matching.py

# 3. 代码长度检查
# 确保 complete_code.content 长度≥150行

# 4. 关键词覆盖率检查
# 确保关键词数量≥8个且涵盖核心概念
```

---

## 审核流程

### 审核标准

**自动化检查**（必须通过）:
- ✅ JSON格式正确
- ✅ 必需字段完整
- ✅ 代码长度≥150行
- ✅ 关键词数量≥8个
- ✅ API数量≥2个

**人工审核**（维护者进行）:
- ✅ 代码质量（遵循CRITICAL规范）
- ✅ 文档准确性（API用法正确）
- ✅ 常见问题实用性
- ✅ 关键词匹配合理性

### 审核时间

- **首次审核**: 7个工作日内
- **修改后复审**: 3个工作日内

### 审核结果

**通过**: 合并到主分支,下一版本发布
**需修改**: 提供修改建议,等待更新
**拒绝**: 说明原因（如重复、质量不达标等）

---

## 常见问题

### Q1: 如何选择关键词？

**原则**:
- ✅ 用户会用什么词描述这个玩法？
- ✅ 覆盖核心概念和常见变体
- ✅ 包含领域术语和通俗说法

**示例**（击杀掉落系统）:
```json
"keywords": [
  "击杀",      // 核心动作
  "掉落",      // 核心概念
  "怪物",      // 常见对象
  "物品",      // 产出物
  "战利品",    // 通俗说法
  "loot",      // 英文术语
  "drop",      // 英文术语
  "monster",   // 英文术语
  "kill",      // 英文术语
  "自定义掉落" // 长尾关键词
]
```

### Q2: 代码长度不够150行怎么办？

**方法**:
- ✅ 添加详细中文注释
- ✅ 提供多个配置示例
- ✅ 实现完整的边界检查
- ✅ 添加日志输出

**反例**:
- ❌ 用空行凑数
- ❌ 注释灌水（无意义重复）
- ❌ 复制粘贴相似代码

### Q3: 如何编写"常见问题"？

**来源**:
- ✅ 实际测试中遇到的问题
- ✅ 社区反馈的高频问题
- ✅ MODSDK文档中的注意事项
- ✅ 容易被忽略的边界情况

**格式**:
```json
{
  "problem": "简洁描述问题现象",
  "cause": "分析根本原因（为什么会出现）",
  "solution": "提供可操作的解决方案"
}
```

### Q4: 玩法包更新后如何维护？

**场景1: MODSDK API变更**
- 提交PR更新玩法包中的API用法
- 标注兼容的MODSDK版本

**场景2: 发现新问题**
- 在原玩法包的`common_issues`中添加
- 提交PR并说明问题来源

**场景3: 优化实现方案**
- 创建新版本玩法包（id添加`-v2`后缀）
- 或提交PR替换原玩法包

### Q5: 可以贡献非Python玩法包吗？

**当前版本**: 仅支持Python（MODSDK服务端/客户端System）

**未来计划**:
- [ ] 支持JSON配置类玩法（如Loot Table、Recipe）
- [ ] 支持UI玩法（HTML/CSS/JavaScript）
- [ ] 支持命令方块玩法

---

## 参考资源

### 内部文档
- [玩法包质量标准](./玩法包质量标准.md)
- [技术架构](./技术架构.md)
- [开发规范](../../.claude/core-docs/核心工作流文档/开发规范.md)

### 工具脚本
- `scripts/add-gameplay-pack.py` - 玩法包添加辅助脚本
- `tests/test-kb-loading.py` - 知识库加载测试
- `tests/test-keyword-matching.py` - 关键词匹配测试

### 社区
- GitHub Issues: https://github.com/[your-repo]/issues
- 讨论区: https://github.com/[your-repo]/discussions

---

## 致谢

感谢所有为知识库贡献玩法包的开发者！你们的贡献让MODSDK开发更简单、更高效！

---

_最后更新: 2025-11-13 | v1.0.0_
