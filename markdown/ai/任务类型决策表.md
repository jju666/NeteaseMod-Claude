# 任务类型决策表

> **AI工作流补充文档**
>
> 用于帮助AI快速识别任务类型并选择合适的执行策略

---

## 🎯 核心决策流程

```
用户任务描述
    ↓
分析修改范围 → 单文件<30行? → 🟢 微任务
    ↓ 否
分析文件数量 → 3-8个文件? → 🟡 标准任务
    ↓ 否
复杂任务判断 → >8文件或架构变更? → 🔴 复杂任务
```

---

## 📊 三级任务分类详解

### 🟢 微任务

**判断标准**：
1. ✅ 单文件修改
2. ✅ 修改范围 < 30行
3. ✅ 无需探索其他代码
4. ✅ 用户明确指定修改内容

**示例任务**：
- 配置修改：`shop_config.py` 价格 10 → 15
- 文案修改：修改提示文字颜色
- 简单BUG修复：修正拼写错误
- 文档更新：补充注释说明

**执行策略**：
```
理解任务 → 直接Edit修改 → Git commit
```

**Token成本**：< 2k

---

### 🟡 标准任务

**判断标准**：
1. ✅ 2-3个文件
2. ✅ 需要理解模块交互
3. ✅ 涉及业务逻辑
4. ❌ 不涉及架构变更

**示例任务**：
- 预设交互修复：商店点击无响应
- 战斗BUG：暴击伤害计算错误
- 添加新技能：添加一个新的主动技能
- UI调整：调整倒计时UI显示逻辑
- 状态机流程：修改游戏阶段切换逻辑

**执行策略**：
```
理解任务 → 查阅文档 → 可选创建tasks/（5章模板）
    ↓
探索代码（父代理直接Read/Grep）
    ↓
设计方案 → 实施修改 → 验证 → Git commit
```

**Token成本**：20-35k

---

### 🔴 复杂任务

**判断标准**：
1. ✅ 多模块重构（5+文件）
2. ✅ 架构变更
3. ✅ 涉及多个系统交互
4. ✅ 需要完整的设计文档

**示例任务**：
- 新功能/系统：添加排行榜系统
- 全局重构：从旧RPG迁移装备系统
- 数据库迁移：Apollo 1.0 → 2.0
- 性能优化：全局tick优化
- 框架升级：ECPreset框架集成

**执行策略**：
```
理解任务 → 查阅文档 → 必须创建tasks/（9章模板）
    ↓
可选并行探索（仅用户要求）
    ↓
分阶段实施 → 单元测试 → 集成测试 → 文档更新 → Git commit
```

**Token成本**：40-60k

---

## 🔍 关键词快速识别

| 关键词 | 任务级别 | 典型示例 |
|--------|---------|---------|
| 配置/价格/参数 | 🟢 微任务 | "调整钻石剑价格为15钻石" |
| 文案/颜色/UI文字 | 🟢 微任务 | "修改提示文字为红色" |
| 修复拼写/注释 | 🟢 微任务 | "修正函数名拼写错误" |
| 预设/交互 | 🟡 标准任务 | "商店预设点击无响应" |
| 战斗BUG/伤害 | 🟡 标准任务 | "修复暴击伤害计算BUG" |
| 添加技能/物品 | 🟡 标准任务 | "添加新的主动技能：火球术" |
| 状态机/流程 | 🟡 标准任务 | "调整倒计时流程逻辑" |
| 新系统/功能 | 🔴 复杂任务 | "添加全局排行榜系统" |
| 重构/迁移 | 🔴 复杂任务 | "迁移装备系统到新架构" |
| 性能优化 | 🔴 复杂任务 | "优化全局tick性能" |

---

## ⚠️ 边界案例处理

### 案例1：日志中显示错误

**用户任务**：日志显示 `AttributeError: 'NoneType' object has no attribute 'xxx'`

**决策流程**：
1. 先理解问题现象（阅读日志、查看代码）
2. 判断修改范围：
   - 如果是单行空指针检查 → 🟢 微任务
   - 如果是生命周期问题，需修改 `__init__` 和 `Create` → 🟡 标准任务
   - 如果是架构问题，需重构多个模块 → 🔴 复杂任务

### 案例2："优化XXX性能"

**用户任务**：优化商店加载性能

**决策流程**：
1. 判断优化范围：
   - 仅优化单个函数（如缓存查询结果）→ 🟢 微任务
   - 优化多个函数的调用逻辑 → 🟡 标准任务
   - 重构整个商店系统架构 → 🔴 复杂任务

### 案例3："添加XXX功能"

**用户任务**：为商店添加打折功能

**决策流程**：
1. 判断实现复杂度：
   - 仅修改 `shop_config.py` 添加折扣字段 → 🟢 微任务
   - 需修改 `shop_preset.py` 和 `shop_ui.py` 显示逻辑 → 🟡 标准任务
   - 需添加新的折扣系统（时间判断、VIP等级等）→ 🔴 复杂任务

---

## 📝 决策模板

当遇到难以分类的任务时，使用以下模板：

```
## 任务分析

**用户任务**：[任务描述]

**涉及文件**（预估）：
- [ ] 文件1：[文件路径] - [修改内容]
- [ ] 文件2：[文件路径] - [修改内容]
- ...

**修改行数**（预估）：[行数]

**是否需要理解其他模块**：[是/否]

**是否涉及架构变更**：[是/否]

---

**决策结论**：[🟢 微任务 / 🟡 标准任务 / 🔴 复杂任务]

**理由**：[简述判断依据]
```

---

## 🎯 最佳实践

### 1. 当无法确定时

**原则**：宁可高估，不要低估

- 不确定是微任务还是标准任务 → 选择标准任务
- 不确定是标准任务还是复杂任务 → 选择复杂任务

### 2. 用户明确要求

**优先级**：用户意图 > 自动判断

- 如果用户说"快速修复" → 倾向微任务
- 如果用户说"完整重构" → 倾向复杂任务

### 3. 历史上下文

**检查历史**：
```bash
dir {{PROJECT_PATH}}\tasks /b
```

- 如果发现相关任务目录 → 继续之前的任务等级
- 如果是全新任务 → 按正常流程判断

---

## 📊 统计参考

根据历史任务统计：
- 85% 的任务属于 🟢 微任务
- 12% 的任务属于 🟡 标准任务
- 3% 的任务属于 🔴 复杂任务

**结论**：大部分任务都可以用微任务快速通道完成。

---

_最后更新: {{CURRENT_DATE}} | 文档版本: 1.0_
