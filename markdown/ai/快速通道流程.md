# 快速通道流程

> **AI工作流补充文档 - 微任务执行指南**
>
> 用于指导AI高效执行微任务（单文件<30行修改）

---

## 🎯 快速通道概述

**适用场景**：
- ✅ 单文件修改
- ✅ 修改范围 < 30行
- ✅ 无需探索其他代码
- ✅ 用户明确指定修改内容

**核心理念**：
> "简单问题简单处理，避免过度设计"

---

## ⚡ 快速通道流程（4步）

```
步骤1: 查阅Systems文档（30秒）⭐ 新增
    ↓
步骤2: 定向搜索定位（30秒）
    ↓
步骤3: 直接Edit修改（1分钟）
    ↓
步骤4: 更新文档并Git commit（1分钟）⭐ 更新
```

**总耗时**：< 3分钟
**Token成本**：< 2k（相比盲目搜索节省80%）

---

## 📋 详细步骤

### 步骤1：查阅项目文档（30秒）⭐

**目标**：快速定位代码位置，避免盲目搜索

**操作**：
```python
# 1. 根据项目类型和任务描述判断涉及的模块
# 项目类型示例：
# - System架构项目: Read("markdown/systems/[系统名].md")
# - 模块化项目: Read("markdown/modules/[模块名].md")
# - 其他架构: Read("markdown/[相关文档].md")

# 2. 提取关键信息
# - 文件路径：RoomManagementSystem.py
# - 关键函数：CreatePlayer()
# - 配置位置：player_data_dict["coin"]
```

**输出示例**（System架构项目）：
```
📂 已查阅项目文档: systems/个性工坊系统.md
🎯 提取关键信息:
  - 文件: systems/RoomManagementSystem.py
  - 函数: CreatePlayer()
  - 位置: player_data_dict["coin"] 初始化
```

---

### 步骤2：定向搜索定位（30秒）

**目标**：基于文档关键词精确定位代码行号

**操作**：
```python
# 1. 使用文档提供的关键词进行精确搜索
Grep(pattern="CreatePlayer", path="systems/RoomManagementSystem.py", output_mode="content", -n=True)

# 2. 读取相关代码确认
Read(file_path="systems/RoomManagementSystem.py", offset=40, limit=20)
```

**输出示例**：
```
📍 定位结果:
- 文件: behavior_packs/.../RoomManagementSystem.py
- 行号: 47
- 当前值: "coin": 0
- 目标值: "coin": 99999
```

---

### 步骤3：直接Edit修改（1分钟）

**目标**：精准修改，添加注释说明原因

**操作**：
```python
Edit(
    file_path="path/to/RoomManagementSystem.py",
    old_string='"coin": 0',
    new_string='"coin": 99999  # 测试环境初始金币（2025-11-11）'
)
```

**注释规范**：
- ✅ 简短说明修改原因
- ✅ 添加修改日期
- ✅ 如果是BUG修复，注明BUG现象

**示例**：
```python
# ✅ 好的注释
"coin": 99999  # 测试环境初始金币（2025-11-11）
use_new_damage_calc = True  # 修复伤害计算错误（2025-11-11）

# ❌ 不好的注释
"coin": 99999  # 修改
use_new_damage_calc = True  # 改成True
```

---

### 步骤4：更新文档并Git commit（1分钟）⭐

**目标**：维护Systems文档，创建清晰的Git提交记录

**操作1：更新项目文档**
```python
# 补充或更新相关信息
# 根据项目类型选择对应文档路径
Edit(
    file_path="markdown/[项目文档目录]/[相关模块].md",
    old_string='- 位置: player_data_dict["coin"] 初始化',
    new_string='- 位置: player_data_dict["coin"] 初始化\n  - 默认值: 99999（测试环境）\n  - 最后更新: 2025-11-11'
)

# System架构项目示例:
# file_path="markdown/systems/个性工坊系统.md"
```

**操作2：Git commit**

**操作**：
```bash
git add [修改的文件] markdown/[项目文档目录]/[相关模块].md
git commit -m "$(cat <<'EOF'
[微任务] 调整玩家默认金币为99999

修改文件:
- RoomManagementSystem.py:47
- markdown/[项目文档目录]/[相关模块].md

修改内容:
- "coin": 0 → 99999

理由:
- 方便测试个性工坊购买流程

文档更新:
- 补充金币默认值配置位置

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

**Commit消息模板**：
```
[微任务] [简短描述]

修改文件:
- [文件路径]:[行号]
- markdown/[项目文档目录]/[相关模块].md ← 新增

修改内容:
- [变量名]: [旧值] → [新值]

理由:
- [修改原因]

文档更新: ← 新增
- [更新内容]

🤖 Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

---

## ✅ 快速通道检查清单

执行快速通道前，确认：

- [ ] 任务确实是微任务（单文件<30行）
- [ ] 用户明确指定了修改内容
- [ ] 项目文档已存在且包含相关信息 ⭐ 新增
- [ ] 不涉及CRITICAL规范（如System生命周期、双端隔离）

**⚠️ 如果有任何一项不确定，转为标准任务流程！**

**⚠️ 如果项目文档不存在或过时，首次执行时会创建初始版本**

---

## 🚫 快速通道禁止场景

### 场景1：涉及CRITICAL规范

**示例**：
```
❌ 用户任务："修复GetComponent返回None的问题"
→ 涉及System生命周期，必须查阅文档
→ 转为标准任务
```

### 场景2：需要理解其他模块

**示例**：
```
❌ 用户任务："修改玩家UI显示逻辑"
→ 可能涉及ServerSystem、ClientSystem等多个文件
→ 转为标准任务
```

### 场景3：用户描述不明确

**示例**：
```
❌ 用户任务："优化实体生成性能"
→ 需要先理解性能瓶颈在哪里
→ 转为标准任务
```

### 场景4：涉及业务逻辑

**示例**：
```
❌ 用户任务："添加新的buff效果"
→ 需要理解buff系统架构
→ 转为标准任务或复杂任务
```

---

## 📊 典型微任务示例

### 示例1：配置修改

**用户任务**：将玩家最大生命值从20调整为40

**执行流程**：
```python
# 1. 定位
Grep("PLAYER_MAX_HEALTH", path="game_config.py", -n=True)

# 2. 修改
Edit(
    file_path="game_config.py",
    old_string="PLAYER_MAX_HEALTH = 20",
    new_string="PLAYER_MAX_HEALTH = 40  # 调整生命值平衡性"
)

# 3. 提交
git commit -m "[微任务] 调整玩家最大生命值为40"
```

---

### 示例2：文案修改

**用户任务**：修改提示文字为红色

**执行流程**：
```python
# 1. 定位
Grep("customTips.*你已加入游戏", path="game_system.py", -n=True)

# 2. 修改
Edit(
    file_path="game_system.py",
    old_string='customTips("你已加入游戏")',
    new_string='customTips("§c你已加入游戏")  # 修改为红色文字'
)

# 3. 提交
git commit -m "[微任务] 修改加入游戏提示文字为红色"
```

---

### 示例3：简单BUG修复

**用户任务**：修正拼写错误 `palyer` → `player`

**执行流程**：
```python
# 1. 定位
Grep("palyer", path="game_manager.py", -n=True)

# 2. 修改
Edit(
    file_path="game_manager.py",
    old_string="palyer_id",
    new_string="player_id"
)

# 3. 提交
git commit -m "[微任务] 修正拼写错误 palyer → player"
```

---

## 💡 最佳实践

### 1. 快速确认

**使用 Grep + Read 快速确认**：
```python
# 快速确认修改位置正确
Grep("target_variable", path="target_file.py", output_mode="content", -n=True, -C=3)
```

### 2. 单次Edit

**尽量使用单次Edit完成修改**：
```python
# ✅ 好的做法
Edit(
    file_path="config.py",
    old_string="price = 10\n    level = 5",
    new_string="price = 15  # 调整价格\n    level = 5"
)

# ❌ 不好的做法（多次Edit）
Edit(file_path="config.py", old_string="price = 10", new_string="price = 15")
Edit(file_path="config.py", old_string="price = 15", new_string="price = 15  # 调整价格")
```

### 3. 清晰注释

**添加有意义的注释**：
```python
# ✅ 好的注释
use_cache = True  # 启用缓存优化性能（2025-01-15）

# ❌ 不好的注释
use_cache = True  # 改成True
```

---

## 📈 效率对比

| 流程 | 步骤数 | 耗时 | Token成本 |
|------|--------|------|-----------|
| 快速通道 | 3步 | <2分钟 | <2k |
| 标准任务 | 6步 | 5-10分钟 | 20-35k |
| 复杂任务 | 9步 | 30-60分钟 | 40-60k |

**结论**：对于简单任务，快速通道可节省90%时间和95% tokens！

---

## ⚠️ 重要提醒

1. **不要过度使用**：85%的任务是微任务，但不要强行将标准任务归类为微任务
2. **保持警惕**：如果修改后发现需要改其他文件，立即转为标准任务
3. **记录追溯**：即使是微任务，也要创建清晰的Git commit记录

---

_最后更新: 2025-11-11 | 文档版本: 3.0 (v16.2 - 强制文档查阅)_
