# å¼€å‘è§„èŒƒ

> **ğŸ“ å¯¼èˆª**: [ğŸ  é¦–é¡µ](../README.md) > [ğŸ“‚ æ–‡æ¡£](../README.md#æ–‡æ¡£å¯¼èˆª) > å¼€å‘è§„èŒƒ
>
> âš ï¸ **CRITICAL**: è¿™äº›è§„åˆ™å¯é˜²æ­¢è¿è¡Œæ—¶é”™è¯¯ã€‚å¼€å‘å‰å¿…è¯»ï¼
>
> **ğŸ“… æœ€åæ›´æ–°**: 2025-02-01

---

## ğŸ“‹ ç›®å½•

1. [Python 2.7å…¼å®¹æ€§](#python-27å…¼å®¹æ€§)
2. [Systemç”Ÿå‘½å‘¨æœŸ](#systemç”Ÿå‘½å‘¨æœŸ-critical) âš ï¸ **CRITICAL**
3. [æ¨¡å—å¯¼å…¥è§„èŒƒ](#æ¨¡å—å¯¼å…¥è§„èŒƒ-critical) âš ï¸ **CRITICAL**
4. [å‘½åè§„èŒƒ](#å‘½åè§„èŒƒ)
5. [æ–‡ä»¶ç»„ç»‡](#æ–‡ä»¶ç»„ç»‡)
6. [äº‹ä»¶ç³»ç»Ÿ](#äº‹ä»¶ç³»ç»Ÿ)
7. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
8. [ç½‘æ˜“å¼•æ“é™åˆ¶](#ç½‘æ˜“å¼•æ“é™åˆ¶)

---

## Python 2.7å…¼å®¹æ€§

### âš ï¸ ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ

ç½‘æ˜“æˆ‘çš„ä¸–ç•Œå¼•æ“ä½¿ç”¨**Python 2.7**ï¼Œå¿…é¡»ä¿æŒå…¼å®¹æ€§ã€‚ä½¿ç”¨Python 3ç‰¹æ€§ä¼šå¯¼è‡´è¯­æ³•é”™è¯¯æˆ–è¿è¡Œæ—¶å´©æºƒã€‚

### å¿…é¡»éµå®ˆçš„è§„åˆ™

#### 1. æ–‡ä»¶ç¼–ç å£°æ˜

**æ¯ä¸ªPythonæ–‡ä»¶å¼€å¤´å¿…é¡»å£°æ˜UTF-8ç¼–ç **ï¼š

```python
# -*- coding: utf-8 -*-
"""æ¨¡å—è¯´æ˜æ–‡æ¡£å­—ç¬¦ä¸²"""
```

#### 2. Printå‡½æ•°

**å¿…é¡»å¯¼å…¥print_function**ï¼š

```python
# âœ… æ­£ç¡®
from __future__ import print_function

print("Hello, World!")
print("Value:", value)

# âŒ é”™è¯¯ï¼ˆPython 2.7ä¼šæŠ¥é”™ï¼‰
print "Hello, World"  # Python 2è¯­æ³•ï¼Œä½†ä¸æ¨è
```

#### 3. å­—ç¬¦ä¸²æ ¼å¼åŒ–

**ä½¿ç”¨ `.format()` è€Œé f-strings**ï¼š

```python
# âœ… æ­£ç¡®
name = "ç©å®¶"
msg = "æ¬¢è¿ {} åŠ å…¥æ¸¸æˆ".format(name)
msg = "åæ ‡: ({}, {}, {})".format(x, y, z)

# âŒ é”™è¯¯ï¼ˆf-stringsæ˜¯Python 3.6+ç‰¹æ€§ï¼‰
msg = f"æ¬¢è¿ {name} åŠ å…¥æ¸¸æˆ"
```

#### 4. ç±»å‹æ³¨è§£

**ä½¿ç”¨æ³¨é‡Šå½¢å¼ï¼Œä¸è¦ä½¿ç”¨Python 3è¯­æ³•**ï¼š

```python
# âœ… æ­£ç¡®
def get_player_name(player_id):
    # type: (str) -> str
    """è·å–ç©å®¶åç§°"""
    return "PlayerName"

# âŒ é”™è¯¯ï¼ˆç±»å‹æ³¨è§£æ˜¯Python 3ç‰¹æ€§ï¼‰
def get_player_name(player_id: str) -> str:
    return "PlayerName"
```

#### 5. å­—å…¸æ–¹æ³•

**æ³¨æ„å­—å…¸æ–¹æ³•åœ¨Python 2/3çš„å·®å¼‚**ï¼š

```python
# âœ… æ­£ç¡®ï¼ˆå…¼å®¹Python 2å’Œ3ï¼‰
for key in dict.keys():
    print(key)

for key, value in dict.items():
    print(key, value)

# âš ï¸ æ³¨æ„ï¼šPython 2çš„dict.iteritems()åœ¨Python 3ä¸­ä¸å­˜åœ¨
# æ¨èä½¿ç”¨dict.items()ï¼ˆä¸¤è€…éƒ½æ”¯æŒï¼‰
```

#### 6. é™¤æ³•è¿ç®—

**æ•´æ•°é™¤æ³•è¡Œä¸ºä¸åŒ**ï¼š

```python
# Python 2: 5 / 2 = 2 (æ•´æ•°é™¤æ³•)
# Python 3: 5 / 2 = 2.5 (æµ®ç‚¹é™¤æ³•)

# âœ… æ­£ç¡®ï¼ˆæ˜ç¡®æ„å›¾ï¼‰
from __future__ import division

result = 5 / 2      # 2.5 (æµ®ç‚¹é™¤æ³•)
result = 5 // 2     # 2 (æ•´æ•°é™¤æ³•)

# âŒ é”™è¯¯ï¼ˆè¡Œä¸ºä¸æ˜ç¡®ï¼‰
result = 5 / 2      # Python 2å’Œ3è¡Œä¸ºä¸åŒ
```

#### 7. å¼‚å¸¸å¤„ç†

**ä½¿ç”¨å…¼å®¹çš„å¼‚å¸¸è¯­æ³•**ï¼š

```python
# âœ… æ­£ç¡®ï¼ˆPython 2å’Œ3éƒ½æ”¯æŒï¼‰
try:
    do_something()
except Exception as e:
    print("Error:", e)

# âŒ é”™è¯¯ï¼ˆPython 2æ—§è¯­æ³•ï¼ŒPython 3ä¸æ”¯æŒï¼‰
try:
    do_something()
except Exception, e:
    print "Error:", e
```

### å…¼å®¹æ€§æ£€æŸ¥æ¸…å•

å¼€å‘æ—¶è¯·ç¡®è®¤ï¼š

- [ ] æ–‡ä»¶å¼€å¤´æœ‰ `# -*- coding: utf-8 -*-`
- [ ] å¯¼å…¥äº† `from __future__ import print_function`
- [ ] ä½¿ç”¨ `.format()` è€Œé f-strings
- [ ] ç±»å‹æ³¨è§£ä½¿ç”¨æ³¨é‡Šå½¢å¼ `# type: ...`
- [ ] å¼‚å¸¸å¤„ç†ä½¿ç”¨ `except ... as e` è¯­æ³•
- [ ] æ²¡æœ‰ä½¿ç”¨Python 3ä¸“æœ‰ç‰¹æ€§ï¼ˆå¦‚ `async/await`ã€`@dataclass` ç­‰ï¼‰

---

## Systemç”Ÿå‘½å‘¨æœŸ âš ï¸ CRITICAL

### âš ï¸ å…³é”®é—®é¢˜

**ç½‘æ˜“å¼•æ“çš„Systemç”Ÿå‘½å‘¨æœŸè®¾è®¡**ï¼š
- âœ… **å¼•æ“åªä¼šè‡ªåŠ¨è§¦å‘ `Destroy()` æ–¹æ³•**
- âŒ **å¼•æ“ä¸ä¼šè‡ªåŠ¨è§¦å‘ `Create()` æ–¹æ³•**

**ç»“è®º**ï¼š`Create()` å¿…é¡»åœ¨ `__init__` ä¸­æ‰‹åŠ¨è°ƒç”¨ï¼

### æ ‡å‡†å®ç°æ¨¡å¼

```python
# -*- coding: utf-8 -*-
"""ç³»ç»Ÿè¯´æ˜"""

from mod.server.system import ServerSystem

class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        super(MySystem, self).__init__(namespace, systemName)

        # åˆå§‹åŒ–æˆå‘˜å˜é‡
        self.players = {}
        self.config = None

        # ========== âš ï¸ é‡è¦ï¼šæ‰‹åŠ¨è°ƒç”¨Create() ==========
        # è¯´æ˜ï¼šç½‘æ˜“å¼•æ“è®¾è®¡ä¸Šåªè‡ªåŠ¨è§¦å‘Destroy()ï¼Œä¸è‡ªåŠ¨è§¦å‘Create()
        # å› æ­¤éœ€è¦åœ¨__init__ä¸­æ‰‹åŠ¨è°ƒç”¨Create()å®Œæˆç³»ç»Ÿåˆå§‹åŒ–
        print("[MySystem] æ‰‹åŠ¨è°ƒç”¨Create()å®Œæˆç³»ç»Ÿåˆå§‹åŒ–")
        self.Create()

    def Create(self):
        """ç³»ç»Ÿåˆ›å»ºæ—¶çš„åˆå§‹åŒ–é€»è¾‘"""
        print("[MySystem] Create() è¢«è°ƒç”¨")

        # æ³¨å†Œäº‹ä»¶
        self.ListenForEvent(
            "ServerPlayerJoinEvent",
            "Minecraft",
            self.OnPlayerJoin
        )

        # åŠ è½½é…ç½®
        self.config = self.load_config()

        # å…¶ä»–åˆå§‹åŒ–é€»è¾‘...

    def Destroy(self):
        """ç³»ç»Ÿé”€æ¯æ—¶è‡ªåŠ¨è¢«å¼•æ“è°ƒç”¨"""
        print("[MySystem] Destroy() è¢«è°ƒç”¨")

        # æ¸…ç†èµ„æº
        self.players.clear()
        self.config = None

        # å–æ¶ˆäº‹ä»¶ç›‘å¬ï¼ˆé€šå¸¸ä¸éœ€è¦æ‰‹åŠ¨å–æ¶ˆï¼Œå¼•æ“ä¼šè‡ªåŠ¨æ¸…ç†ï¼‰

    def OnPlayerJoin(self, args):
        """ç©å®¶åŠ å…¥äº‹ä»¶å¤„ç†"""
        player_id = args.get("id")
        print("[MySystem] ç©å®¶åŠ å…¥:", player_id)
```

### ä¸ºä»€ä¹ˆéœ€è¦æ‰‹åŠ¨è°ƒç”¨ï¼Ÿ

**å¼•æ“æºç åˆ†æ**ï¼ˆ`mod/common/system.py`ï¼‰ï¼š

```python
class System(object):
    def __init__(self, namespace, systemName):
        self.namespace = namespace
        self.systemName = systemName

    def Create(self):
        """ç”±å­ç±»å®ç°ï¼Œä½†å¼•æ“ä¸ä¼šè‡ªåŠ¨è°ƒç”¨"""
        pass

    def Destroy(self):
        """å¼•æ“ä¼šåœ¨ç³»ç»Ÿé”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨"""
        pass
```

**å¼•æ“åªåœ¨ç³»ç»Ÿé”€æ¯æ—¶è°ƒç”¨`Destroy()`ï¼Œä¸ä¼šåœ¨åˆ›å»ºæ—¶è°ƒç”¨`Create()`ã€‚**

### å¸¸è§é”™è¯¯

#### âŒ é”™è¯¯1ï¼šå¿˜è®°è°ƒç”¨Create()

```python
class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        super(MySystem, self).__init__(namespace, systemName)
        # âŒ å¿˜è®°è°ƒç”¨self.Create()

    def Create(self):
        # è¿™ä¸ªæ–¹æ³•æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œï¼
        self.ListenForEvent(...)  # äº‹ä»¶ä¸ä¼šæ³¨å†Œ
```

**åæœ**ï¼šäº‹ä»¶ç›‘å¬ä¸ç”Ÿæ•ˆï¼Œé…ç½®ä¸åŠ è½½ï¼Œç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œã€‚

#### âŒ é”™è¯¯2ï¼šåœ¨__init__ä¸­é‡å¤è°ƒç”¨

```python
class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        super(MySystem, self).__init__(namespace, systemName)
        self.Create()
        self.Create()  # âŒ é‡å¤è°ƒç”¨
```

**åæœ**ï¼šäº‹ä»¶å¯èƒ½è¢«é‡å¤æ³¨å†Œï¼Œå¯¼è‡´å›è°ƒæ‰§è¡Œå¤šæ¬¡ã€‚

### é˜²æ­¢é‡å¤è°ƒç”¨çš„ä¿æŠ¤æªæ–½

```python
class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        super(MySystem, self).__init__(namespace, systemName)

        self._created = False  # æ ‡è®°æ˜¯å¦å·²åˆ›å»º

        if not self._created:
            print("[MySystem] æ‰‹åŠ¨è°ƒç”¨Create()å®Œæˆç³»ç»Ÿåˆå§‹åŒ–")
            self.Create()

    def Create(self):
        if self._created:
            print("[MySystem] Create()å·²è¢«è°ƒç”¨ï¼Œè·³è¿‡")
            return

        print("[MySystem] æ‰§è¡ŒCreate()åˆå§‹åŒ–")
        # åˆå§‹åŒ–é€»è¾‘...

        self._created = True
```

### ç›¸å…³æ–‡æ¡£

è¯¦è§é¡¹ç›®æ–‡æ¡£ï¼š`æ‰‹åŠ¨è°ƒç”¨Create()ä¿®å¤æ–¹æ¡ˆ.md`

---

## æ¨¡å—å¯¼å…¥è§„èŒƒ âš ï¸ CRITICAL

### âš ï¸ å…³é”®é—®é¢˜

**ç½‘æ˜“å¼•æ“çš„ModåŠ è½½æœºåˆ¶ä¼šæ‰«ææ¨¡å—çš„æ‰€æœ‰å±æ€§**ï¼Œå°è¯•å®ä¾‹åŒ–ä»»ä½•å…·æœ‰`MOD_NAME`å±æ€§çš„å¯¹è±¡ã€‚

**é”™è¯¯çš„å¯¼å…¥æ–¹å¼ä¼šå¯¼è‡´**ï¼š
```
TypeError: 'module' object is not callable
```

### é—®é¢˜æ ¹æº

ç½‘æ˜“å¼•æ“çš„`ImportModMain()`å‡½æ•°å®ç°ï¼š

```python
def ImportModMain(self, modMainPath, initTypeString):
    modModule = __import__(modMainPath, fromlist=[''])

    for mKey in dir(modModule):  # âš ï¸ éå†æ¨¡å—çš„æ‰€æœ‰å±æ€§
        cls = getattr(modModule, mKey)
        if not hasattr(cls, 'MOD_NAME'):
            continue
        instance = cls()  # âŒ å°è¯•è°ƒç”¨ - å¦‚æœclsæ˜¯moduleå¯¹è±¡ä¼šæŠ¥é”™!
```

### é”™è¯¯åœºæ™¯ç¤ºä¾‹

```python
# modMain.py
# âŒ é”™è¯¯å¯¼å…¥æ–¹å¼
import modConfig  # è¿™ä¼šå°†modConfigæ¨¡å—å¯¹è±¡æ·»åŠ åˆ°å½“å‰æ¨¡å—çš„å‘½åç©ºé—´

@Mod.Binding(name=modConfig.MOD_NAME, version=modConfig.MOD_VERSION)
class Script_NeteaseMod(object):
    pass
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. `dir(modMain)` åŒ…å« `'modConfig'`ï¼ˆå› ä¸º `import modConfig`ï¼‰
2. `getattr(modMain, 'modConfig')` è¿”å›modConfigæ¨¡å—å¯¹è±¡
3. `hasattr(modConfig, 'MOD_NAME')` ä¸ºTrueï¼ˆmodConfigå®šä¹‰äº†MOD_NAMEï¼‰
4. `modConfig()` å°è¯•è°ƒç”¨æ¨¡å—å¯¹è±¡ â†’ **TypeError: 'module' object is not callable**

### âœ… æ­£ç¡®çš„å¯¼å…¥è§„èŒƒ

#### è§„åˆ™1ï¼šæ°¸è¿œä¸è¦ä½¿ç”¨ `import module` å¯¼å…¥é…ç½®æ¨¡å—

**å¯¹äºåŒ…å«`MOD_NAME`å¸¸é‡çš„é…ç½®æ¨¡å—**ï¼Œå¿…é¡»ä½¿ç”¨ `from ... import ...`ï¼š

```python
# âœ… æ­£ç¡®å¯¼å…¥æ–¹å¼
from mod.common.mod import Mod
import mod.client.extraClientApi as clientApi
import mod.server.extraServerApi as serverApi

# âš ï¸ å…³é”®ï¼šä½¿ç”¨from...importå¯¼å…¥ï¼Œè€Œéimport modConfig
from modConfig import MOD_NAME, MOD_VERSION, SERVER_SYSTEMS, CLIENT_SYSTEMS
from modConfig import CLIENT_PRESET_IMPORTS, CLIENT_PRESET_TYPES

@Mod.Binding(name=MOD_NAME, version=MOD_VERSION)
class Script_NeteaseMod(object):
    def __init__(self):
        pass

    @Mod.InitServer()
    def Script_NeteaseModServerInit(self):
        # âœ… ä½¿ç”¨ç›´æ¥å¯¼å…¥çš„å˜é‡å
        for system_name, system_path in SERVER_SYSTEMS:
            serverApi.RegisterSystem(MOD_NAME, system_name, system_path)
```

#### è§„åˆ™1.1ï¼šå­ç›®å½•ä¸­å¯¼å…¥modConfigå¿…é¡»ä½¿ç”¨å®Œæ•´è·¯å¾„ âš ï¸ **NEW**

**åœ¨å­ç›®å½•æ–‡ä»¶ä¸­**ï¼ˆå¦‚ `config/`, `systems/`, `presets/`ï¼‰ï¼Œå¯¼å…¥`modConfig`æ—¶å¿…é¡»ä½¿ç”¨**å®Œæ•´çš„åŒ…è·¯å¾„**ï¼š

```python
# âœ… æ­£ç¡® - åœ¨å­ç›®å½•ä¸­ä½¿ç”¨å®Œæ•´è·¯å¾„
# æ–‡ä»¶ä½ç½®: Script_NeteaseMod/config/shop_config.py
from Script_NeteaseMod.modConfig import MOD_NAME

# âŒ é”™è¯¯ - åœ¨å­ç›®å½•ä¸­ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ä¼šå¯¼è‡´ImportError
# æ–‡ä»¶ä½ç½®: Script_NeteaseMod/config/shop_config.py
from modConfig import MOD_NAME  # ImportError: No module named modConfig
```

**åŸå› **ï¼š
- `modConfig.py` ä½äº `Script_NeteaseMod/` æ ¹ç›®å½•
- å­ç›®å½•æ–‡ä»¶ï¼ˆå¦‚ `Script_NeteaseMod/config/shop_config.py`ï¼‰ä¸åœ¨åŒä¸€ç›®å½•å±‚çº§
- Pythonæ¨¡å—è§£æè§„åˆ™è¦æ±‚ä½¿ç”¨å®Œæ•´è·¯å¾„ä»åŒ…æ ¹å¼€å§‹å¯¼å…¥

**æ­£ç¡®åšæ³•å¯¹ç…§è¡¨**ï¼š

| æ–‡ä»¶ä½ç½® | æ­£ç¡®å¯¼å…¥æ–¹å¼ | é”™è¯¯å¯¼å…¥æ–¹å¼ |
|---------|-------------|-------------|
| `Script_NeteaseMod/modMain.py` | `from modConfig import MOD_NAME` | âœ… åŒçº§ç›®å½•å¯ç”¨ |
| `Script_NeteaseMod/config/shop_config.py` | `from Script_NeteaseMod.modConfig import MOD_NAME` | âŒ `from modConfig import ...` |
| `Script_NeteaseMod/systems/XXXSystem.py` | `from Script_NeteaseMod.modConfig import MOD_NAME` | âŒ `from modConfig import ...` |
| `Script_NeteaseMod/presets/server/XXX.py` | `from Script_NeteaseMod.modConfig import MOD_NAME` | âŒ `from modConfig import ...` |

**å®é™…æ¡ˆä¾‹**ï¼ˆshop_config.pyä¿®å¤ï¼‰ï¼š

```python
# âŒ é”™è¯¯ - å¯¼è‡´ ImportError: No module named modConfig
# æ–‡ä»¶: Script_NeteaseMod/config/shop_config.py
from mod.common.minecraftEnum import ItemColor, EnchantType
import mod.server.extraServerApi as serverApi
from modConfig import MOD_NAME  # âŒ å­ç›®å½•ä¸­æ— æ³•æ‰¾åˆ°æ¨¡å—

# âœ… æ­£ç¡®
# æ–‡ä»¶: Script_NeteaseMod/config/shop_config.py
from mod.common.minecraftEnum import ItemColor, EnchantType
import mod.server.extraServerApi as serverApi
from Script_NeteaseMod.modConfig import MOD_NAME  # âœ… ä½¿ç”¨å®Œæ•´è·¯å¾„
```

#### è§„åˆ™2ï¼šAPIæ¨¡å—å¯ä»¥ä½¿ç”¨ `import ... as ...`

**è¿™äº›æ¨¡å—ä¸åŒ…å«`MOD_NAME`ï¼Œä¸ä¼šè¢«å¼•æ“è¯¯è¯†åˆ«**ï¼š

```python
# âœ… æ­£ç¡®
import mod.server.extraServerApi as serverApi
import mod.client.extraClientApi as clientApi
```

#### è§„åˆ™3ï¼šæ™®é€šæ¨¡å—ä¼˜å…ˆä½¿ç”¨ `from ... import ...`

```python
# âœ… æ¨è
from systems.MyGameSystem import MyGameSystem
from systems.DataManager import DataManager

# âš ï¸ å¯ç”¨ä½†ä¸æ¨èï¼ˆå¦‚æœæ¨¡å—åŒ…å«ç‰¹æ®Šå±æ€§å¯èƒ½æœ‰é£é™©ï¼‰
import systems.MyGameSystem
```

### é€šç”¨å¯¼å…¥å‡†åˆ™

| æ¨¡å—ç±»å‹ | æ–‡ä»¶ä½ç½® | æ­£ç¡®å¯¼å…¥æ–¹å¼ | é”™è¯¯å¯¼å…¥æ–¹å¼ |
|---------|---------|-------------|-------------|
| **é…ç½®æ¨¡å—**ï¼ˆæœ‰MOD_NAMEï¼‰ | modMain.pyåŒçº§ | `from modConfig import VAR` | âŒ `import modConfig` |
| **é…ç½®æ¨¡å—**ï¼ˆæœ‰MOD_NAMEï¼‰ | å­ç›®å½•ï¼ˆconfig/systems/presets/ï¼‰ | `from Script_NeteaseMod.modConfig import VAR` | âŒ `from modConfig import VAR` |
| **APIæ¨¡å—** | ä»»ä½•ä½ç½® | `import mod.server.extraServerApi as api` | âœ… å¯ç”¨ |
| **ç³»ç»Ÿæ¨¡å—** | ä»»ä½•ä½ç½® | `from systems.XXX import XXX` | âœ… æ¨è |

### æ’æŸ¥æ–¹æ³•

å¦‚æœé‡åˆ° `TypeError: 'module' object is not callable`ï¼š

#### æ­¥éª¤1ï¼šæ£€æŸ¥æ‰€æœ‰ `import` è¯­å¥

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
grep "^import [^.]" behavior_packs/behavior_pack_TSK85dvb/Script_NeteaseMod/modMain.py
```

#### æ­¥éª¤2ï¼šæŸ¥æ‰¾å¯¼å…¥çš„æ¨¡å—æ˜¯å¦æœ‰ `MOD_NAME`

```bash
# æ£€æŸ¥è¢«å¯¼å…¥æ¨¡å—
grep "MOD_NAME" behavior_packs/behavior_pack_TSK85dvb/Script_NeteaseMod/modConfig.py
```

#### æ­¥éª¤3ï¼šæ”¹ç”¨ `from ... import ...`

å°†æ‰€æœ‰é—®é¢˜å¯¼å…¥æ”¹ä¸ºï¼š
```python
from modConfig import MOD_NAME, MOD_VERSION, ...
```

### å®é™…æ¡ˆä¾‹

**é—®é¢˜ä»£ç **ï¼š
```python
# âŒ å¯¼è‡´TypeError
import modConfig

@Mod.Binding(name=modConfig.MOD_NAME, version=modConfig.MOD_VERSION)
class Script_NeteaseMod(object):
    @Mod.InitServer()
    def Script_NeteaseModServerInit(self):
        for system_name, system_path in modConfig.SERVER_SYSTEMS:
            serverApi.RegisterSystem(modConfig.MOD_NAME, system_name, system_path)
```

**ä¿®å¤åä»£ç **ï¼š
```python
# âœ… æ­£ç¡®
from modConfig import MOD_NAME, MOD_VERSION, SERVER_SYSTEMS

@Mod.Binding(name=MOD_NAME, version=MOD_VERSION)
class Script_NeteaseMod(object):
    @Mod.InitServer()
    def Script_NeteaseModServerInit(self):
        for system_name, system_path in SERVER_SYSTEMS:
            serverApi.RegisterSystem(MOD_NAME, system_name, system_path)
```

### ç›¸å…³å¼•æ“æºç 

å‚è€ƒï¼š`D:\EcWork\3.5\mod\common\minecraftMod.py` çš„ `ImportModMain` å‡½æ•°

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## 4. å‘½åè§„èŒƒ

### ç±»åï¼šPascalCase

```python
# âœ… æ­£ç¡®
class MyGameSystem(ServerSystem):
    pass

class DataManager(object):
    pass

# âŒ é”™è¯¯
class mygameSystem(ServerSystem):  # é¦–å­—æ¯åº”å¤§å†™
    pass

class data_manager(object):  # åº”ä½¿ç”¨PascalCase
    pass
```

### æ–¹æ³•/å‡½æ•°åï¼šsnake_case

```python
# âœ… æ­£ç¡®
def on_enter(self):
    pass

def register_sub_state(self, name, state_class):
    pass

def get_player_team_id(self, player_id):
    pass

# âŒ é”™è¯¯
def OnEnter(self):  # åº”ä½¿ç”¨snake_case
    pass

def RegisterSubState(self, name, state_class):  # åº”ä½¿ç”¨snake_case
    pass
```

### å¸¸é‡ï¼šUPPER_SNAKE_CASE

```python
# âœ… æ­£ç¡®
MOD_NAME = "Script_NeteaseMod"
MOD_VERSION = "1.0.0"
MAX_PLAYERS_PER_TEAM = 4
DEFAULT_TIMEOUT_SECONDS = 10

# âŒ é”™è¯¯
modName = "Script_NeteaseMod"  # åº”å…¨å¤§å†™
maxPlayersPerTeam = 4  # åº”å…¨å¤§å†™+ä¸‹åˆ’çº¿
```

### é¢„è®¾ç±»å‹ï¼šnamespace:type

```python
# âœ… æ­£ç¡®
"bedwars:bed"
"bedwars:generator"
"bedwars:shop"
"bedwars:spawn"

# âŒ é”™è¯¯
"BedwarsPresetBed"  # åº”ä½¿ç”¨namespace:typeæ ¼å¼
"bedwars_shop"  # åº”ä½¿ç”¨å†’å·åˆ†éš”
```

### ç§æœ‰æˆå‘˜ï¼šå•ä¸‹åˆ’çº¿å‰ç¼€

```python
# âœ… æ­£ç¡®
class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        self._created = False  # ç§æœ‰æˆå‘˜
        self._internal_state = {}

    def _internal_method(self):  # ç§æœ‰æ–¹æ³•
        pass

# âš ï¸ æ³¨æ„ï¼šPythonä¸å¼ºåˆ¶ç§æœ‰ï¼Œä½†çº¦å®šä¿—æˆä½¿ç”¨å•ä¸‹åˆ’çº¿
```

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## 5. æ–‡ä»¶ç»„ç»‡

### æ¨¡å—æ–‡ä»¶ç»“æ„

æ¯ä¸ªPythonæ–‡ä»¶åº”éµå¾ªä»¥ä¸‹ç»“æ„ï¼š

```python
# -*- coding: utf-8 -*-
"""
æ¨¡å—åç§°å’Œç®€è¦è¯´æ˜

è¯¦ç»†è¯´æ˜ï¼ˆå¯é€‰ï¼‰ï¼š
- åŠŸèƒ½1
- åŠŸèƒ½2

é‡æ„è¯´æ˜ï¼ˆå¦‚é€‚ç”¨ï¼‰ï¼š
ä»è€é¡¹ç›®XXXPartè¿ç§»åˆ°æ–°é¡¹ç›®XXXSystem
"""

# 1. æ ‡å‡†åº“å¯¼å…¥
from __future__ import print_function

# 2. ç½‘æ˜“å¼•æ“å¯¼å…¥
import mod.server.extraServerApi as serverApi

# 3. ç¬¬ä¸‰æ–¹åº“å¯¼å…¥ï¼ˆå¦‚æœ‰ï¼‰
# import third_party_lib

# 4. é¡¹ç›®å†…éƒ¨å¯¼å…¥
from systems.state.GamingState import GamingState
from modConfig import MOD_NAME

# 5. ç±»å‹æ³¨è§£ï¼ˆæ³¨é‡Šå½¢å¼ï¼‰
# type: (str) -> bool

# 6. å¸¸é‡å®šä¹‰
DEFAULT_RADIUS = 5.0

# 7. ç±»å®šä¹‰
class MyClass(object):
    pass

# 8. å‡½æ•°å®šä¹‰
def my_function():
    pass
```

### ç›®å½•ç»„ç»‡è§„åˆ™

- **ç³»ç»Ÿæ–‡ä»¶**ï¼š`systems/XXXSystem.py`
- **çŠ¶æ€æ–‡ä»¶**ï¼š`systems/state/XXXState.py` æˆ– `systems/bedwars_states/XXXState.py`
- **é¢„è®¾æœåŠ¡ç«¯**ï¼š`presets/server/XXXPresetDefServer.py`
- **é¢„è®¾å®¢æˆ·ç«¯**ï¼š`presets/client/XXXPresetDefClient.py`
- **å·¥å…·ç±»**ï¼š`systems/util/XXXHelper.py`
- **é…ç½®æ–‡ä»¶**ï¼š`config/XXX.py`

### __init__.pyæ–‡ä»¶

æ¯ä¸ªPythonåŒ…ç›®å½•å¿…é¡»åŒ…å«`__init__.py`ï¼š

```python
# -*- coding: utf-8 -*-
"""
åŒ…è¯´æ˜
"""

# å¯ä»¥ä¸ºç©ºï¼Œæˆ–å¯¼å‡ºå¸¸ç”¨ç±»/å‡½æ•°
from .MyClass import MyClass
from .my_function import my_function

__all__ = ['MyClass', 'my_function']
```

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## 6. äº‹ä»¶ç³»ç»Ÿ

### æ³¨å†Œå¼•æ“äº‹ä»¶

```python
# âœ… æ­£ç¡®
def Create(self):
    self.ListenForEvent(
        "ServerPlayerJoinEvent",   # äº‹ä»¶å
        "Minecraft",                # å‘½åç©ºé—´
        self.OnPlayerJoin           # å›è°ƒå‡½æ•°
    )

def OnPlayerJoin(self, args):
    player_id = args.get("id")
    print("ç©å®¶åŠ å…¥:", player_id)
```

### åœ¨çŠ¶æ€å†…ç›‘å¬äº‹ä»¶

```python
# âœ… æ­£ç¡® - è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
class MyState(GamingState):
    def on_enter(self):
        self.listen_event(
            "ServerPlayerJoinEvent",
            self.on_player_join
        )
        # çŠ¶æ€é€€å‡ºæ—¶ä¼šè‡ªåŠ¨å–æ¶ˆç›‘å¬

    def on_player_join(self, args):
        player_id = args.get("id")
        print("State: ç©å®¶åŠ å…¥", player_id)
```

### å‘é€å®¢æˆ·ç«¯äº‹ä»¶

```python
# âœ… å•ä¸ªç©å®¶
self.NotifyToClient(player_id, "CustomClientEvent", {"key": "value"})

# âœ… æ‰€æœ‰ç©å®¶
self.BroadcastToAllClient("CustomClientEvent", {"key": "value"})

# âœ… æŒ‡å®šç»´åº¦çš„æ‰€æœ‰ç©å®¶
self.BroadcastToAllClient("CustomClientEvent", {"key": "value"}, dimensionId=0)
```

### äº‹ä»¶å›è°ƒå‘½å

```python
# âœ… æ­£ç¡® - ä½¿ç”¨Onå‰ç¼€
def OnPlayerJoin(self, args):
    pass

def OnPlayerDie(self, args):
    pass

# âŒ é”™è¯¯ - å‘½åä¸æ¸…æ™°
def handle_join(self, args):  # åº”ä½¿ç”¨Onå‰ç¼€
    pass

def player_die_handler(self, args):  # åº”ä½¿ç”¨Onå‰ç¼€
    pass
```

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## 7. æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. é¿å…åœ¨Update()ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ

```python
# âœ… æ­£ç¡® - ä½¿ç”¨è®¡æ•°å™¨é™ä½é¢‘ç‡
class MyState(GamingState):
    def __init__(self, system_context):
        super(MyState, self).__init__(system_context)
        self.tick_counter = 0

    def on_tick(self):
        self.tick_counter += 1

        # æ¯20 tickï¼ˆ1ç§’ï¼‰æ‰§è¡Œä¸€æ¬¡
        if self.tick_counter % 20 == 0:
            self.update_expensive_calculation()

# âŒ é”™è¯¯ - æ¯tickéƒ½æ‰§è¡Œè€—æ—¶æ“ä½œ
class MyState(GamingState):
    def on_tick(self):
        # æ¯tickéƒ½æŸ¥è¯¢æ•°æ®åº“ã€è®¡ç®—å¤æ‚é€»è¾‘ç­‰
        self.query_database()
        self.complex_calculation()
```

### 2. åŠæ—¶å–æ¶ˆäº‹ä»¶ç›‘å¬

```python
# âœ… æ­£ç¡® - åœ¨Destroyä¸­å–æ¶ˆç›‘å¬
def Create(self):
    self.ListenForEvent("SomeEvent", "Minecraft", self.handler)

def Destroy(self):
    self.UnListenForEvent("SomeEvent", "Minecraft", self.handler)
```

### 3. ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®

```python
# âœ… æ­£ç¡® - ä½¿ç”¨æˆå‘˜å˜é‡ç¼“å­˜
class MySystem(ServerSystem):
    def __init__(self, namespace, systemName):
        super(MySystem, self).__init__(namespace, systemName)
        self.player_cache = {}  # ç¼“å­˜ç©å®¶æ•°æ®

    def get_player_team(self, player_id):
        if player_id in self.player_cache:
            return self.player_cache[player_id]

        team = self._query_player_team(player_id)
        self.player_cache[player_id] = team
        return team

# âŒ é”™è¯¯ - æ¯æ¬¡éƒ½æŸ¥è¯¢
class MySystem(ServerSystem):
    def get_player_team(self, player_id):
        return self._query_player_team(player_id)  # æ¯æ¬¡éƒ½æŸ¥è¯¢ï¼Œæ€§èƒ½å·®
```

### 4. æ‰¹é‡æ“ä½œ

```python
# âœ… æ­£ç¡® - æ‰¹é‡å¤„ç†
def update_all_players_hud(self, message):
    for player_id in self.get_all_players():
        self.NotifyToClient(player_id, "UpdateHUD", {"msg": message})

# âŒ é”™è¯¯ - ä¸€æ¬¡ä¸€ä¸ªï¼ˆå¦‚æœå¯ä»¥æ‰¹é‡ï¼‰
def update_player_hud(self, player_id, message):
    self.NotifyToClient(player_id, "UpdateHUD", {"msg": message})
    # ç„¶ååœ¨å¤–éƒ¨å¾ªç¯è°ƒç”¨æ­¤æ–¹æ³•
```

### 5. æ—¥å¿—æ§åˆ¶

```python
# âœ… æ­£ç¡® - ä½¿ç”¨æ—¥å¿—çº§åˆ«
DEBUG = True

def on_player_join(self, player_id):
    if DEBUG:
        print("[DEBUG] ç©å®¶åŠ å…¥:", player_id)

    # æ ¸å¿ƒé€»è¾‘...

# âŒ é”™è¯¯ - ç”Ÿäº§ç¯å¢ƒå¤§é‡æ—¥å¿—
def on_player_join(self, player_id):
    print("ç©å®¶åŠ å…¥:", player_id)
    print("å½“å‰ç©å®¶åˆ—è¡¨:", self.players)
    print("å½“å‰çŠ¶æ€:", self.current_state)
    # å¤§é‡æ—¥å¿—å½±å“æ€§èƒ½
```

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## 8. ç½‘æ˜“å¼•æ“é™åˆ¶

### 1. Pythonç‰ˆæœ¬

- âœ… **å¿…é¡»å…¼å®¹Python 2.7**
- âŒ ä¸èƒ½ä½¿ç”¨Python 3ä¸“æœ‰ç‰¹æ€§

### 2. å®ä½“æ ‡è¯†ç¬¦

- âœ… å®ä½“ç±»å‹åç§°å»ºè®®ä¸è¶…è¿‡32å­—ç¬¦
- âœ… ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼š`ecbedwars_entity_bed`

### 3. ç»´åº¦ç®¡ç†

- âœ… ç»´åº¦IDå¿…é¡»æ˜¯æ•´æ•°
- âœ… æ¨èä½¿ç”¨10000ä»¥ä¸Šçš„IDé¿å…å†²çª
- âœ… ä¸»ä¸–ç•Œï¼š0ï¼Œåœ°ç‹±ï¼š1ï¼Œæœ«åœ°ï¼š2

### 4. äº‹ä»¶ç³»ç»Ÿ

- âœ… è‡ªå®šä¹‰äº‹ä»¶åç§°å»ºè®®ä½¿ç”¨é©¼å³°å‘½åï¼š`TeamResourceUpdateEvent`
- âœ… äº‹ä»¶æ•°æ®å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼ˆå­—å…¸ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€æ•°å­—ï¼‰
- âŒ ä¸èƒ½ä¼ é€’å¯¹è±¡å®ä¾‹

### 5. ç»„ä»¶é™åˆ¶

- âš ï¸ æŸäº›ç»„ä»¶åœ¨ç‰¹å®šç»´åº¦æˆ–æ¸¸æˆæ¨¡å¼ä¸‹å¯èƒ½ä¸å¯ç”¨
- âš ï¸ å®¢æˆ·ç«¯ç»„ä»¶ä¸èƒ½åœ¨æœåŠ¡ç«¯ä½¿ç”¨ï¼Œåä¹‹äº¦ç„¶

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®è®¤ï¼š

### Python 2.7å…¼å®¹æ€§
- [ ] æ–‡ä»¶å¼€å¤´æœ‰ `# -*- coding: utf-8 -*-`
- [ ] å¯¼å…¥äº† `from __future__ import print_function`
- [ ] ä½¿ç”¨ `.format()` è€Œé f-strings
- [ ] ç±»å‹æ³¨è§£ä½¿ç”¨æ³¨é‡Šå½¢å¼

### Systemç”Ÿå‘½å‘¨æœŸ
- [ ] åœ¨ `__init__` ä¸­æ‰‹åŠ¨è°ƒç”¨äº† `self.Create()`
- [ ] `Create()` ä¸­åŒ…å«åˆå§‹åŒ–é€»è¾‘
- [ ] `Destroy()` ä¸­åŒ…å«æ¸…ç†é€»è¾‘

### æ¨¡å—å¯¼å…¥
- [ ] é…ç½®æ¨¡å—ä½¿ç”¨ `from ... import ...`
- [ ] æ²¡æœ‰ä½¿ç”¨ `import modConfig`
- [ ] **å­ç›®å½•æ–‡ä»¶ä½¿ç”¨ `from Script_NeteaseMod.modConfig import ...`** âš ï¸ NEW
- [ ] **modMain.pyåŒçº§æ–‡ä»¶ä½¿ç”¨ `from modConfig import ...`**

### å‘½åè§„èŒƒ
- [ ] ç±»åä½¿ç”¨PascalCase
- [ ] æ–¹æ³•åä½¿ç”¨snake_case
- [ ] å¸¸é‡ä½¿ç”¨UPPER_SNAKE_CASE

### æ–‡ä»¶ç»„ç»‡
- [ ] æ–‡ä»¶æœ‰æ–‡æ¡£å­—ç¬¦ä¸²è¯´æ˜
- [ ] å¯¼å…¥é¡ºåºæ­£ç¡®
- [ ] ç›®å½•æœ‰ `__init__.py`

### çŠ¶æ€æœº
- [ ] çŠ¶æ€åªåŒ…å«è¯¥çŠ¶æ€çš„é€»è¾‘
- [ ] ä½¿ç”¨ `switch_to_sub_state()` åˆ‡æ¢
- [ ] ä½¿ç”¨ `listen_event()` ç›‘å¬äº‹ä»¶

### æ€§èƒ½
- [ ] `on_tick()` ä¸­é¿å…è€—æ—¶æ“ä½œ
- [ ] åŠæ—¶å–æ¶ˆäº‹ä»¶ç›‘å¬
- [ ] ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®

[â¬†ï¸ è¿”å›ç›®å½•](#ç›®å½•)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### å­¦ä¹ è·¯å¾„
- **ä¸Šä¸€ç¯‡**: [å¿«é€Ÿå¼€å§‹](./å¿«é€Ÿå¼€å§‹.md) ğŸš€
- **å½“å‰**: å¼€å‘è§„èŒƒ ğŸ“
- **ä¸‹ä¸€ç¯‡**: [å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md) ğŸ“–

### å¿…è¯»æ–‡æ¡£
- [é—®é¢˜æ’æŸ¥](./é—®é¢˜æ’æŸ¥.md) - è¿åè§„èŒƒæ—¶æŸ¥çœ‹
- [è¿ç§»æŒ‡å—](./è¿ç§»æŒ‡å—.md) - æ¶æ„å¯¹æ¯”
- [CLAUDE.md](../CLAUDE.md) - æ ¸å¿ƒæ¶æ„å‚è€ƒ

---

## ğŸ”— å¿«é€Ÿé“¾æ¥

| æ ¸å¿ƒè§„èŒƒ | å¼€å‘æŒ‡å— | å‚è€ƒèµ„æ–™ |
|---------|---------|---------|
| [ğŸ  é¦–é¡µ](../README.md) | [ğŸ“– å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md) | [ğŸ—ï¸ æ¶æ„æ–‡æ¡£](../CLAUDE.md) |
| [ğŸš€ å¿«é€Ÿå¼€å§‹](./å¿«é€Ÿå¼€å§‹.md) | [ğŸ”§ é—®é¢˜æ’æŸ¥](./é—®é¢˜æ’æŸ¥.md) | [ğŸ“Š é¡¹ç›®çŠ¶æ€](./é¡¹ç›®çŠ¶æ€.md) |

---

**[â¬†ï¸ è¿”å›é¡¶éƒ¨](#å¼€å‘è§„èŒƒ)** | **[ğŸ  è¿”å›é¦–é¡µ](../README.md)** | **[â¡ï¸ ä¸‹ä¸€ç¯‡: å¼€å‘æŒ‡å—](./å¼€å‘æŒ‡å—.md)**

---

_æœ€åæ›´æ–°: 2025-01-29 | æ–‡æ¡£ç‰ˆæœ¬: 2.0_

---

**è®°ä½**ï¼šéµå¾ªè¿™äº›è§„èŒƒå¯ä»¥é¿å…90%çš„å¸¸è§é”™è¯¯ï¼
