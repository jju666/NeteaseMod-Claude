# äº‹ä»¶ç³»ç»Ÿå®Œæ•´å‚è€ƒ

> ğŸ“¡ **æ·±å…¥ç†è§£MODSDKäº‹ä»¶é©±åŠ¨æ¶æ„**
>
> æœ¬æ–‡æ¡£è¯¦ç»†è®²è§£MODSDKäº‹ä»¶ç³»ç»Ÿçš„å·¥ä½œåŸç†ã€æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥
>
> **ç‰ˆæœ¬**: v1.0
> **æœ€åæ›´æ–°**: 2025-11-11

---

## ç›®å½•

1. [äº‹ä»¶ç³»ç»Ÿæ¦‚è¿°](#ä¸€äº‹ä»¶ç³»ç»Ÿæ¦‚è¿°)
2. [äº‹ä»¶ç±»å‹åˆ†ç±»](#äºŒäº‹ä»¶ç±»å‹åˆ†ç±»)
3. [äº‹ä»¶ç›‘å¬ä¸é€šçŸ¥](#ä¸‰äº‹ä»¶ç›‘å¬ä¸é€šçŸ¥)
4. [äº‹ä»¶ä¼˜å…ˆçº§æœºåˆ¶](#å››äº‹ä»¶ä¼˜å…ˆçº§æœºåˆ¶)
5. [äº‹ä»¶æ•°æ®è§„èŒƒ](#äº”äº‹ä»¶æ•°æ®è§„èŒƒ)
6. [ç½‘ç»œäº‹ä»¶ä¼˜åŒ–](#å…­ç½‘ç»œäº‹ä»¶ä¼˜åŒ–)
7. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#ä¸ƒæ€§èƒ½ä¼˜åŒ–å»ºè®®)
8. [å¸¸è§é”™è¯¯ä¸é™·é˜±](#å…«å¸¸è§é”™è¯¯ä¸é™·é˜±)
9. [æœ€ä½³å®è·µæ¸…å•](#ä¹æœ€ä½³å®è·µæ¸…å•)

---

## ä¸€ã€äº‹ä»¶ç³»ç»Ÿæ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯äº‹ä»¶ç³»ç»Ÿ?

MODSDKé‡‡ç”¨**äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼ˆEvent-Driven Architectureï¼‰ï¼Œé€šè¿‡å‘å¸ƒ-è®¢é˜…æ¨¡å¼å®ç°æ¨¡å—é—´çš„æ¾è€¦åˆé€šä¿¡ã€‚

**æ ¸å¿ƒç»„ä»¶**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ListenForEvent      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   System A  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ Event Managerâ”‚
â”‚  (è®¢é˜…è€…)   â”‚                          â”‚  (äº‹ä»¶ç®¡ç†å™¨) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚ åˆ†å‘äº‹ä»¶
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     NotifyToServer      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   System B  â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Event Managerâ”‚
â”‚  (å¤„ç†å™¨)   â”‚                          â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆä½¿ç”¨äº‹ä»¶ç³»ç»Ÿ?**

1. **è§£è€¦æ¨¡å—**: Systemä¹‹é—´ä¸éœ€è¦ç›´æ¥å¼•ç”¨,é€šè¿‡äº‹ä»¶é€šä¿¡
2. **æ‰©å±•æ€§**: æ·»åŠ æ–°ç›‘å¬å™¨æ— éœ€ä¿®æ”¹å‘é€æ–¹ä»£ç 
3. **è·¨ç«¯é€šä¿¡**: é€šè¿‡`NotifyToServer`/`NotifyToClient`å®ç°åŒç«¯äº¤äº’
4. **å¼‚æ­¥å¤„ç†**: äº‹ä»¶å¤„ç†ä¸é˜»å¡æ¸¸æˆä¸»å¾ªç¯

---

### 1.2 äº‹ä»¶ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯"
        ClientSystem[ClientSystem] -->|ListenForEvent| ClientEventMgr[Client Event Manager]
        ClientEventMgr -->|NotifyToServer| Network
    end

    subgraph "æœåŠ¡å™¨"
        ServerSystem[ServerSystem] -->|ListenForEvent| ServerEventMgr[Server Event Manager]
        ServerEventMgr -->|NotifyToClient| Network
    end

    Network -->|ç½‘ç»œä¼ è¾“| ClientEventMgr
    Network -->|ç½‘ç»œä¼ è¾“| ServerEventMgr

    style Network fill:#f9f,stroke:#333
```

---

## äºŒã€äº‹ä»¶ç±»å‹åˆ†ç±»

### 2.1 ä¸‰å¤§äº‹ä»¶ç±»å‹

| ç±»å‹ | è§¦å‘æ–¹å¼ | æ€§èƒ½ | å¸¸è§åœºæ™¯ |
|------|---------|------|---------|
| **å¼•æ“äº‹ä»¶** | è‡ªåŠ¨è§¦å‘ | é«˜æ•ˆ | `AddPlayerCreatedEvent`, `DamageEvent` |
| **è‡ªå®šä¹‰äº‹ä»¶** | æ‰‹åŠ¨Notify | ä¸­ç­‰ | `Shop_BuyItemEvent`, `Quest_CompleteEvent` |
| **åŒç«¯é€šä¿¡äº‹ä»¶** | NotifyToServer/Client | ç½‘ç»œå¼€é”€ | å®¢æˆ·ç«¯â†’æœåŠ¡å™¨è¯·æ±‚ |

### 2.2 äº‹ä»¶å‘½åè§„èŒƒ

```
{æ¨¡å—}_{æ“ä½œ}Event

âœ… æ­£ç¡®: Shop_BuyItemEvent, VIP_LevelUpEvent
âŒ é”™è¯¯: buyItem (ç¼ºå°‘æ¨¡å—), shop:buy (ç‰¹æ®Šå­—ç¬¦)
```

### 2.3 åŒç«¯é€šä¿¡API

| API | æ–¹å‘ | ç”¨é€” |
|-----|------|------|
| `NotifyToServer(event, data)` | å®¢æˆ·ç«¯â†’æœåŠ¡å™¨ | å‘é€UIæ“ä½œ |
| `NotifyToClient(playerId, event, data)` | æœåŠ¡å™¨â†’å®¢æˆ·ç«¯ | æ›´æ–°ç©å®¶UI |
| `BroadcastToAllClient(event, data)` | æœåŠ¡å™¨â†’æ‰€æœ‰å®¢æˆ·ç«¯ | å…¨å±€å¹¿æ’­ |

**ä¼ªä»£ç æµç¨‹**:
```python
# å®¢æˆ·ç«¯
OnClickBuy(itemId):
    NotifyToServer('Shop_RequestBuyEvent', {itemId})

# æœåŠ¡å™¨
OnBuyRequest(args):
    if CheckMoney(playerId, itemId):
        DeductMoney(); GiveItem()
        NotifyToClient(playerId, 'Shop_BuySuccessEvent', {})
    else:
        NotifyToClient(playerId, 'Shop_BuyFailedEvent', {reason})
```

---

## ä¸‰ã€äº‹ä»¶ç›‘å¬ä¸é€šçŸ¥

### 3.1 ListenForEvent API

```python
ListenForEvent(namespace, systemName, eventName, self, callback, priorityLevel=0)
```

| å‚æ•° | è¯´æ˜ | æ³¨æ„äº‹é¡¹ |
|------|------|---------|
| `namespace` | å‘½åç©ºé—´ | å¼•æ“äº‹ä»¶ç”¨`GetEngineNamespace()` |
| `priorityLevel` | ä¼˜å…ˆçº§(0-10) | âš ï¸ **å¼•æ“äº‹ä»¶ä¸æ”¯æŒæ­¤å‚æ•°** |

**å–æ¶ˆç›‘å¬**:
```python
def Destroy(self):
    self.UnListenAllEvents()  # æ¨èä½¿ç”¨
```

---

## å››ã€äº‹ä»¶ä¼˜å…ˆçº§æœºåˆ¶

**ä¼˜å…ˆçº§èŒƒå›´**: 0-10 (æ•°å­—è¶Šå¤§,ä¼˜å…ˆçº§è¶Šé«˜)

| ä¼˜å…ˆçº§ | ä½¿ç”¨åœºæ™¯ | æ‰§è¡Œé¡ºåº |
|--------|---------|---------|
| **10** | æƒé™éªŒè¯ã€åä½œå¼Š | æœ€å…ˆæ‰§è¡Œ |
| **5-7** | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ | ä¸­é—´æ‰§è¡Œ |
| **0-2** | æ—¥å¿—ã€UIæ›´æ–° | æœ€åæ‰§è¡Œ |

**ä¼ªä»£ç ç¤ºä¾‹**:
```python
# ä¼˜å…ˆçº§10: æƒé™éªŒè¯
ListenForEvent(..., CheckPermission, priorityLevel=10)

# ä¼˜å…ˆçº§5: ä¸šåŠ¡é€»è¾‘
ListenForEvent(..., ProcessBuy, priorityLevel=5)

# ä¼˜å…ˆçº§0: æ—¥å¿—è®°å½•
ListenForEvent(..., LogPurchase, priorityLevel=0)
```

---

## äº”ã€äº‹ä»¶æ•°æ®è§„èŒƒ

### 5.1 æ•°æ®ç±»å‹è¦æ±‚

| ç±»å‹ | æ”¯æŒ | è¯´æ˜ |
|------|------|------|
| `int`, `float`, `bool`, `str`, `None` | âœ… | åŸºç¡€ç±»å‹ |
| `list`, `dict` | âœ… | å®¹å™¨ç±»å‹ |
| `tuple`, `set` | âŒ | åºåˆ—åŒ–å¤±è´¥ |
| è‡ªå®šä¹‰å¯¹è±¡/å‡½æ•° | âŒ | æ— æ³•åºåˆ—åŒ– |

---

### 5.2 æ•°æ®å¤§å°ä¸æ€§èƒ½

**é™åˆ¶**: å•ä¸ªäº‹ä»¶<64KBï¼ˆæ¨è<10KBï¼‰

| æ•°æ®å¤§å° | ç½‘ç»œå»¶è¿Ÿ | å»ºè®® |
|---------|---------|------|
| <1KB | ~5ms | âœ… æ¨è |
| 1-10KB | ~15ms | âš ï¸ å¯æ¥å— |
| >10KB | >50ms | âŒ é¿å… |

**ä¼˜åŒ–åŸåˆ™**: åªä¼ å¿…è¦æ•°æ® + åˆ†é¡µ

```python
# âŒ é”™è¯¯: ä¼ 100ä¸ªå®Œæ•´ç©å®¶å¯¹è±¡
eventData = {'players': [å®Œæ•´å¯¹è±¡ Ã— 100]}

# âœ… æ­£ç¡®: Top10 + åªä¼ IDå’Œåˆ†æ•°
eventData = {'top10': [{'id': xxx, 'score': xxx}], 'page': 1}
```

---

## å…­ã€ç½‘ç»œäº‹ä»¶ä¼˜åŒ–

### 6.1 äº‹ä»¶å‹ç¼©ï¼ˆå¼•æ“è‡ªåŠ¨ï¼‰

MODSDKè‡ªåŠ¨å°†äº‹ä»¶åå‹ç¼©ä¸ºç´¢å¼•ï¼ˆ40å­—èŠ‚ â†’ 2å­—èŠ‚ï¼Œ**95%æµé‡èŠ‚çœ**ï¼‰ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒã€‚

---

### 6.2 æ‰¹é‡å¹¿æ’­ä¼˜åŒ–

| æ–¹å¼ | æ€§èƒ½ï¼ˆ100ç©å®¶ï¼‰ | æ¨è |
|------|----------------|------|
| `for playerId: NotifyToClient()` | 100æ¬¡åºåˆ—åŒ– â‰ˆ 100ms | âŒ |
| `BroadcastToAllClient()` | 1æ¬¡åºåˆ—åŒ– â‰ˆ 1ms | âœ… |

```python
# âœ… æ¨è: ä½¿ç”¨å¹¿æ’­API
self.BroadcastToAllClient('MyEvent', eventData)
```

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–æŠ€å·§

| ä¼˜åŒ–ç‚¹ | é—®é¢˜ | è§£å†³æ–¹æ¡ˆ | æ•ˆæœ |
|-------|------|---------|------|
| **äº‹ä»¶é¢‘ç‡** | é«˜é¢‘äº‹ä»¶ï¼ˆ60fpsï¼‰ | èŠ‚æµï¼ˆæ¯20å¸§å‘1æ¬¡ï¼‰ | èŠ‚çœ95%æµé‡ |
| **ç›‘å¬å™¨æ•°é‡** | è¿‡å¤šç›‘å¬å™¨ | å•äº‹ä»¶<20ä¸ªï¼ŒSystemæ€»æ•°<50ä¸ª | æå‡å“åº”é€Ÿåº¦ |
| **äº‹ä»¶å¾ªç¯** | Aè§¦å‘Bï¼ŒBè§¦å‘A | é˜²é‡å…¥æ ‡å¿— `is_processing` | é¿å…æ­»å¾ªç¯ |
| **æ‰¹é‡é€šçŸ¥** | é€ä¸ªå‘é€ | ä½¿ç”¨ `BroadcastToAllClient` | 100å€æ€§èƒ½æå‡ |

**èŠ‚æµä¼ªä»£ç **:
```python
# æ¯20å¸§ï¼ˆçº¦0.33ç§’ï¼‰å‘é€ä¸€æ¬¡
if self.tick_counter % 20 == 0:
    self.NotifyToServer('PositionEvent', data)
```

---

## å…«ã€å¸¸è§é”™è¯¯é€ŸæŸ¥è¡¨

| é”™è¯¯ | åæœ | æ­£ç¡®åšæ³• |
|------|------|---------|
| å¼•æ“äº‹ä»¶ä¼  `priorityLevel` | å‚æ•°æ— æ•ˆ | å¼•æ“äº‹ä»¶ä¸ä¼  `priorityLevel` å‚æ•° |
| å¿˜è®°å–æ¶ˆç›‘å¬ | å†…å­˜æ³„æ¼ | `Destroy()` ä¸­è°ƒç”¨ `UnListenAllEvents()` |
| å›è°ƒä¸­æŠ›å¼‚å¸¸ | åç»­ç›‘å¬å™¨ä¸­æ–­ | ä½¿ç”¨ `try-except` + `args.get()` å®‰å…¨è·å–æ•°æ® |
| EventDataä½¿ç”¨tuple | åºåˆ—åŒ–å¤±è´¥ | ä½¿ç”¨ `list` ä»£æ›¿ `tuple` |
| é«˜é¢‘äº‹ä»¶æœªèŠ‚æµ | ç½‘ç»œæ‹¥å¡ | ä½¿ç”¨ `tick_counter % N` èŠ‚æµ |

---

## ä¹ã€æœ€ä½³å®è·µæ¸…å•

**âœ… ç›‘å¬è§„èŒƒ**:
- [ ] ä½¿ç”¨æ˜ç¡®çš„å‘½åç©ºé—´ï¼ˆé¿å…å†²çªï¼‰
- [ ] å¼•æ“äº‹ä»¶ä¸ä¼  `priorityLevel`
- [ ] `Destroy()` ä¸­å–æ¶ˆæ‰€æœ‰ç›‘å¬

**âœ… é€šçŸ¥è§„èŒƒ**:
- [ ] äº‹ä»¶æ•°æ®<10KB
- [ ] é¿å…ä¼ è¾“ `tuple`/`set`/è‡ªå®šä¹‰å¯¹è±¡
- [ ] æ‰¹é‡é€šçŸ¥ä½¿ç”¨ `BroadcastToAllClient`

**âœ… åŒç«¯éš”ç¦»**:
- [ ] å®¢æˆ·ç«¯åªè´Ÿè´£UIï¼Œä¸šåŠ¡é€»è¾‘åœ¨æœåŠ¡å™¨
- [ ] æœåŠ¡å™¨éªŒè¯æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆé˜²ä½œå¼Šï¼‰

**âœ… æ€§èƒ½ä¼˜åŒ–**:
- [ ] é«˜é¢‘äº‹ä»¶ï¼ˆ>10æ¬¡/ç§’ï¼‰ä½¿ç”¨èŠ‚æµ
- [ ] å•äº‹ä»¶ç›‘å¬å™¨<20ä¸ªï¼ŒSystemæ€»æ•°<50ä¸ª
- [ ] é¿å…äº‹ä»¶å¾ªç¯ï¼ˆé˜²é‡å…¥æ ‡å¿—ï¼‰

---

## åã€å‚è€ƒèµ„æº

### å®˜æ–¹æ–‡æ¡£
- **MODSDKäº‹ä»¶API**: å‚è€ƒ`.claude/docs/modsdk-wiki/`ï¼ˆæœ¬åœ°ç¦»çº¿æ–‡æ¡£ï¼‰
- **åŸºå²©ç‰ˆWIKI**: å‚è€ƒ`.claude/docs/bedrock-wiki/`

### ç›¸å…³å·¥ä½œæµæ–‡æ¡£
- **å¼€å‘è§„èŒƒ.md**: åŒç«¯éš”ç¦»ã€Systemè®¾è®¡è§„èŒƒ
- **é—®é¢˜æ’æŸ¥.md**: äº‹ä»¶ç›¸å…³å¸¸è§é—®é¢˜
- **æ·±å…¥ç†è§£ECSæ¶æ„.md**: ECSä¸äº‹ä»¶ç³»ç»Ÿçš„å…³ç³»

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-11
**ç»´æŠ¤è€…**: NeteaseMod-Claudeå·¥ä½œæµ
