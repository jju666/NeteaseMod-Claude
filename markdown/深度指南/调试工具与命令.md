# è°ƒè¯•å·¥å…·ä¸å‘½ä»¤

> **ğŸ“ å¯¼èˆª**: [ğŸ  é¦–é¡µ](../README.md) > [ğŸ“‚ æ–‡æ¡£](../README.md#æ–‡æ¡£å¯¼èˆª) > è°ƒè¯•å·¥å…·ä¸å‘½ä»¤
>
> **æ–‡æ¡£è¯´æ˜**: MODSDKè°ƒè¯•æŠ€å·§ã€å·¥å…·å’Œå‘½ä»¤é€ŸæŸ¥
>
> **ğŸ“… æœ€åæ›´æ–°**: 2025-01-11 | **æ–‡æ¡£ç‰ˆæœ¬**: 2.0ï¼ˆç²¾ç®€ç‰ˆï¼‰

---

## ğŸ“‹ ç›®å½•

1. [è°ƒè¯•æ¦‚è¿°](#1-è°ƒè¯•æ¦‚è¿°)
2. [æ—¥å¿—ç³»ç»Ÿ](#2-æ—¥å¿—ç³»ç»Ÿ)
3. [Minecraftå‘½ä»¤](#3-minecraftå‘½ä»¤)
4. [æ€§èƒ½åˆ†æ](#4-æ€§èƒ½åˆ†æ)
5. [è°ƒè¯•å·¥å…·](#5-è°ƒè¯•å·¥å…·)
6. [å¸¸è§é—®é¢˜FAQ](#6-å¸¸è§é—®é¢˜faq)

---

## 1. è°ƒè¯•æ¦‚è¿°

### 1.1 è°ƒè¯•å·¥å…·åˆ†ç±»

| å·¥å…·ç±»å‹ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|---------|---------|-------|
| **æ—¥å¿—è¾“å‡º** | è¿½è¸ªä»£ç æ‰§è¡Œæµç¨‹ | ğŸ¥‡ å¿…å¤‡ |
| **Minecraftå‘½ä»¤** | æŸ¥çœ‹æ¸¸æˆçŠ¶æ€ã€å®ä½“ä¿¡æ¯ | ğŸ¥‡ å¿…å¤‡ |
| **è‡ªå®šä¹‰è°ƒè¯•UI** | å®æ—¶ç›‘æ§æ•°æ® | ğŸ¥ˆ æ¨è |
| **æ€§èƒ½åˆ†æ** | å®šä½æ€§èƒ½ç“¶é¢ˆ | ğŸ¥ˆ æ¨è |

---

### 1.2 è°ƒè¯•æµç¨‹å›¾

```mermaid
graph TD
    A[å‘ç°é—®é¢˜] --> B{é—®é¢˜ç±»å‹?}
    B -->|é€»è¾‘é”™è¯¯| C[æ·»åŠ æ—¥å¿—è¾“å‡º]
    B -->|æ€§èƒ½é—®é¢˜| D[ä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·]
    B -->|æ•°æ®é”™è¯¯| E[ä½¿ç”¨Minecraftå‘½ä»¤æŸ¥è¯¢]

    C --> F[é‡ç°é—®é¢˜]
    D --> F
    E --> F

    F --> G[åˆ†ææ—¥å¿—/æ•°æ®]
    G --> H{æ‰¾åˆ°æ ¹å› ?}
    H -->|æ˜¯| I[ä¿®å¤ä»£ç ]
    H -->|å¦| J[æ·»åŠ æ›´å¤šæ—¥å¿—]
    J --> F

    I --> K[æµ‹è¯•éªŒè¯]
    K --> L{é—®é¢˜è§£å†³?}
    L -->|æ˜¯| M[åˆ é™¤è°ƒè¯•ä»£ç ]
    L -->|å¦| F
```

---

## 2. æ—¥å¿—ç³»ç»Ÿ

### 2.1 æ—¥å¿—çº§åˆ«ä¸ç”¨é€”

| çº§åˆ« | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| **DEBUG** | è¯¦ç»†è°ƒè¯•ä¿¡æ¯ | `"ç©å®¶ä½ç½®: (100, 64, 200)"` |
| **INFO** | æ­£å¸¸æµç¨‹è®°å½• | `"ç©å®¶åŠ å…¥æœåŠ¡å™¨"` |
| **WARNING** | æ½œåœ¨é—®é¢˜æç¤º | `"ç©å®¶ä½™é¢ä¸è¶³"` |
| **ERROR** | ä¸¥é‡é”™è¯¯ | `"é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥"` |

---

### 2.2 ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ

**æ—¥å¿—ç®¡ç†å™¨å®ç°**ï¼ˆ160è¡Œï¼Œå®Œæ•´ä»£ç è§ä¸‹ï¼‰:

```python
# -*- coding: utf-8 -*-
import time

class LogManager:
    """æ—¥å¿—ç®¡ç†å™¨ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰"""

    _instance = None
    DEBUG, INFO, WARNING, ERROR = 0, 1, 2, 3
    LEVEL_NAMES = {0: 'DEBUG', 1: 'INFO', 2: 'WARNING', 3: 'ERROR'}

    @staticmethod
    def GetInstance():
        if LogManager._instance is None:
            LogManager._instance = LogManager()
        return LogManager._instance

    def __init__(self):
        self.currentLevel = LogManager.INFO
        self.prefix = "[MyMod]"

    def SetLevel(self, level):
        self.currentLevel = level

    def _Log(self, level, message):
        if level < self.currentLevel:
            return
        timestamp = time.strftime('%H:%M:%S')
        levelName = self.LEVEL_NAMES[level]
        print('[{}] {} [{}] {}'.format(timestamp, self.prefix, levelName, message))

    def Debug(self, message):
        self._Log(LogManager.DEBUG, message)

    def Info(self, message):
        self._Log(LogManager.INFO, message)

    def Warning(self, message):
        self._Log(LogManager.WARNING, message)

    def Error(self, message):
        self._Log(LogManager.ERROR, message)

# ä½¿ç”¨ç¤ºä¾‹
logger = LogManager.GetInstance()
logger.SetPrefix("[ShopMod]")
logger.Info("æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ")
```

**è¾“å‡ºç¤ºä¾‹**:
```
[10:30:15] [ShopMod] [INFO] æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
[10:30:20] [ShopMod] [WARNING] ç©å®¶ä½™é¢ä¸è¶³
```

---

### 2.3 æ—¥å¿—æŠ€å·§é€ŸæŸ¥

| æŠ€å·§ | ä»£ç ç¤ºä¾‹ | ç”¨é€” |
|------|---------|------|
| **è¾“å‡ºå˜é‡ç±»å‹** | `logger.Debug("dataç±»å‹: {}, å€¼: {}".format(type(data), data))` | è°ƒè¯•ç±»å‹é”™è¯¯ |
| **è¾“å‡ºè°ƒç”¨æ ˆ** | `traceback.format_exc()` | å¼‚å¸¸è¿½è¸ª |
| **è¾“å‡ºå¯¹è±¡çŠ¶æ€** | `logger.Debug("Entity: {} ä½ç½®: {}".format(entityId, pos))` | å®ä½“è°ƒè¯• |
| **æ–‡ä»¶æŒä¹…åŒ–** | `with open(logPath, 'a', encoding='utf-8') as f: f.write(line)` | æ—¥å¿—å½’æ¡£ |

---

### 2.4 æ—¥å¿—æ–‡ä»¶æŒä¹…åŒ–

```python
# -*- coding: utf-8 -*-
import time

# âš ï¸ æ³¨æ„: osæ¨¡å—ä¸åœ¨Pythonç™½åå•å†…ï¼ŒMODå®¡æ ¸ä¼šå¤±è´¥
# æ›¿ä»£æ–¹æ¡ˆ: ä½¿ç”¨å›ºå®šè·¯å¾„æˆ–serverApiæä¾›çš„æ¥å£

class FileLogger:
    def __init__(self, logFileName):
        # ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œé¿å…ä½¿ç”¨osæ¨¡å—
        self.logFilePath = 'logs/' + logFileName
        # æ³¨æ„: ç›®å½•éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œæˆ–åœ¨MODåˆå§‹åŒ–æ—¶åˆ›å»º

    def Log(self, level, message):
        timestamp = time.strftime('%Y-%m-%d %H:%M:%S')
        logLine = '[{}] [{}] {}\n'.format(timestamp, level, message)
        try:
            with open(self.logFilePath, 'a') as f:
                f.write(logLine)
        except IOError as e:
            print("[FileLogger] å†™å…¥å¤±è´¥:", e)

# ä½¿ç”¨
fileLogger = FileLogger('debug.log')
fileLogger.Log('INFO', "æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ")
```

**ç™½åå•åˆè§„è¯´æ˜**:
- âœ… `time` æ¨¡å—åœ¨ç™½åå•å†…ï¼ˆç”¨äºæ—¶é—´æˆ³ï¼‰
- âŒ `os` æ¨¡å—**ä¸åœ¨ç™½åå•**ï¼Œå·²ç§»é™¤
- ğŸ’¡ æ›¿ä»£æ–¹æ¡ˆ: ä½¿ç”¨å›ºå®šç›¸å¯¹è·¯å¾„ä»£æ›¿ `os.path` æ“ä½œ
- ğŸ“ ç›®å½•éœ€è¦æå‰åˆ›å»ºï¼Œæˆ–ä½¿ç”¨ç½‘æ˜“æä¾›çš„æ–‡ä»¶API

---

## 3. Minecraftå‘½ä»¤

### 3.1 å¸¸ç”¨è°ƒè¯•å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | åŠŸèƒ½ | ç¤ºä¾‹ | è¾“å‡ºæ‘˜è¦ |
|------|------|------|---------|
| `/scoreboard players list` | æŸ¥çœ‹è®¡åˆ†æ¿æ•°æ® | `/scoreboard players list @a` | åˆ—å‡ºæ‰€æœ‰ç©å®¶åˆ†æ•° |
| `/data get entity @p` | æŸ¥çœ‹å®ä½“NBT | `/data get entity @p Health` | `ç©å®¶ç”Ÿå‘½å€¼: 20.0` |
| `/tag @s add debug_mode` | æ·»åŠ å®ä½“æ ‡ç­¾ | `/tag @p add test` | æ ‡è®°ç©å®¶ä¸ºæµ‹è¯•æ¨¡å¼ |
| `/execute as @p run say ~` | æŸ¥çœ‹ç©å®¶ä½ç½® | `/execute as @p run say ~ ~ ~` | `æˆ‘çš„ä½ç½®: 100 64 200` |
| `/execute as @e run say @s` | åˆ—å‡ºæ‰€æœ‰å®ä½“ | `/execute as @e[type=!player]` | åˆ—å‡ºéç©å®¶å®ä½“ |

---

### 3.2 è‡ªå®šä¹‰è°ƒè¯•å‘½ä»¤

**å®ç° `/debugshop` å‘½ä»¤**ï¼ˆ120è¡Œï¼Œæ ¸å¿ƒä»£ç ï¼‰:

```python
# -*- coding: utf-8 -*-
import mod.server.extraServerApi as serverApi

ServerSystem = serverApi.GetServerSystemCls()

class ShopServerSystem(ServerSystem):
    def __init__(self, namespace, systemName):
        super(ShopServerSystem, self).__init__(namespace, systemName)
        self.RegisterCommand('debugshop', self.OnDebugShopCommand)

    def RegisterCommand(self, cmdName, callback):
        self.ListenForEvent(
            serverApi.GetEngineNamespace(),
            serverApi.GetEngineSystemName(),
            'PlayerInputCommandEvent',
            self,
            self.OnPlayerInputCommand
        )
        if not hasattr(self, 'customCommands'):
            self.customCommands = {}
        self.customCommands[cmdName] = callback

    def OnPlayerInputCommand(self, args):
        playerId = args['playerId']
        command = args['command']
        if command.startswith('/'):
            cmdName = command[1:].split(' ')[0]
            if cmdName in self.customCommands:
                self.customCommands[cmdName](playerId, command)
                args['cancel'] = True

    def OnDebugShopCommand(self, playerId, command):
        shopData = self._GetPlayerShopData(playerId)
        self._SendMessage(playerId, "===== å•†åŸæ•°æ® =====")
        self._SendMessage(playerId, "ä½™é¢: {}".format(shopData.get('balance', 0)))
        self._SendMessage(playerId, "==================")

    def _SendMessage(self, playerId, message):
        chatComp = serverApi.GetEngineCompFactory().CreateMsg(playerId)
        chatComp.NotifyOneMessage(playerId, message, "Â§e[è°ƒè¯•]Â§r")
```

**ä½¿ç”¨**: `/debugshop` â†’ è¾“å‡ºç©å®¶å•†åŸæ•°æ®

---

## 4. æ€§èƒ½åˆ†æ

### 4.1 æ€§èƒ½è®¡æ—¶å™¨

```python
# -*- coding: utf-8 -*-
import time

class Timer(object):
    """æ€§èƒ½è®¡æ—¶å™¨ï¼ˆæ”¯æŒwithè¯­å¥ï¼‰"""
    def __init__(self, name):
        self.name = name
        self.startTime = None

    def __enter__(self):
        self.startTime = time.time()
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        elapsed = time.time() - self.startTime
        print("[Timer] {} è€—æ—¶: {:.3f}ç§’".format(self.name, elapsed))

# ä½¿ç”¨
with Timer("æ‰¹é‡å¤„ç†æˆå°±"):
    for playerId in playerList:
        self.ProcessAchievements(playerId)
```

**è¾“å‡º**: `[Timer] æ‰¹é‡å¤„ç†æˆå°± è€—æ—¶: 0.150ç§’`

---

### 4.2 æ€§èƒ½åˆ†æå™¨ï¼ˆProfileï¼‰

**è£…é¥°å™¨å®ç°**ï¼ˆ80è¡Œï¼‰:

```python
# -*- coding: utf-8 -*-
import time

class PerformanceProfiler:
    def __init__(self):
        self.timings = {}

    def Profile(self, funcName):
        def Decorator(func):
            def Wrapper(*args, **kwargs):
                startTime = time.time()
                result = func(*args, **kwargs)
                elapsed = time.time() - startTime

                if funcName not in self.timings:
                    self.timings[funcName] = {'count': 0, 'total': 0.0}
                self.timings[funcName]['count'] += 1
                self.timings[funcName]['total'] += elapsed
                return result
            return Wrapper
        return Decorator

    def PrintReport(self):
        print("===== æ€§èƒ½åˆ†ææŠ¥å‘Š =====")
        for funcName, stats in sorted(self.timings.items(), key=lambda x: x[1]['total'], reverse=True):
            avgTime = stats['total'] / stats['count']
            print("{}: æ€»è€—æ—¶{:.3f}ç§’, è°ƒç”¨{}æ¬¡, å¹³å‡{:.3f}ç§’".format(
                funcName, stats['total'], stats['count'], avgTime
            ))

# ä½¿ç”¨
profiler = PerformanceProfiler()

@profiler.Profile('ProcessAchievements')
def ProcessAchievements(self, playerId):
    # ä¸šåŠ¡é€»è¾‘
    pass
```

**è¾“å‡ºæ‘˜è¦**:
```
ProcessAchievements: æ€»è€—æ—¶1.250ç§’, è°ƒç”¨100æ¬¡, å¹³å‡0.013ç§’
UpdatePlayerData: æ€»è€—æ—¶0.500ç§’, è°ƒç”¨200æ¬¡, å¹³å‡0.003ç§’
```

---

### 4.3 TPSç›‘æ§

**TPSï¼ˆTicks Per Secondï¼‰**: æœåŠ¡å™¨æ¯ç§’æ¸¸æˆåˆ»æ•°
- æ­£å¸¸å€¼: 20 TPS
- å¡é¡¿: <20 TPS

```python
# -*- coding: utf-8 -*-
import time

class TPSMonitor:
    def __init__(self):
        self.lastCheckTime = time.time()
        self.tickCount = 0
        self.currentTPS = 20.0

    def OnTick(self):
        self.tickCount += 1
        now = time.time()
        elapsed = now - self.lastCheckTime

        if elapsed >= 1.0:
            self.currentTPS = self.tickCount / elapsed
            print("[TPS] å½“å‰TPS: {:.2f}".format(self.currentTPS))
            self.tickCount = 0
            self.lastCheckTime = now

# åœ¨ServerSystem.Update()ä¸­è°ƒç”¨
tpsMonitor.OnTick()
```

---

## 5. è°ƒè¯•å·¥å…·

### 5.1 è¿œç¨‹è°ƒè¯•ï¼ˆVSCode + ptvsdï¼‰

**é…ç½®æ­¥éª¤é€ŸæŸ¥**:

| æ­¥éª¤ | æ“ä½œ | å‘½ä»¤/é…ç½® |
|-----|------|----------|
| 1. å®‰è£…ptvsd | å®‰è£…è°ƒè¯•åº“ | `pip install ptvsd==4.3.2` |
| 2. å¯ç”¨è°ƒè¯•æœåŠ¡å™¨ | MODä»£ç ä¸­å¯ç”¨ | `ptvsd.enable_attach(address=('0.0.0.0', 5678))` |
| 3. VSCodeé…ç½® | åˆ›å»º `.vscode/launch.json` | è§ä¸‹æ–¹é…ç½® |
| 4. å¼€å§‹è°ƒè¯• | æŒ‰F5é™„åŠ è°ƒè¯•å™¨ | è®¾ç½®æ–­ç‚¹åè§¦å‘ |

**launch.jsoné…ç½®**:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Python: é™„åŠ åˆ°MinecraftæœåŠ¡å™¨",
      "type": "python",
      "request": "attach",
      "connect": {"host": "localhost", "port": 5678},
      "pathMappings": [
        {
          "localRoot": "${workspaceFolder}/behavior_packs/YourMod",
          "remoteRoot": "/path/to/minecraft/behavior_packs/YourMod"
        }
      ]
    }
  ]
}
```

**âš ï¸ æ³¨æ„äº‹é¡¹**:
- ä»…åœ¨å¼€å‘ç¯å¢ƒå¯ç”¨ï¼ˆç”Ÿäº§ç¯å¢ƒç¦ç”¨ï¼‰
- æ–­ç‚¹ä¼šé˜»å¡æ¸¸æˆï¼ˆä»…å•äººæµ‹è¯•ï¼‰
- ä½¿ç”¨é…ç½®å¼€å…³æ§åˆ¶: `if config.get('debug_mode', False):`

---

### 5.2 å®æ—¶æ•°æ®ç›‘æ§UI

**å®¢æˆ·ç«¯è°ƒè¯•UIç¤ºä¾‹**ï¼ˆ60è¡Œï¼‰:

```python
# -*- coding: utf-8 -*-
import mod.client.extraClientApi as clientApi

ClientSystem = clientApi.GetClientSystemCls()

class DebugClientSystem(ClientSystem):
    def __init__(self, namespace, systemName):
        super(DebugClientSystem, self).__init__(namespace, systemName)
        self.CreateTimer(1.0, self.UpdateDebugUI)

    def UpdateDebugUI(self):
        fps = self._GetFPS()
        entityCount = self._GetEntityCount()
        tps = self._GetTPS()

        debugInfo = "FPS: {} | å®ä½“æ•°: {} | TPS: {}".format(fps, entityCount, tps)
        print("[DebugUI]", debugInfo)

        self.CreateTimer(1.0, self.UpdateDebugUI)
```

---

## 6. å¸¸è§é—®é¢˜FAQ

### Q1: æ—¥å¿—è¾“å‡ºä¸­æ–‡ä¹±ç ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
```python
# -*- coding: utf-8 -*-  # æ–‡ä»¶å¼€å¤´å£°æ˜ç¼–ç 
with open(logPath, 'a', encoding='utf-8') as f:  # æŒ‡å®šç¼–ç 
    f.write(message)
```

---

### Q2: ç”Ÿäº§ç¯å¢ƒå¦‚ä½•ç¦ç”¨è°ƒè¯•æ—¥å¿—ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
```python
# å¼€å‘ç¯å¢ƒ
logger.SetLevel(LogManager.DEBUG)  # è¾“å‡ºæ‰€æœ‰æ—¥å¿—

# ç”Ÿäº§ç¯å¢ƒ
logger.SetLevel(LogManager.INFO)   # ä»…INFOåŠä»¥ä¸Š
```

---

### Q3: å¦‚ä½•æŸ¥çœ‹MODæ˜¯å¦æ­£å¸¸åŠ è½½ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
```python
def __init__(self, namespace, systemName):
    super(MyServerSystem, self).__init__(namespace, systemName)
    print("[MyMod] Systemå·²åŠ è½½:", systemName)
```

å¦‚æœæ§åˆ¶å°æ— è¾“å‡º â†’ MODæœªæ­£ç¡®åŠ è½½ã€‚

---

### Q4: è¿œç¨‹è°ƒè¯•æ— æ³•è¿æ¥ï¼Ÿ

**æ£€æŸ¥æ¸…å•**:
- âœ… å®‰è£…ptvsd: `pip install ptvsd==4.3.2`
- âœ… ç«¯å£æœªè¢«å ç”¨ï¼ˆé»˜è®¤5678ï¼‰
- âœ… é˜²ç«å¢™å¼€æ”¾ç«¯å£
- âœ… VSCode `launch.json` é…ç½®æ­£ç¡®

---

### Q5: å®¢æˆ·ç«¯æ—¥å¿—åœ¨å“ªé‡Œï¼Ÿ

**æ—¥å¿—ä½ç½®**:
- Windows: `C:/Users/YourName/AppData/Local/Packages/.../LocalState/logs/latest.log`
- ä½¿ç”¨ `tail -f` ç›‘æ§å®æ—¶æ—¥å¿—å˜åŒ–

---

## ğŸ“š æ¨èé˜…è¯»

- [æ€§èƒ½ä¼˜åŒ–å®Œæ•´æŒ‡å—.md](æ€§èƒ½ä¼˜åŒ–å®Œæ•´æŒ‡å—.md) - æ·±å…¥æ€§èƒ½åˆ†æ
- [å¼€å‘è§„èŒƒ.md](å¼€å‘è§„èŒƒ.md) - é¿å…å¸¸è§é”™è¯¯
- [é—®é¢˜æ’æŸ¥.md](é—®é¢˜æ’æŸ¥.md) - å¸¸è§é—®é¢˜è§£å†³

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0ï¼ˆç²¾ç®€ç‰ˆï¼Œä»1014è¡Œå‹ç¼©è‡³~450è¡Œï¼‰
**æœ€åæ›´æ–°**: 2025-01-11
**å‹ç¼©ç­–ç•¥**: æ”¹ç”¨è¡¨æ ¼åŒ–ã€åˆ é™¤å†—ä½™è¾“å‡ºã€ä¿ç•™æ ¸å¿ƒä»£ç å’Œæµç¨‹å›¾

**çŸ¥è¯†æ¥æº**: MODSDKå®˜æ–¹æ–‡æ¡£ã€MinecraftåŸºå²©ç‰ˆå‘½ä»¤å‚è€ƒã€Python 2.7æ ‡å‡†åº“ã€é€šç”¨è°ƒè¯•æœ€ä½³å®è·µ
