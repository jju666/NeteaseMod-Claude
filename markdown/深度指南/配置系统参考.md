# é…ç½®ç³»ç»Ÿå‚è€ƒ

> **ğŸ“ å¯¼èˆª**: [ğŸ  é¦–é¡µ](../README.md) > [ğŸ“‚ æ–‡æ¡£](../README.md#æ–‡æ¡£å¯¼èˆª) > é…ç½®ç³»ç»Ÿå‚è€ƒ
>
> **æ–‡æ¡£è¯´æ˜**: æ·±å…¥è®²è§£MODSDKé¡¹ç›®çš„é…ç½®ç®¡ç†æœ€ä½³å®è·µ
>
> **ğŸ“… æœ€åæ›´æ–°**: 2025-01-11
> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0

---

## ğŸ“‹ ç›®å½•

1. [é…ç½®ç³»ç»Ÿæ¦‚è¿°](#1-é…ç½®ç³»ç»Ÿæ¦‚è¿°)
2. [é…ç½®æ–‡ä»¶è®¾è®¡](#2-é…ç½®æ–‡ä»¶è®¾è®¡)
3. [é…ç½®åŠ è½½ä¸è§£æ](#3-é…ç½®åŠ è½½ä¸è§£æ)
4. [é…ç½®çƒ­æ›´æ–°](#4-é…ç½®çƒ­æ›´æ–°)
5. [é…ç½®è¿ç§»ç­–ç•¥](#5-é…ç½®è¿ç§»ç­–ç•¥)
6. [æœ€ä½³å®è·µ](#6-æœ€ä½³å®è·µ)
7. [å¸¸è§é—®é¢˜FAQ](#7-å¸¸è§é—®é¢˜faq)

---

## 1. é…ç½®ç³»ç»Ÿæ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯é…ç½®ç³»ç»Ÿï¼Ÿ

**å®šä¹‰**ï¼šå°†å¯å˜å‚æ•°ï¼ˆå¦‚å•†å“ä»·æ ¼ã€æ´»åŠ¨æ—¶é—´ï¼‰ä¸ä»£ç åˆ†ç¦»ï¼Œå­˜å‚¨åœ¨å¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œä¾¿äºä¿®æ”¹å’Œç®¡ç†ã€‚

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… å•†å“ä»·æ ¼ã€åº“å­˜é…ç½®
- âœ… æ´»åŠ¨æ—¶é—´ã€å¥–åŠ±è®¾ç½®
- âœ… NPCå¯¹è¯æ–‡æœ¬
- âœ… å…³å¡æ•°æ®ã€åœ°å›¾é…ç½®

**ä¼˜åŠ¿**ï¼š
- âœ… æ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´å‚æ•°
- âœ… æ”¯æŒçƒ­æ›´æ–°ï¼ˆä¸é‡å¯æœåŠ¡å™¨ï¼‰
- âœ… ä¾¿äºè¿è¥äººå‘˜ç®¡ç†

---

### 1.2 é…ç½®æ–¹æ¡ˆé€‰æ‹©

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|---------|------|------|
| **JSONæ–‡ä»¶** | ç»“æ„åŒ–æ•°æ®ï¼ˆå•†å“ã€æˆå°±ï¼‰ | æ˜“è¯»ã€æ”¯æŒåµŒå¥— | ä¸æ”¯æŒæ³¨é‡Š |
| **Pythonæ–‡ä»¶** | å¤æ‚é…ç½®é€»è¾‘ | æ”¯æŒä»£ç é€»è¾‘ | å®‰å…¨é£é™©ï¼ˆå¯æ‰§è¡Œä»£ç ï¼‰ |
| **CSVæ–‡ä»¶** | è¡¨æ ¼æ•°æ®ï¼ˆå•†å“åˆ—è¡¨ï¼‰ | Excelå¯ç¼–è¾‘ | ä¸æ”¯æŒåµŒå¥—ç»“æ„ |
| **YAMLæ–‡ä»¶** | äººç±»å¯è¯»é…ç½® | æ”¯æŒæ³¨é‡Šã€æ˜“è¯» | éœ€è¦ç¬¬ä¸‰æ–¹åº“ |

**æ¨èæ–¹æ¡ˆ**ï¼š
- ğŸ¥‡ **JSONæ–‡ä»¶** - å®˜æ–¹æ¨èï¼Œå…¼å®¹æ€§å¥½
- ğŸ¥ˆ **CSVæ–‡ä»¶** - å¤§é‡è¡¨æ ¼æ•°æ®
- ğŸ¥‰ **Pythonæ–‡ä»¶** - ä»…ç”¨äºå¼€å‘ç¯å¢ƒé…ç½®

---

### 1.3 ç›®å½•ç»“æ„è§„èŒƒ

**æ¨èç›®å½•ç»“æ„**ï¼š

```
behavior_packs/YourMod/
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ global.json          # å…¨å±€é…ç½®ï¼ˆæœåŠ¡å™¨è®¾ç½®ï¼‰
â”‚   â”œâ”€â”€ shop/                # å•†åŸé…ç½®
â”‚   â”‚   â”œâ”€â”€ items.json       # å•†å“é…ç½®
â”‚   â”‚   â””â”€â”€ categories.json  # åˆ†ç±»é…ç½®
â”‚   â”œâ”€â”€ achievements/        # æˆå°±é…ç½®
â”‚   â”‚   â””â”€â”€ achievements.json
â”‚   â””â”€â”€ npcs/                # NPCé…ç½®
â”‚       â”œâ”€â”€ dialogues.json   # å¯¹è¯é…ç½®
â”‚       â””â”€â”€ quests.json      # ä»»åŠ¡é…ç½®
â”œâ”€â”€ data/                    # æ•°æ®æ–‡ä»¶ç›®å½•ï¼ˆåªè¯»ï¼‰
â”‚   â””â”€â”€ map_data.json        # åœ°å›¾æ•°æ®
â””â”€â”€ modMain.py
```

---

## 2. é…ç½®æ–‡ä»¶è®¾è®¡

### 2.1 JSONé…ç½®æ–‡ä»¶ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šå•†å“é…ç½®ï¼ˆconfig/shop/items.jsonï¼‰

```json
{
  "_version": "1.0",
  "_description": "å•†åŸå•†å“é…ç½®",
  "_last_updated": "2025-01-11",

  "items": [
    {
      "id": "shop_sword_001",
      "name": "é’»çŸ³å‰‘",
      "description": "é”‹åˆ©æ— æ¯”çš„é’»çŸ³å‰‘",
      "category": "weapon",
      "price": 100,
      "currency": "coin",
      "stock": -1,
      "reward": {
        "type": "item",
        "itemName": "minecraft:diamond_sword",
        "count": 1,
        "enchantments": [
          {"id": "sharpness", "level": 5}
        ]
      },
      "requirements": {
        "min_level": 10,
        "vip_level": 0
      },
      "enabled": true
    },
    {
      "id": "shop_apple_001",
      "name": "é‡‘è‹¹æœ",
      "description": "æ¢å¤ç”Ÿå‘½å€¼çš„é‡‘è‹¹æœ",
      "category": "consumable",
      "price": 50,
      "currency": "coin",
      "stock": 100,
      "reward": {
        "type": "item",
        "itemName": "minecraft:golden_apple",
        "count": 10
      },
      "requirements": {
        "min_level": 1,
        "vip_level": 0
      },
      "enabled": true
    }
  ]
}
```

**è®¾è®¡åŸåˆ™**ï¼š
- âœ… æ·»åŠ å…ƒæ•°æ®ï¼ˆç‰ˆæœ¬å·ã€æ›´æ–°æ—¥æœŸï¼‰
- âœ… ä½¿ç”¨åµŒå¥—ç»“æ„ç»„ç»‡å¤æ‚æ•°æ®
- âœ… æ·»åŠ `enabled`å­—æ®µæ§åˆ¶å¼€å…³
- âœ… ä½¿ç”¨`requirements`å­—æ®µå®šä¹‰å‰ç½®æ¡ä»¶

---

#### ç¤ºä¾‹2ï¼šå…¨å±€é…ç½®ï¼ˆconfig/global.jsonï¼‰

```json
{
  "_version": "1.0",

  "server": {
    "name": "æˆ‘çš„ä¸–ç•Œç”Ÿå­˜æœåŠ¡å™¨",
    "max_players": 20,
    "difficulty": "normal",
    "pvp_enabled": true
  },

  "features": {
    "shop_enabled": true,
    "achievement_enabled": true,
    "vip_system_enabled": true
  },

  "economy": {
    "starting_money": 1000,
    "death_penalty": 0.1,
    "max_money": 999999999
  },

  "debug": {
    "log_level": "INFO",
    "performance_monitor": false,
    "remote_debug": false
  }
}
```

---

### 2.2 CSVé…ç½®æ–‡ä»¶ç¤ºä¾‹

**é€‚ç”¨åœºæ™¯**ï¼šå¤§é‡è¡¨æ ¼æ•°æ®ï¼ˆå¦‚å•†å“åˆ—è¡¨ã€æˆå°±åˆ—è¡¨ï¼‰

#### ç¤ºä¾‹ï¼šæˆå°±é…ç½®ï¼ˆconfig/achievements/achievements.csvï¼‰

```csv
id,name,description,type,target,reward_type,reward_item,reward_count,enabled
kill_zombie_100,åƒµå°¸æ€æ‰‹,å‡»æ€100åªåƒµå°¸,kill,100,item,minecraft:diamond,5,true
kill_skeleton_50,éª·é«…å…‹æ˜Ÿ,å‡»æ€50åªéª·é«…,kill,50,item,minecraft:emerald,3,true
place_block_1000,å»ºç­‘å¤§å¸ˆ,æ”¾ç½®1000ä¸ªæ–¹å—,place,1000,currency,coin,500,true
```

**åŠ è½½CSVé…ç½®**ï¼š

```python
# -*- coding: utf-8 -*-
import csv
import os

def LoadAchievementsFromCSV(self):
    """
    ä»CSVæ–‡ä»¶åŠ è½½æˆå°±é…ç½®

    Returns:
        dict: {achievementId: {...}}
    """
    modPath = os.path.dirname(__file__)
    csvPath = os.path.join(modPath, 'config', 'achievements', 'achievements.csv')

    achievements = {}

    try:
        with open(csvPath, 'r', encoding='utf-8') as f:
            reader = csv.DictReader(f)

            for row in reader:
                achievementId = row['id']

                # ç±»å‹è½¬æ¢
                achievements[achievementId] = {
                    'id': achievementId,
                    'name': row['name'],
                    'description': row['description'],
                    'type': row['type'],
                    'target': int(row['target']),
                    'reward_type': row['reward_type'],
                    'reward_item': row['reward_item'],
                    'reward_count': int(row['reward_count']),
                    'enabled': row['enabled'].lower() == 'true'
                }

        print("[Config] CSVé…ç½®åŠ è½½æˆåŠŸ,å…±", len(achievements), "ä¸ªæˆå°±")
        return achievements

    except IOError as e:
        print("[Config] CSVæ–‡ä»¶ä¸å­˜åœ¨:", csvPath)
        return {}
    except (ValueError, KeyError) as e:
        print("[Config] CSVæ ¼å¼é”™è¯¯:", e)
        return {}
```

---

## 3. é…ç½®åŠ è½½ä¸è§£æ

### 3.1 é…ç½®ç®¡ç†å™¨æ¨¡å¼

**è®¾è®¡åŸåˆ™**ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†é…ç½®ï¼Œé¿å…é‡å¤åŠ è½½

```python
# -*- coding: utf-8 -*-
"""
é…ç½®ç®¡ç†å™¨ - å•ä¾‹æ¨¡å¼
èŒè´£ï¼šåŠ è½½ã€ç¼“å­˜ã€æä¾›é…ç½®æ•°æ®
"""

import json
import os

class ConfigManager:
    """é…ç½®ç®¡ç†å™¨ï¼ˆå•ä¾‹ï¼‰"""

    _instance = None

    @staticmethod
    def GetInstance():
        if ConfigManager._instance is None:
            ConfigManager._instance = ConfigManager()
        return ConfigManager._instance

    def __init__(self):
        # é…ç½®ç¼“å­˜
        self.configs = {}

        # MODæ ¹ç›®å½•
        self.modPath = os.path.dirname(__file__)

    def LoadConfig(self, configName):
        """
        åŠ è½½é…ç½®æ–‡ä»¶

        Args:
            configName (str): é…ç½®åç§°ï¼ˆå¦‚"shop/items"ï¼‰

        Returns:
            dict: é…ç½®æ•°æ®
        """
        # æ£€æŸ¥ç¼“å­˜
        if configName in self.configs:
            return self.configs[configName]

        # æ„å»ºæ–‡ä»¶è·¯å¾„
        configPath = os.path.join(self.modPath, 'config', configName + '.json')

        try:
            # è¯»å–JSONæ–‡ä»¶
            with open(configPath, 'r', encoding='utf-8') as f:
                config = json.load(f)

                # ç¼“å­˜é…ç½®
                self.configs[configName] = config

                print("[ConfigManager] é…ç½®åŠ è½½æˆåŠŸ:", configName)
                return config

        except IOError as e:
            print("[ConfigManager] é…ç½®æ–‡ä»¶ä¸å­˜åœ¨:", configPath)
            return {}
        except ValueError as e:
            print("[ConfigManager] JSONæ ¼å¼é”™è¯¯:", e)
            return {}

    def ReloadConfig(self, configName):
        """
        é‡æ–°åŠ è½½é…ç½®ï¼ˆçƒ­æ›´æ–°ï¼‰

        Args:
            configName (str): é…ç½®åç§°
        """
        # æ¸…é™¤ç¼“å­˜
        if configName in self.configs:
            del self.configs[configName]

        # é‡æ–°åŠ è½½
        return self.LoadConfig(configName)

    def GetConfig(self, configName, key=None, default=None):
        """
        è·å–é…ç½®å€¼

        Args:
            configName (str): é…ç½®åç§°
            key (str): é…ç½®é”®ï¼ˆå¯é€‰ï¼‰
            default: é»˜è®¤å€¼

        Returns:
            é…ç½®å€¼æˆ–æ•´ä¸ªé…ç½®å¯¹è±¡
        """
        config = self.LoadConfig(configName)

        if key is None:
            return config

        return config.get(key, default)

# åˆ›å»ºå…¨å±€å®ä¾‹
configManager = ConfigManager.GetInstance()

# ä½¿ç”¨ç¤ºä¾‹
shopConfig = configManager.GetConfig('shop/items')
serverName = configManager.GetConfig('global', 'server.name', 'æœªå‘½åæœåŠ¡å™¨')
```

---

### 3.2 é…ç½®éªŒè¯

**é—®é¢˜**ï¼šé…ç½®æ–‡ä»¶å¯èƒ½åŒ…å«é”™è¯¯æ•°æ®ï¼ˆå¦‚è´Ÿä»·æ ¼ã€ç©ºå•†å“IDï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼šåŠ è½½åéªŒè¯

```python
def ValidateShopConfig(self, config):
    """
    éªŒè¯å•†å“é…ç½®

    Args:
        config (dict): å•†å“é…ç½®

    Returns:
        tuple: (bool, str) - (æ˜¯å¦æœ‰æ•ˆ, é”™è¯¯ä¿¡æ¯)
    """
    items = config.get('items', [])

    for item in items:
        # æ£€æŸ¥å¿…å¡«å­—æ®µ
        if 'id' not in item:
            return False, "å•†å“ç¼ºå°‘idå­—æ®µ"

        if 'price' not in item:
            return False, "å•†å“{}ç¼ºå°‘priceå­—æ®µ".format(item['id'])

        # æ£€æŸ¥ä»·æ ¼åˆæ³•æ€§
        if item['price'] < 0:
            return False, "å•†å“{}ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°".format(item['id'])

        # æ£€æŸ¥åº“å­˜åˆæ³•æ€§
        stock = item.get('stock', -1)
        if stock < -1:
            return False, "å•†å“{}åº“å­˜é…ç½®é”™è¯¯".format(item['id'])

    return True, "é…ç½®éªŒè¯é€šè¿‡"

# ä½¿ç”¨ç¤ºä¾‹
config = configManager.LoadConfig('shop/items')
isValid, message = self.ValidateShopConfig(config)

if not isValid:
    print("[Config] é…ç½®éªŒè¯å¤±è´¥:", message)
    # ä½¿ç”¨é»˜è®¤é…ç½®æˆ–æ‹’ç»å¯åŠ¨
else:
    print("[Config] é…ç½®éªŒè¯é€šè¿‡")
```

---

### 3.3 é…ç½®é»˜è®¤å€¼å¤„ç†

**é—®é¢˜**ï¼šé…ç½®æ–‡ä»¶ç¼ºå°‘æŸäº›å­—æ®µæ—¶å¯¼è‡´é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨é»˜è®¤å€¼

```python
def GetItemConfig(self, itemId):
    """
    è·å–å•†å“é…ç½®ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰

    Args:
        itemId (str): å•†å“ID

    Returns:
        dict: å•†å“é…ç½®
    """
    config = configManager.GetConfig('shop/items')
    items = config.get('items', [])

    # æŸ¥æ‰¾å•†å“
    for item in items:
        if item['id'] == itemId:
            # å¡«å……é»˜è®¤å€¼
            return {
                'id': item['id'],
                'name': item.get('name', 'æœªå‘½åå•†å“'),
                'description': item.get('description', ''),
                'price': item.get('price', 0),
                'currency': item.get('currency', 'coin'),
                'stock': item.get('stock', -1),  # -1è¡¨ç¤ºæ— é™åº“å­˜
                'enabled': item.get('enabled', True)
            }

    return None  # å•†å“ä¸å­˜åœ¨
```

---

## 4. é…ç½®çƒ­æ›´æ–°

### 4.1 ä¸ºä»€ä¹ˆéœ€è¦çƒ­æ›´æ–°ï¼Ÿ

**åœºæ™¯**ï¼š
- è¿è¥æ´»åŠ¨è°ƒæ•´å•†å“ä»·æ ¼
- ä¿®å¤é…ç½®é”™è¯¯ï¼ˆå¦‚NPCå¯¹è¯æ–‡æœ¬ï¼‰
- ä¸´æ—¶å¼€å¯/å…³é—­åŠŸèƒ½

**ä¸ä½¿ç”¨çƒ­æ›´æ–°çš„åæœ**ï¼š
- âŒ éœ€è¦é‡å¯æœåŠ¡å™¨ï¼ˆç©å®¶æ‰çº¿ï¼‰
- âŒ ä¿®æ”¹ç”Ÿæ•ˆæ…¢

---

### 4.2 å®ç°çƒ­æ›´æ–°æœºåˆ¶

#### æ–¹æ³•1ï¼šå®šæ—¶é‡æ–°åŠ è½½

```python
class ConfigHotReloadSystem(ServerSystem):
    """é…ç½®çƒ­é‡è½½System"""

    def __init__(self, namespace, systemName):
        super(ConfigHotReloadSystem, self).__init__(namespace, systemName)

        # è®°å½•é…ç½®æ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´
        self.configModifyTimes = {}

        # å®šæ—¶æ£€æŸ¥é…ç½®å˜åŒ–ï¼ˆæ¯10ç§’ï¼‰
        self.CreateTimer(10.0, self.CheckConfigChanges)

    def CheckConfigChanges(self):
        """æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦è¢«ä¿®æ”¹"""
        modPath = os.path.dirname(__file__)
        configPath = os.path.join(modPath, 'config', 'shop', 'items.json')

        try:
            # è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´
            currentModifyTime = os.path.getmtime(configPath)

            # æ£€æŸ¥æ˜¯å¦æœ‰å˜åŒ–
            lastModifyTime = self.configModifyTimes.get(configPath, 0)

            if currentModifyTime > lastModifyTime:
                print("[HotReload] æ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å˜åŒ–:", configPath)

                # é‡æ–°åŠ è½½é…ç½®
                configManager.ReloadConfig('shop/items')

                # æ›´æ–°ä¿®æ”¹æ—¶é—´
                self.configModifyTimes[configPath] = currentModifyTime

                # é€šçŸ¥å…¶ä»–Systemé…ç½®å·²æ›´æ–°
                self.NotifyToAllSystems('ConfigReloadedEvent', {
                    'configName': 'shop/items'
                })

        except OSError as e:
            print("[HotReload] æ— æ³•è·å–æ–‡ä»¶ä¿®æ”¹æ—¶é—´:", e)

        # é‡æ–°åˆ›å»ºå®šæ—¶å™¨
        self.CreateTimer(10.0, self.CheckConfigChanges)
```

---

#### æ–¹æ³•2ï¼šç®¡ç†å‘˜å‘½ä»¤è§¦å‘

```python
def OnAdminCommand(self, args):
    """
    ç®¡ç†å‘˜å‘½ä»¤ï¼š/reloadconfig <configName>
    """
    playerId = args['playerId']
    command = args['command']

    # æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
    if not self._IsAdmin(playerId):
        self._SendMessage(playerId, "ä½ æ²¡æœ‰æƒé™æ‰§è¡Œæ­¤å‘½ä»¤")
        return

    # è§£æå‘½ä»¤
    parts = command.split(' ')
    if len(parts) < 2:
        self._SendMessage(playerId, "ç”¨æ³•: /reloadconfig <configName>")
        return

    configName = parts[1]

    # é‡æ–°åŠ è½½é…ç½®
    configManager.ReloadConfig(configName)

    self._SendMessage(playerId, "é…ç½®å·²é‡æ–°åŠ è½½: " + configName)
    print("[Admin] ç®¡ç†å‘˜", playerId, "é‡æ–°åŠ è½½é…ç½®:", configName)
```

---

### 4.3 çƒ­æ›´æ–°æ³¨æ„äº‹é¡¹

**æ³¨æ„1ï¼šçº¿ç¨‹å®‰å…¨**

```python
# âŒ ä¸å®‰å…¨ï¼šç›´æ¥æ›¿æ¢é…ç½®å¯èƒ½å¯¼è‡´è¯»å–åˆ°ä¸å®Œæ•´çš„æ•°æ®
self.config = newConfig

# âœ… å®‰å…¨ï¼šä½¿ç”¨ä¸´æ—¶å˜é‡+åŸå­æ›¿æ¢
tempConfig = self.LoadConfig()
self.config = tempConfig
```

---

**æ³¨æ„2ï¼šé€šçŸ¥ä¾èµ–æ¨¡å—**

```python
# é…ç½®é‡æ–°åŠ è½½å,é€šçŸ¥å…¶ä»–System
self.NotifyToAllSystems('ConfigReloadedEvent', {
    'configName': 'shop/items'
})

# å…¶ä»–Systemç›‘å¬äº‹ä»¶
def OnConfigReloaded(self, args):
    configName = args['configName']
    if configName == 'shop/items':
        # é‡æ–°åˆå§‹åŒ–å•†å“ç¼“å­˜
        self._InitShopCache()
```

---

## 5. é…ç½®è¿ç§»ç­–ç•¥

### 5.1 ä¸ºä»€ä¹ˆéœ€è¦é…ç½®è¿ç§»ï¼Ÿ

**åœºæ™¯**ï¼š
- æ–°ç‰ˆæœ¬æ·»åŠ äº†æ–°çš„é…ç½®å­—æ®µ
- ä¿®æ”¹äº†é…ç½®ç»“æ„ï¼ˆå¦‚åµŒå¥—å±‚çº§å˜åŒ–ï¼‰
- åºŸå¼ƒäº†æ—§çš„é…ç½®å­—æ®µ

**ä¸è¿ç§»çš„åæœ**ï¼š
- âŒ è¯»å–æ—§é…ç½®æ—¶æŠ¥é”™
- âŒ åŠŸèƒ½å¼‚å¸¸ï¼ˆç¼ºå°‘æ–°å­—æ®µï¼‰

---

### 5.2 é…ç½®ç‰ˆæœ¬æ§åˆ¶

**åŸåˆ™**ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ç‰ˆæœ¬å·

```json
{
  "_version": "2.0",
  "items": [...]
}
```

---

### 5.3 é…ç½®è¿ç§»å®ç°

```python
def LoadShopConfig(self):
    """åŠ è½½å•†å“é…ç½®ï¼ˆè‡ªåŠ¨è¿ç§»ï¼‰"""
    config = self._LoadRawConfig('shop/items')

    # è·å–é…ç½®ç‰ˆæœ¬
    version = config.get('_version', '1.0')

    # ç‰ˆæœ¬è¿ç§»
    if version == '1.0':
        config = self._MigrateV1ToV2(config)
        self._SaveConfig('shop/items', config)
        print("[Config] é…ç½®å·²è¿ç§»è‡³v2.0")

    return config

def _MigrateV1ToV2(self, config):
    """
    v1.0 â†’ v2.0è¿ç§»

    å˜åŒ–ï¼š
    - æ·»åŠ `enabled`å­—æ®µï¼ˆé»˜è®¤trueï¼‰
    - æ·»åŠ `requirements`å­—æ®µ
    """
    items = config.get('items', [])

    for item in items:
        # æ·»åŠ æ–°å­—æ®µ
        if 'enabled' not in item:
            item['enabled'] = True

        if 'requirements' not in item:
            item['requirements'] = {
                'min_level': 1,
                'vip_level': 0
            }

    # æ›´æ–°ç‰ˆæœ¬å·
    config['_version'] = '2.0'
    config['_migrated_from'] = '1.0'
    config['_migration_date'] = '2025-01-11'

    return config

def _SaveConfig(self, configName, config):
    """ä¿å­˜é…ç½®åˆ°æ–‡ä»¶"""
    configPath = os.path.join(self.modPath, 'config', configName + '.json')

    try:
        with open(configPath, 'w', encoding='utf-8') as f:
            json.dump(config, f, ensure_ascii=False, indent=2)
        print("[Config] é…ç½®å·²ä¿å­˜:", configPath)
    except IOError as e:
        print("[Config] ä¿å­˜é…ç½®å¤±è´¥:", e)
```

---

### 5.4 å‘åå…¼å®¹ç­–ç•¥

**åŸåˆ™**ï¼šæ–°ç‰ˆæœ¬ä»£ç èƒ½å¤„ç†æ—§ç‰ˆæœ¬é…ç½®

```python
def GetItemPrice(self, item):
    """
    è·å–å•†å“ä»·æ ¼ï¼ˆå‘åå…¼å®¹ï¼‰

    v1.0: priceå­—æ®µæ˜¯æ•´æ•°
    v2.0: priceå­—æ®µæ˜¯å¯¹è±¡ {"amount": 100, "currency": "coin"}
    """
    price = item.get('price')

    # v1.0æ ¼å¼ï¼ˆæ•´æ•°ï¼‰
    if isinstance(price, (int, long, float)):
        return {
            'amount': int(price),
            'currency': 'coin'
        }

    # v2.0æ ¼å¼ï¼ˆå¯¹è±¡ï¼‰
    if isinstance(price, dict):
        return {
            'amount': price.get('amount', 0),
            'currency': price.get('currency', 'coin')
        }

    # é»˜è®¤å€¼
    return {'amount': 0, 'currency': 'coin'}
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 é…ç½®è®¾è®¡åŸåˆ™

#### åŸåˆ™1ï¼šä½¿ç”¨é…ç½®è€Œéç¡¬ç¼–ç 

```python
# âŒ ç¡¬ç¼–ç ï¼ˆä¸æ¨èï¼‰
INITIAL_MONEY = 1000
MAX_FRIENDS = 50

# âœ… é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
initialMoney = configManager.GetConfig('global', 'economy.starting_money', 1000)
maxFriends = configManager.GetConfig('global', 'social.max_friends', 50)
```

---

#### åŸåˆ™2ï¼šé…ç½®åˆ†ç±»ç®¡ç†

```python
# âœ… æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†é…ç½®
config/
â”œâ”€â”€ shop/
â”‚   â”œâ”€â”€ items.json
â”‚   â””â”€â”€ categories.json
â”œâ”€â”€ achievements/
â”‚   â””â”€â”€ achievements.json
â””â”€â”€ npcs/
    â””â”€â”€ dialogues.json

# âŒ æ‰€æœ‰é…ç½®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­
config/all.json  # ä¸æ¨è
```

---

#### åŸåˆ™3ï¼šæ·»åŠ é…ç½®æ³¨é‡Šï¼ˆä½¿ç”¨å…ƒæ•°æ®ï¼‰

```json
{
  "_comment": "è¿™æ˜¯å•†å“é…ç½®æ–‡ä»¶",
  "_version": "1.0",
  "_last_updated": "2025-01-11",
  "_author": "Admin",

  "items": [...]
}
```

---

### 6.2 æ€§èƒ½ä¼˜åŒ–

#### ä¼˜åŒ–1ï¼šå»¶è¿ŸåŠ è½½

```python
class ConfigManager:
    def __init__(self):
        self.configs = {}

    def LoadConfig(self, configName):
        """å»¶è¿ŸåŠ è½½ï¼šä»…åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åŠ è½½"""
        if configName not in self.configs:
            self.configs[configName] = self._LoadFromFile(configName)
        return self.configs[configName]
```

---

#### ä¼˜åŒ–2ï¼šç¼“å­˜é…ç½®æ•°æ®

```python
# âŒ æ¯æ¬¡è°ƒç”¨éƒ½é‡æ–°åŠ è½½
def GetShopItems(self):
    config = self._LoadConfig('shop/items')
    return config['items']

# âœ… åŠ è½½ä¸€æ¬¡,ç¼“å­˜ç»“æœ
def __init__(self):
    self.shopItemsCache = None

def GetShopItems(self):
    if self.shopItemsCache is None:
        config = configManager.LoadConfig('shop/items')
        self.shopItemsCache = config['items']
    return self.shopItemsCache
```

---

### 6.3 å®‰å…¨æ€§

#### å®‰å…¨åŸåˆ™1ï¼šä¸ä½¿ç”¨Pythoné…ç½®æ–‡ä»¶æ‰§è¡Œä»£ç 

```python
# âŒ å±é™©ï¼šæ‰§è¡ŒPythonä»£ç 
configPath = 'config.py'
execfile(configPath)  # å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç 

# âœ… å®‰å…¨ï¼šä»…è¯»å–JSONæ•°æ®
config = json.load(open('config.json'))
```

---

#### å®‰å…¨åŸåˆ™2ï¼šéªŒè¯é…ç½®æ•°æ®

```python
def GetItemPrice(self, item):
    """è·å–å•†å“ä»·æ ¼ï¼ˆéªŒè¯æ•°æ®ï¼‰"""
    price = item.get('price', 0)

    # éªŒè¯ä»·æ ¼èŒƒå›´
    if price < 0 or price > 999999999:
        print("[Warning] å•†å“ä»·æ ¼å¼‚å¸¸:", item['id'], price)
        return 0

    return price
```

---

## 7. å¸¸è§é—®é¢˜FAQ

### Q1: JSONæ–‡ä»¶ä¸æ”¯æŒæ³¨é‡Šæ€ä¹ˆåŠï¼Ÿ

**ç­”æ¡ˆ**ï¼šä½¿ç”¨å…ƒæ•°æ®å­—æ®µ

```json
{
  "_comment": "è¿™æ˜¯æ³¨é‡Šå†…å®¹",
  "price": 100
}
```

æˆ–ä½¿ç”¨JSONCï¼ˆå¸¦æ³¨é‡Šçš„JSONï¼‰åº“ã€‚

---

### Q2: é…ç½®æ–‡ä»¶è¿‡å¤§å¯¼è‡´åŠ è½½æ…¢ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ‹†åˆ†é…ç½®æ–‡ä»¶ï¼ˆæŒ‰æ¨¡å—ï¼‰
2. å»¶è¿ŸåŠ è½½ï¼ˆä»…åŠ è½½éœ€è¦çš„é…ç½®ï¼‰
3. ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ï¼ˆå¦‚MessagePackï¼‰

---

### Q3: å¦‚ä½•é˜²æ­¢ç©å®¶ç¯¡æ”¹é…ç½®æ–‡ä»¶ï¼Ÿ

**ç­”æ¡ˆ**ï¼š
- é…ç½®æ–‡ä»¶åœ¨æœåŠ¡ç«¯ï¼Œç©å®¶æ— æ³•è®¿é—®
- å®¢æˆ·ç«¯MODçš„é…ç½®å¯ä»¥ä½¿ç”¨MD5æ ¡éªŒ

```python
import hashlib

def VerifyConfigIntegrity(self, configPath):
    """éªŒè¯é…ç½®æ–‡ä»¶å®Œæ•´æ€§"""
    with open(configPath, 'rb') as f:
        content = f.read()
        md5 = hashlib.md5(content).hexdigest()

    expectedMD5 = "abc123..."  # é¢„æœŸçš„MD5å€¼
    if md5 != expectedMD5:
        print("[Warning] é…ç½®æ–‡ä»¶è¢«ç¯¡æ”¹!")
        return False

    return True
```

---

### Q4: é…ç½®çƒ­æ›´æ–°åæ•°æ®ä¸ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ

**ç­”æ¡ˆ**ï¼šä½¿ç”¨äº‹åŠ¡æœºåˆ¶

```python
def ReloadConfig(self, configName):
    """åŸå­æ€§é‡æ–°åŠ è½½é…ç½®"""
    # åŠ è½½æ–°é…ç½®åˆ°ä¸´æ—¶å˜é‡
    newConfig = self._LoadFromFile(configName)

    # éªŒè¯æ–°é…ç½®
    if not self._ValidateConfig(newConfig):
        print("[Error] æ–°é…ç½®éªŒè¯å¤±è´¥,æ”¾å¼ƒæ›´æ–°")
        return False

    # åŸå­æ›¿æ¢
    self.configs[configName] = newConfig
    return True
```

---

### Q5: å¦‚ä½•ç®¡ç†å¤šè¯­è¨€é…ç½®ï¼Ÿ

**ç­”æ¡ˆ**ï¼šä½¿ç”¨è¯­è¨€ä»£ç ä½œä¸ºKey

```json
{
  "items": [
    {
      "id": "shop_sword_001",
      "name": {
        "zh_CN": "é’»çŸ³å‰‘",
        "en_US": "Diamond Sword",
        "ja_JP": "ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®å‰£"
      },
      "description": {
        "zh_CN": "é”‹åˆ©æ— æ¯”çš„é’»çŸ³å‰‘",
        "en_US": "A sharp diamond sword"
      }
    }
  ]
}
```

```python
def GetItemName(self, item, language='zh_CN'):
    """è·å–å•†å“åç§°ï¼ˆå¤šè¯­è¨€ï¼‰"""
    names = item.get('name', {})
    return names.get(language, names.get('zh_CN', 'æœªçŸ¥å•†å“'))
```

---

## ğŸ“š æ¨èé˜…è¯»

å®Œæˆæœ¬æ–‡æ¡£å­¦ä¹ åï¼Œå»ºè®®ç»§ç»­é˜…è¯»ï¼š

- [æ•°æ®æŒä¹…åŒ–æŒ‡å—.md](æ•°æ®æŒä¹…åŒ–æŒ‡å—.md) - é…ç½®æŒä¹…åŒ–å­˜å‚¨
- [ä¸šåŠ¡ç³»ç»Ÿå®ç°æ¡ˆä¾‹.md](ä¸šåŠ¡ç³»ç»Ÿå®ç°æ¡ˆä¾‹.md) - é…ç½®åœ¨å®æˆ˜ä¸­çš„åº”ç”¨
- [å¼€å‘è§„èŒƒ.md](å¼€å‘è§„èŒƒ.md) - é…ç½®ç®¡ç†å¼€å‘è§„èŒƒ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-01-11
**è´¡çŒ®è€…**: NeteaseMod-Claudeå·¥ä½œæµå›¢é˜Ÿ

**çŸ¥è¯†æ¥æºå£°æ˜**ï¼š
æœ¬æ–‡æ¡£åŸºäºä»¥ä¸‹åˆæ³•æ¥æºç¼–å†™ï¼š
- âœ… Python 2.7æ ‡å‡†åº“æ–‡æ¡£ï¼ˆjsonã€csvã€osæ¨¡å—ï¼‰
- âœ… é€šç”¨è½¯ä»¶å·¥ç¨‹é…ç½®ç®¡ç†æœ€ä½³å®è·µï¼ˆå¦‚ç‰ˆæœ¬æ§åˆ¶ã€çƒ­æ›´æ–°ã€è¿ç§»ç­–ç•¥ç­‰ï¼‰
- âœ… JSON/CSVæ•°æ®æ ¼å¼è§„èŒƒ

æ‰€æœ‰ä»£ç ç¤ºä¾‹å‡ä¸ºç‹¬ç«‹è®¾è®¡ï¼Œæœªå¼•ç”¨ä»»ä½•éå®˜æ–¹ä»£ç å®ç°ã€‚
