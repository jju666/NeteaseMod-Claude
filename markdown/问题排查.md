# 问题排查指南

> **📍 导航**: [🏠 首页](../README.md) > [📂 文档](../README.md#文档导航) > 问题排查
>
> 🔧 常见问题解决方案、调试技巧和性能优化建议
>
> **📅 最后更新**: 2025-01-09

---

## 📋 目录

1. [常见问题（FAQ）](#常见问题faq)
2. [调试技巧](#调试技巧)
3. [网易引擎限制](#网易引擎限制)
4. [性能问题](#性能问题)

---

## 常见问题（FAQ）

### 问题1：导入错误 - 找不到模块

**症状**：`ImportError: No module named 'XXX'`

**解决方案**：

1. **检查modConfig.py中的系统路径是否正确**
   - 服务端系统：`"Script_NeteaseMod.systems.XXXSystem.XXXSystem"`
   - 客户端系统：`"Script_NeteaseMod.systems.XXXClientSystem.XXXClientSystem"`

2. **确认文件名和类名匹配**（Python 2.7区分大小写）

3. **检查所有包目录都有`__init__.py`文件**

---

### 问题2：实体无法交互

**症状**：创建的实体在游戏中无响应

**解决方案**：

1. **检查实体是否在正确的维度创建**
   ```python
   # 确保维度ID正确
   dimension_id = 0  # 主世界
   entity_comp.CreateEntity({
       "itemName": "minecraft:zombie",
       "pos": (100, 64, 100),
       "dimensionId": dimension_id
   })
   ```

2. **验证实体类型名称是否正确**
   ```python
   # 使用正确的实体标识符
   "itemName": "minecraft:zombie"  # 原版实体
   "itemName": "namespace:custom_entity"  # 自定义实体
   ```

3. **检查实体组件是否正确初始化**

---

### 问题3：配置文件读取失败

**症状**：JSON配置无法加载，报语法错误

**解决方案**：

1. 使用JSON验证工具检查格式
2. 注意JSON语法：不支持末尾逗号，字符串必须用双引号，不支持注释
3. 配置文件路径使用绝对路径或相对路径

---

### 问题4：客户端事件无法接收

**症状**：服务端发送的事件客户端收不到

**解决方案**：

1. 检查事件名称在服务端和客户端是否一致
2. 验证客户端系统是否在`modConfig.py`中注册
3. 确认使用了正确的发送方法：
   - 单个玩家：`self.NotifyToClient(player_id, event_name, data)`
   - 所有玩家：`self.BroadcastToAllClient(event_name, data)`

---

### 问题5：TypeError: 'module' object is not callable

**症状**：启动时报错`TypeError: 'module' object is not callable`

**原因**：模块导入方式错误

**解决方案**：⚠️ **使用`from ... import ...`而不是`import module`**

详见 [开发规范 - 模块导入规范](./开发规范.md#模块导入规范-critical)

[⬆️ 返回目录](#目录)

---

## 调试技巧

### 1. 使用print()输出日志

```python
# 推荐的日志格式
print("[INFO] [系统名] 消息内容")
print("[ERROR] [系统名] 错误信息")
print("[DEBUG] [系统名] 调试信息")
```

### 2. 日志输出位置

- **游戏日志**：网易MC客户端的日志目录
- **控制台输出**：游戏运行时的控制台窗口

### 3. 异常捕获

```python
try:
    # 你的代码
    pass
except Exception as e:
    print("[ERROR] 发生异常:", e)
    import traceback
    traceback.print_exc()
```

[⬆️ 返回目录](#目录)

---

## 网易引擎限制

### 1. Python版本限制
- ✅ 必须兼容Python 2.7
- ❌ 不能使用Python 3专有特性

### 2. 实体标识符限制
- 实体类型名称建议不超过32字符
- 使用小写字母和下划线

### 3. 维度管理限制
- 维度ID必须是整数
- 推荐使用10000以上避免冲突
- 主世界：0，地狱：1，末地：2

### 4. 事件系统限制
- 事件数据必须可序列化（字典、列表、字符串、数字）
- 不能传递对象实例

### 5. 组件限制
- 某些组件在特定维度或游戏模式下可能不可用
- 客户端组件不能在服务端使用，反之亦然

[⬆️ 返回目录](#目录)

---

## 性能问题

### 问题1：Tick性能低

**解决**：使用计数器降低频率

```python
def Update(self):
    self.tick_counter += 1
    if self.tick_counter % 20 == 0:  # 每秒执行一次
        self.expensive_operation()
```

### 问题2：内存泄漏

**解决**：
- 在System的`Destroy()`中取消事件监听
- 手动注册的事件记得在`Destroy()`中取消

### 问题3：大量日志影响性能

**解决**：使用DEBUG开关

```python
DEBUG = False  # 生产环境设为False

if DEBUG:
    print("[DEBUG] 调试信息")
```

---

## 获取帮助

如果以上方法都无法解决问题：

1. 📖 **查看相关文档**：
   - [开发规范](./开发规范.md)
   - [开发指南](./开发指南.md)
   - [CLAUDE.md](../CLAUDE.md)

2. 🔍 **查阅官方文档**：
   - [网易MODSDK Wiki](https://github.com/EaseCation/netease-modsdk-wiki)
   - [基岩版Wiki](https://github.com/Bedrock-OSS/bedrock-wiki)

3. 📝 **记录问题详情**并寻求帮助

[⬆️ 返回目录](#目录)

---

## 📚 相关文档

### 重要参考
- [开发规范](./开发规范.md) - 避免常见错误
- [开发指南](./开发指南.md) - 正确开发方式
- [快速开始](./快速开始.md) - 环境配置问题

### 架构文档
- [CLAUDE.md](../CLAUDE.md) - 核心架构参考

---

**[⬆️ 返回顶部](#问题排查指南)** | **[🏠 返回首页](../README.md)**

---

_最后更新: 2025-01-09 | 文档版本: 3.0 (MODSDK通用版)_
