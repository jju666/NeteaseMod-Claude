# /cc - Claude Code 标准工作流任务执行

## 描述
按照 CLAUDE.md 中的标准工作流程（理解任务 → 查阅文档 → 执行与收尾）分析并执行指定的工作任务。

## 用法
```
/cc <任务描述>
```

## 示例
```
{{EXAMPLE_TASKS}}
```

---

## 任务执行指令

你现在需要按照 [CLAUDE.md](../../CLAUDE.md) 中定义的标准工作流程执行以下任务：

**用户任务**：{{ARGUMENTS}}

---

## 📋 工作流程提醒

### 🎯 步骤1：理解任务

1. **检查历史上下文**：查看 `{{PROJECT_PATH}}/tasks/` 目录，判断是否为继续任务

2. **识别任务类型**：
   - **微任务**：单文件、<20行、无需探索 → 直接执行
   - **标准任务**：2-3文件、需理解交互 → 可选创建tasks目录（5章模板）
   - **复杂任务**：5+文件、架构变更 → 必须创建tasks目录（9章模板）

3. **理解问题现象**：
   - ⚠️ **如果任务描述中提到"日志"或"错误"**，则按以下优先级查阅日志文件：
{{LOG_FILES}}
   - 使用 Grep/Read 查看相关代码
   - 分析调用链和数据流

4. **标记文档类型**：根据问题性质标记需要查阅的文档

---

### 📚 步骤2：查阅文档 ⭐ 核心步骤

按优先级查阅文档：

1. **markdown/开发规范.md** - 检查是否违反CRITICAL规范（最高优先级）
   - 使用Grep搜索关键词，定位相关规范
   - 详细阅读并提取原则

2. **markdown/问题排查.md** - 查找是否为已知问题
   - 搜索相似问题描述
   - 如找到，直接使用解决方案

3. **Systems文档** - 系统实现文档
   - 路径：`markdown/systems/`
   - 查阅相关系统的技术文档

{{ARCHITECTURE_DOCS_SECTION}}{{BUSINESS_DOCS_SECTION}}

4. **官方MODSDK文档** - 遇到不熟悉的API时查阅 ⭐
   - **GitHub仓库**: https://github.com/EaseCation/netease-modsdk-wiki
   - **何时查阅**：
     - ❌ 本地文档不足：markdown/目录未找到相关API说明
     - 🔍 遇到不熟悉的API：不确定API参数、返回值、使用方式
     - 🐛 需要查询最新文档：确认API是否有更新

   - **查阅方式**（使用WebFetch工具）：
     ```python
     # 示例1：查询API用法
     WebFetch(
         url="https://raw.githubusercontent.com/EaseCation/netease-modsdk-wiki/main/docs/mcdocs/1-ModAPI/...",
         prompt="提取[API名称]的使用说明、参数定义和返回值"
     )

     # 示例2：查询事件说明
     WebFetch(
         url="https://raw.githubusercontent.com/EaseCation/netease-modsdk-wiki/main/docs/mcdocs/1-ModAPI/...",
         prompt="提取[事件名称]的触发时机、参数和使用示例"
     )
     ```

5. **基岩版Wiki** - 涉及原版实体/物品/NBT时查阅 ⭐
   - **GitHub仓库**: https://github.com/Bedrock-OSS/bedrock-wiki
   - **何时查阅**：
     - 🎮 涉及原版实体、物品、方块时
     - 📦 NBT数据结构相关问题时
     - ⚙️ 需要了解原版游戏机制时

   - **查阅方式**（使用WebFetch工具）：
     ```python
     # 示例：查询NBT结构
     WebFetch(
         url="https://raw.githubusercontent.com/Bedrock-OSS/bedrock-wiki/main/docs/nbt/...",
         prompt="提取[物品/实体]的NBT字段定义和数据结构"
     )
     ```

**⚠️ 官方文档查阅策略**：
- ✅ **优先使用本地文档**：先查阅 `markdown/` 目录中的文档
- 🌐 **本地不足时查阅官方**：
  - 本地文档未找到相关内容
  - 遇到不熟悉的API或原版机制
  - 需要确认最新的API变更
- 📝 **记录查阅结果**：将WebFetch的查阅结果记录到核心检查点输出中

#### 🔍 文档缺失检测 ⭐ 自学习机制

在查阅文档时，如果发现以下情况：

**场景1：文档不存在**
```python
if 查阅markdown/systems/[system_name].md时发现文档不存在:
    在tasks/[任务名]/实施日志.md中标记:
    "- [ ] 需要创建: systems/[system_name].md"
```

**场景2：文档过于简略（<300字）**
```python
if 文档存在但内容<300字:
    标记: "- [ ] 需要补充: systems/[system_name].md（当前过于简略）"
```

**场景3：缺少关键章节**
```python
if 文档缺少"数据流"或"常见问题"章节:
    标记: "- [ ] 需要补充章节: systems/[system_name].md - [缺失章节名]"
```

**标记格式**：
在 `tasks/[任务名]/实施日志.md` 中添加：
```markdown
## 📝 文档补充标记

- [ ] 需要创建: systems/CombatSystem.md
- [ ] 需要补充: systems/WeaponSystem.md - 数据流章节
- [ ] 需要更新: 问题排查.md - 添加常见问题
```

---

### 🚦 核心检查点（步骤2→3）

**必须输出以下格式**：

```
✅ 检查点完成:

1. 已查阅文档:
   - [文档名 - 章节名] (第X-Y行)
   - [文档名 - 章节名] (第X-Y行)

2. 提取的关键原则:
   ⛔ 禁止: [具体禁止事项，必须来自文档]
   ✅ 应该: [正确做法，必须来自文档]
   📚 原因: [设计原理，必须来自文档]

3. 文档依据清单:
   - [文档名:行号] [简短描述]
   - [文档名:行号] [简短描述]

4. 官方文档查阅（如有）:
   - [GitHub文件路径] - [查阅的API/概念]
   - 提取内容: [关键信息摘要]
   (如未使用WebFetch查阅官方文档，可跳过此项)

{{NBT_CHECK_SECTION}}
```

---

### 🔧 步骤3：执行与收尾

1. **创建任务上下文**（标准/复杂任务）

2. **设计修复方案**（基于文档原则+代码参考）

3. **执行修改**（添加注释说明"为什么"和"参考了哪个实现"）
   ```python
   # 示例注释格式
   # 使用NotifyToClient通信而非GetSystem获取客户端系统
   # 原因:网易引擎的双端隔离原则(开发规范.md:164)
   # 参考:combat_service.py:1869 _send_damage_result方法
   self.NotifyToClient(player_id, "ShowDamageUI", damage_data)
   ```

4. **处理中途反馈**（如用户测试失败，回到步骤3.4）

5. **验证修复**

6. **收尾工作**（⚠️ 用户明确说"已修复"/"已解决"后执行）：

   **① 文档更新** ⭐ 自学习核心:

   ```python
   # 检查文档补充标记
   if 实施日志中存在文档补充标记:
       询问用户: "本次任务发现{N}个文档需要补充，是否现在更新？[Y/n]"

       if 用户确认:
           for 每个标记:
               根据本次任务中对代码的理解，补充对应文档
   ```

   **自动补充策略**：
   - **新建文档**：使用"中等详细度"模板（~1500字），基于本次任务的理解填充
   - **补充章节**：在现有文档中添加新章节，包含本次任务的发现
   - **更新常见问题**：如果修复了BUG，添加到对应文档的"常见问题"章节

   **文档更新示例**：
   ```markdown
   # 示例1: 创建新文档
   如果标记 == "需要创建: systems/CombatSystem.md":
       1. 根据本次任务分析CombatSystem的代码
       2. 生成中等详细度文档（~1500字）:
          - 概述: 基于本次任务理解的业务逻辑
          - 架构: 类结构和主要方法
          - 数据流: 本次任务涉及的数据流
          - 常见问题: 本次任务遇到的问题

   # 示例2: 补充章节
   如果标记 == "需要补充: systems/WeaponSystem.md - 数据流":
       在WeaponSystem.md中添加"## 📊 数据流"章节
       描述本次任务中理解的武器系统数据流

   # 示例3: 更新常见问题
   如果本次任务修复了BUG:
       在对应系统文档的"## ❓ 常见问题"章节添加:
         - 问题描述
         - 根本原因（引用文档原则）
         - 解决方案（代码示例）
         - 相关代码位置
         - 修复时间
   ```

   **更新文档待补充清单**：
   ```python
   # 更新 markdown/文档待补充清单.md
   for 已补充的文档:
       标记为已完成: - [x] systems/[SystemName].md
   ```

   **② DEBUG清理**：
   ```bash
   # 搜索临时调试代码
   Grep pattern="print\(.*\[DEBUG\]|print\(.*临时|print\(.*测试|# TODO.*临时|# DEBUG"

   # 列出所有匹配项，询问用户是否清理
   # 用户确认后，使用Edit删除
   ```

   **③ 归档任务**（标准/复杂任务）：
   - 更新完整上下文.md状态为"已完成"
   - 询问用户是否归档到 `tasks/completed/[YYYY-MM]/`

---

## ⚠️ CRITICAL 规范提醒

{{CRITICAL_RULES}}

---

## 📂 核心路径参考

{{CORE_PATHS}}

---

## 🎯 输出格式建议

在执行过程中，使用清晰的分隔符标记各个步骤：

```
🎯 步骤1: 理解任务
─────────────────
...

📚 步骤2: 查阅文档
─────────────────
📋 检查点: 文档原则提取报告
...

🔧 步骤3: 执行与收尾
─────────────────
...

✅ 完成总结
─────────────────
...
```

---

现在开始执行任务！
