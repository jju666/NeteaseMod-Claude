# 安装与配置

> **基于Claude的MODSDK开发工作流 - 快速部署指南**
>
> 一次安装，全局可用

---

## 🎯 目标

完成安装后，你可以在**任意MODSDK项目**中使用`/initmc`命令，自动部署完整的AI辅助开发工作流。

---

## 📋 前置要求

### 必需环境
- **Node.js** - 版本 ≥ 12.x（用于运行安装脚本）
- **Claude Code** - AI辅助开发工具
- **Git** - 用于克隆项目

### 验证环境
```bash
# 检查Node.js
node --version
# 应显示: v12.x 或更高版本

# 检查Git
git --version
```

---

## 🚀 快速安装（3步）

### 步骤1: 克隆项目

```bash
# 克隆到你的工作目录（任意位置均可）
cd D:\EcWork  # 或你的工作目录
git clone <项目仓库地址> 基于Claude的MODSDK开发工作流
cd 基于Claude的MODSDK开发工作流
```

### 步骤2: 全局安装

```bash
# 运行全局安装脚本
npm run install-global
```

**安装脚本会自动：**
- 将工作流文件复制到 `~/.claude-modsdk-workflow/`
- 配置全局命令（根据操作系统自动选择方式）

**Windows系统：**
- 创建 `modsdk-deploy.cmd` 到用户目录
- 可能需要手动添加用户目录到PATH（安装脚本会提示）

**Unix/Linux/Mac系统：**
- 添加alias到 `~/.bashrc` 或 `~/.zshrc`
- 需要运行 `source ~/.bashrc` 激活

### 步骤3: 验证安装

```bash
# 验证全局安装
ls ~/.claude-modsdk-workflow/.claude/commands/initmc.md

# Windows:
dir "%USERPROFILE%\.claude-modsdk-workflow\.claude\commands\initmc.md"

# 如果文件存在，说明安装成功
```

---

## ✅ 完成！现在可以初始化项目

您有**两种方式**在MODSDK项目中初始化工作流：

### 方式1: 使用 `/initmc` 命令（推荐 ⭐）

```bash
# 1. 打开任意MODSDK项目
cd <你的MODSDK项目目录>

# 2. 在Claude Code终端中执行
/initmc

# 3. AI会自动：
#    - 分析项目结构
#    - 生成完整文档
#    - 配置AI工作流
```

**优点**：
- ✅ AI自动分析项目结构
- ✅ 智能生成定制化文档
- ✅ 支持交互式配置

### 方式2: 使用 `modsdk-deploy` 命令

```bash
# 1. 打开任意MODSDK项目
cd <你的MODSDK项目目录>

# 2. 执行部署命令
modsdk-deploy

# 3. 然后在Claude Code中运行
/initmc
```

**说明**：
- `modsdk-deploy` 仅复制 `/initmc` 命令文件到项目
- 实际的文档生成和分析由 `/initmc` 完成
- 如果 `modsdk-deploy` 命令不可用，可以直接使用 `/initmc`

**Windows用户注意**：
如果提示 "modsdk-deploy 不是内部或外部命令"，有两种解决方案：
```bash
# 方案1: 直接调用脚本
node "%USERPROFILE%\.claude-modsdk-workflow\bin\quick-deploy.js"

# 方案2: 直接使用 /initmc（推荐）
# 在Claude Code中执行 /initmc 即可，无需 modsdk-deploy
```

---

## 🔍 工作原理

### 全局安装后的文件位置

```
~/.claude-modsdk-workflow/
├── CLAUDE.md                    # 核心工作流配置
├── .claude/                     # Claude Code配置
│   └── commands/
│       └── initmc.md            # /initmc 命令定义
├── markdown/                    # 完整文档库
│   ├── 开发规范.md
│   ├── 问题排查.md
│   ├── 开发指南.md
│   └── ai/                      # AI辅助文档
├── templates/                   # 文档模板
└── bin/                         # 工具脚本
```

### /initmc 命令的工作流程

1. **检测项目**：验证当前目录是否为MODSDK项目（检查`modMain.py`）
2. **分析项目**：扫描Systems、代码结构、项目规模
3. **生成文档**：根据项目特点生成定制化文档
4. **配置工作流**：部署CLAUDE.md和.claude/commands/

---

## 🎯 使用示例

### 场景1: 新建MODSDK项目

```bash
# 1. 创建新项目
cd D:\MyProjects
mkdir MyAwesomeMod
cd MyAwesomeMod

# 2. 创建modMain.py（或从模板复制）
echo "# My MODSDK Project" > modMain.py

# 3. 初始化工作流
/initmc

# 4. 开始开发
/cc 创建一个玩家加入事件监听System
```

### 场景2: 现有MODSDK项目

```bash
# 1. 打开现有项目
cd D:\ExistingProject

# 2. 初始化工作流（会自动分析现有代码）
/initmc

# 3. AI会识别现有的Systems并生成文档
```

---

## 🔧 高级配置

### /initmc 命令参数

```bash
# 基本用法（推荐）
/initmc

# 生成详细文档
/initmc --detail=full

# 完全自动模式（不询问确认）
/initmc --mode=auto

# 覆盖现有文档
/initmc --overwrite
```

### 自定义模板（可选）

如果你想修改生成的文档模板：

```bash
# 1. 找到全局安装目录
cd ~/.claude-modsdk-workflow/templates

# 2. 修改模板文件
# 编辑 CLAUDE.md.template、开发规范.md.template 等

# 3. 重新运行 /initmc 即可使用新模板
```

---

## ❓ 常见问题

### Q1: npm run install-global 失败？

**错误1: 权限不足**
```bash
# Windows: 以管理员身份运行终端
# Linux/Mac: 使用sudo
sudo npm run install-global
```

**错误2: Node.js未安装**
```bash
# 下载并安装Node.js
https://nodejs.org/

# 推荐安装LTS版本
```

### Q2: modsdk-deploy 提示"全局工作流未安装"？（已修复）

**症状**（v1.0版本的BUG）：
```bash
D:\EcWork\NetEaseMapECBedWars>modsdk-deploy

✅ 全局工作流已安装: C:\Users\28114\.claude-modsdk-workflow

📍 部署 /initmc 命令...

❌ 错误: 全局工作流未安装
   请先运行: npm run install-global
```

**原因**：
- `quick-deploy.js` 脚本路径错误（已在 v1.1 修复）
- 原代码检查：`WORKFLOW_HOME/commands/initmc.md`
- 正确路径：`WORKFLOW_HOME/.claude/commands/initmc.md`

**解决方案**：
```bash
# 1. 更新工作流代码（包含修复）
cd D:\EcWork\基于Claude的MODSDK开发工作流
git pull

# 2. 重新全局安装
npm run install-global

# 3. 在目标项目中重新部署
cd <你的MODSDK项目>
modsdk-deploy
# 或直接使用
/initmc
```

**如果无法更新**：
```bash
# 直接使用 /initmc 命令（推荐）
# /initmc 不依赖 modsdk-deploy，可以直接使用
/initmc
```

**修复版本**: 2025-11-10 v1.1

---

### Q2.5: 缺少 /enhance-docs 和 /validate-docs 命令？（已修复）

**症状**（v1.0版本的问题）：
```bash
# /initmc 执行成功，但缺少命令文件
$ ls .claude/commands
cc.md
initmc.md
# 缺少 enhance-docs.md 和 validate-docs.md
```

**原因**：
- 模板目录缺少 `enhance-docs.md.template` 和 `validate-docs.md.template`
- 生成器代码只生成 `cc.md`，未生成其他命令文件

**解决方案**：
```bash
# 1. 更新工作流代码（包含修复）
cd D:\EcWork\基于Claude的MODSDK开发工作流
git pull

# 2. 重新全局安装
npm run install-global

# 3. 在目标项目中重新初始化
cd <你的MODSDK项目>
/initmc --overwrite
```

**手动修复**（如果无法更新）：
```bash
# 从全局目录手动复制命令文件
cp ~/.claude-modsdk-workflow/.claude/commands/enhance-docs.md ./.claude/commands/
cp ~/.claude-modsdk-workflow/.claude/commands/validate-docs.md ./.claude/commands/

# Windows:
copy "%USERPROFILE%\.claude-modsdk-workflow\.claude\commands\enhance-docs.md" ".\.claude\commands\"
copy "%USERPROFILE%\.claude-modsdk-workflow\.claude\commands\validate-docs.md" ".\.claude\commands\"

# 然后重启Claude Code
```

**修复版本**: 2025-11-10 v1.2

---

### Q3: /initmc 命令不可用？

**原因**: Claude Code需要识别 `.claude/commands/initmc.md` 文件

**解决方案1**: 确认全局安装成功
```bash
# 检查文件是否存在
ls ~/.claude-modsdk-workflow/.claude/commands/initmc.md

# Windows:
dir "%USERPROFILE%\.claude-modsdk-workflow\.claude\commands\initmc.md"
```

**解决方案2**: 使用 modsdk-deploy 部署到项目
```bash
# 在项目目录执行
cd <你的MODSDK项目>
modsdk-deploy

# 或直接调用脚本
node "%USERPROFILE%\.claude-modsdk-workflow\bin\quick-deploy.js"

# 然后重启Claude Code
```

**解决方案3**: 手动复制命令文件
```bash
# 复制 .claude 目录到当前项目
cp -r ~/.claude-modsdk-workflow/.claude ./

# Windows:
xcopy /E /I "%USERPROFILE%\.claude-modsdk-workflow\.claude" ".\.claude"
```

### Q4: /initmc 提示"当前目录不是MODSDK项目"？

**原因**: 当前目录缺少`modMain.py`文件

**解决**:
```bash
# 确认你在项目根目录
ls modMain.py

# 如果不存在，创建一个
touch modMain.py
```

### Q5: 已有markdown/目录，会被覆盖吗？

**默认行为**: AI会询问是否备份

```
⚠️  检测到现有文档

发现 markdown/ 目录已存在。

选项:
1. 备份后继续（推荐）
2. 覆盖现有文档（需 --overwrite 参数）
3. 取消操作

是否备份现有文档后继续？[Y/n]
```

### Q6: 安装后如何更新工作流？

```bash
# 1. 拉取最新代码
cd <工作流项目目录>
git pull

# 2. 重新全局安装
npm run install-global

# 3. 在目标项目中重新运行
cd <你的MODSDK项目>
/initmc --overwrite
```

### Q7: 如何卸载？

```bash
# 1. 运行卸载脚本
cd <工作流项目目录>
npm run uninstall

# 2. 手动删除全局目录（可选）
rm -rf ~/.claude-modsdk-workflow

# Windows:
rmdir /S /Q %USERPROFILE%\.claude-modsdk-workflow
```

---

## 🌐 Claude Code配置说明

### 工作流依赖的Claude Code功能

1. **斜杠命令（Slash Commands）**
   - 位置: `.claude/commands/*.md`
   - 功能: 定义自定义命令（如`/initmc`、`/cc`）

2. **项目配置（CLAUDE.md）**
   - 位置: 项目根目录
   - 功能: 指导AI的工作流程和规范

3. **权限配置（.claude/settings.local.json）**
   - 位置: `.claude/settings.local.json`
   - 功能: 配置工具权限（可选）

### 全局vs项目本地

| 配置 | 全局位置 | 项目位置 | 用途 |
|------|---------|---------|------|
| **initmc命令** | `~/.claude-modsdk-workflow/.claude/commands/` | 无 | 全局可用 |
| **cc命令** | 模板 | 项目`.claude/commands/` | 项目专属 |
| **CLAUDE.md** | 模板 | 项目根目录 | 项目专属 |
| **文档库** | `~/.claude-modsdk-workflow/markdown/` | 项目`markdown/` | 各自独立 |

---

## 📖 下一步

安装完成后，建议按以下顺序学习：

1. **[快速开始.md](./markdown/快速开始.md)** - 5分钟了解基本流程
2. **[CLAUDE.md](./CLAUDE.md)** - 理解AI工作流程
3. **在实际项目中试用** - 执行 `/initmc` 并开始开发

---

## 📞 获取帮助

### 文档资源
- **快速入门**: [快速开始.md](./markdown/快速开始.md)
- **工作流详解**: [CLAUDE.md](./CLAUDE.md)
- **开发规范**: [开发规范.md](./markdown/开发规范.md)

### 问题反馈
- GitHub Issues: <项目仓库地址>/issues
- 直接询问Claude: `/cc 我遇到了安装问题：[描述]`

---

## 🎓 设计理念

### 为什么选择全局安装？

**优势**：
- ✅ **一次安装，到处使用** - 避免每个项目重复配置
- ✅ **统一工作流** - 所有项目使用相同的AI规范和文档
- ✅ **便于更新** - 只需在一个地方更新工作流

**原理**：
- 全局目录存储模板和通用文档
- `/initmc`命令根据项目特点生成定制化配置
- 每个项目获得独立的CLAUDE.md和markdown/目录

---

## 📊 安装验证清单

完成安装后，请逐项验证：

### ✅ 环境验证
- [ ] Node.js (≥12.x) 已安装且可用
- [ ] Git 版本控制可用
- [ ] Claude Code 已启动

### ✅ 全局安装验证
- [ ] `npm run install-global` 执行成功
- [ ] `~/.claude-modsdk-workflow/` 目录存在
- [ ] `~/.claude-modsdk-workflow/.claude/commands/initmc.md` 文件存在

### ✅ 命令验证
- [ ] 在任意目录执行 `/initmc` 有响应（即使报错也说明命令可用）
- [ ] 在MODSDK项目目录执行 `/initmc` 能正常运行

### ✅ 功能验证
- [ ] `/initmc` 能分析项目结构
- [ ] 能生成 CLAUDE.md 文件
- [ ] 能生成 markdown/ 目录和文档
- [ ] `/cc` 命令在初始化后可用

---

_最后更新: 2025-11-09 | 文档版本: 2.0_
