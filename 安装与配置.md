# 安装与配置

> **基于Claude的MODSDK开发工作流 - 快速部署指南 v2.0**
>
> 一次安装，到处使用

---

## 🎯 目标

完成安装后，你可以在**任意MODSDK项目**中使用 `initmc` 命令，自动部署完整的AI辅助开发工作流。

---

## 📋 前置要求

### 必需环境
- **Node.js** - 版本 ≥ 12.x（用于运行安装脚本和部署命令）
- **Claude Code** - AI辅助开发工具
- **Git** - 用于克隆项目

### 验证环境
```bash
# 检查Node.js
node --version
# 应显示: v12.x 或更高版本

# 检查Git
git --version
```

---

## 🚀 快速安装（2步）

### 步骤1: 克隆项目

```bash
# 克隆到你的工作目录（任意位置均可）
cd D:\EcWork  # 或你的工作目录
git clone <项目仓库地址> 基于Claude的MODSDK开发工作流
cd 基于Claude的MODSDK开发工作流
```

### 步骤2: 全局安装

```bash
# 安装依赖
npm install

# 运行全局安装脚本
npm run install-global
```

**安装脚本会自动：**
- 将工作流文件复制到 `~/.claude-modsdk-workflow/`
- 通过 `npm link` 注册全局命令 `initmc`

**验证安装：**
```bash
# 检查全局工作流目录
ls ~/.claude-modsdk-workflow/

# Windows:
dir "%USERPROFILE%\.claude-modsdk-workflow\"

# 检查命令是否可用
which initmc  # Unix/Mac
where initmc  # Windows
```

---

## ✅ 使用 initmc 命令部署工作流

### 基本用法

```bash
# 1. 打开任意MODSDK项目根目录（包含 modMain.py 的目录）
cd <你的MODSDK项目目录>

# 2. 执行部署命令
initmc

# 3. 等待部署完成（约10-30秒）

# 4. 重启Claude Code（如果已打开）

# 5. 立即开始开发
/cc 创建一个玩家加入事件监听System
```

### 部署内容

- ✅ **3个命令文件**：
  - `/cc` - 标准工作流任务执行器
  - `/enhance-docs` - 批量补充文档
  - `/validate-docs` - 验证文档完整性

- ✅ **完整的 CLAUDE.md**：
  - 核心规范（CRITICAL规范，防止90%错误）
  - 三步工作流程（理解任务 → 查阅文档 → 执行与收尾）
  - 三级任务分类（微任务/标准任务/复杂任务）

- ✅ **markdown/ 目录**：
  - `开发规范.md` - MODSDK开发规范（34KB）
  - `问题排查.md` - 常见问题和解决方案（21KB）
  - `快速开始.md` - 5分钟快速上手（7KB）
  - `开发指南.md` - 完整开发工作流（20KB）
  - `API速查.md` - 常用API代码片段（15KB）
  - `MODSDK核心概念.md` - System/Component/Event/Entity速查（12KB）

- ✅ **markdown/ai/ 目录**：
  - `任务类型决策表.md` - 任务分级指南
  - `快速通道流程.md` - 微任务流程
  - `上下文管理规范.md` - 模板系统

- ✅ **目录结构**：
  - `tasks/` - 任务上下文管理
  - `markdown/systems/` - 系统文档目录

### 优势

- ✅ **可靠性高** - 不依赖AI理解，使用Node.js脚本直接复制文件
- ✅ **自动验证** - 每个文件复制后验证大小，确保不是空文件
- ✅ **快速部署** - 10-30秒完成（vs 原方案的3-15分钟）
- ✅ **定制化配置** - 自动替换项目路径等占位符
- ✅ **友好的错误提示** - 彩色输出，清晰的错误信息

### 注意事项

- ⚠️ 必须在 MODSDK 项目根目录（包含 `modMain.py` 的目录）执行
- ⚠️ 命令会自动检测并阻止在工作流项目本身执行
- ⚠️ 如果目标目录已有工作流文件，会被覆盖

---

## 📊 部署示例输出

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  MODSDK 工作流部署工具 v2.0
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ℹ️  当前目录: D:\MyProjects\MyMod

✅ 检测到 MODSDK 项目

🔍 检测全局工作流目录...
✅ 找到全局工作流目录: C:\Users\<用户名>\.claude-modsdk-workflow

📋 复制命令文件...
  ✅ enhance-docs.md - 5.3 KB
  ✅ validate-docs.md - 6.6 KB
  ✅ cc.md - 11.6 KB (定制化)

📚 复制通用文档...
  ✅ 开发规范.md - 34.4 KB
  ✅ 问题排查.md - 21.4 KB
  ✅ 快速开始.md - 7.0 KB
  ✅ 开发指南.md - 19.7 KB
  ✅ API速查.md - 14.6 KB
  ✅ MODSDK核心概念.md - 12.0 KB

🤖 复制 AI 辅助文档...
  ✅ 任务类型决策表.md - 5.5 KB
  ✅ 快速通道流程.md - 6.6 KB
  ✅ 上下文管理规范.md - 11.6 KB

⚙️  生成定制化配置...
  ✅ CLAUDE.md - 12.2 KB

📁 创建目录结构...
  ✅ tasks/
  ✅ markdown/systems/

🔍 验证部署结果...
  ✅ .claude/commands/cc.md - 11.6 KB
  ✅ .claude/commands/enhance-docs.md - 5.3 KB
  ✅ .claude/commands/validate-docs.md - 6.6 KB
  ✅ CLAUDE.md - 12.2 KB
  ✅ markdown/开发规范.md - 34.4 KB
  ✅ markdown/问题排查.md - 21.4 KB

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  ✅ 工作流部署完成！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 部署统计:
  ✅ 命令文件: 3 个
  ✅ 通用文档: 6 个
  ✅ AI 文档: 3 个
  ✅ 配置文件: 1 个

📝 后续步骤:
  1. 查阅 CLAUDE.md 了解 AI 工作流程
  2. 使用 /cc "任务描述" 快速创建/继续任务
  3. 查阅 markdown/ 目录下的文档

🎯 可用命令:
  /cc "任务描述" - 快速任务执行器
  /enhance-docs - 批量补充文档
  /validate-docs - 验证文档完整性

🎉 开始高效开发吧！
```

---

## 🔍 工作原理

### 全局安装后的文件位置

```
~/.claude-modsdk-workflow/
├── CLAUDE.md                    # 核心工作流配置（模板）
├── .claude/                     # Claude Code配置
│   └── commands/
│       ├── cc.md                # /cc 命令定义（模板）
│       ├── enhance-docs.md      # /enhance-docs 命令定义
│       ├── validate-docs.md     # /validate-docs 命令定义
│       └── initmc.md            # /initmc 命令定义（已废弃）
├── markdown/                    # 完整文档库
│   ├── 开发规范.md
│   ├── 问题排查.md
│   ├── 开发指南.md
│   ├── 快速开始.md
│   ├── API速查.md
│   ├── MODSDK核心概念.md
│   └── ai/                      # AI辅助文档
│       ├── 任务类型决策表.md
│       ├── 快速通道流程.md
│       └── 上下文管理规范.md
├── scripts/                     # 核心脚本
│   └── initmc.js                # 部署脚本（核心逻辑）
└── bin/                         # 全局命令入口
    └── initmc.js                # initmc 命令入口
```

### initmc 命令的工作流程

1. **检测项目类型**
   - 验证当前目录是否为MODSDK项目（检查 `modMain.py`）
   - 检测是否为工作流项目本身（防止循环部署）

2. **检测全局工作流目录**
   - 查找 `~/.claude-modsdk-workflow/`
   - 如果找不到，提示用户运行 `npm run install-global`

3. **复制命令文件**
   - 创建 `.claude/commands/` 目录
   - 复制 `enhance-docs.md` 和 `validate-docs.md`（完整内容，>5KB）
   - 生成定制化的 `cc.md`（替换项目路径占位符）

4. **复制通用文档**
   - 复制 6 个通用文档到 `markdown/` 目录
   - 复制 3 个AI辅助文档到 `markdown/ai/` 目录
   - 所有文档都验证大小（确保不是空文件）

5. **生成配置文件**
   - 生成定制化的 `CLAUDE.md`（替换项目路径和日期）

6. **创建目录结构**
   - 创建 `tasks/` 目录
   - 创建 `markdown/systems/` 目录

7. **验证部署结果**
   - 检查所有关键文件是否存在
   - 验证文件大小（>1KB，防止空文件）
   - 输出详细的部署报告

---

## ❓ 常见问题

### Q1: 执行 `initmc` 提示 "找不到命令"

**原因**: npm 全局 bin 目录不在 PATH 中

**解决方案**:

**Windows**:
```bash
# 方法1: 检查npm全局目录
npm config get prefix
# 输出示例: C:\Users\<用户名>\AppData\Roaming\npm

# 确保该路径在系统环境变量PATH中

# 方法2: 直接调用脚本
node "%USERPROFILE%\.claude-modsdk-workflow\bin\initmc.js"
```

**Unix/Mac**:
```bash
# 添加到 .bashrc 或 .zshrc
export PATH="$HOME/.npm-global/bin:$PATH"
source ~/.bashrc  # 或 ~/.zshrc
```

### Q2: 执行 `initmc` 提示 "找不到全局工作流目录"

**原因**: 未执行全局安装

**解决方案**:
```bash
cd <工作流项目目录>
npm install
npm run install-global
```

### Q3: 部署后某些命令文件为空或过小

**原因**: 全局工作流目录文件损坏

**解决方案**:
```bash
# 重新执行全局安装
cd <工作流项目目录>
npm run install-global

# 然后重新部署
cd <MODSDK项目目录>
initmc
```

### Q4: 想在工作流项目本身测试 `initmc`

**说明**: 不能在工作流项目本身执行 `initmc`，命令会自动检测并阻止。

**解决方案**: 应该在其他MODSDK项目中测试。

### Q5: 执行 `initmc` 提示 "当前目录不是 MODSDK 项目"

**原因**: 当前目录不包含 `modMain.py` 文件

**解决方案**:
- 确保在 MODSDK 项目根目录执行（包含 `modMain.py` 的目录）
- 如果你的项目结构特殊（如 `modMain.py` 在子目录），需要在正确的目录执行

---

## 🔄 更新工作流

如果工作流项目有更新：

```bash
# 1. 拉取最新代码
cd <工作流项目目录>
git pull

# 2. 安装新依赖（如果有）
npm install

# 3. 重新全局安装
npm run install-global

# 4. 在MODSDK项目中重新部署（可选）
cd <MODSDK项目目录>
initmc
```

---

## 🗑️ 卸载工作流

```bash
# 1. 卸载全局命令
cd <工作流项目目录>
npm run uninstall

# 2. 删除全局工作流目录（可选）
rm -rf ~/.claude-modsdk-workflow

# Windows:
rmdir /s /q "%USERPROFILE%\.claude-modsdk-workflow"
```

---

## 📚 相关文档

- **[CLAUDE.md](./CLAUDE.md)** - 工作流核心配置和使用指南
- **[Claude指令参考.md](./Claude指令参考.md)** - AI指令编写规范
- **[CHANGELOG.md](./CHANGELOG.md)** - 版本更新日志

---

## 🆕 版本更新日志

### v2.0.0 (2025-11-10)

**重大变更**：
- ✅ 使用独立脚本替代 AI 驱动的 `/initmc` slash command
- ✅ 新增全局命令 `initmc`（Node.js脚本）
- ✅ 100% 可靠的文件复制（自动验证，防止空文件）
- ✅ 快速部署（10-30秒 vs 原来的3-15分钟）
- ✅ 废弃 `/initmc` slash command（标记为已废弃）

**文件变更**：
- 新增 `scripts/initmc.js` - 核心部署逻辑
- 新增 `bin/initmc.js` - 全局命令入口
- 修改 `package.json` - 添加 `initmc` bin命令
- 修改 `.claude/commands/initmc.md` - 标记为已废弃
- 完全重写 `安装与配置.md`

---

**版本**: v2.0.0  
**最后更新**: 2025-11-10  
**维护者**: MODSDK Team
